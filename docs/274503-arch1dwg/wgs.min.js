// WGS v0.0.16
//
// Copyright 2017 Autodesk, Inc.
// All rights reserved.
// 
// This computer source code and related instructions and comments are the
// unpublished confidential and proprietary information of Autodesk, Inc.
// and are protected under Federal copyright and state trade secret law.
// They may not be disclosed to, copied or used by any third party without
// the prior written consent of Autodesk, Inc.
var WGS=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){var d,e,f,g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(h,i){"object"===g(b)&&void 0!==a?i(b,c(1)):(e=[b,c(1)],d=i,void 0!==(f="function"==typeof d?d.apply(b,e):d)&&(a.exports=f))}(0,function(a,b){"use strict";function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}function e(a){return isFinite(a=+a)&&0!=a?a<0?-e(-a):Math.log(a+Math.sqrt(a*a+1)):a}function f(a){return["#if defined( USE_SURFACE_ALBEDO_MAP ) || defined( USE_SURFACE_ROUGHNESS_MAP ) || defined( USE_SURFACE_CUTOUT_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_OPAQUE_ALBEDO_MAP ) || defined( USE_OPAQUE_F0_MAP ) || defined( USE_OPAQUE_LUMINANCE_MODIFIER_MAP ) || defined( USE_LAYERED_BOTTOM_F0_MAP ) || defined( USE_LAYERED_F0_MAP ) || defined( USE_LAYERED_DIFFUSE_MAP ) || defined( USE_LAYERED_FRACTION_MAP ) || defined( USE_LAYERED_ROUGHNESS_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_METAL_F0_MAP ) || defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )","#define "+a,"#endif"].join("\n")}function h(a,b,c,d){var e=c?"_v3":"",f=c?"vec3 ":"",g=c?b+" = average("+b+e+");":"",h=d?b+e+" = SRGBToLinear("+b+e+");":"";return["#if defined( USE_"+a.toUpperCase()+"_MAP )","vec2 uv_"+a+"_map = ("+a+"_map_texMatrix * vec3(vUv, 1.0)).xy;",a.toUpperCase()+"_CLAMP_TEST;",f+b+e+" = texture2D("+a+"_map, uv_"+a+"_map).xyz;",h,"if("+a+"_map_invert) "+b+e+" = vec3(1.0) - "+b+e+";",g,"#else",b+" = "+a+";","#endif"].join("\n")}function i(a){var b=a+"_texMatrix",c=a+"_invert";return["#if defined( "+("USE_"+a).toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform bool "+c+";","#endif"].join("\n")}function j(a){var b=a+"_texMatrix",c=a+"_bumpScale",d=a+"_bumpmapType";return["#if defined( "+("USE_"+a).toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform vec2 "+c+";","uniform int "+d+";","#endif"].join("\n")}function k(a){return a.vb?a.vb.length/a.vbstride:a.attributes.positions?a.attributes.positions.count:0}function l(a,b,c){var d,e=a.attributes,f=a.vb||e.position.array,g=a.vb?a.vbstride:3;if(a.vblayout){if(!a.vblayout.position)return;d=a.vblayout.position.offset}else{if(!e.position)return;d=e.position.itemOffset||0}var h=f.length/g;hj||(hj=new qj);for(var i=d,j=0;j<h;j++,i+=g)hj.set(f[i],f[i+1],f[i+2]),c&&hj.applyMatrix4(c),b(hj,j)}function m(a,b){var c,d,e,f=a.attributes;ij||(ij=new qj,jj=new qj,kj=new qj,lj=new qj,mj=new qj,nj=new qj);var g,h=a.vb||f.position.array,i=a.vb||f.normal&&f.normal.array,j=a.vb?a.vbstride:3;if(a.vblayout){if(!a.vblayout.position)return;g=a.vblayout.position.offset}else{if(!f.position)return;g=f.position.itemOffset||0}var k=0,l=a.vblayout?a.vblayout.normal:f.normal||null;l?k=l.offset||l.itemOffset:i=null,!l||3===l.itemSize&&4===l.bytesPerItem||(i=null);var m=a.ib||a.indices||(f.index?f.index.array:null);if(m){var n=a.offsets;n&&0!==n.length||(n=[{start:0,count:m.length,index:0}]);for(var o=0,p=n.length;o<p;++o)for(var q=n[o].start,r=n[o].count,s=n[o].index,t=q,u=q+r;t<u;t+=3){c=s+m[t],d=s+m[t+1],e=s+m[t+2];var v=c*j+g,w=d*j+g,x=e*j+g;if(ij.x=h[v],ij.y=h[v+1],ij.z=h[v+2],jj.x=h[w],jj.y=h[w+1],jj.z=h[w+2],kj.x=h[x],kj.y=h[x+1],kj.z=h[x+2],i){var y=c*j+k,z=d*j+k,A=e*j+k;lj.x=i[y],lj.y=i[y+1],lj.z=i[y+2],mj.x=i[z],mj.y=i[z+1],mj.z=i[z+2],nj.x=i[A],nj.y=i[A+1],nj.z=i[A+2],b(ij,jj,kj,c,d,e,lj,mj,nj)}else b(ij,jj,kj,c,d,e)}}else for(var B=a.vb?a.vb.length/a.vbstride:h.length/3,C=0;C<B;C++){c=3*C,d=3*C+1,e=3*C+2;var v=c*j+g,w=d*j+g,x=e*j+g;if(ij.x=h[v],ij.y=h[v+1],ij.z=h[v+2],jj.x=h[w],jj.y=h[w+1],jj.z=h[w+2],kj.x=h[x],kj.y=h[x+1],kj.z=h[x+2],i){var y=c*j+k,z=d*j+k,A=e*j+k;lj.x=i[y],lj.y=i[y+1],lj.z=i[y+2],mj.x=i[z],mj.y=i[z+1],mj.z=i[z+2],nj.x=i[A],nj.y=i[A+1],nj.z=i[A+2],b(ij,jj,kj,c,d,e,lj,mj,nj)}else b(ij,jj,kj,c,d,e)}}function n(a,b){var c,d,e=a.attributes;oj||(oj=new qj,pj=new qj);var f=2;a.lineWidth&&(f=6);var g=a.ib||a.indices||(e.index?e.index.array:null);if(g){var h=a.vb?a.vb:e.position.array,i=a.vb?a.vbstride:3,j=a.offsets;j&&0!==j.length||(j=[{start:0,count:g.length,index:0}]);for(var k=0,l=j.length;k<l;++k)for(var m=j[k].start,n=j[k].count,o=j[k].index,p=m,q=m+n;p<q;p+=f)c=o+g[p],d=o+g[p+1],oj.x=h[c*i],oj.y=h[c*i+1],oj.z=h[c*i+2],pj.x=h[d*i],pj.y=h[d*i+1],pj.z=h[d*i+2],b(oj,pj,c,d)}else for(var h=a.vb?a.vb:e.position.array,i=a.vb?a.vbstride:3,r=0,s=h.length;r<s;r+=f)c=r,d=r+1,oj.x=h[c*i],oj.y=h[c*i+1],oj.z=h[c*i+2],pj.x=h[d*i],pj.y=h[d*i+1],pj.z=h[d*i+2],b(oj,pj,c,d)}function o(a,b){function c(a,b){var c=0|a.x*j,d=0|a.y*j,e=0|a.z*j,g=f[c];g||(f[c]=g={});var h=g[d];h||(g[d]=h={});var i=h[e];return void 0===i&&(h[e]=i=b),i}function d(a,b){var d=c(a,b);e[b]=d}var e=[],f={},g=1;if(a.boundingBox||b){var h=(new tj).copy(a.boundingBox||b),i=h.size();g=Math.max(i.x,Math.max(i.y,i.z))}var j=65536/g;return Bj(a,d),e}function p(a,b){function c(a,b){d[3*b]=a.x,d[3*b+1]=a.y,d[3*b+2]=a.z}var d=new Float32Array(3*zj(a));return Bj(a,c,b),d}function q(a,b,c,d){function e(a,b){b.x=j[3*a],b.y=j[3*a+1],b.z=j[3*a+2]}function f(a,b,c,d){e(a,m),e(b,n),e(c,q),n.sub(m),q.sub(m),n.cross(q),d.copy(n).normalize()}function g(a,b,c){var e=i[a],g=i[b],h=i[c];if(e!==g&&e!==h&&g!==h){var j=!1;if(e>g){var m=e;e=g,g=m,j=!0}var n=k[e];if(n){var o=n[g];if(void 0===o)n[g]=j?-c-1:c;else{if(d)l.push(a),l.push(b);else{f(a,b,c,r),o<0?f(g,e,i[-o-1],s):f(e,g,i[o],s);var p=r.dot(s);Math.abs(p)<.25&&(l.push(a),l.push(b))}delete n[g]}}else k[e]={},k[e][g]=c}}function h(a,b,c,d,e,f){g(d,e,f),g(e,f,d),g(f,d,e)}if(!a.isLines&&!a.iblines){var i=o(a,c),j=p(a,b),k={},l=[],m=new sj,n=new sj,q=new sj,r=new sj,s=new sj;Aj(a,h);for(var t in k)for(var u in k[t])l.push(parseInt(t)),l.push(parseInt(u));l.length>1&&(a.iblines=new Uint16Array(l.length),a.iblines.set(l))}}function r(){uj||(uj=new b.Matrix4,vj=new b.Ray,wj=new b.Vector3,xj=new b.Vector3,yj=new b.Vector3)}function s(a,c,d){r();var e=a.geometry;if(e){var f=a.material,g=f?f.side:b.FrontSide;uj.getInverse(a.matrixWorld),vj.copy(c.ray).applyMatrix4(uj);var h,i,j=c.precision;rj.enumMeshTriangles(e,function(e,f,k,l,m,n){null!==(h=g===b.BackSide?vj.intersectTriangle(k,f,e,!0):vj.intersectTriangle(e,f,k,g!==b.DoubleSide))&&(h.applyMatrix4(a.matrixWorld),(i=c.ray.origin.distanceTo(h))<j||i<c.near||i>c.far||d.push({distance:i,point:h,face:new b.Face3(l,m,n,b.Triangle.normal(e,f,k)),faceIndex:null,fragId:a.fragId,dbId:a.dbId}))})}}function t(a,c,d){r();var e=a.geometry;if(e){var f=c.linePrecision;a.isWideLine&&a.geometry.lineWidth&&(f=a.geometry.lineWidth);var g=f*f;uj.getInverse(a.matrixWorld),vj.copy(c.ray).applyMatrix4(uj);var h=new b.Vector3,i=new b.Vector3;e instanceof b.BufferGeometry&&rj.enumMeshLines(e,function(b,e){var f,j;vj.distanceSqToSegment(b,e,i,h),h.applyMatrix4(a.matrixWorld),i.applyMatrix4(a.matrixWorld),(j=h.distanceToSquared(i))>g||(f=c.ray.origin.distanceTo(h))<c.near||f>c.far||d.push({distance:f,point:h,face:null,faceIndex:null,fragId:a.fragId,dbId:a.dbId})})}}function u(a,c,d){r();var e=a.geometry;if(e){uj.getInverse(a.matrixWorld),vj.copy(c.ray).applyMatrix4(uj);var f=c.precision,g=c.params.PointCloud.threshold;g||(g=1),g*=Math.max(3,e.pointSize),g/=4,e instanceof b.BufferGeometry&&rj.enumMeshVertices(e,function(b){if(!(vj.distanceToPoint(b)>g)){var e=vj.closestPointToPoint(b);if(null!==e){e.applyMatrix4(a.matrixWorld);var h=c.ray.origin.distanceTo(e);h<f||h<c.near||h>c.far||d.push({distance:h,point:b,face:null,faceIndex:null,fragId:a.fragId,dbId:a.dbId})}}})}}function v(a,b,c){a.isLine||a.isWideLine?t(a,b,c):a.isPoint?u(a,b,c):s(a,b,c)}function w(a,c,d,e){if(a instanceof b.Mesh?v(a,c,d):a.raycast(c,d),!0===e)for(var f=a.children,g=0,h=f.length;g<h;g++)w(f[g],c,d,!0)}function x(a,b,c,d){w(a,b,c,d),c.sort(Dj)}function y(a,b,c){this.geoms=[null],this.numGeomsInMemory=0,this.geomMemory=0,this.gpuMeshMemory=0,this.gpuNumMeshes=0,this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=b,this.geomBoxes=new Float32Array(6*Math.max(1,a+1)),this.disableStreaming=!!c}function z(){Hj||(Hj=new b.Box3)}function A(a,c,d,e){this.frags=a,this.indices=c,this.start=d,this.count=e,this.lastItem=d,this.overrideMaterial=null,this.sortDone=!1,this.numAdded=0,this.avgFrameTime=void 0,this.nodeIndex=void 0,this.boundingBox=new b.Box3,this.boundingBoxHidden=new b.Box3,this.sortObjects=!1,this.sortDone=!1,this.sortByShaderDone=!1,this.depths=null,this.indicesView=null,this.frustumCulled=!0,this.forceVisible=!1,this.renderImmediate=!a.useThreeMesh,this.renderImportance=0,z()}function B(a,b,c,d){var e=!1;return c.getWorldBounds(d,Hj),a&&!b.intersectsBox(Hj)&&(e=!0),e}function C(a,c,d){var e;if(c.array)e=new b.BufferAttribute(c.array,c.itemSize);else{var f=a+"|"+c.bytesPerItem+"|"+c.normalize+"|"+c.isPattern+"|"+c.divisor+"|"+c.offset;if(e=Lj[f])return e;e=new b.BufferAttribute(void 0,c.itemSize),Lj[f]=e}return e.bytesPerItem=c.bytesPerItem,e.normalize=c.normalize,e.isPattern=c.isPattern,d&&(e.divisor=c.divisor),c.array||(c.hasOwnProperty("offset")?e.itemOffset=c.offset:b.warn("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),e}function D(a){var b="";for(var c in a.attributes)b+=c+"|";var d=Mj[b];return d||(d=Object.keys(a.attributes),Mj[b]=d,d)}function E(){Ij=new b.BufferAttribute(void 0,1),Ij.bytesPerItem=2,Jj=new b.BufferAttribute(void 0,1),Jj.bytesPerItem=4,Kj=function(){this.uuid=null,this.name=null,this.id=Nj++,this.attributes={},this.attributesKeys=[],this.drawcalls=[],this.offsets=this.drawcalls,this.boundingBox=null,this.boundingSphere=null,this.numInstances=void 0,this.streamingDraw=!1,this.streamingIndex=!1,this.svfid=void 0,this.vb=null,this.vbbuffer=void 0,this.ib=null,this.ibbuffer=void 0,this.iblines=null,this.iblinesbuffer=void 0,this.vaos=void 0,this.vbNeedsUpdate=!1,this.vbstride=0,this.byteSize=0,this.attributesKeys=void 0,this.__webglInit=void 0},Kj.prototype=Object.create(b.BufferGeometry.prototype),Kj.prototype.constructor=Kj}function F(){return Kj||E(),new Kj}function G(c){var d=c.mesh,e=F();Ki()&&(e.packId=c.packId,e.meshIndex=c.meshIndex),e.byteSize=0,e.vb=d.vb,e.vbbuffer=void 0,e.vbNeedsUpdate=!0,e.byteSize+=d.vb.byteLength,e.vbstride=d.vbstride,d.isLines&&(e.isLines=d.isLines),d.isWideLines&&(e.isWideLines=!0,e.lineWidth=d.lineWidth),d.isPoints&&(e.isPoints=d.isPoints,e.pointSize=d.pointSize),c.is2d&&(e.is2d=!0),e.numInstances=d.numInstances;for(var f in d.vblayout){var g=d.vblayout[f];e.attributes[f]=C(f,g,e.numInstances)}if(a.memoryOptimizedLoading)e.attributes.index=d.indices instanceof Uint32Array?Jj:Ij,e.ib=d.indices,e.ibbuffer=void 0,d.iblines&&(e.attributes.indexlines=d.iblines instanceof Uint32Array?Jj:Ij,e.iblines=d.iblines,e.iblinesbuffer=void 0);else{var h=new b.BufferAttribute(d.indices,1);h.bytesPerItem=d.indices instanceof Uint32Array?4:2,e.addAttribute("index",h)}e.attributesKeys=D(e),e.byteSize+=d.indices.byteLength,e.boundingBox=(new b.Box3).copy(d.boundingBox),e.boundingSphere=(new b.Sphere).copy(d.boundingSphere),e.drawcalls=null,e.offsets=null,c.geometry=e,c.mesh=null}function H(){return Pj++}function I(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=H()}function J(a){a.x=.5*(1+Math.atan2(a.y,a.x)/Math.PI),a.y=.5*(1+a.z),a.z=0}function K(a){var b=2*a.x-1,c=2*a.y-1,d=Math.sin(b*Math.PI),e=Math.cos(b*Math.PI),f=Math.sqrt(1-c*c),g=c;a.x=e*f,a.y=d*f,a.z=g}function L(a,b,c){b[c++]=255&a,b[c++]=a>>8&255,b[c++]=a>>16&255,b[c]=0}function M(a,b){return b.copy(a),b[12]=0,b[13]=0,b[14]=0,b.getInverse(b).transpose()}function N(a,b,c){for(var d=16*a,e=0;e<16;e++)c.elements[e]=b[e+d]}function O(a){for(var b=new Uint16Array(a.length+1),c=0,d=0;d<a.length;d++)b[d]=c,c+=Rj(a[d]);return b[d]=c,b}function P(a,b,c,d){var e=O(a),f=new I;return f.vb=b.vb,f.vbstride=b.vbstride,f.posOffset=b.attributes.position.itemOffset,f.normalOffset=b.attributes.normal?b.attributes.normal.itemOffset:-1,f.matrices=c,f.ranges=e,f.dbIds=d,f}function Q(a,b){b.vb=a.vb,b.attributes.id.array=a.vertexIds,b.needsUpdate=!0}function R(a,c,d,e){var f=P(a,c,d,e),g=new b.Vector3,h=new b.Matrix4;Q(f.run(h,g),c)}function S(a){var c=a+"_texMatrix",d=a+"_invert",e={};return e[a]={type:"t",value:null},e[c]={type:"m3",value:new b.Matrix3},e[d]={type:"i",value:0},e}function T(a){var c=a+"_texMatrix",d=a+"_bumpScale",e=a+"_bumpmapType",f={};return f[a]={type:"t",value:null},f[c]={type:"m3",value:new b.Matrix3},f[d]={type:"v2",value:new b.Vector2(1,1)},f[e]={type:"i",value:0},f}function U(b){a.logger=b}function V(a,c,d){if(!a||!a.colors)return new b.Color(1,0,0);var e=a.colors[c];if(!e)return new b.Color(0,0,0);var f=e.values;if(!f||!f.length)return new b.Color(1,0,0);var g=f[0];return new b.Color(g.r,g.g,g.b)}function W(a,b,c){if(!a||!a.scalars)return c;var d=a.scalars[b];return d?d.values[0]:c}function X(a,b,c){if(!a||!a.booleans)return c;var d=a.booleans;return d?d[b]:c}function Y(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];return e?e.values[0]:d}function Z(a,c,d){var e={bands:0,weights:new b.Vector4(1,1,1,1),frequencies:new b.Vector4(1,1,1,1)};if(!a||!a[c])return e;var f=a[c][d];if(!(f&&f.values&&f.values instanceof Array))return e;var g=f.values;e.bands=g.length/2;for(var h=0;h<e.bands;++h)e.frequencies.setComponent(h,1/g[2*h]),e.weights.setComponent(h,g[2*h+1]);return e}function $(a,b,c,d){if(!a||!a.scalars)return d;var e=a.scalars[b];return e?ca(e.values[0],e.units,c):d}function _(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];return e&&e.connections?e.connections[0]:d}function aa(a){var b=a;return b<=.04045?b/=12.92:b=Math.pow((b+.055)/1.055,2.4),b}function ba(a){var c,d,e;return c=aa(a.r),d=aa(a.g),e=aa(a.b),new b.Color(c,d,e)}function ca(a,c,d){var e=bk[d];e||(e=1,b.warn("Unsupported unit: "+d));var f=bk[c];return f||(f=1,b.warn("Unsupported unit: "+c)),a*e/f}function da(a,c,d){if(0===c){var e=$(a,"bumpmap_Depth",d,0),f=1,g=1;return null!=Y(a,"scalars","texture_RealWorldScale")?f=g=$(a,"texture_RealWorldScale",d,1):(f=$(a,"texture_RealWorldScaleX",d,1),g=$(a,"texture_RealWorldScaleY",d,1)),f=0===f?1:1/f,g=0===g?1:1/g,new b.Vector2(f*e,g*e)}var h=Y(a,"scalars","bumpmap_NormalScale",1);return new b.Vector2(h,h)}function ea(a,b){var c=$(a,"texture_RealWorldOffsetX",b,0),d=$(a,"texture_RealWorldOffsetY",b,0),e=Y(a,"scalars","texture_UOffset",0),f=Y(a,"scalars","texture_VOffset",0),g=1,h=1;null!=Y(a,"scalars","texture_RealWorldScale")?g=h=$(a,"texture_RealWorldScale",b,1):(g=$(a,"texture_RealWorldScaleX",b,1),h=$(a,"texture_RealWorldScaleY",b,1)),g=0===g?1:g,h=0===h?1:h;var i=Y(a,"scalars","texture_UScale",1),j=Y(a,"scalars","texture_VScale",1),k=Y(a,"scalars","texture_WAngle",1);k*=Math.PI/180;var l=Math.cos(k),m=Math.sin(k),n=i/g,o=j/h;return{elements:[l*n,m*n,0,-m*o,l*o,0,-l*n*c+m*o*d+e,-m*n*c-l*o*d+f,1]}}function fa(){var a=[0,128,64,191,32,160,96,223,16,143,80,207,48,175,112,239,8,135,72,199,40,167,103,231,25,151,88,215,56,183,120,250],c=new Uint8Array(a),d=new b.DataTexture(c,32,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);d.generateMipmaps=!1,d.flipY=!1,d.needsUpdate=!0;for(var e,f,g=function(a,b){return Math.atan2(a*b,Math.sqrt(a*a+b*b+1))},h=new Uint8Array(16384),i=0;i<128;++i)for(var j=0;j<128;++j){e=i/128*2-1,f=j/128*2-1,e=Math.min(Math.max(1/128-1,e),1-1/128),f=Math.min(Math.max(1/128-1,f),1-1/128);var k=e-1/128,l=e+1/128,m=f-1/128,n=f+1/128,o=g(l,n)-g(k,n)-g(l,m)+g(k,m);h[128*i+j]=1e6*o}var p=new b.DataTexture(h,128,128,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);p.generateMipmaps=!1,p.flipY=!1,p.needsUpdate=!0,_j={randomNum:d,solidAngle:p}}function ga(){var a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Uint8Array(a),d=new b.DataTexture(c,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);d.generateMipmaps=!1,d.flipY=!1,d.needsUpdate=!0;var e=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],f=new Uint8Array(e),g=new b.DataTexture(f,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);g.generateMipmaps=!1,g.flipY=!1,g.needsUpdate=!0;for(var h,i,j,k,l,m,n,o,p=function(b){return a[b%256]},q=new Array(262144),r=0;r<256;++r)for(o=0;o<256;++o)h=p(o)+r,i=p(h),j=p(h+1),k=p(o+1)+r,l=p(k),m=p(k+1),n=4*(256*r+o),q[n]=i,q[n+1]=j,q[n+2]=l,q[n+3]=m;var s=new Uint8Array(q),t=new b.DataTexture(s,256,256,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0;var u=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],v=new Array(1024);for(o=0;o<256;++o){var w=a[o]%16;v[4*o]=127*u[3*w]+128,v[4*o+1]=127*u[3*w+1]+128,v[4*o+2]=127*u[3*w+2]+128,v[4*o+3]=0}var x=new Uint8Array(v),y=new b.DataTexture(x,256,1,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0,ak={permutation:d,gradient:g,perm2D:t,permGrad:y}}function ha(a,b,c){a[c+"_enable"]=Y(b,"booleans",c+"_enable",0);var d=Z(b,"scalars",c+"_prof");a[c+"_bands"]=d.bands,a[c+"_weights"]=d.weights,a[c+"_frequencies"]=d.frequencies}function ia(a,c){var d=a.materials,e=d[a.userassets[0]],f=e.properties,g=ma(a);if(c){if(!(g?c.isPrismMaterial:c instanceof b.MeshPhongMaterial))return null;c.needsUpdate=!0}else c=g?$j.createPrismMaterial():new b.MeshPhongMaterial;var h,i;if(c.proteinMat=a,c.proteinCategories=e.categories,c.packedNormals=!0,e&&g){c.tag=e.tag,c.prismType=e.definition,void 0===c.prismType&&(c.prismType=""),void 0!==a.IsSingleSided&&!1===a.IsSingleSided&&(c.side=b.DoubleSide);var j=c.mapList;switch(c.transparent=!1,c.envExponentMin=1,c.envExponentMax=512,c.envExponentCount=10,c.surface_albedo=ba(V(f,"surface_albedo",new b.Color(1,0,0))),j.surface_albedo_map=_(f,"colors","surface_albedo",null),c.surface_anisotropy=Y(f,"scalars","surface_anisotropy",0),j.surface_anisotropy_map=_(f,"scalars","surface_anisotropy",null),c.surface_rotation=Y(f,"scalars","surface_rotation",0),j.surface_rotation_map=_(f,"scalars","surface_rotation",null),c.surface_roughness=Y(f,"scalars","surface_roughness",0),j.surface_roughness_map=_(f,"scalars","surface_roughness",null),j.surface_cutout_map=_(f,"textures","surface_cutout",null),j.surface_normal_map=_(f,"textures","surface_normal",null),null!=j.surface_cutout_map&&(c.side=b.DoubleSide,c.transparent=!0),c.prismType){case"PrismOpaque":c.opaque_albedo=ba(V(f,"opaque_albedo",new b.Color(1,0,0))),j.opaque_albedo_map=_(f,"colors","opaque_albedo",null),c.opaque_luminance_modifier=ba(V(f,"opaque_luminance_modifier",new b.Color(0,0,0))),j.opaque_luminance_modifier_map=_(f,"colors","opaque_luminance_modifier",null),c.opaque_f0=Y(f,"scalars","opaque_f0",0),j.opaque_f0_map=_(f,"scalars","opaque_f0",null),c.opaque_luminance=Y(f,"scalars","opaque_luminance",0);break;case"PrismMetal":c.metal_f0=ba(V(f,"metal_f0",new b.Color(1,0,0))),j.metal_f0_map=_(f,"colors","metal_f0",null);break;case"PrismLayered":c.layered_bottom_f0=ba(V(f,"layered_bottom_f0",new b.Color(1,1,1))),j.layered_bottom_f0_map=_(f,"colors","layered_bottom_f0",null),c.layered_diffuse=ba(V(f,"layered_diffuse",new b.Color(1,0,0))),j.layered_diffuse_map=_(f,"colors","layered_diffuse",null),c.layered_anisotropy=Y(f,"scalars","layered_anisotropy",0),j.layered_anisotropy_map=_(f,"scalars","layered_anisotropy",null),c.layered_f0=Y(f,"scalars","layered_f0",0),j.layered_f0_map=_(f,"scalars","layered_f0",null),c.layered_fraction=Y(f,"scalars","layered_fraction",0),j.layered_fraction_map=_(f,"scalars","layered_fraction",null),c.layered_rotation=Y(f,"scalars","layered_rotation",0),j.layered_rotation_map=_(f,"scalars","layered_rotation",null),c.layered_roughness=Y(f,"scalars","layered_roughness",0),j.layered_roughness_map=_(f,"scalars","layered_roughness",null),j.layered_normal_map=_(f,"textures","layered_normal",null);break;case"PrismTransparent":c.transparent_color=ba(V(f,"transparent_color",new b.Color(1,0,0))),c.transparent_distance=Y(f,"scalars","transparent_distance",0),c.transparent_ior=Y(f,"scalars","transparent_ior",0),c.transparent=!0;break;case"PrismWood":ha(c,f,"wood_fiber_cosine"),ha(c,f,"wood_fiber_perlin"),c.wood_fiber_perlin_scale_z=Y(f,"scalars","wood_fiber_perlin_scale_z",0),ha(c,f,"wood_growth_perlin"),c.wood_latewood_ratio=Y(f,"scalars","wood_latewood_ratio",0),c.wood_earlywood_sharpness=Y(f,"scalars","wood_earlywood_sharpness",0),c.wood_latewood_sharpness=Y(f,"scalars","wood_latewood_sharpness",0),c.wood_ring_thickness=Y(f,"scalars","wood_ring_thickness",0),ha(c,f,"wood_earlycolor_perlin"),c.wood_early_color=ba(V(f,"wood_early_color",new b.Color(1,0,0))),c.wood_use_manual_late_color=Y(f,"booleans","wood_use_manual_late_color",0),c.wood_manual_late_color=ba(V(f,"wood_manual_late_color",new b.Color(1,0,0))),ha(c,f,"wood_latecolor_perlin"),c.wood_late_color_power=Y(f,"scalars","wood_late_color_power",0),ha(c,f,"wood_diffuse_perlin"),c.wood_diffuse_perlin_scale_z=Y(f,"scalars","wood_diffuse_perlin_scale_z",0),c.wood_use_pores=Y(f,"booleans","wood_use_pores",0),c.wood_pore_type=Y(f,"choicelists","wood_pore_type",0),c.wood_pore_radius=Y(f,"scalars","wood_pore_radius",0),c.wood_pore_cell_dim=Y(f,"scalars","wood_pore_cell_dim",0),c.wood_pore_color_power=Y(f,"scalars","wood_pore_color_power",0),c.wood_pore_depth=Y(f,"scalars","wood_pore_depth",0),c.wood_use_rays=Y(f,"booleans","wood_use_rays",0),c.wood_ray_color_power=Y(f,"scalars","wood_ray_color_power",0),c.wood_ray_seg_length_z=Y(f,"scalars","wood_ray_seg_length_z",0),c.wood_ray_num_slices=Y(f,"integers","wood_ray_num_slices",0),c.wood_ray_ellipse_z2x=Y(f,"scalars","wood_ray_ellipse_z2x",0),c.wood_ray_ellipse_radius_x=Y(f,"scalars","wood_ray_ellipse_radius_x",0),c.wood_use_latewood_bump=Y(f,"booleans","wood_use_latewood_bump",0),c.wood_latewood_bump_depth=Y(f,"scalars","wood_latewood_bump_depth",0),c.wood_use_groove_roughness=Y(f,"booleans","wood_use_groove_roughness",0),c.wood_groove_roughness=Y(f,"scalars","wood_groove_roughness",0),c.wood_diffuse_lobe_weight=Y(f,"scalars","wood_diffuse_lobe_weight",0),c.wood_curly_distortion_enable=Y(f,"booleans","wood_curly_distortion_enable",0),c.wood_curly_distortion_scale=Y(f,"scalars","wood_curly_distortion_scale",0),j.wood_curly_distortion_map=_(f,"scalars","wood_curly_distortion_map",null),ak||ga(),c.uniforms.permutationMap.value=ak.permutation,c.uniforms.gradientMap.value=ak.gradient,c.uniforms.perm2DMap.value=ak.perm2D,c.uniforms.permGradMap.value=ak.permGrad;break;default:b.warn("Unknown prism type: "+c.prismType)}c.enableImportantSampling&&(c.surface_anisotropy||c.surface_rotation||c.layered_anisotropy||c.layered_rotation)&&(_j||fa(),c.uniforms.importantSamplingRandomMap.value=_j.randomNum,c.uniforms.importantSamplingSolidAngleMap.value=_j.solidAngle),c.defines={},c.textureMaps={};for(var k in j)if(j[k]){var l=d[j[k]];i=l.properties;var m="BumpMap"==l.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",n=i.uris[m].values[0];n&&(h={mapName:k,uri:n,textureObj:l,isPrism:!0},c.textureMaps[h.mapName]=h,c.defines["USE_"+k.toUpperCase()]="")}c.defines[c.prismType.toUpperCase()]="","PrismWood"==c.prismType&&c.enable3DWoodBump&&(c.defines.PRISMWOODBUMP=""),c.enableImportantSampling&&(c.defines.ENABLEIMPORTANTSAMPLING="")}else if(e&&!g&&"SimplePhong"==e.definition){c.tag=e.tag,c.proteinType=e.proteinType,void 0===c.proteinType&&(c.proteinType=null);var o=c.ambient=V(f,"generic_ambient"),p=c.color=V(f,"generic_diffuse"),q=c.specular=V(f,"generic_specular"),r=c.emissive=V(f,"generic_emissive");c.shininess=W(f,"generic_glossiness",30),c.opacity=1-W(f,"generic_transparency",0),c.reflectivity=W(f,"generic_reflectivity_at_0deg",0);var s=X(f,"generic_bump_is_normal"),t=W(f,"generic_bump_amount",0);null==t&&(t=1),s?(t>1&&(t=1),c.normalScale=new b.Vector2(t,t)):(t>=1&&(t=.03),c.bumpScale=t);var u=X(f,"generic_is_metal");void 0!==u&&(c.metal=u);var v=X(f,"generic_backface_cull");void 0===v||v||(c.side=b.DoubleSide),c.transparent=e.transparent,c.textureMaps={};var w=e.textures;for(var x in w)if(h={},h.textureObj=d[w[x].connections[0]],i=h.textureObj.properties,h.uri=i.uris.unifiedbitmap_Bitmap.values[0],h.uri){if("generic_diffuse"==x)h.mapName="map",(!c.color||0===c.color.r&&0===c.color.g&&0===c.color.b)&&c.color.setRGB(1,1,1);else if("generic_bump"==x)h.mapName=s?"normalMap":"bumpMap";else if("generic_specular"==x)h.mapName="specularMap";else{if("generic_alpha"!=x)continue;h.mapName="alphaMap",c.side=b.DoubleSide,c.transparent=!0}c.textureMaps[h.mapName]=h}0===p.r&&0===p.g&&0===p.b&&0===q.r&&0===q.g&&0===q.b&&0===o.r&&0===o.g&&0===o.b&&0===r.r&&0===r.g&&0===r.b&&(p.r=p.g=p.b=.4),c.extraDepthOffset=W(f,"generic_depth_offset"),c.extraDepthOffset&&(c.polygonOffset=!0,c.polygonOffsetFactor=c.extraDepthOffset,c.polygonOffsetUnits=0)}else c.ambient=197379,c.color=7829367,c.specular=3355443,c.shininess=30,c.shading=b.SmoothShading;return a.transparent=c.transparent,c}function ja(a,c,d){var e=a.properties;c.clampS=!Y(e,"booleans","texture_URepeat",!1),c.clampT=!Y(e,"booleans","texture_VRepeat",!1),c.wrapS=c.clampS?b.ClampToEdgeWrapping:b.RepeatWrapping,c.wrapT=c.clampT?b.ClampToEdgeWrapping:b.RepeatWrapping,c.matrix=ea(e,d),"UnifiedBitmap"==a.definition&&(c.invert=Y(e,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==a.definition&&(c.bumpmapType=Y(e,"choicelists","bumpmap_Type",0),c.bumpScale=da(e,c.bumpmapType,d))}function ka(a,c){if(a){var d=a.properties;c.invert=X(d,"unifiedbitmap_Invert"),c.clampS=!X(d,"texture_URepeat",!0),c.clampT=!X(d,"texture_VRepeat",!0),c.wrapS=c.clampS?b.ClampToEdgeWrapping:b.RepeatWrapping,c.wrapT=c.clampT?b.ClampToEdgeWrapping:b.RepeatWrapping;var e=W(d,"texture_UScale",1),f=W(d,"texture_VScale",1),g=W(d,"texture_UOffset",0),h=W(d,"texture_VOffset",0),i=W(d,"texture_WAngle",0);c.matrix={elements:[Math.cos(i)*e,Math.sin(i)*f,0,-Math.sin(i)*e,Math.cos(i)*f,0,g,h,1]}}}function la(a,c,d,e){"bumpMap"==a.mapName||"normalMap"==a.mapName?c.anisotropy=0:c.anisotropy=e||0,c.flipY=void 0===a.flipY||a.flipY,c.invert=!1,c.wrapS=b.RepeatWrapping,c.wrapT=b.RepeatWrapping,a.isPrism?ja(a.textureObj,c,d):ka(a.textureObj,c)}function ma(a){var b=a.materials,c=b[a.userassets[0]];if(c){var d=c.definition;return"PrismLayered"==d||"PrismMetal"==d||"PrismOpaque"==d||"PrismTransparent"==d||"PrismWood"==d}return!1}function na(a,c){var d=new b.MeshPhongMaterial;d.packedNormals=!0,d.textureMaps={};var e=a.values,f=e.diffuse;if(f)if(Array.isArray(f))d.color=new b.Color(f[0],f[1],f[2]);else if("string"==typeof f){d.color=new b.Color(1,1,1);var g={};g.mapName="map";var h=c.gltf.textures[f];g.uri=h.source,g.flipY=!1,d.textureMaps[g.mapName]=g}var i=e.specular;return i&&(d.specular=new b.Color(i[0],i[1],i[2])),e.shininess&&(d.shininess=e.shininess),d.reflectivity=0,d.transparent=!1,d}function oa(a){return.299*a.r+.587*a.g+.114*a.b}function pa(a,c,d){var e=a.proteinMat?a.proteinMat:null,f=a.prismType&&-1!==a.prismType.indexOf("Prism");if(f&&a.transparent&&(a.side===b.FrontSide&&(a.side=b.DoubleSide),a.side===b.DoubleSide&&a.depthTest&&(a.twoPassTransparency=!0)),!c){var g=a.proteinType&&-1!==a.proteinType.indexOf("Prism");if(a.metal)a.reflectivity||(a.reflectivity=oa(a.specular)),e&&(1===a.reflectivity&&(a.reflectivity=oa(a.specular)),0===a.color.r&&0===a.color.g&&0===a.color.b||(a.color.r*=.1,a.color.g*=.1,a.color.b*=.1));else if(g){var h=!1;if("PrismLayered"===a.proteinType){a.clearcoat=!0,a.reflectivity=.06;var i=a.proteinCategories;i&&i.length&&-1!=i[0].indexOf("Metal")&&(h=!0)}a.reflectivity=Math.sqrt(a.reflectivity),h?a.specular.copy(a.color):(a.specular.r=a.reflectivity,a.specular.g=a.reflectivity,a.specular.b=a.reflectivity)}else a.reflectivity?a.reflectivity>.3?(a.metal=!0,a.specular.r=a.color.r,a.specular.g=a.color.g,a.specular.b=a.color.b,a.color.r*=.1,a.color.g*=.1,a.color.b*=.1):(a.specular.r*=a.reflectivity,a.specular.g*=a.reflectivity,a.specular.b*=a.reflectivity):1!==a.color.r||1!==a.color.g||1!==a.color.b||1!==a.specular.r||1!==a.specular.g||1!==a.specular.b||a.textureMaps&&(a.textureMaps.map||a.textureMaps.specularMap)?(a.reflectivity=.01+.06*oa(a.specular),a.specular.r*=a.reflectivity,a.specular.g*=a.reflectivity,a.specular.b*=a.reflectivity):(a.metal=!0,a.reflectivity=.7,a.color.r*=.1,a.color.g*=.1,a.color.b*=.1),a.opacity<1&&(a.reflectivity=1);(a.transparent||a.textureMaps&&(a.textureMaps.map&&-1!==a.textureMaps.map.uri.toLowerCase().indexOf(".png")||a.textureMaps.alphaMap))&&(a.alphaTest=.01)}if(a.textureMaps&&a.textureMaps.normalMap){var j=a.bumpScale;(void 0===j||j>=1)&&(j=1),a.normalScale=new b.Vector2(j,j)}else void 0===a.bumpScale&&a.textureMaps&&(a.textureMaps.map||a.textureMaps.bumpMap)?a.bumpScale=.03:a.bumpScale>=1&&(a.bumpScale=.03);if((!c||f)&&a.transparent)if(f)a.lmv_depthWriteTransparent=!0,a.depthWrite=!!d;else if(a.opacity>=1){var k=a.textureMaps&&a.textureMaps.alphaMap;k||(a.transparency=!1)}else a.lmv_depthWriteTransparent=!0,a.depthWrite=!!d;void 0!==a.shininess&&(a.shininess*=.25)}function qa(a,c){c.attributes.color&&(a.vertexColors=b.VertexColors,a.needsUpdate=!0),!a.proteinType&&c.attributes.uv&&c.attributes.uv.isPattern&&(a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0),a.textureMaps&&a.textureMaps.map&&!a.textureMaps.bumpMap&&(a.textureMaps.bumpMap=a.textureMaps.map,a.needsUpdate=!0),a.bumpScale=.03)}function ra(a,b,c){var d=a.slots[c];d?-1==d.indexOf(b)&&d.push(b):a.slots[c]=[b]}function sa(a,b,c){var d=a.slots[c];d=d.filter(function(a){return a!=b}),0==d.length?delete a.slots[c]:a.slots[c]=d}function ta(a){return a.isLines?kk.LINES:a.isPoints?kk.POINTS:a.isWideLines?kk.WIDE_LINES:kk.TRIANGLES}function ua(a,b){switch(!0===a.isLines&&(a.isLines=void 0),!0===a.isWideLines&&(a.isWideLines=void 0),
!0===a.isPoints&&(a.isPoints=void 0),b){case kk.LINES:a.isLines=!0;break;case kk.WIDE_LINES:a.isWideLines=!0;break;case kk.POINTS:a.isPoints=!0}}function va(a){this.geoms=[],this.matrices=[],this.vertexCount=0,this.material=a,this.fragIds=[],this.worldBox=new b.Box3}function wa(a,c){a.vb&&a.vbstride||b.warn("copyVertexFormat() supports only interleaved buffers");for(var d in a.attributes)c.attributes[d]=a.attributes[d];c.attributesKeys=a.attributesKeys.slice(0),c.vbstride=a.vbstride}function xa(a,b){ua(b,ta(a)),b.lineWidth=a.lineWidth,b.pointSize=a.pointSize}function ya(a){for(var c=a[0].vbstride,d=0,e=0,f=0,g=0;g<a.length;g++){var h=a[g];d+=a[g].ib.length,e+=gk(h),a[g].iblines&&(f+=a[g].iblines.length)}var i=F();i.vb=new Float32Array(e*c),i.ib=new Uint16Array(d),f&&(i.iblines=new Uint16Array(f)),i.byteSize=i.vb.byteLength+i.ib.byteLength,i.iblines&&(i.byteSize+=i.iblines.byteLength),xa(a[0],i),wa(a[0],i);var j=new b.BufferAttribute(null,3);j.normalize=!0,j.bytesPerItem=1,i.addAttribute("id",j);var k=a[0];return ua(i,ta(k)),k.isPoints&&(i=k.pointSize),k.isWideLines&&(i=k.lineWidth),i}function za(a,b){for(var c=0,d=0,e=0,f=0,g=0;g<a.length;g++){for(var h=a[g],i=gk(h),j=0;j<h.ib.length;j++)b.ib[e+j]=h.ib[j]+d;if(h.iblines){for(var j=0;j<h.iblines.length;j++)b.iblines[f+j]=h.iblines[j]+d;f+=h.iblines.length}b.vb.set(h.vb,c),c+=h.vb.length,d+=i,e+=h.ib.length}}function Aa(a,b,c,d,e){var f=ya(a);return f.boundingBox=d.clone(),za(a,f),e?e.addMergeTask(a,f,b,c):hk(a,f,b,c),f}function Ba(a,b){if(a.vbstride!=b.vbstride)return!1;if(ta(a)!==ta(b))return!1;if(a.isPoints&&a.pointSize!==b.pointSize)return!1;if(a.isWideLines&&a.lineWidth!==b.lineWidth)return!1;if(a.attributesKeys.length!=b.attributesKeys.length)return!1;for(var c=0,d=a.attributesKeys.length;c<d;c++){var e=a.attributesKeys[c],f=a.attributes[e],g=b.attributes[e];if(!g)return!1;if(f===g)return!0;if(f.itemOffset!==g.itemOffset||f.normalize!==g.normalize||f.itemSize!==g.itemSize||f.bytesPerItem!==g.bytesPerItem||f.isPattern!==g.isPattern)return!1}return!0}function Ca(a){this.meshes=[],this.fragId2MeshIndex=new Int32Array(a);for(var b=0;b<this.fragId2MeshIndex.length;b++)this.fragId2MeshIndex[b]=-1;this.byteSize=0,this.consolidationMap=null}function Da(){this.buckets={},this.bucketCount=0,this.costs=0}function Ea(a,b){this.fragOrder=new Uint32Array(a),this.ranges=new Uint32Array(b),this.boxes=new Array(b),this.numConsolidated=-1}function Fa(a){ik.createWorker=a}function Ga(){return!!ik.createWorker}function Ha(a,c){function d(a,b,c,d){i.compose(b,c,d);for(var e=a.elements,f=i.elements,g=0;g<16;g++){var h=e[g],j=f[g];if(Math.abs(j-h)>1e-5)return!1}return!0}var e=F();e.ib=a.ib,e.vb=a.vb,e.iblines=a.iblines,wa(a,e),xa(a,e);this.offsets=new Float32Array(3*c),this.rotations=new Float32Array(4*c),this.scalings=new Float32Array(3*c),this.ids=new Uint8Array(3*c);var f=new b.Vector3,g=new b.Quaternion,h=new b.Vector3,i=new b.Matrix4,j=0,k=c;this.addInstance=function(a,c){return j>=k?(b.warn("Instance buffer is already full."),!1):(a.decompose(f,g,h),!!d(a,f,g,h)&&(this.offsets[3*j]=f.x,this.offsets[3*j+1]=f.y,this.offsets[3*j+2]=f.z,this.rotations[4*j]=g.x,this.rotations[4*j+1]=g.y,this.rotations[4*j+2]=g.z,this.rotations[4*j+3]=g.w,this.scalings[3*j]=h.x,this.scalings[3*j+1]=h.y,this.scalings[3*j+2]=h.z,L(c,this.ids,3*j),j++,!0))},this.finish=function(){if(0==j)return null;j<k&&(this.offsets=new Float32Array(this.offsets.buffer,0,3*j),this.rotations=new Float32Array(this.rotations.buffer,0,4*j),this.scalings=new Float32Array(this.scalings.buffer,0,3*j),this.ids=new Uint8Array(this.ids.buffer,0,3*j));var a=new b.BufferAttribute(this.offsets,3),c=new b.BufferAttribute(this.rotations,4),d=new b.BufferAttribute(this.scalings,3),f=new b.BufferAttribute(this.ids,3);return f.normalize=!0,f.bytesPerItem=1,a.divisor=1,c.divisor=1,d.divisor=1,f.divisor=1,e.addAttribute("instOffset",a),e.addAttribute("instRotation",c),e.addAttribute("instScaling",d),e.addAttribute("id",f),e.numInstances=j,e.byteSize=e.vb.byteLength+e.ib.byteLength+this.offsets.byteLength+this.rotations.byteLength+this.scalings.byteLength,e}}function Ia(a){var c=new b.PlaneBufferGeometry(1,1);if(c.attributes.index.array.reverse)c.attributes.index.array.reverse();else for(var d,e=c.attributes.index.array,f=Math.floor(e.length/2),g=0,h=e.length;g<f;++g)d=e[g],e[g]=e[h-1-g],e[h-1-g]=d;return new b.Mesh(c,a)}function Ja(){this.shadowMap=void 0,this.shadowMapSize=void 0,this.shadowMatrix=void 0,this.shadowLightDir=void 0,this.init=function(a){this.shadowMap=a,this.shadowMapSize=new b.Vector2(a.width,a.height),this.shadowMatrix=new b.Matrix4,this.shadowLightDir=new b.Vector3},this.apply=function(a){a.shadowMap=this.shadowMap,a.shadowMatrix=this.shadowMatrix,a.shadowLightDir=this.shadowLightDir,this.shadowMap?(xi.setMacro(a,"USE_SHADOWMAP"),Ck.UseHardShadows&&xi.setMacro(a,"USE_HARD_SHADOWS")):(xi.removeMacro(a,"USE_SHADOWMAP"),xi.removeMacro(a,"USE_HARD_SHADOWS"))}}function Ka(a){function c(a,b){a.forEach(function(a){b.apply(a)})}function d(a){var c=new b.WebGLRenderTarget(a,a,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,type:b.FloatType,stencilBuffer:!1,generateMipmaps:!1});return c.generateMipmaps=!1,c}function e(a){n.setRenderTarget(a),n.setClearColor(m,1),n.clear()}function f(a){var b=i.shadowMap;i.shadowMap=t,c(a,i),i.apply(o),i.shadowMap=b}function g(a){a.uniforms.shadowMapRangeMin.value=k.near,a.uniforms.shadowMapRangeSize.value=k.far-k.near,a.uniforms.shadowESMConstant.value=Ck.ShadowESMConstant,a.uniforms.shadowMinOpacity.value=Ck.ShadowMinOpacity}function h(a,c,d){var e=d||new b.Vector3;return e.x=1&c?a.max.x:a.min.x,e.y=2&c?a.max.y:a.min.y,e.z=4&c?a.max.z:a.min.z,e}var i=null,j=null,k=new b.OrthographicCamera,l=Math.exp(Ck.ShadowESMConstant),m=Ck.UseHardShadows?new b.Color(1,1,1):new b.Color(l,1,1),n=a,o=null,p=null,q=null,r=xi.createShaderMaterial(zk),s=new Bk;r.getCustomOverrideMaterial=s.getCustomOverrideMaterial;var t=null,u=function(){var a=new b.Matrix4,c=new b.Matrix4,d=new b.Vector3(0,0,0),e=new b.Box3,f=new b.Vector3,g=new b.Vector3;return function(b,h,i){b.position.copy(i),b.lookAt(d),a.makeRotationFromQuaternion(b.quaternion),c.getInverse(a),e.copy(h).applyMatrix4(c),g=e.center(g),f.set(g.x,g.y,e.max.z),f.applyMatrix4(a),b.position.copy(f),g=e.size(g),b.left=-.5*g.x,b.right=.5*g.x,b.bottom=-.5*g.y,b.top=.5*g.y,b.near=0,b.far=g.z,b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),b.updateProjectionMatrix()}}();this.init=function(){i=new Ja,i.init(d(Ck.ShadowMapSize)),j=Ck.BlurShadowMap?new Ai(Ck.ShadowMapSize,Ck.ShadowMapSize,Ck.ShadowMapBlurRadius,1,{type:i.shadowMap.type,format:i.shadowMap.format}):void 0,o=xi.createShaderMaterial(Ak),o.depthWrite=!1,o.transparent=!0,p=yk.createGroundShape(o),q=new b.Scene,q.add(p),this.groundShapeBox=new b.Box3,t=d(1),e(t)},this.init(),this.state=Dk,this.startUpdate=function(a,b,c,d,e){var f=a.getVisibleBounds(!0);return this.beginShadowMapUpdate(c,f,d),a.reset(k,3,!0),this.state=Ek,b=this.continueUpdate(a,b,e)},this.continueUpdate=function(a,b,c){return b=a.renderSome(this.renderSceneIntoShadowMap,b),a.isDone()?(this.state=Fk,this.finishShadowMapUpdate(c)):f(c),b},this.beginShadowMapUpdate=function(a,b,c){u(k,b,c),g(r),s.forEachMaterial(g),Ck.UseHardShadows&&(xi.setMacro(r,"USE_HARD_SHADOWS"),s.forEachMaterial(function(a){xi.setMacro(a,"USE_HARD_SHADOWS")})),e(i.shadowMap),this.renderSceneIntoShadowMap(q)},this.renderSceneIntoShadowMap=function(a){a.overrideMaterial=r,n.render(a,k,i.shadowMap),a.overrideMaterial=null},this.finishShadowMapUpdate=function(a){j&&!Ck.UseHardShadows&&j.render(n,i.shadowMap,i.shadowMap),i.shadowMatrix.multiplyMatrices(k.projectionMatrix,k.matrixWorldInverse),i.shadowMapRangeMin=k.near,i.shadowMapRangeSize=k.far-k.near,i.shadowLightDir.copy(k.position).normalize(),c(a,i),i.apply(o),this.isValid=!0},this.cleanup=function(a){j&&j.cleanup(),i.shadowMap&&i.shadowMap.dispose(),c(a,Gk),r.dispose(),s.dispose(),o.dispose(),p.geometry.dispose()},this.setGroundShadowTransform=function(){return function(a,b,c,d){yk.setGroundShapeTransform(p,a,b,c,d),this.groundShapeBox.setFromObject(p)}}(),this.renderGroundShadow=function(a,b){n.render(q,a,b,!1)},this.expandByGroundShadow=function(){var a=new b.Plane,c=new b.Ray,d=new b.Vector3,e=new b.Vector3,f=new b.Box3;return function(b,g){a.normal.set(0,1,0),a.constant=-b.min.y,c.direction.copy(g).negate().normalize();var i=b.center(d),j=100*i.distanceToSquared(b.min)*100;f.makeEmpty();for(var k=0;k<8;k++){c.origin=h(b,k);var l=c.intersectPlane(a,e);l&&(l.distanceToSquared(i)>=j||f.expandByPoint(l))}b.union(f)}}(),this.getShadowParams=function(){return i},this.getShadowCamera=function(){return k}}function La(a,b,c,d){A.call(this,a,b,c,d),this.visibleStats=0}function Ma(a){function b(a){return a.matrix.elements[2]+a.matrix.elements[12]}for(var c,d=a.getFragmentList(),e=a,f=e.is2d()&&!d.onDemandLoadingEnabled(),g=d.getCount(),h=0,i=[new Int32Array(g)],j=0,k=!1,l=0;l<g;l++)i[0][l]=l;this.calculateFragOrder=function(){if(e.isvizCacheEnabled){var a,b=e.readbackTargetIdCallback(),d={},f=b.width*b.height,h=b.buffer;for(a=0;a<f;a++){var j=h[4*a+2]<<16|h[4*a+1]<<8|h[4*a];16777215!=j&&(d[j]=1+(0|d[j]))}var k=Object.keys(d).sort(function(a,b){return d[b]-d[a]}).map(Number);e.setFastLoadList(k,c);var l=i[0];l.set(k);var m=k.length;for(a=0;a<g;++a)d[a]||(l[m++]=a)}};var m=Kk;a.is2d()&&(m/=3),Ei()&&(m/=3,a.is2d()&&(m/=2)),m=Math.floor(m);var n=m>0?m:Kk,o=Math.floor((g+n-1)/n),p=d.onDemandLoadingEnabled(),q=p?La:A,r=new Array(o);for(l=0;l<o;l++){var s=l*n,t=r[l]=new q(d,i,s,n),u=s+n;u>g&&(u=g),t.lastItem=u,p&&t.calculateBounds()}this.addFragment=function(a){if(i[0].length<=a){var b=2*i[0].length;b<=a&&(b=a+1);var c=new Int32Array(b);c.set(i[0]),i[0]=c,this.visibleBoundsDirty=!0}i[0][a]=a;var e=Math.floor(a/n);if(r){var f=r[e];f||(r[e]=f=new q(d,i,e*n,n)),f&&f.onFragmentAdded(a)}},this.getFragmentCount=function(){if(!r)return 0;for(var a=r[r.length-1].lastItem;--a>=0&&!(d.geomids[a]>=0););return a+1},this.reset=function(a,d){j!=b(d)&&(k=!0),j=b(d),c=d,h=0,f&&r[0]&&(r[0].drawEnd=0)},this.getSceneCount=function(){return r.length},this.getGeomScenes=function(){return r},this.done=function(){if(f&&!e.isLoadDone())return!1;var a;return h>=r.length-1&&(!(a=r[h])||a.drawStart>=a.lastItem)},this.nextBatch=function(){if(e.isvizCacheEnabled&&k&&(90==h||400==h||h==this.getSceneCount()-1)&&(h==this.getSceneCount()-1&&e.isLoadDone()&&(k=!1),this.calculateFragOrder(h>=this.getSceneCount()-1)),h>=this.getSceneCount())return null;var a=r[h];if(f){if(a.lastItem>=a.start+a.count&&(++h,r[h]&&(r[h].drawEnd=r[h].start)),a.drawStart=a.drawEnd,a.drawEnd=a.lastItem,a.hasOwnProperty("drawStart")&&a.lastItem<=a.drawStart)return null}else++h;return a.renderImportance=0,a},this.getVisibleBounds=function(a,b){for(var c=this.getSceneCount(),d=0;d<c;d++)r[d].calculateBounds(),a.union(r[d].boundingBox),b.union(r[d].boundingBox),b.union(r[d].boundingBoxHidden)},this.rayCast=function(a,b,c){for(var d=this.getSceneCount(),e=0;e<d;e++)r[e].raycast(a,b,c)}}function Na(a,c,d,e){for(var f=new b.Box3,g=new Da,h=0;h<d.length&&!(g.costs>=e);h++){var i=d[h];a.getWorldBounds(i,f);var j=a.getGeometry(i),k=a.getMaterial(i);g.addGeom(j,k,f,i)}return g.createConsolidationMap(d,h)}function Oa(a,b,c,d,e){if(!(d>=c.length)){for(var f=d,g=-1,h=-1,i=d;i<c.length;i++){var j=c[i],k=a.getGeometryId(j),l=a.getMaterialId(j);k==g&&l==h||(i!=d&&Mk(a,b,c,f,i,e),f=i,g=k,h=l)}Mk(a,b,c,f,c.length,e)}}function Pa(a){for(var b=a.getCount(),c=[],d=0;d<b;d++){var e=a.getGeometryId(d),f=0|c[e];c[e]=f+1}return c}function Qa(a,b){function c(c,d){var e=a.getGeometry(c),f=a.getGeometry(d),g=b[e.id],h=b[f.id],i=g*e.byteSize,j=h*f.byteSize;return i!=j?i-j:e.id!=f.id?e.id-f.id:a.getMaterialId(c)-a.getMaterialId(d)}for(var d=0,e=a.getCount(),f=new Int32Array(e),g=0;g<e;g++)a.getGeometry(g)&&(f[d]=g,d++);if(d<e&&(f=new Int32Array(f.buffer,f.byteOffset,d)),f.sort)f.sort(c);else{var h=new Array(e);for(g=0;g<e;g++)h[g]=f[g];for(h.sort(c),g=0;g<f.length;g++)f[g]=h[g]}return f}function Ra(a,b,c,d){for(var e=a.geoms,f=[],g=0,h=0,i=0;i<b.meshes.length;i++){var j=b.meshes[i],k=j.geometry;k.byteSize||(k.byteSize=(k.vb.byteLength||0)+(k.ib.byteLength||0));var l=Number.isInteger(j.fragId);e.chooseMemoryType(k,k.numInstances,g,h),k.streamingDraw||(h+=k.byteSize,g+=1,l||(k.discardAfterUpload=!0)),l&&(f[k.id]=!0)}for(i=1;i<e.geoms.length;i++)if((k=e.geoms[i])&&!f[i]){var m=c[i];e.chooseMemoryType(k,m,g,h),k.streamingDraw&&d.deallocateGeometry(k),k.streamingDraw||(h+=k.byteSize,g+=1)}}function Sa(a,b,c,d,e){var f=d.supportsInstancedArrays();c=c||100<<20;var g=Pa(a);if(!e){e=Na(a,b,Qa(a,g),c)}var h=e.buildConsolidation(a,b,a.model),i=e.fragOrder,j=e.numConsolidated;if(f)Oa(a,b,i,j,h);else for(var k=j;k<i.length;k++){var l=i[k];h.addSingleFragment(a,l)}Ra(a,h,g,d);var m=a.model.getModelId();for(k=0;k<h.meshes.length;k++){h.meshes[k].modelId=m}return h}function Ta(a,c){function d(a){k[a]||(k[a]=new b.Scene);var c=k[a];return c.children.length=0,c}function e(a){return a.numInstances?n.Instanced:a.attributes.id?n.Merged:n.Original}function f(a){if(j)return n.Original;var b=h.fragId2MeshIndex[a];return e(h.meshes[b].geometry)}var g=a,h=c,i=[],j=!1,k=[],l=new b.Matrix4,m=new b.Box3;this.getConsolidation=function(){return h},this.reset=function(){i.length=null;var a=g.getCount();j=!1;for(var b=g.db2ThemingColor.length>0,c=0;c<a;c++){var d=g.vizflags[c],e=0==(d&Vi),f=0!=(d&Xi),h=0!=(d&Yi),k=!1;if(b){var l=g.fragments.fragId2dbId[c];k=!!g.db2ThemingColor[l]}if(e||f||k||h){j=!0;break}}},this.dispose=function(){for(var a=0;a<h.meshes.length;a++){var b=h.meshes[a],c=b.geometry;c&&(c.dispose(),c.needsUpdate=!0)}},this.consolidateNextBatch=function(a,c){var e=a.nodeIndex;if(j||void 0===e)return a;if(h.inProgress)return a;for(var f=d(e),k=a.start;k<a.lastItem;k++){var l=a.indices?a.indices[k]:k,n=h.fragId2MeshIndex[l],o=null;if(-1===n){if(!g.getGeometry(l))continue;return b.warn("Warning: Missing fragment in consolidation. Consolidation disabled."),a}i[n]||(g.getWorldBounds(l,m),c.intersectsBox(m)&&(o=h.meshes[n],i[n]=!0,f.children.push(o)))}return f.boundingBox=a.boundingBox,f.renderImportance=a.renderImportance,f.sortObjects=a.sortObjects,f};var n={Merged:1,Instanced:2,Original:3};this.updateRenderProxy=function(a,b){if(a.geometry&&a.geometry.attributes){var c=f(b);if(e(a.geometry)!=c){var d=g.getGeometry(b),i=h.fragId2MeshIndex[b],j=h.meshes[i];if(c===n.Original)a.geometry=d,a.material=g.getMaterial(b),g.getWorldMatrix(b,a.matrix);else if(c===n.Instanced){g.getWorldMatrix(b,l);var k=g.fragments.fragId2dbId[b],o=new Ha(d,1);o.addInstance(l,k),a.geometry=o.finish(),a.material=j.material,a.matrix.identity()}else g.getWorldMatrix(b,l),g.getWorldBounds(b,m),k=g.fragments.fragId2dbId[b],a.geometry=Aa([d],l.elements,[k],m),a.material=j.material,a.matrix.identity();a.dispatchEvent({type:"removed"})}}}}function Ua(){function a(a){var b=m[a],c=f;if(n)for(;c>e&&m[l[c-1]]>b;)l[c]=l[c-1],c--;else for(;c>e&&m[l[c-1]]<b;)l[c]=l[c-1],c--;l[c]=a,f++}function c(a){var b=h.getLeftChild(a);-1!==b&&(c(b),c(b+1)),r.makeEmpty(),-1!==b&&(h.getBoxThree(b,s),r.union(s),h.getBoxThree(b+1,s),r.union(s)),h.getPrimCount(a)&&(r.union(j[a].boundingBox),r.union(j[a].boundingBoxHidden)),h.setBoxThree(a,r)}var d,e,f,g,h=null,i=null,j=null,k=null,l=null,m=null,n=1,o=!0,p=!1,q=!1,r=new b.Box3,s=new b.Box3,t=!1;this.initialize=function(a,b,c,e){d=a.getFragmentList(),e&&e.hasOwnProperty("prioritize_screen_size")&&(o=e.prioritize_screen_size),i=c,j=new Array(b.nodeCount),k=new Int8Array(b.nodeCount),h=b,l=new Int32Array(b.nodeCount+1),m=new Float32Array(b.nodeCount);for(var f=d.onDemandLoadingEnabled()?La:A,g=0;g<b.nodeCount;g++){var n=b.getPrimCount(g);n&&(j[g]=new f(d,i,b.getPrimStart(g),n),j[g].lastItem=j[g].start+n,j[g].numAdded=n,j[g].nodeIndex=g,8&b.getFlags(g)&&(j[g].sortObjects=!0),b.getBoxThree(g,j[g].boundingBox))}},this.addFragment=function(a,b){},this.reset=function(a){g=a,e=0,f=0,k[0]=k[1]=Gj.CONTAINMENT_UNKNOWN,l[f++]=0,p=!1,q=!1,t=!1},this.nextBatch=function(){for(q||p||e!==f||(l[f++]=1,p=!0);e!==f;){var b=n||p?l[--f]:l[e++],c=k[b];if(c!==Gj.CONTAINS&&(h.getBoxThree(b,r),c=g.intersectsBox(r)),c!==Gj.OUTSIDE){var d,i,s=h.getLeftChild(b),u=-1!==s;if(u){var v=h.getFlags(b),w=g.viewDir[3&v]<0?1:0,x=v>>2&1,y=v>>3&1,z=n||p?1:0,A=0,B=0;o&&!p?(d=s+x,i=s+1-x,h.getBoxThree(d,r),m[d]=A=g.projectedBoxArea(r,c===Gj.CONTAINS),h.getBoxThree(i,r),m[i]=B=g.projectedBoxArea(r,c===Gj.CONTAINS),k[d]=k[i]=c,A>0&&a(d),B>0&&a(i)):(w^z^y&&(x=1-x),d=s+x,i=s+1-x,l[f++]=d,m[d]=-1,l[f++]=i,m[i]=-1,k[d]=k[i]=c)}if(0!==h.getPrimCount(b)){var C=j[b];return C.renderImportance=g.projectedBoxArea(C.boundingBox,c===Gj.CONTAINS),C}}p||q||e!==f||(l[f++]=1,p=!0)}return t=!0,null},this.skipOpaqueShapes=function(){p||q||(e=0,f=0,l[f++]=1,q=!0)},this.getVisibleBounds=function(a,b){for(var d=0;d<j.length;d++){var e=j[d];e&&(e.calculateBounds(),a.union(e.boundingBox),b.union(e.boundingBox),b.union(e.boundingBoxHidden))}c(0),c(1)},this.rayCast=function(a,c,d){for(var e=[1,0],f=new b.Vector3;e.length;){var g=e.pop();h.getBoxThree(g,r),r.expandByScalar(.5);if(null!==a.ray.intersectBox(r,f)){var i=h.getLeftChild(g);-1!==i&&(e.push(i),e.push(i+1));if(0!==h.getPrimCount(g)){j[g].raycast(a,c,d)}}}},this.getSceneCount=function(){return j.length},this.getGeomScenes=function(){return j},this.done=function(){return t}}function Va(){function a(a,b){void 0===a.avgFrameTime?a.avgFrameTime=b:a.avgFrameTime=.8*a.avgFrameTime+.2*b}function c(b,c,d){var e,f;for(e=0;e<b.length;e++)f=b[e],f.cameraDistance=f.boundingBox.distanceToPoint(c.position);var g=function(a,b){return b.cameraDistance-a.cameraDistance};b.sort(g);var h=performance.now();for(e=0;e<b.length;e++){f=b[e],d(f);var i=performance.now(),j=i-h;h=i,a(f,j)}}var d=!1,e=!1,f=0,g=[],h=[],i=[],j=new b.Box3,k=[],l=new Gj,m=new b.Raycaster,n=performance,o=Ti;this.enableNonResumableFrames=!1,this.budgetForTransparent=.1;var p=!1,q=[],r=null;this.frustum=function(){return l},this.addModel=function(a){g.push(a),h.length=g.length,i.length=g.length},this.removeModel=function(a){var b=g.indexOf(a);return b>=0&&g.splice(b,1),h.length=g.length,i.length=g.length,b>=0},this.isEmpty=function(){return 0===g.length},this.needsRender=function(){return d},this.resetNeedsRender=function(){d=!1},this.frameResumePossible=function(){return!p},this.renderSome=function(b,j,k){for(var l,m,s=n.now(),t=0===f,u=this.budgetForTransparent*j;;){for(var v=0,w=null,x=0;x<h.length;x++){var y=h[x];m=g[x],y||(h[x]=y=m.nextBatch());if(p&&j<u){y&&!y.sortObjects&&(m.skipOpaqueShapes(),y=m.nextBatch())}null!==y&&(w||(v=x,w=y),y.renderImportance>w.renderImportance&&(v=x,w=y))}if(!w){e=!0;for(var z=0;z<g.length;++z)if((m=g[z])&&m.is2d()&&!m.isLoadDone()&&!m.getFragmentList().onDemandLoadingEnabled()){e=!1;break}break}if(g[v].is2d()&&g[v].getFragmentList()&&g[v].getFragmentList().onDemandLoadingEnabled()){var A=i[v];w.drawOrderRender=A&&A.drawOrderRender<A.lastItem?w.start:w.lastItem,i[v]=w}if(h[v]=g[v].nextBatch(),f++,w.sortObjects&&p)q.push(w),j-=void 0===w.avgFrameTime?.05:w.avgFrameTime;else{b(w),w.hasOwnProperty("drawEnd")&&(w.drawEnd=w.lastItem),l=n.now();var B=l-s;s=l,a(w,B),j-=w.avgFrameTime}if(g[v].getFragmentList()&&g[v].getFragmentList().onDemandLoadingEnabled())for(var C,D=w.start,E=w.lastItem,F=g[v].getFragmentList().vizflags,G=w.getIndices();D<E;)C=G?G[D]:D,F[C]&$i&&(F[C]=(F[C]|Zi)&~$i),++D;if(j<=0)break}var H=g[0].frameUpdatePaging(t,k);return(o!=H||g[0].needResumeNextFrame())&&(d=!0,o=H),q.length>0&&(c(q,r,b),q.length=0),j},this.reset=function(a,b,c){if(e=!1,f=0,this.resetNeedsRender(),l.reset(a),l.areaCullThreshold=Ri,g.length){p=this.enableNonResumableFrames&&c==cj&&b===Ui,r=a;for(var d=0;d<g.length;d++)g[d].resetIterator(a,l,b,c),h[d]=g[d].nextBatch(),i[d]=null}},this.isDone=function(){return e||this.isEmpty()},this.setAllVisibility=function(a){for(var b=0;b<g.length;b++)g[b].setAllVisibility(a)},this.hideLines=function(a){for(var b=0;b<g.length;b++)g[b].hideLines(a)},this.hidePoints=function(a){for(var b=0;b<g.length;b++)g[b].hidePoints(a)},this.hasHighlighted=function(){for(var a=0;a<g.length;a++)if(g[a].hasHighlighted())return!0;return!1},this.areAllVisible=function(){for(var a=0;a<g.length;a++)if(!g[a].areAllVisible())return!1;return!0},this.invalidateVisibleBounds=function(){for(var a=0;a<g.length;a++)g[a].visibleBoundsDirty=!0},this.getVisibleBounds=function(a){if(1===g.length)return g[0].getVisibleBounds(a);j.makeEmpty();for(var b=0;b<g.length;b++)j.union(g[b].getVisibleBounds(a));return j},this.findModel=function(a){for(var b=0;b<g.length;b++)if(g[b].getModelId()===a)return g[b];return null},this.rayIntersect=function(a,b,c,d,e,f){m.set(a,b);var h;if(g.length>1){var i=[];if(e)for(h=0;h<e.length;h++){var j=this.findModel(e[h]);j&&j.rayIntersect(m,c,[d[h]])}else for(h=0;h<g.length;h++)if(!g[h].is2d()){var k=g[h].rayIntersect(m,c,d,f);k&&i.push(k)}return i.length?(i.sort(function(a,b){return a.distance-b.distance}),i[0]):null}return!g.length||g[0].is2d()?null:g[0].rayIntersect(m,c,d,f)},this.getRenderProgress=function(){return g[0].getRenderProgress()},this.getModels=function(){return g},this.getHiddenModels=function(){return k},this.getFragmentList=function(){return g[0].getFragmentList()},this.getGeometryList=function(){return g[0].getGeometryList()},this.getSceneCount=function(){return g[0].getSceneCount()},this.getGeomScenes=function(){return g[0].getGeomScenes()},this.geomPacksMissingLastFrame=function(){return g[0].geomPacksMissingLastFrame()},this.explode=function(a){if(g.length){for(var c=new b.Vector3,d=0;d<g.length;d++){var e=g[d],f=e.getData().instanceTree,h=e.getFragmentList(),i=e.getVisibleBounds(!0).center();if(a*=2,f&&f.nodeAccess.nodeBoxes&&0!==a){var j=a*(f.maxDepth-1)+1,k=0|j,l=j-k,m=new Float32Array(6);!function b(d,e,g,i,j,n,o,p){var q=2*a;e==k&&(q*=l),f.getNodeBox(d,m);var r=.5*(m[0]+m[3]),s=.5*(m[1]+m[4]),t=.5*(m[2]+m[5]);if(e>0&&e<=k){var u=(r-g)*q,v=(s-i)*q,w=(t-j)*q;n+=u,o+=v,p+=w}f.enumNodeChildren(d,function(a){b(a,e+1,r,s,t,n,o,p)},!1),c.x=n,c.y=o,c.z=p,f.enumNodeFragments(d,function(a){h.updateAnimTransform(a,null,null,c)},!1)}(f.getRootId(),0,i.x,i.y,i.x,0,0,0)}else for(var n=h.fragments.boxes,o=0,p=h.getCount();o<p;o++)if(0==a)h.updateAnimTransform(o);else{var q=6*o,r=.5*(n[q]+n[q+3]),s=.5*(n[q+1]+n[q+4]),t=.5*(n[q+2]+n[q+5]);c.x=a*(r-i.x),c.y=a*(s-i.y),c.z=a*(t-i.z),h.updateAnimTransform(o,null,null,c)}}this.invalidateVisibleBounds()}},this.update=function(a){for(var b=!1,c=0;c<g.length;c++){var d=g[c];b=b||d.update(a)}return b},this.hideModel=function(a){for(var b=0;b<g.length;b++){var c=g[b];if(c&&c.id===a)return this.removeModel(c),k.push(c),!0}return!1},this.showModel=function(a){for(var b=0;b<k.length;++b){var c=k[b];if(c&&c.id===a)return this.addModel(c),k.splice(b,1),!0}return!1},this.getMemoryInfo=function(){function a(a){for(var d=0;d<a.length;++d){var e=a[d].getMemoryInfo();e&&(b=e,c.limit+=e.limit,c.effectiveLimit+=e.effectiveLimit,c.loaded+=e.loaded)}}var b,c={limit:0,effectiveLimit:0,loaded:0};return a(g),a(k),b?c:null}}function Wa(b,c){this.model=b,this.fragments=b.getData().fragments,this.geoms=b.getGeometryList(),this.pagingProxy=c,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!a.memoryOptimizedLoading):(this.boxes=null,this.transforms=null,this.useThreeMesh=!c||!c.onDemandLoadingEnabled());var d=this.fragments.length;this.vizflags=new Uint16Array(d),this.useThreeMesh&&(this.vizmeshes=new Array(d)),this.geomids=new Int32Array(d),this.materialids=new Int32Array(d),this.materialmap={},this.db2ThemingColor=[],this.originalColors=[],this.themingOrGhostingNeedsUpdate=[],this.dbIdIsHidden=[],this.dbIdIsGhosted=[],this.reachLimit=!1,this.animxforms=null;for(var e=0;e<d;e++)this.vizflags[e]=1,this.geomids[e]=-1;this.allVisible=!0,this.allVisibleDirty=!1,this.nextAvailableFragID=d,this.boxTransform=[],this.boxCount=0}function Xa(a){var b=a.r;return a.r=a.b,a.b=b,a}function Ya(a,b){var c=a.originalColors[b];if(a.themingOrGhostingNeedsUpdate[b]){var d=a.getGeometry(b),e=d?d.attributes:null,f=e?e.color4b:null,g=e?e.dbId4b:null,h=e?e.layerVp4b:null,i=e?e.flags4b:null;if(f&&g&&d.vb&&h&&i){for(var j=new Uint32Array(d.vb.buffer),k=d.vbstride,l=j.length/d.vbstride,m=!1,n=f.itemOffset,o=g.itemOffset,p=h.itemOffset,q=i.itemOffset,r=0;r<l;r++){var s=j[r*k+o],t=c?c[r]:j[r*k+n],u=j[r*k+p];s=s<<8>>8;var v=-1==s&&0==(u&parseInt("FFFF",16)),w=a.db2ThemingColor[s],x=a.dbIdIsHidden[s];if(w||x){if(!c){c=new Uint32Array(l);for(var y=0;y<l;y++)c[y]=j[y*k+n];a.originalColors[b]=c}t=x?0:Ok(t,w),m=!0}else c&&(t=c[r]);j[r*k+n]=t;var z=a.dbIdIsGhosted[s]&&!v,A=j[r*k+q];z?A|=255<<24:A&=16777215,j[r*k+q]=A}m||(a.originalColors[b]=null),d.vbNeedsUpdate=!0,a.themingOrGhostingNeedsUpdate[b]=!1}}}function Za(a,b){if(a.model.is2d()){var c=a.fragments.dbId2fragId[b];if(Array.isArray(c))for(var d=0;d<c.length;d++)a.themingOrGhostingNeedsUpdate[c[d]]=!0;else"number"==typeof c&&(a.themingOrGhostingNeedsUpdate[c]=!0)}}function $a(a,b){this.frags=a,this.fragId=b,this.scale=null,this.quaternion=null,this.position=null}function _a(a,b,c){this.level=a,this.x=b,this.y=c}function ab(a,b,c){var d=a.clone();return d.max(b),d.min(c),d.distanceToSquared(a)}function bb(a,b,c,d){var e=a.clone();return e.max(c),e.min(d),e.sub(a).dot(b)}function cb(){function a(a,b,c){var d=Math.ceil(Math.log2(a)),e=Math.ceil(Math.log2(b));return Math.max(d,e)-Math.log2(c)}function c(a,b,c){var d=b-c;d>0&&(a.texWidth>>=d,a.texHeight>>=d,a.maxLevel=c)}this.urlPattern=null,this.tileSize=null,this.maxLevel=null,this.textureLoader=null,this.texWidth=0,this.texHeight=0,this.maxActiveTiles=Ei()?0:400,this.cacheSize=Ei()?0:150,this.onRootLoaded=null,this.levelOffset=0,this.pixelRatio=1,this.getRootTileSize=function(){return 1*(this.tileSize<<this.maxLevel)},this.getQuadWidth=function(){return 1*this.texWidth/this.getRootTileSize()},this.getQuadHeight=function(){return 1*this.texHeight/this.getRootTileSize()},this.getPageToModelTransform=function(a,b){var c=a/this.getQuadWidth(),d=b/this.getQuadHeight();return new Tk(!0).set(c,0,0,0,0,d,0,0,0,0,1,0,0,0,0,1)},this.getBBox=function(){var a=this.getQuadWidth(),c=this.getQuadHeight(),d=1-c;return new b.Box3(new b.Vector3(0,d,0),new b.Vector3(a,1,0))},this.valid=function(){return"string"==typeof this.urlPattern&&this.urlPattern.length>0&&"number"==typeof this.tileSize&&this.tileSize>0&&"number"==typeof this.maxLevel&&this.maxLevel>0&&"number"==typeof this.texWidth&&this.texWidth>0&&"number"==typeof this.texHeight&&this.texHeight>0},this.initForSimpleImage=function(a,b){this.urlPattern=decodeURIComponent(a),this.maxLevel=0,this.levelOffset=0,this.tileSize=-1,this.texWidth=-1,this.texHeight=-1,this.onRootLoaded=b},this.initFromLoadOptions=function(b,d,e){this.urlPattern=decodeURIComponent(b),this.textureLoader=e,d&&(this.tileSize=d.tileSize,this.maxLevel=a(d.texWidth,d.texHeight,d.tileSize),this.texWidth=d.texWidth,this.texHeight=d.texHeight,this.levelOffset=d.levelOffset,"number"==typeof d.maxLevel&&c(this,this.maxLevel,d.maxLevel),this.maxActiveTiles=d.maxActiveTiles||this.maxActiveTiles,this.cacheSize=d.cacheSize||this.cacheSize,this.zips=d.zips)}}function db(a,c){function d(a){var b=E.maxLevel-a;return E.texWidth>>b}function e(a){var b=E.maxLevel-a;return E.texHeight>>b}function f(a){var b=d(a.level),c=e(a.level),f=a.x*E.tileSize,g=a.y*E.tileSize;return f>=b||g>=c}function g(a){var c=d(a.level),f=e(a.level),g=a.x*E.tileSize,h=a.y*E.tileSize,i=1*Math.max(0,Math.min(E.tileSize,c-g)),j=1*Math.max(0,Math.min(E.tileSize,f-h)),k=1*E.tileSize;return new b.Vector2(1*i/k,j/k)}function h(a){return 1/(1<<a)}function i(){this.offsetX=0,this.offsetY=0,this.scaleX=1,this.scaleY=1}function j(a,b){var c=a.level-b.level,d=1<<c,e=1/d,f=e,h=g(b);e/=h.x,f/=h.y;var j=b.x*d,k=b.y*d,l=a.x-j,m=a.y-k,n=g(a);l*=e,m*=f,m=1-m-f*n.y;var o=new i;return o.offsetX=l,o.offsetY=m,o.scaleX=e*n.x,o.scaleY=f*n.y,o}function k(a){return h(a.level)*a.x}function l(a){return h(a.level)*((1<<a.level)-1-a.y)}function m(a){return J[Uk.tile2Index(a)]}function n(a){var b=m(a);return b instanceof Yk&&b.state==Xk}function o(a,b){for(var c=a.getParent();c;){var d=m(c),e=d&&d.state==Xk;if(e&&b&&d.mesh.material.map.needsUpdate&&c.level>0&&(e=!1),e)break;c=c.getParent()}return c}function p(a,c){var d=c||T,e=[];e.push(new b.Vector2(d.offsetX,d.offsetY)),e.push(new b.Vector2(d.offsetX+d.scaleX,d.offsetY)),e.push(new b.Vector2(d.offsetX+d.scaleX,d.offsetY+d.scaleY)),e.push(new b.Vector2(d.offsetX,d.offsetY+d.scaleY)),a.faceVertexUvs[0].length=0,a.faceVertexUvs[0].push([e[0],e[1],e[2]]),a.faceVertexUvs[0].push([e[0],e[2],e[3]]),a.uvsNeedUpdate=!0}function q(a){var c=new b.Geometry;return c.vertices.push(new b.Vector3(0,0,0),new b.Vector3(1,0,0),new b.Vector3(1,1,0),new b.Vector3(0,1,0)),c.faces.push(new b.Face3(0,1,2)),c.faces.push(new b.Face3(0,2,3)),p(c,a),c.computeFaceNormals(),c}function r(a){var b=R[S];return b?p(b,a):(b=q(a),R[S]=b),S++,b}function s(a,c,d){var e;if(c)Q||(Q=q()),e=Q;else{var f=o(a);c=v(f).material;e=r(j(a,f))}var i=new b.Mesh(e,c),m=h(a.level),n=g(a),p=(1-n.y)*m,s=k(a),t=l(a);return i.position.set(s,t+p,0),i.scale.set(m*n.x,m*n.y,1),i}function t(a){var b=E.levelOffset?E.levelOffset:0;return E.urlPattern.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",a.level+b)}function u(c){var d=Uk.tile2Index(c),e=J[d];if(!e||e.state==Vk){e||(e=new Yk(K),J[d]=e),e.state=Wk;var f=t(c),g=function(d){if(U){0==E.maxLevel&&(-1==E.texWidth&&(E.texWidth=d.image.width),-1==E.texHeight&&(E.texHeight=d.image.height),-1==E.tileSize&&(E.tileSize=Math.max(d.image.width,d.image.height)),F=a.getBBox()),d.minFilter=b.LinearFilter,d.magFilter=b.LinearFilter;var g=new b.MeshBasicMaterial({color:4294967295});g.map=d,g.name=f,g.disableEnvMap=!0,f.toLowerCase().indexOf(".png")&&(g.transparent=!0,g.alphaTest=.01),H.addMaterial(g.name,g,!0);var h=s(c,g);e.mesh=h,e.state=Xk,N--,O=!0;var i=d&&d.image?d.image.src:null;i&&b.Cache&&b.Cache.get(i)&&b.Cache.remove(i),0==c.level&&E.onRootLoaded&&E.onRootLoaded()}};N++,E.textureLoader(f,function(a){g(a)},function(a){console.error(a)})}}function v(a){var b=Uk.tile2Index(a),c=J[b];return c&&c.state==Xk?c.mesh:null}function w(a,b){var c=k(a),d=l(a);b.set(c,d,0)}function x(a,b){var c=h(a.level),d=k(a)+c,e=l(a)+c;b.set(d,e,0)}function y(a,b){this.tile=a,this.prio=b}function z(a,b){return a.prio>b.prio}function A(a){var b=J[Uk.tile2Index(a)];b&&b.timeStamp!=K&&(b.timeStamp=K,L++)}function B(a,b,c){a.sort(function(a,d){var e=W(a,b,c);return W(d,b,c)-e});for(var d=0,e=0;e<a.length;e++){var f=m(a[e]);if(!f||f.state!=Wk){if(N>=M)break;u(a[e]),d++}}return d}function C(a){if(a&&a.mesh&&a.mesh.material){var b=a.mesh.material;H.removeMaterial(b.name),b.map.dispose(),b.map.needsUpdate=!0;var c={type:"dispose"};b.dispatchEvent(c),b.needsUpdate=!0}}function D(a,b,c){var d=Object.keys(J),e=d.length,f=E.cacheSize-e,g=a-f;if(!(g<=0)){d.sort(function(a,d){var e=J[a].timeStamp,f=J[d].timeStamp;if(e!=f)return e-f;var g=Uk.index2Tile(a),h=Uk.index2Tile(d);return W(g,b,c)-W(h,b,c)});for(var h=Math.min(g,d.length),i=0;i<h;i++){var j=d[i];if(0!==Uk.index2Tile(j).level&&J[j].state==Xk){if(J[j].timeStamp==K)break;C(J[j]),delete J[j]}}}}var E=a,F=a.getBBox(),G=new b.Scene,H=c,I=!0,J=[],K=0,L=0,M=5,N=0,O=!1,P=[],Q=null,R=[],S=0;this.nextBatch=function(){return I?null:(I=!0,G)},this.getSceneCount=function(){return 1},this.done=function(){return I},this.rayCast=function(a,b){return null},this.getVisibleBounds=function(a,b){a&&a.copy(F),b&&b.copy(F)};var T=new i,U=this;u(new Uk.TileCoords(0,0,0));var V=function(){var a=new b.Vector3,c=new b.Vector3,d=new b.Box3;return function(b,e){return w(b,a),x(b,c),d.set(a,c),e.intersectsBox(d)>0}}(),W=function(){var a=new b.Vector3,c=new b.Vector3;return function(b,d,e){var f=h(b.level);w(b,a),x(b,c);var g=ab(e,a,c),i=V(b,d),j=i?100:1;return g=Math.max(g,1e-4),j*(f*f)/g}}(),X=function(){
var a=new b.Vector3,c=new b.Vector3;return function(d,e,f,g,h){w(d,a),x(d,c);var i=bb(e,f,a,c);return(c.x-a.x)/(Math.tan(b.Math.degToRad(g/2))*i)*.5*h}}();this.dispose=function(){var a;for(a in J)C(J[a]);for(Q&&(Q.dispose(),Q.needsUpdate=!0),a=0;a<R.length;a++){var b=R[a];b&&(b.dispose(),b.needsUpdate=!0)}},this.dtor=function(){this.dispose(),U=null,H=null},this.reset=function(a,b){var c,d;for(c=0;c<G.children.length;c++){G.children[c].dispatchEvent({type:"removed"})}if(G.children.length=0,K++,L=0,S=0,!n(new Uk.TileCoords(0,0,0)))return void(I=!0);var e=new Nk(z),g=new Uk.TileCoords(0,0,0),h=W(g,a,b.position);e.add(new y(g,h));for(var i=b.getWorldDirection(),j=0|b.clientHeight*E.pixelRatio,k=[],l=[],m=[];e.size()>0;){if(d=e.get(0).tile,e.removeAt(0),!f(d)){var o=!0;d.level==E.maxLevel&&(o=!1);X(d,b.position,i,b.fov,j)<E.tileSize&&(o=!1);var p=V(d,a);if(p&&(n(d)||m.push(d),A(d)),!p&&k.length+l.length>E.maxActiveTiles&&(o=!1),o)for(var q=0;q<4;q++){var r=d.getChild(q);h=W(r,a,b.position),e.add(new y(r,h))}else p?k.push(d):l.push(d)}}var t=0;O=!1;var u=!0;for(c=0;c<k.length;++c){d=k[c];var w=v(d);w&&w.material.map.needsUpdate&&(t<5?t++:(w=s(d,null,!0),O=!0,u=!1)),w||(w=s(d,null),u=!1),G.add(w)}I=!1;var x=B(m,a,b.position);L+=N;var C=[];for(c=0;c<l.length&&!(L>=E.maxActiveTiles);c++)if(d=l[c],n(d))for(var F=0;F<=d.level;F++){var H=d.getParentAtLevel(F);if(A(H),L>E.maxActiveTiles)break}else C.push(d),L++;if(x+=B(C,a,b.position),D(x,a,b.position),u&&P.length>0){var J=P.splice(0,P.length);setTimeout(function(){for(var a=0;a<J.length;a++)J[a]()},1)}},this.callWhenRefined=function(a){P.push(a)},this.update=function(){return O}}function eb(a,b,c){if(a){if(a-3*b*2<=Pi&&c<Qi)return!1}return!0}function fb(a){function c(a){var b=d.getFragmentList().fragments.packIds[a];j.pagingProxy&&j.pagingProxy.addGeomPackMissingLastFrame(b)}var d=this,e=new b.Box3,f=new b.Box3,g=new b.Box3;this.visibleBoundsDirty=!1,this.enforceBvh=!1,this.isvizCacheEnabled=!1;var h=0;this.id=$k++;var i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=0,q=null,r=Ui,s=_k[Ui],t=!1,u=Ti;this.getData=function(){return a},this.getGeometryList=function(){return i},this.getFragmentList=function(){return j},this.getModelId=function(){return this.id},this.initialize=function(a){var b=this.getData(),c=b.numGeoms||0,d=!eb(b.packFileTotalSize,b.primitiveCount,c);i=new y(c,this.is2d(),d),j=new Wa(this,a);var g=this.getBoundingBox();g&&(e.copy(g),f.copy(g)),m=k=new Ma(this)},this.initFromCustomIterator=function(a){m=a,this.visibleBoundsDirty=!0},this.dtor=function(a){j&&j.dispose(a),m&&m.dtor&&m.dtor(),n&&n.dispose()},this.activateFragment=function(a,b,c){j&&(j.setMesh(a,b,c),m.addFragment(a),j.getWorldBounds(a,g),e.union(g),f.union(g))},this.setFragment=function(a,b){return void 0===a&&(a=this.getFragmentList().getNextAvailableFragmentId()),j.setMesh(a,b,!0),k&&k.addFragment(a),l&&!j.fragmentsHaveBeenAdded()&&l.addFragment(a),j.getWorldBounds(a,g),e.union(g),f.union(g),a},this.setBVH=function(a,b,c){m=l=new Ua,m.initialize(this,a,b,c)},this.resetIterator=function(a,b,c,d){if(d=d||aj,j&&j.pagingProxy&&j.pagingProxy.resetIterator(a,d),d!=aj&&(d>=bj&&j&&j.onDemandLoadingEnabled()&&j.setFlagGlobal(Zi,!1),d>=cj&&j&&j.pageOutGeometryEnabled())){u=Ti,j.pagingProxy&&j.pagingProxy.reset();var e,f,g=m.getGeomScenes();for(f=g.length,e=0;e<f;e++){var h=g[e];h&&h.resetVisStatus&&h.resetVisStatus()}}return t=!1,l&&!j.fragmentsHaveBeenAdded()&&(t=!0),this.isvizCacheEnabled&&(t=!1),t?m=l:k&&(m=k),p=0,r=c,s=c<_k.length?_k[c]:_k[Ui],q=b,m.reset(b,a),j&&j.resetBoxRun(),n&&n.reset(),m},this.nextBatch=function(){for(;;){var a=m.nextBatch();if(p++,!a)return null;if(n&&a instanceof A&&(a=n.consolidateNextBatch(a,q)),a instanceof b.Scene)return a;if(a.visibleStats&s)d=!(a.visibleStats&s<<16);else{var d=a.applyVisibility(r,q,this.getFragmentList().fragments.packIds?c:function(){});void 0!==a.visibleStats&&(a.visibleStats|=s,d||(a.visibleStats|=s<<16)),d||this.is2d()||(a.sortObjects&&!this.getFragmentList().useThreeMesh?a.sortByDepth(q):a.sortDone||a.sortByMaterial())}if(!d)return a}},this.getVisibleBounds=function(a){return this.visibleBoundsDirty&&(e.makeEmpty(),f.makeEmpty(),m.getVisibleBounds(e,f,a),this.visibleBoundsDirty=!1),a?f:e},this.rayIntersect=function(a,c,d,e){this.visibleBoundsDirty&&this.getVisibleBounds();var f,g=[];if(d&&d.length>0){var h=this.getFragmentMap(),i=[];if(h)for(f=0;f<d.length;f++)h.enumNodeFragments(d[f],function(a){i.push(a)},!0);else i=d;if(i.length>2)m.rayCast(a,g,d);else for(f=0;f<i.length;f++){var k=j.getVizmesh(i[f]);if(k){var l=Ej.rayCast(k,a,g);l&&g.push(l)}}}else m.rayCast(a,g);if(!g.length)return null;g.sort(function(a,b){return a.distance-b.distance});var n=!!e;for(e=e||[],f=0;f<g.length;f++){var o=g[f].fragId;if(!this.is2d()){if(this.isFragVisible(o)){var p=j.getMaterial(o);if(c&&p.transparent)continue;var q=g[f],r=!1,s=q.point;if(p&&p.cutplanes)for(var t=0;t<p.cutplanes.length;t++)r=r||p.cutplanes[t].dot(new b.Vector4(s.x,s.y,s.z,1))>1e-6;if(r||e.push(q),q.model=this,!n&&e.length>0)break}}}var u=e[0]||null;return u&&(u.model=this),u},this.setHighlighted=function(a,b){if(!j)return!1;var c=j.setFlagFragment(a,Wi,b);return c&&(b?h++:h--),c},this.setVisibility=function(a,b){j&&(j.setVisibility(a,b),this.visibleBoundsDirty=!0)},this.setAllVisibility=function(a){j&&(j.setAllVisibility(a),this.visibleBoundsDirty=!0)},this.hideLines=function(a){j&&j.hideLines(a)},this.hidePoints=function(a){j&&j.hidePoints(a)},this.hasHighlighted=function(){return!!h},this.isFragVisible=function(a){return j.isFragVisible(a)},this.areAllVisible=function(){return!j||j.areAllVisible()},this.getGeomScenes=function(){return m.getGeomScenes()},this.getRenderProgress=function(){var a=p/m.getSceneCount();return a>1?1:a},this.pageOutIfNeeded=function(a,b,c){return j.pagingProxy?j.pagingProxy.pageOut(a,b,c):Ti},this.frameUpdatePaging=function(a,b){return j&&j.pageOutGeometryEnabled()?(u=this.pageOutIfNeeded(!1,!1,b),m.done()&&(u=this.pageOutIfNeeded(!0,!1,b))==Si&&(u=this.pageOutIfNeeded(!0,!0,b)),u):u},this.geomPacksMissingLastFrame=function(){return j&&j.pagingProxy?j.pagingProxy.geomPacksMissingLastFrame():[]},this.addGeomPackMissingLastFrame=function(a){return!j||!j.pagingProxy||j.pagingProxy.addGeomPackMissingLastFrame(a)},this.needResumeNextFrame=function(){return!(!j||!j.pagingProxy)&&j.pagingProxy.needResumeNextFrame()},this.update=function(a){return!(!m||!m.update)&&m.update(a)},this.setThemingColor=function(a,c){j?j.setThemingColor(a,c):b.warn("Theming colors are not supported by this model type.")},this.clearThemingColors=function(){j&&j.clearThemingColors()},this.getLeaflet=function(){return m instanceof db?m:null},this.consolidate=function(a,b,c){var d=Sa(j,a,b,c,o);n=new Ta(j,d),o=d.consolidationMap},this.unconsolidate=function(){n&&(n.dispose(),n=null)},this.isConsolidated=function(){return!!n},this.getConsolidation=function(){return n?n.getConsolidation():null},this.getInstanceTree=function(){return a?a.instanceTree:null},this.getFragmentMap=function(){return a?a.instanceTree||a.fragmentMap:null},this.getBoundingBox=function(){return a?a.bbox:null},this.is2d=function(){return!(!a||!a.is2d)},this.updateRenderProxy=function(a,b){n&&n.updateRenderProxy(a,b)},this.skipOpaqueShapes=function(){m&&m.skipOpaqueShapes&&m.skipOpaqueShapes()},this.getMemoryInfo=function(){return j.getMemoryInfo()}}function gb(a,c){for(var d=255*a.x,e=255*a.y,f=255*a.z,g=255*c.x,h=255*c.y,i=255*c.z,j=new Uint8Array(16),k=new Uint8Array(16),l=new Uint8Array(16),m=0;m<4;m++)j[4*m]=d,j[4*m+1]=e,j[4*m+2]=f,j[4*m+3]=255,k[4*m]=g,k[4*m+1]=h,k[4*m+2]=i,k[4*m+3]=255,m>1?(l[4*m]=d,l[4*m+1]=e,l[4*m+2]=f,l[4*m+3]=255):(l[4*m]=g,l[4*m+1]=h,l[4*m+2]=i,l[4*m+3]=255);var n=new b.DataTexture(l,2,2,b.RGBAFormat),o=new b.DataTexture(l,2,2,b.RGBAFormat),p=new b.DataTexture(k,2,2,b.RGBAFormat),q=new b.DataTexture(j,2,2,b.RGBAFormat),r=new b.DataTexture(l,2,2,b.RGBAFormat),s=new b.DataTexture(l,2,2,b.RGBAFormat),t=new b.Texture(null,b.CubeReflectionMapping,b.RepeatWrapping,b.RepeatWrapping,b.LinearFilter,b.LinearFilter,b.RGBAFormat);return t.image=[o,n,q,p,s,r],t.needsUpdate=!0,t}function hb(a,b,c){this.nodeAccess=a,this.maxDepth=c,this.objectCount=b,this.numHidden=0,this.numOff=0}function ib(a){this.numOffs=0,this.numHidden=0;var b,c={};!function(a){function d(b){for(var c=0,d=a.length;c<d;c++){var e=a[c];Array.isArray(e)||(g[0]=e,e=g);for(var f=0;f<e.length;f++)b(c,e[f])}}var e=0,f=[],g=[0];d(function(a,b){var d=c[b];void 0===d&&(c[b]=d=f.length,f.push(0),f.push(0)),++f[d],++e}),b=new Uint32Array(e+f.length/2),b.fill(0);var h,i,j=0;for(h in c){i=c[h];var k=f[i],l=j+k+1;b[j]=k,f[i]=f[i+1]=j,j=l}var m=!1;d(function(a,d){var e=c[d],g=f[e+1]+1;g>b.length||b[g]?m||(console.error("DbidFragmentMap.buildMap: Internal error fragment overlap"),m=!0):(b[g]=a,f[e+1]=g)}),m=!1;for(h in c){i=c[h];var n=f[i+1]+1;n<b.length&&!b[n]&&(m||(console.error("DbidFragmentMap.buildMap: Internal error fragment underfilled"),m=!0))}for(h in c)i=c[h],c[h]=f[i]}(a),this.setFlagNode=function(a,d,e){if(!c.hasOwnProperty(a))return!1;var f=c[a];return!!(b[f]&d)!=e&&(e?b[f]|=d:b[f]&=~d,!0)},this.setNodeOff=function(a,b){var c=this.setFlagNode(a,ol,b);return c&&(b?this.numOff++:this.numOff--),c},this.isNodeOff=function(a){var d=c[a];return!!(b[d]&ol)},this.setNodeHidden=function(a,b){var c=this.setFlagNode(a,pl,b);return c&&(b?this.numHidden++:this.numHidden--),c},this.isNodeHidden=function(a){var d=c[a];return!!(b[d]&pl)},this.getRootId=function(){return rl},this.enumNodeFragments=function(a,d){var e;"number"==typeof a?e=a:a&&(e=a.dbId);for(var f=c[e],g=(b[f]&ql)+f+1;++f<g;)d(b[f],e)},this.enumNodeChildren=function(a,b,d){if(d&&b(a),a==rl)for(var e in c)b(Number(e))}}function jb(a,b){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=[],this.nameSuffixes=[],this.getIndex(0)}function kb(a){var b=new Int32Array(a.length);return b.set(a),b}function lb(a,b,c){this.nodes=a.nodes,this.children=a.children,this.dbIdToIndex=a.dbIdToIndex,this.names=a.names,this.nameSuffixes=a.nameSuffixes,this.strings=a.strings,this.rootId=b,this.numNodes=this.nodes.length/sl,this.visibleIds=null,this.nodeBoxes=c||new Float32Array(6*this.numNodes)}function mb(a,b){this.bytes_per_node=b?32:36;var c,d;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,d=a,this.nodeCount=c):(c=0|a,d=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0),this.nodeCapacity=c,this.nodesRaw=d,this.is_lean_node=b,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}function nb(a,b){this.boxes=a.boxes,this.polygonCounts=a.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=a.materials,this.materialDefs=b,this.count=a.length,this.boxStride=6}function ob(a,b,c){this.finfo=c||new nb(a,b),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(tl*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}function pb(a,b,c){var d=a&&zl.webWorkerClass||!zl.mainThreadClass?zl.webWorkerClass:zl.mainThreadClass;return d?new d(b,!!c):null}function qb(a){return"ErrorCode:"+a+"."}function rb(b){return 403===b||401===b?a.ErrorCodes.NETWORK_ACCESS_DENIED:404===b?a.ErrorCodes.NETWORK_FILE_NOT_FOUND:b>=500?a.ErrorCodes.NETWORK_SERVER_ERROR:a.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE}function sb(){return"undefined"!=typeof XMLHttpRequest?XMLHttpRequest:(Il||(Il=c(2),Il.prototype._restrictedHeaders.cookie=!1),Il)}function tb(a){var b=a.split("/");if(0==b.length)return a;for(var c=[],d=0;d<b.length;++d){var e=b[d];"."!==e&&(".."===e&&c.length?c.pop():c.push(e))}return 0==c.length?"":c.join("/")}function ub(a,b){for(var c=a.length-b,d=new ArrayBuffer(c),e=new Uint8Array(d,0),f=0,g=b;f<c;f++,g++)e[f]=255&a.charCodeAt(g);return e}function vb(a,b){return-1===b.indexOf("file://")&&(-1!==b.indexOf("://")||(!!a||void 0))}function wb(a,b,d,e){function f(a){if("json"==e.responseType)try{return JSON.parse(a.toString("utf8"))}catch(a){d(a)}return a}0===a.indexOf("file://")&&(a=a.substr(7)),c(3).readFile(a,function(g,h){g?d(0,0,{httpStatusText:g,url:a}):31==h[0]&&139==h[1]?c(4).gunzip(h,null,function(c,g){c?d(0,0,{httpStatusText:c,url:a}):(g=f(g),e.ondata&&e.ondata(g),b(g))}):(h=f(h),e.ondata&&e.ondata(h),b(h))})}function xb(b,c){c.hasOwnProperty("asynchronous")?c.asynchronous||a.logger.warn("LMV: Sync XHR used. Performance warning."):c.asynchronous=!0,c.hasOwnProperty("responseType")||(c.responseType="arraybuffer"),c.hasOwnProperty("withCredentials")||(c.withCredentials=!!b.auth),c.headers=b.headers,c.queryParams=b.queryParams,c.endpoint=b.endpoint}function yb(b){var c=b.data;if(c&&c.debug)return void a.logger.debug(c.message);if(c.cbId){var d=Ul[c.cbId];c&&c.error?d[1]&&d[1](c.error):d[0]&&d[0](c.result),delete Ul[c.cbId]}}function zb(a,b){var c=Tl++;return Ul[c]=[a,b],c}function Ab(){Nl&&Nl.doOperation({operation:Sl,clearCaches:!0})}function Bb(a,b){var c=255*b[2]+b[3],d=Math.pow(2,(c-127)/2),e=d/b[1],f=b[0]*e,g=Wl[0]*f+Wl[3]*d+Wl[6]*e,h=Wl[1]*f+Wl[4]*d+Wl[7]*e,i=Wl[2]*f+Wl[5]*d+Wl[8]*e;g<0&&(g=0),h<0&&(h=0),i<0&&(i=0),a[0]=g,a[1]=h,a[2]=i}function Cb(a,b,c){var d=.0625*Math.sqrt(b[0]*c),e=.0625*Math.sqrt(b[1]*c),f=.0625*Math.sqrt(b[2]*c),g=Math.max(Math.max(d,e),Math.max(f,1e-6));g>1&&(g=1);var h=Math.ceil(255*g)/255;d>1&&(d=1),e>1&&(e=1),f>1&&(f=1),a[3]=h;var i=1/h;a[0]=d*i,a[1]=e*i,a[2]=f*i}function Db(a,b,c){var d=Math.sqrt(b[0]*c),e=Math.sqrt(b[1]*c),f=Math.sqrt(b[2]*c);d>65504&&(d=65504),e>65504&&(e=65504),f>65504&&(f=65504),a[0]=d,a[1]=e,a[2]=f}function Eb(a){for(var b=[],c=Array.isArray(a.image)?a.image:[a.image],d=0;d<c.length;d++)for(var e=c[d],f=0;f<e.mipmaps.length;f++){var g=e.mipmaps[f];b.push(g.data.buffer)}return b}function Fb(a){var b=a.width,c=a.height,d=void 0,e=void 0;if(0==(b&b-1)&&0==(c&c-1)){if(b*c<=gm)return a;d=b,e=c}else{for(d=1;2*d<b;)d*=2;for(e=1;2*e<c;)e*=2}for(;d*e>gm;)d=Math.max(d/2,1),e=Math.max(e/2,1);var f=document.createElement("canvas"),g=f.getContext("2d");return f.width=d,f.height=e,f.wasNPOT=!0,g.drawImage(a,0,0,d,e),f}function Gb(a){return a.format===b.AlphaFormat||a.format===b.RGBAFormat}function Hb(a){return a.clampS||a.clampT}function Ib(a){return a.minFilter!==b.NearestFilter&&a.minFilter!==b.LinearFilter}function Jb(a){!0===a.image.wasNPOT&&Gb(a)&&Hb(a)&&Ib(a)&&Fi()&&Ji()&&(a.minFilter=b.LinearFilter,a.generateMipmaps=!1,a.needsUpdate=!0)}function Kb(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return"data:image/jpeg;base64,"+window.btoa(b)}function Lb(c,d,e,f,g){function h(b){g&&g.extractImage&&(b=g.extractImage(b));var c=new Image;j.image=c,Jb(j),c.onload=function(){j.needsUpdate=!0,f&&f(j)},c.onerror=function(b){a.logger.error(b,qb(a.ErrorCodes.UNKNOWN_FAILURE)),f&&f(null)},c.src=Kb(b)}function i(b,c){var d="Error: "+b+" ("+c+")";a.logger.error(d,qb(a.ErrorCodes.NETWORK_SERVER_ERROR)),f&&f(null)}var j=new b.Texture(void 0,e);return g&&g.rawData?h(g.rawData):Ll.getItem(c,d,h,i),j}function Mb(c,d,e,f,g){function h(a){g&&g.extractImage&&(a=g.extractImage(a)),j.image={data:a,width:void 0,height:void 0},j.needsUpdate=!0,f&&f(j)}function i(b,c){var d="Error: "+b+" ("+c+")";a.logger.error(d,qb(a.ErrorCodes.NETWORK_SERVER_ERROR)),f&&f(null)}var j=new b.DataTexture(void 0,e);return Ll.getItem(c,d,h,i),j}function Nb(a,b,c,d){var e=c.textureMaps;if(!e)return!1;var f=e[d];if(!f)return!1;if(b.clearTextureFromMaterial(a,c,f,d),f.tex){var g=c.defines;g&&delete g[d],c.needsUpdate=!0,c[d]=null,f.tex=null}return!0}function Ob(){return dm+cm.length}function Pb(a,b,c){throw new Error(c+" Key: "+a+" Value: "+JSON.stringify(b))}function Qb(a){return vm.indexOf(a)>=0}function Rb(a,b,c){return"bumpmap_Bitmap"===a||"unifiedbitmap_Bitmap"===a||"image"===a?c.innerMats.hasOwnProperty(b)?dc(c.innerMats[b],c.getURL):{IMAGE_MARKER:"REMOVE",urn:b}:"surface_cutout"===a||"wood_curly_distortion_map"===a?[c.innerMats.hasOwnProperty(b)?dc(c.innerMats[b],c.getURL):{REFERENCE_MARKER:"REMOVE",urn:b}]:{texture:[c.innerMats.hasOwnProperty(b)?dc(c.innerMats[b],c.getURL):{REFERENCE_MARKER:"REMOVE",urn:b}]}}function Sb(a,b,c){if(b.hasOwnProperty("connections")){var d=b.connections;if(1===d.length)return Rb(a,d[0],c);(d.length>1||0===d.length)&&Pb(a,d,"Invalid connection.")}}function Tb(a,b){if(b.hasOwnProperty("units")){var c=b.units;if(um.hasOwnProperty(c)&&(c=um[c]),"cd/m^2"===c||"Lux_I"===c||""===c)return;return tm.find(function(a){return a===c})||Pb(a,b,"Value contains an illegal unit."),c}}function Ub(a,b){if(b&&b.hasOwnProperty("values"))return b.values;Pb(a,b,"Missing values in key.")}function Vb(a,b){var c=Ub(a,b);if(Array.isArray(c))return c;Pb(a,b,"Expected an array value.")}function Wb(a,b){var c=Vb(a,b);if(1===c.length)return c[0];Pb(c,a,"Expected a single value.")}function Xb(a,b,c){var d=Sb(a,b,c);if(d)return d;var e=Wb(a,b);return e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")||Pb(e,a,"Expected a color object with r, g and b fields."),{value:{linearFloat:[e.r,e.g,e.b]}}}function Yb(a,b){var c=Wb(a,b);xm.hasOwnProperty(a)||Pb(a,c,"Unknown choice type key.");var d=xm[a];return(c<0||c>=d.length)&&Pb(a,c,"Choice value is out of range."),xm[a][c]}function Zb(a,b,c){var d=["wood_growth_perlin_prof","wood_fiber_perlin_prof","wood_diffuse_perlin_prof","wood_earlycolor_perlin_prof","wood_latecolor_perlin_prof","wood_fiber_cosine_prof","wood_secondary_perlin_prof","center_direction","up_direction"],e=["wood_earlywood_sharpness","wood_latewood_ratio","wood_fiber_roughness","wood_late_color_power","wood_ray_ellipse_z2x","wood_diffuse_perlin_scale_z","wood_latewood_sharpness","wood_diffuse_lobe_weight","wood_groove_roughness","wood_secondary_perlin_scale_z","wood_ray_color_power","wood_fiber_perlin_scale_z","wood_secondary_color_power","wood_pore_color_power","wood_curly_distortion_scale","bumpmap_RGBAmount","bumpmap_UOffset","bumpmap_VOffset","bumpmap_UScale","bumpmap_VScale","unifiedbitmap_RGBAmount","unifiedbitmap_UOffset","unifiedbitmap_VOffset","unifiedbitmap_UScale","unifiedbitmap_VScale","opaque_luminance","transparent_ior","illuminance","white_luminance"];if(d.indexOf(a)>=0)return Vb(a,b);if(e.indexOf(a)>=0)return Vb(a,b)[0];var f=Tb(a,b),g=Sb(a,b,c);if(g)return f&&(g.unit=f),g;if(c.unitsProps?c.unitsProps[a]:f)return{value:Wb(a,b),unit:f||"inch"};var h=Vb(a,b);return h=1===h.length?h[0]:h,c.scalarValues?h:{value:h}}function $b(a,b){var c=Ub(a,b);return Array.isArray(c)||(c.hasOwnProperty("default")||Pb(b,a,"String object missing a default language value."),c=c.default),Array.isArray(c)||Pb(a,b,"Expected an array value."),1===c.length?c[0]:c}function _b(a,b,c){b.hasOwnProperty("binary_connections")||Pb(a,b,"Expected binary connections field in value.");var d=b.binary_connections;if(1===d.length)return Rb(a,d[0],c);Pb(a,b,"Invalid binary connections field.")}function ac(a,b){if("boolean"==typeof b)return b;var c=Wb(a,b);return"boolean"!=typeof c&&Pb(a,c,"Boolean value expected."),c}function bc(a,b){if("number"==typeof b)return b;var c=Wb(a,b);return Number.isInteger(c)||Pb(a,c,"Integer value expected."),c}function cc(a,b){var c={};return Object.keys(a).forEach(function(d){if(ym.hasOwnProperty(d)){var e=a[d],f=ym[d];Object.keys(e).forEach(function(a){var d=a;d in Am&&(d=Am[d]),Qb(d)||(c[d]=f(a,e[a],b))})}}),c}function dc(a,b){var c={options:{},files:{}};if(c.options.data=cc(a.properties,{innerMats:{},getURL:b,unitsProps:zm,scalarValues:!0}),a.properties.uris){var d="BumpMap"==c.options.data.protein_type?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",e=Wb(d,a.properties.uris[d]);e&&(c.files[d]={properties:b(e),options:{title:e,description:e,name:e,uri:e}})}return c}function ec(a,b){if(!ck.isPrismMaterial(a))return null;if(a.userassets.length>1||0===a.userassets.length)throw new Error("Illegal asset definition. Correct number of userassets: ["+a.userassets+"]");var c=a.userassets[0];if(!a.materials||!a.materials.hasOwnProperty(c))throw new Error("Illegal asset definition. Missing user definition: ["+c+"]");var d=a.materials[c],e={type:d.definition,options:{}},f=cc(d.properties,{innerMats:a.materials,getURL:b});return f.protein_type=d.definition,f.private_tags=[d.tag,d.tag,d.tag,d.tag,d.tag],f.bumpmap_Type&&(f.bumpmap_NormalScale=f.bumpmap_NormalScale||1),"PrismWood"===e.type&&(f.hasOwnProperty("wood_curly_distortion_enable")||(f.wood_curly_distortion_enable=!1,f.wood_curly_distortion_scale=.15)),"PrismIBL"===e.type&&f.hasOwnProperty("center_angle")&&(f.center_angle.unit="radian"),e.options.data=f,e.options.tags=d.categories,e}function fc(a){var c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new b.Color(1,1,1);a=(a||{}).value||{};var e=d;if(a.srgb24bit&&a.srgb24bit.length>=3){var f=a.srgb24bit.slice(0,3).map(function(a){return a/255}),g=Gl(f,3),h=g[0],i=g[1],j=g[2];if(c){var k=[h,i,j].map(gc),l=Gl(k,3);h=l[0],i=l[1],j=l[2]}e.setRGB(h,i,j)}else if(a.linearFloat&&a.linearFloat.length>=3){var m=a.linearFloat.slice(0,3),n=Gl(m,3),o=n[0],p=n[1],q=n[2];if(!c){var r=[o,p,q].map(hc),s=Gl(r,3);o=s[0],p=s[1],q=s[2]}e.setRGB(o,p,q)}return e}function gc(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function hc(a){return a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)}function ic(a){return a&&a.length?a[0]:void 0}function jc(a){return a&&a.texture?a.texture[0]:void 0}function kc(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a?"object"===(void 0===a?"undefined":Al(a))?void 0===a.value?b:a.value:a:b}function lc(a,b){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"inch",d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a=a||{};var e=a.unit||c;return(a.value||d)*(Dm[b]||1)/(Dm[e]||1)}function mc(a){var b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a=a||{};var d=a.unit||"degree",e=a.value||c;return b?"degree"===d?e:180*e/Math.PI:"degree"===d?e*Math.PI/180:e}function nc(){var a=[0,128,64,191,32,160,96,223,16,143,80,207,48,175,112,239,8,135,72,199,40,167,103,231,25,151,88,215,56,183,120,250],c=new Uint8Array(a),d=new b.DataTexture(c,32,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);d.generateMipmaps=!1,d.flipY=!1,d.needsUpdate=!0;for(var e=function(a,b){return Math.atan2(a*b,Math.sqrt(a*a+b*b+1))},f=new Uint8Array(16384),g=0;g<128;++g)for(var h=0;h<128;++h){var i=g/128*2-1,j=h/128*2-1;i=Math.min(Math.max(1/128-1,i),1-1/128),j=Math.min(Math.max(1/128-1,j),1-1/128);var k=i-1/128,l=i+1/128,m=j-1/128,n=j+1/128,o=e(l,n)-e(k,n)-e(l,m)+e(k,m);f[128*g+h]=1e6*o}var p=new b.DataTexture(f,128,128,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);p.generateMipmaps=!1,p.flipY=!1,p.needsUpdate=!0,Em={randomNum:d,solidAngle:p}}function oc(){var a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Uint8Array(a),d=new b.DataTexture(c,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);d.generateMipmaps=!1,d.flipY=!1,d.needsUpdate=!0;var e=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],f=new Uint8Array(e),g=new b.DataTexture(f,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);g.generateMipmaps=!1,g.flipY=!1,g.needsUpdate=!0;for(var h=function(b){return a[b%256]},i=new Array(262144),j=0;j<256;j++)for(var k=0;k<256;k++){var l=h(k)+j,m=h(l),n=h(l+1),o=h(k+1)+j,p=h(o),q=h(o+1),r=4*(256*j+k);i[r]=m,i[r+1]=n,i[r+2]=p,i[r+3]=q}var s=new Uint8Array(i),t=new b.DataTexture(s,256,256,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0;for(var u=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],v=new Array(1024),w=0;w<256;++w){var x=a[w]%16;v[4*w]=127*u[3*x]+128,v[4*w+1]=127*u[3*x+1]+128,v[4*w+2]=127*u[3*x+2]+128,v[4*w+3]=0}var y=new Uint8Array(v),z=new b.DataTexture(y,256,1,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);z.generateMipmaps=!1,z.flipY=!1,z.needsUpdate=!0,Fm={permutation:d,gradient:g,perm2d:t,permGrad:z}}function pc(a,c,d){var e=0,f=new b.Vector4(1,1,1,1),g=new b.Vector4(1,1,1,1),h=c.options.data["wood_"+d+"_prof"];if(h&&h.length>0){e=h.length/2;for(var i=0;i<e;i++)g.setComponent(i,1/h[2*i]),f.setComponent(i,h[2*i+1])}a["wood_"+d+"_enable"]=kc(c.options.data["wood_"+d+"_enable"]),a["wood_"+d+"_bands"]=e,a["wood_"+d+"_weights"]=f,a["wood_"+d+"_frequencies"]=g}function qc(a,c,d,e){var f=a.textureObj;c.name=f.options.title,c.clampS=(f.options.data.texture_URepeat,!1),c.clampT=(f.options.data.texture_VRepeat,!1),c.wrapS=c.clampS?b.ClampToEdgeWrapping:b.RepeatWrapping,c.wrapT=c.clampT?b.ClampToEdgeWrapping:b.RepeatWrapping;var g=lc(f.options.data.texture_RealWorldOffsetX,d,"inch"),h=lc(f.options.data.texture_RealWorldOffsetY,d,"inch"),i=f.options.data.texture_UOffset||0,j=f.options.data.texture_VOffset||0,k=void 0,l=void 0;k=lc(f.options.data.texture_RealWorldScaleX,d,"inch",1),l=lc(f.options.data.texture_RealWorldScaleY,d,"inch",1);var m=f.options.data.texture_UScale||1,n=f.options.data.texture_VScale||1,o=mc(f.options.data.texture_WAngle,!1),p=Math.cos(o),q=Math.sin(o),r=m/k,s=n/l;if(c.matrix={elements:[p*r,q*s,0,-q*s,p*s,0,-p*r*g+q*s*h+i,-q*r*g-p*s*h+j,1]},"BumpMap"===f.options.data.protein_type)if(c.bumpmapType=Bm[f.options.data.bumpmap_Type]||0,0===c.bumpmapType){var t=lc(f.options.data.bumpmap_Depth,d,"inch",1);c.bumpScale=new b.Vector2(t/k,t/l)}else{var u=f.options.data.bumpmap_NormalScale||1;c.bumpScale=new b.Vector2(u,u)}else c.invert=f.options.data.unifiedbitmap_Invert||!1}function rc(a,c,d,e){if(e){if(!e.isPrismMaterial)return null;e.needsUpdate=!0}else e=Yj();e.proteinMat=a,e.proteinCategories=a.options.tags,e.packedNormals=!0,e.name=a.options.data.private_tags[2],e.tag=a.options.data.private_tags[2],e.prismType=a.options.data.protein_type||"",e.side=b.DoubleSide,e.transparent=!1,e.envExponentMin=1,e.envExponentMax=512,e.envExponentCount=10;var f=d||{};switch(e.surface_albedo=fc(a.options.data.surface_albedo),f.surface_albedo_map=jc(a.options.data.surface_albedo),e.surface_anisotropy=kc(a.options.data.surface_anisotropy),f.surface_anisotropy_map=jc(a.options.data.surface_anisotropy),f.surface_cutout_map=ic(a.options.data.surface_cutout),e.surface_ndf_type=Cm[a.options.data.surface_ndf_type]||1,f.surface_normal_map=jc(a.options.data.surface_normal),e.surface_rotation=mc(a.options.data.surface_rotation,!0),f.surface_rotation_map=jc(a.options.data.surface_rotation),e.surface_roughness=kc(a.options.data.surface_roughness,.2),f.surface_roughness_map=jc(a.options.data.surface_roughness),f.surface_cutout_map&&(e.side=b.DoubleSide,e.transparent=!0),e.prismType){case"PrismOpaque":e.opaque_albedo=fc(a.options.data.opaque_albedo),f.opaque_albedo_map=jc(a.options.data.opaque_albedo),e.opaque_emission=!!a.options.data.opaque_emission||!1,e.opaque_f0=kc(a.options.data.opaque_f0,.02),f.opaque_f0_map=jc(a.options.data.opaque_f0),e.opaque_luminance=a.options.data.opaque_luminance||0,e.opaque_luminance_modifier=fc(a.options.data.opaque_luminance_modifier,!0),f.opaque_luminance_modifier_map=jc(a.options.data.opaque_luminance_modifier),e.opaque_mfp=lc(a.options.data.opaque_mfp,c,"millimeter"),e.opaque_mfp_modifier=fc(a.options.data.opaque_mfp_modifier),f.opaque_mfp_modifier_map=jc(a.options.data.opaque_mfp_modifier),e.opaque_translucency=!!a.options.data.opaque_translucency||!1;break;case"PrismMetal":e.metal_f0=fc(a.options.data.metal_f0,!0),f.metal_f0_map=jc(a.options.data.metal_f0);break;case"PrismLayered":e.layered_anisotropy=kc(a.options.data.layered_anisotropy),f.layered_anisotropy_map=jc(a.options.data.layered_anisotropy),e.layered_bottom_f0=fc(a.options.data.layered_bottom_f0,!0),f.layered_bottom_f0_map=jc(a.options.data.layered_bottom_f0),e.layered_diffuse=fc(a.options.data.layered_diffuse,!0),f.layered_diffuse_map=jc(a.options.data.layered_diffuse),e.layered_f0=kc(a.options.data.layered_f0,.02),f.layered_f0_map=jc(a.options.data.layered_f0),e.layered_fraction=kc(a.options.data.layered_fraction,.5),f.layered_fraction_map=jc(a.options.data.layered_fraction),e.layered_ndf_type=Cm[a.options.data.layered_ndf_type]||1,f.layered_normal_map=jc(a.options.data.layered_normal),e.layered_rotation=mc(a.options.data.layered_rotation,!0),f.layered_rotation_map=jc(a.options.data.layered_rotation),e.layered_roughness=kc(a.options.data.layered_roughness,.2),f.layered_roughness_map=jc(a.options.data.layered_roughness);break;case"PrismTransparent":e.transparent=!0,e.transparent_color=fc(a.options.data.transparent_color,!0),e.transparent_distance=lc(a.options.data.transparent_distance,c,"inch",.125),e.transparent_ior=a.options.data.transparent_ior||1.5;break;case"PrismWood":pc(e,a,"diffuse_perlin"),pc(e,a,"earlycolor_perlin"),pc(e,a,"fiber_cosine"),pc(e,a,"fiber_perlin"),pc(e,a,"growth_perlin"),pc(e,a,"latecolor_perlin"),f.wood_curly_distortion_map=ic(a.options.data.wood_curly_distortion_map),e.wood_curly_distortion_enable=kc(a.options.data.wood_curly_distortion_enable),e.wood_curly_distortion_scale=kc(a.options.data.wood_curly_distortion_scale),e.wood_diffuse_lobe_weight=kc(a.options.data.wood_diffuse_lobe_weight),e.wood_diffuse_perlin_scale_z=kc(a.options.data.wood_diffuse_perlin_scale_z),e.wood_early_color=fc(a.options.data.wood_early_color,!0),e.wood_earlywood_sharpness=kc(a.options.data.wood_earlywood_sharpness),e.wood_latewood_sharpness=kc(a.options.data.wood_latewood_sharpness),e.wood_fiber_perlin_scale_z=kc(a.options.data.wood_fiber_perlin_scale_z),
e.wood_groove_roughness=kc(a.options.data.wood_groove_roughness),e.wood_late_color_power=kc(a.options.data.wood_late_color_power),e.wood_latewood_bump_depth=kc(a.options.data.wood_latewood_bump_depth),e.wood_latewood_ratio=kc(a.options.data.wood_latewood_ratio),e.wood_manual_late_color=fc(a.options.data.wood_manual_late_color,!0),e.wood_pore_cell_dim=kc(a.options.data.wood_pore_cell_dim),e.wood_pore_color_power=kc(a.options.data.wood_pore_color_power),e.wood_pore_depth=kc(a.options.data.wood_pore_depth),e.wood_pore_radius=kc(a.options.data.wood_pore_radius),e.wood_pore_type=kc(a.options.data.wood_pore_type),e.wood_ray_color_power=kc(a.options.data.wood_ray_color_power),e.wood_ray_ellipse_radius_x=kc(a.options.data.wood_ray_ellipse_radius_x),e.wood_ray_ellipse_z2x=kc(a.options.data.wood_ray_ellipse_z2x),e.wood_ray_num_slices=kc(a.options.data.wood_ray_num_slices),e.wood_ray_seg_length_z=kc(a.options.data.wood_ray_seg_length_z),e.wood_ring_thickness=kc(a.options.data.wood_ring_thickness),e.wood_use_groove_roughness=kc(a.options.data.wood_use_groove_roughness),e.wood_use_latewood_bump=kc(a.options.data.wood_use_latewood_bump),e.wood_use_manual_late_color=kc(a.options.data.wood_use_manual_late_color),e.wood_use_pores=kc(a.options.data.wood_use_pores),e.wood_use_rays=kc(a.options.data.wood_use_rays),Fm||oc(),e.uniforms.permutationMap.value=Fm.permutation,e.uniforms.gradientMap.value=Fm.gradient,e.uniforms.perm2DMap.value=Fm.perm2d,e.uniforms.permGradMap.value=Fm.permGrad;break;default:b.warn("Unknown Prism type: "+e.prismType)}return e.enableImportantSampling&&(e.surface_anisotropy||e.surface_rotation||e.layered_anisotropy||e.layered_rotation)&&(Em||nc(),e.uniforms.importantSamplingRandomMap.value=Em.randomNum,e.uniforms.importantSamplingSolidAngleMap.value=Em.solidAngle),e.defines={},e.textureMaps={},e.defines[e.prismType.toUpperCase()]="","PrismWood"===e.prismType&&e.enable3DWoodBump&&(e.defines.PRISMWOODBUMP=""),e.enableImportantSampling&&(e.defines.ENABLEIMPORTANTSAMPLING=""),e.transparent&&(e.lmv_depthWriteTransparent=!0,e.depthWrite=!0),Object.keys(f).forEach(function(a){f[a]?(e.textureMaps[a]={mapName:a,isPrism:!0},e.defines["USE_"+a.toUpperCase()]=""):delete f[a]}),e}var sc={type:"git",url:"https://git.autodesk.com/WGS/wgs.js.git"},tc={build:"gulp",dev:"gulp serve",serve:"gulp serve",watch:"gulp watch",clean:"gulp clean",tsc:"tsc",docs:"typedoc --out docs/ src/",test:"typings install && mocha -r ts-node/register ./tests/unittests/test*.ts",eslint:"eslint src --ext=.ts",postpublish:"gulp deploy"},uc={"@types/three":"0.84.8","core-js":"2.5.0",xhr2:"0.1.4"},vc={three:"0.71.0"},wc={"@types/chai":"4.0.0","@types/mocha":"2.2.41","babel-core":"6.25.0","babel-plugin-external-helpers":"6.22.0","babel-preset-es2015":"6.24.1","browser-sync":"2.18.12",chai:"4.0.2",del:"3.0.0",eslint:"3.19.0","eslint-plugin-import":"2.3.0",gulp:"3.9.1","gulp-concat":"2.6.1","gulp-load-plugins":"1.5.0","gulp-mirror":"1.0.0","gulp-rename":"1.2.2","gulp-s3-upload":"1.6.4","gulp-sourcemaps":"2.6.0","gulp-typescript":"3.2.1","gulp-uglify":"3.0.0","merge-stream":"1.0.1",mocha:"3.4.2",rollup:"0.42.0","rollup-plugin-babel":"2.7.1","rollup-plugin-commonjs":"8.0.2","rollup-plugin-json":"2.3.0","rollup-plugin-includepaths":"0.2.2","rollup-plugin-node-resolve":"3.0.0","rollup-plugin-sourcemaps":"0.4.2","rollup-plugin-typescript":"0.8.1","rollup-stream":"1.21.0","run-sequence":"2.0.0","ts-node":"3.0.6",typedoc:"0.7.1",typescript:"2.3.4","typescript-eslint-parser":"3.0.0",typings:"2.1.1","vinyl-buffer":"1.0.0","vinyl-source-stream":"1.1.0"},xc={registry:"https://art-bobcat.autodesk.com/artifactory/api/npm/autodesk-npm",access:"public"},yc={name:"@adsk/wgs.js",version:"0.0.16",description:"Collection of components for three.js",license:"UNLICENSED",repository:sc,main:"dist/wgs.js",module:"dist/wgs.module.js",scripts:tc,dependencies:uc,peerDependencies:vc,devDependencies:wc,publishConfig:xc},zc=d(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),Ac={}.hasOwnProperty,Bc=function(a,b){return Ac.call(a,b)},Cc=function(a){try{return!!a()}catch(a){return!0}},Dc=!Cc(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Ec=d(function(a){var b=a.exports={version:"2.5.0"};"number"==typeof __e&&(__e=b)}),Fc=function(a){return"object"===(void 0===a?"undefined":g(a))?null!==a:"function"==typeof a},Gc=function(a){if(!Fc(a))throw TypeError(a+" is not an object!");return a},Hc=zc.document,Ic=Fc(Hc)&&Fc(Hc.createElement),Jc=function(a){return Ic?Hc.createElement(a):{}},Kc=!Dc&&!Cc(function(){return 7!=Object.defineProperty(Jc("div"),"a",{get:function(){return 7}}).a}),Lc=function(a,b){if(!Fc(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!Fc(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!Fc(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!Fc(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},Mc=Object.defineProperty,Nc=Dc?Object.defineProperty:function(a,b,c){if(Gc(a),b=Lc(b,!0),Gc(c),Kc)try{return Mc(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},Oc={f:Nc},Pc=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},Qc=Dc?function(a,b,c){return Oc.f(a,b,Pc(1,c))}:function(a,b,c){return a[b]=c,a},Rc=0,Sc=Math.random(),Tc=function(a){return"Symbol(".concat(void 0===a?"":a,")_",(++Rc+Sc).toString(36))},Uc=d(function(a){var b=Tc("src"),c=Function.toString,d=(""+c).split("toString");Ec.inspectSource=function(a){return c.call(a)},(a.exports=function(a,c,e,f){var g="function"==typeof e;g&&(Bc(e,"name")||Qc(e,"name",c)),a[c]!==e&&(g&&(Bc(e,b)||Qc(e,b,a[c]?""+a[c]:d.join(String(c)))),a===zc?a[c]=e:f?a[c]?a[c]=e:Qc(a,c,e):(delete a[c],Qc(a,c,e)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[b]||c.call(this)})}),Vc=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},Wc=function(a,b,c){if(Vc(a),void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)}}return function(){return a.apply(b,arguments)}},Xc=function a(b,c,d){var e,f,g,h,i=b&a.F,j=b&a.G,k=b&a.S,l=b&a.P,m=b&a.B,n=j?zc:k?zc[c]||(zc[c]={}):(zc[c]||{}).prototype,o=j?Ec:Ec[c]||(Ec[c]={}),p=o.prototype||(o.prototype={});j&&(d=c);for(e in d)f=!i&&n&&void 0!==n[e],g=(f?n:d)[e],h=m&&f?Wc(g,zc):l&&"function"==typeof g?Wc(Function.call,g):g,n&&Uc(n,e,g,b&a.U),o[e]!=g&&Qc(o,e,h),l&&p[e]!=g&&(p[e]=g)};zc.core=Ec,Xc.F=1,Xc.G=2,Xc.S=4,Xc.P=8,Xc.B=16,Xc.W=32,Xc.U=64,Xc.R=128;var Yc=Xc,Zc=d(function(a){var b=Tc("meta"),c=Oc.f,d=0,e=Object.isExtensible||function(){return!0},f=!Cc(function(){return e(Object.preventExtensions({}))}),h=function(a){c(a,b,{value:{i:"O"+ ++d,w:{}}})},i=function(a,c){if(!Fc(a))return"symbol"==(void 0===a?"undefined":g(a))?a:("string"==typeof a?"S":"P")+a;if(!Bc(a,b)){if(!e(a))return"F";if(!c)return"E";h(a)}return a[b].i},j=function(a,c){if(!Bc(a,b)){if(!e(a))return!0;if(!c)return!1;h(a)}return a[b].w},k=function(a){return f&&l.NEED&&e(a)&&!Bc(a,b)&&h(a),a},l=a.exports={KEY:b,NEED:!1,fastKey:i,getWeak:j,onFreeze:k}}),$c=zc["__core-js_shared__"]||(zc["__core-js_shared__"]={}),_c=function(a){return $c[a]||($c[a]={})},ad=d(function(a){var b=_c("wks"),c=zc.Symbol,d="function"==typeof c;(a.exports=function(a){return b[a]||(b[a]=d&&c[a]||(d?c:Tc)("Symbol."+a))}).store=b}),bd=Oc.f,cd=ad("toStringTag"),dd=function(a,b,c){a&&!Bc(a=c?a:a.prototype,cd)&&bd(a,cd,{configurable:!0,value:b})},ed=ad,fd={f:ed},gd=Oc.f,hd={}.toString,id=function(a){return hd.call(a).slice(8,-1)},jd=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==id(a)?a.split(""):Object(a)},kd=function(a){if(void 0==a)throw TypeError("Can't call method on  "+a);return a},ld=function(a){return jd(kd(a))},md=Math.ceil,nd=Math.floor,od=function(a){return isNaN(a=+a)?0:(a>0?nd:md)(a)},pd=Math.min,qd=function(a){return a>0?pd(od(a),9007199254740991):0},rd=Math.max,sd=Math.min,td=function(a,b){return a=od(a),a<0?rd(a+b,0):sd(a,b)},ud=function(a){return function(b,c,d){var e,f=ld(b),g=qd(f.length),h=td(d,g);if(a&&c!=c){for(;g>h;)if((e=f[h++])!=e)return!0}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}},vd=_c("keys"),wd=function(a){return vd[a]||(vd[a]=Tc(a))},xd=ud(!1),yd=wd("IE_PROTO"),zd=function(a,b){var c,d=ld(a),e=0,f=[];for(c in d)c!=yd&&Bc(d,c)&&f.push(c);for(;b.length>e;)Bc(d,c=b[e++])&&(~xd(f,c)||f.push(c));return f},Ad="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),Bd=Object.keys||function(a){return zd(a,Ad)},Cd=function(a,b){for(var c,d=ld(a),e=Bd(d),f=e.length,g=0;f>g;)if(d[c=e[g++]]===b)return c},Dd=Object.getOwnPropertySymbols,Ed={f:Dd},Fd={}.propertyIsEnumerable,Gd={f:Fd},Hd=function(a){var b=Bd(a),c=Ed.f;if(c)for(var d,e=c(a),f=Gd.f,g=0;e.length>g;)f.call(a,d=e[g++])&&b.push(d);return b},Id=Array.isArray||function(a){return"Array"==id(a)},Jd=Dc?Object.defineProperties:function(a,b){Gc(a);for(var c,d=Bd(b),e=d.length,f=0;e>f;)Oc.f(a,c=d[f++],b[c]);return a},Kd=zc.document,Ld=Kd&&Kd.documentElement,Md=wd("IE_PROTO"),Nd=function(){},Od=function(){var a,b=Jc("iframe"),c=Ad.length;for(b.style.display="none",Ld.appendChild(b),b.src="javascript:",a=b.contentWindow.document,a.open(),a.write("<script>document.F=Object<\/script>"),a.close(),Od=a.F;c--;)delete Od.prototype[Ad[c]];return Od()},Pd=Object.create||function(a,b){var c;return null!==a?(Nd.prototype=Gc(a),c=new Nd,Nd.prototype=null,c[Md]=a):c=Od(),void 0===b?c:Jd(c,b)},Qd=Ad.concat("length","prototype"),Rd=Object.getOwnPropertyNames||function(a){return zd(a,Qd)},Sd={f:Rd},Td=Sd.f,Ud={}.toString,Vd="object"==("undefined"==typeof window?"undefined":g(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Wd=function(a){try{return Td(a)}catch(a){return Vd.slice()}},Xd=function(a){return Vd&&"[object Window]"==Ud.call(a)?Wd(a):Td(ld(a))},Yd={f:Xd},Zd=Object.getOwnPropertyDescriptor,$d=Dc?Zd:function(a,b){if(a=ld(a),b=Lc(b,!0),Kc)try{return Zd(a,b)}catch(a){}if(Bc(a,b))return Pc(!Gd.f.call(a,b),a[b])},_d={f:$d},ae=Zc.KEY,be=_d.f,ce=Oc.f,de=Yd.f,ee=zc.Symbol,fe=zc.JSON,ge=fe&&fe.stringify,he=ad("_hidden"),ie=ad("toPrimitive"),je={}.propertyIsEnumerable,ke=_c("symbol-registry"),le=_c("symbols"),me=_c("op-symbols"),ne=Object.prototype,oe="function"==typeof ee,pe=zc.QObject,qe=!pe||!pe.prototype||!pe.prototype.findChild,re=Dc&&Cc(function(){return 7!=Pd(ce({},"a",{get:function(){return ce(this,"a",{value:7}).a}})).a})?function(a,b,c){var d=be(ne,b);d&&delete ne[b],ce(a,b,c),d&&a!==ne&&ce(ne,b,d)}:ce,se=function(a){var b=le[a]=Pd(ee.prototype);return b._k=a,b},te=oe&&"symbol"==g(ee.iterator)?function(a){return"symbol"==(void 0===a?"undefined":g(a))}:function(a){return a instanceof ee},ue=function(a,b,c){return a===ne&&ue(me,b,c),Gc(a),b=Lc(b,!0),Gc(c),Bc(le,b)?(c.enumerable?(Bc(a,he)&&a[he][b]&&(a[he][b]=!1),c=Pd(c,{enumerable:Pc(0,!1)})):(Bc(a,he)||ce(a,he,Pc(1,{})),a[he][b]=!0),re(a,b,c)):ce(a,b,c)},ve=function(a,b){Gc(a);for(var c,d=Hd(b=ld(b)),e=0,f=d.length;f>e;)ue(a,c=d[e++],b[c]);return a},we=function(a,b){return void 0===b?Pd(a):ve(Pd(a),b)},xe=function(a){var b=je.call(this,a=Lc(a,!0));return!(this===ne&&Bc(le,a)&&!Bc(me,a))&&(!(b||!Bc(this,a)||!Bc(le,a)||Bc(this,he)&&this[he][a])||b)},ye=function(a,b){if(a=ld(a),b=Lc(b,!0),a!==ne||!Bc(le,b)||Bc(me,b)){var c=be(a,b);return!c||!Bc(le,b)||Bc(a,he)&&a[he][b]||(c.enumerable=!0),c}},ze=function(a){for(var b,c=de(ld(a)),d=[],e=0;c.length>e;)Bc(le,b=c[e++])||b==he||b==ae||d.push(b);return d},Ae=function(a){for(var b,c=a===ne,d=de(c?me:ld(a)),e=[],f=0;d.length>f;)!Bc(le,b=d[f++])||c&&!Bc(ne,b)||e.push(le[b]);return e};oe||(ee=function(){if(this instanceof ee)throw TypeError("Symbol is not a constructor!");var a=Tc(arguments.length>0?arguments[0]:void 0),b=function b(c){this===ne&&b.call(me,c),Bc(this,he)&&Bc(this[he],a)&&(this[he][a]=!1),re(this,a,Pc(1,c))};return Dc&&qe&&re(ne,a,{configurable:!0,set:b}),se(a)},Uc(ee.prototype,"toString",function(){return this._k}),_d.f=ye,Oc.f=ue,Sd.f=Yd.f=ze,Gd.f=xe,Ed.f=Ae,Dc&&Uc(ne,"propertyIsEnumerable",xe,!0),fd.f=function(a){return se(ad(a))}),Yc(Yc.G+Yc.W+Yc.F*!oe,{Symbol:ee});for(var Be="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Ce=0;Be.length>Ce;)ad(Be[Ce++]);for(var De=Bd(ad.store),Ee=0;De.length>Ee;)!function(a){var b=Ec.Symbol||(Ec.Symbol=zc.Symbol||{});"_"==a.charAt(0)||a in b||gd(b,a,{value:fd.f(a)})}(De[Ee++]);Yc(Yc.S+Yc.F*!oe,"Symbol",{for:function(a){return Bc(ke,a+="")?ke[a]:ke[a]=ee(a)},keyFor:function(a){if(te(a))return Cd(ke,a);throw TypeError(a+" is not a symbol!")},useSetter:function(){qe=!0},useSimple:function(){qe=!1}}),Yc(Yc.S+Yc.F*!oe,"Object",{create:we,defineProperty:ue,defineProperties:ve,getOwnPropertyDescriptor:ye,getOwnPropertyNames:ze,getOwnPropertySymbols:Ae}),fe&&Yc(Yc.S+Yc.F*(!oe||Cc(function(){var a=ee();return"[null]"!=ge([a])||"{}"!=ge({a:a})||"{}"!=ge(Object(a))})),"JSON",{stringify:function(a){if(void 0!==a&&!te(a)){for(var b,c,d=[a],e=1;arguments.length>e;)d.push(arguments[e++]);return b=d[1],"function"==typeof b&&(c=b),!c&&Id(b)||(b=function(a,b){if(c&&(b=c.call(this,a,b)),!te(b))return b}),d[1]=b,ge.apply(fe,d)}}}),ee.prototype[ie]||Qc(ee.prototype,ie,ee.prototype.valueOf),dd(ee,"Symbol"),dd(Math,"Math",!0),dd(zc.JSON,"JSON",!0);var Fe=ad("toStringTag"),Ge="Arguments"==id(function(){return arguments}()),He=function(a,b){try{return a[b]}catch(a){}},Ie=function(a){var b,c,d;return void 0===a?"Undefined":null===a?"Null":"string"==typeof(c=He(b=Object(a),Fe))?c:Ge?id(b):"Object"==(d=id(b))&&"function"==typeof b.callee?"Arguments":d},Je={};Je[ad("toStringTag")]="z",Je+""!="[object z]"&&Uc(Object.prototype,"toString",function(){return"[object "+Ie(this)+"]"},!0);var Ke={},Le={};Qc(Le,ad("iterator"),function(){return this});var Me=function(a,b,c){a.prototype=Pd(Le,{next:Pc(1,c)}),dd(a,b+" Iterator")},Ne=function(a){return Object(kd(a))},Oe=wd("IE_PROTO"),Pe=Object.prototype,Qe=Object.getPrototypeOf||function(a){return a=Ne(a),Bc(a,Oe)?a[Oe]:"function"==typeof a.constructor&&a instanceof a.constructor?a.constructor.prototype:a instanceof Object?Pe:null},Re=ad("iterator"),Se=!([].keys&&"next"in[].keys()),Te=function(){return this},Ue=function(a,b,c,d,e,f,g){Me(c,b,d);var h,i,j,k=function(a){if(!Se&&a in o)return o[a];switch(a){case"keys":case"values":return function(){return new c(this,a)}}return function(){return new c(this,a)}},l=b+" Iterator",m="values"==e,n=!1,o=a.prototype,p=o[Re]||o["@@iterator"]||e&&o[e],q=p||k(e),r=e?m?k("entries"):q:void 0,s="Array"==b?o.entries||p:p;if(s&&(j=Qe(s.call(new a)))!==Object.prototype&&j.next&&(dd(j,l,!0),Bc(j,Re)||Qc(j,Re,Te)),m&&p&&"values"!==p.name&&(n=!0,q=function(){return p.call(this)}),(Se||n||!o[Re])&&Qc(o,Re,q),Ke[b]=q,Ke[l]=Te,e)if(h={values:m?q:k("values"),keys:f?q:k("keys"),entries:r},g)for(i in h)i in o||Uc(o,i,h[i]);else Yc(Yc.P+Yc.F*(Se||n),b,h);return h},Ve=function(a){return function(b,c){var d,e,f=String(kd(b)),g=od(c),h=f.length;return g<0||g>=h?a?"":void 0:(d=f.charCodeAt(g),d<55296||d>56319||g+1===h||(e=f.charCodeAt(g+1))<56320||e>57343?a?f.charAt(g):d:a?f.slice(g,g+2):e-56320+(d-55296<<10)+65536)}}(!0);Ue(String,"String",function(a){this._t=String(a),this._i=0},function(){var a,b=this._t,c=this._i;return c>=b.length?{value:void 0,done:!0}:(a=Ve(b,c),this._i+=a.length,{value:a,done:!1})}),Yc(Yc.S,"Array",{isArray:Id});var We=function(a,b,c,d){try{return d?b(Gc(c)[0],c[1]):b(c)}catch(b){var e=a.return;throw void 0!==e&&Gc(e.call(a)),b}},Xe=ad("iterator"),Ye=Array.prototype,Ze=function(a){return void 0!==a&&(Ke.Array===a||Ye[Xe]===a)},$e=function(a,b,c){b in a?Oc.f(a,b,Pc(0,c)):a[b]=c},_e=ad("iterator"),af=Ec.getIteratorMethod=function(a){if(void 0!=a)return a[_e]||a["@@iterator"]||Ke[Ie(a)]},bf=ad("iterator"),cf=!1;try{var df=[7][bf]();df.return=function(){cf=!0},Array.from(df,function(){throw 2})}catch(a){}var ef=function(a,b){if(!b&&!cf)return!1;var c=!1;try{var d=[7],e=d[bf]();e.next=function(){return{done:c=!0}},d[bf]=function(){return e},a(d)}catch(a){}return c};Yc(Yc.S+Yc.F*!ef(function(a){Array.from(a)}),"Array",{from:function(a){var b,c,d,e,f=Ne(a),g="function"==typeof this?this:Array,h=arguments.length,i=h>1?arguments[1]:void 0,j=void 0!==i,k=0,l=af(f);if(j&&(i=Wc(i,h>2?arguments[2]:void 0,2)),void 0==l||g==Array&&Ze(l))for(b=qd(f.length),c=new g(b);b>k;k++)$e(c,k,j?i(f[k],k):f[k]);else for(e=l.call(f),c=new g;!(d=e.next()).done;k++)$e(c,k,j?We(e,i,[d.value,k],!0):d.value);return c.length=k,c}}),Yc(Yc.S+Yc.F*Cc(function(){function a(){}return!(Array.of.call(a)instanceof a)}),"Array",{of:function(){for(var a=0,b=arguments.length,c=new("function"==typeof this?this:Array)(b);b>a;)$e(c,a,arguments[a++]);return c.length=b,c}});var ff=function(a,b){return!!a&&Cc(function(){b?a.call(null,function(){},1):a.call(null)})},gf=[].join;Yc(Yc.P+Yc.F*(jd!=Object||!ff(gf)),"Array",{join:function(a){return gf.call(ld(this),void 0===a?",":a)}});var hf=[].slice;Yc(Yc.P+Yc.F*Cc(function(){Ld&&hf.call(Ld)}),"Array",{slice:function(a,b){var c=qd(this.length),d=id(this);if(b=void 0===b?c:b,"Array"==d)return hf.call(this,a,b);for(var e=td(a,c),f=td(b,c),g=qd(f-e),h=Array(g),i=0;i<g;i++)h[i]="String"==d?this.charAt(e+i):this[e+i];return h}});var jf=[].sort,kf=[1,2,3];Yc(Yc.P+Yc.F*(Cc(function(){kf.sort(void 0)})||!Cc(function(){kf.sort(null)})||!ff(jf)),"Array",{sort:function(a){return void 0===a?jf.call(Ne(this)):jf.call(Ne(this),Vc(a))}});var lf=ad("species"),mf=function(a){var b;return Id(a)&&(b=a.constructor,"function"!=typeof b||b!==Array&&!Id(b.prototype)||(b=void 0),Fc(b)&&null===(b=b[lf])&&(b=void 0)),void 0===b?Array:b},nf=function(a,b){return new(mf(a))(b)},of=function(a,b){var c=1==a,d=2==a,e=3==a,f=4==a,g=6==a,h=5==a||g,i=b||nf;return function(b,j,k){for(var l,m,n=Ne(b),o=jd(n),p=Wc(j,k,3),q=qd(o.length),r=0,s=c?i(b,q):d?i(b,0):void 0;q>r;r++)if((h||r in o)&&(l=o[r],m=p(l,r,n),a))if(c)s[r]=m;else if(m)switch(a){case 3:return!0;case 5:return l;case 6:return r;case 2:s.push(l)}else if(f)return!1;return g?-1:e||f?f:s}},pf=of(0),qf=ff([].forEach,!0);Yc(Yc.P+Yc.F*!qf,"Array",{forEach:function(a){return pf(this,a,arguments[1])}});var rf=of(1);Yc(Yc.P+Yc.F*!ff([].map,!0),"Array",{map:function(a){return rf(this,a,arguments[1])}});var sf=of(2);Yc(Yc.P+Yc.F*!ff([].filter,!0),"Array",{filter:function(a){return sf(this,a,arguments[1])}});var tf=of(3);Yc(Yc.P+Yc.F*!ff([].some,!0),"Array",{some:function(a){return tf(this,a,arguments[1])}});var uf=of(4);Yc(Yc.P+Yc.F*!ff([].every,!0),"Array",{every:function(a){return uf(this,a,arguments[1])}});var vf=function(a,b,c,d,e){Vc(b);var f=Ne(a),g=jd(f),h=qd(f.length),i=e?h-1:0,j=e?-1:1;if(c<2)for(;;){if(i in g){d=g[i],i+=j;break}if(i+=j,e?i<0:h<=i)throw TypeError("Reduce of empty array with no initial value")}for(;e?i>=0:h>i;i+=j)i in g&&(d=b(d,g[i],i,f));return d};Yc(Yc.P+Yc.F*!ff([].reduce,!0),"Array",{reduce:function(a){return vf(this,a,arguments.length,arguments[1],!1)}}),Yc(Yc.P+Yc.F*!ff([].reduceRight,!0),"Array",{reduceRight:function(a){return vf(this,a,arguments.length,arguments[1],!0)}});var wf=ud(!1),xf=[].indexOf,yf=!!xf&&1/[1].indexOf(1,-0)<0;Yc(Yc.P+Yc.F*(yf||!ff(xf)),"Array",{indexOf:function(a){return yf?xf.apply(this,arguments)||0:wf(this,a,arguments[1])}});var zf=[].lastIndexOf,Af=!!zf&&1/[1].lastIndexOf(1,-0)<0;Yc(Yc.P+Yc.F*(Af||!ff(zf)),"Array",{lastIndexOf:function(a){if(Af)return zf.apply(this,arguments)||0;var b=ld(this),c=qd(b.length),d=c-1;for(arguments.length>1&&(d=Math.min(d,od(arguments[1]))),d<0&&(d=c+d);d>=0;d--)if(d in b&&b[d]===a)return d||0;return-1}});var Bf=[].copyWithin||function(a,b){var c=Ne(this),d=qd(c.length),e=td(a,d),f=td(b,d),g=arguments.length>2?arguments[2]:void 0,h=Math.min((void 0===g?d:td(g,d))-f,d-e),i=1;for(f<e&&e<f+h&&(i=-1,f+=h-1,e+=h-1);h-- >0;)f in c?c[e]=c[f]:delete c[e],e+=i,f+=i;return c},Cf=ad("unscopables"),Df=Array.prototype;void 0==Df[Cf]&&Qc(Df,Cf,{});var Ef=function(a){Df[Cf][a]=!0};Yc(Yc.P,"Array",{copyWithin:Bf}),Ef("copyWithin");var Ff=function(a){for(var b=Ne(this),c=qd(b.length),d=arguments.length,e=td(d>1?arguments[1]:void 0,c),f=d>2?arguments[2]:void 0,g=void 0===f?c:td(f,c);g>e;)b[e++]=a;return b};Yc(Yc.P,"Array",{fill:Ff}),Ef("fill");var Gf=of(5),Hf=!0;"find"in[]&&Array(1).find(function(){Hf=!1}),Yc(Yc.P+Yc.F*Hf,"Array",{find:function(a){return Gf(this,a,arguments.length>1?arguments[1]:void 0)}}),Ef("find");var If=of(6),Jf=!0;"findIndex"in[]&&Array(1).findIndex(function(){Jf=!1}),Yc(Yc.P+Yc.F*Jf,"Array",{findIndex:function(a){return If(this,a,arguments.length>1?arguments[1]:void 0)}}),Ef("findIndex");var Kf=ad("species"),Lf=function(a){var b=zc[a];Dc&&b&&!b[Kf]&&Oc.f(b,Kf,{configurable:!0,get:function(){return this}})};Lf("Array");var Mf=function(a,b){return{value:b,done:!!a}},Nf=Ue(Array,"Array",function(a,b){this._t=ld(a),this._i=0,this._k=b},function(){var a=this._t,b=this._k,c=this._i++;return!a||c>=a.length?(this._t=void 0,Mf(1)):"keys"==b?Mf(0,c):"values"==b?Mf(0,a[c]):Mf(0,[c,a[c]])},"values");Ke.Arguments=Ke.Array,Ef("keys"),Ef("values"),Ef("entries");for(var Of,Pf=Tc("typed_array"),Qf=Tc("view"),Rf=!(!zc.ArrayBuffer||!zc.DataView),Sf=Rf,Tf=0,Uf="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");Tf<9;)(Of=zc[Uf[Tf++]])?(Qc(Of.prototype,Pf,!0),Qc(Of.prototype,Qf,!0)):Sf=!1;var Vf={ABV:Rf,CONSTR:Sf,TYPED:Pf,VIEW:Qf},Wf=function(a,b,c){for(var d in b)Uc(a,d,b[d],c);return a},Xf=function(a,b,c,d){if(!(a instanceof b)||void 0!==d&&d in a)throw TypeError(c+": incorrect invocation!");return a},Yf=function(a){if(void 0===a)return 0;var b=od(a),c=qd(b);if(b!==c)throw RangeError("Wrong length!");return c},Zf=d(function(a,b){function c(a,b,c){var d,e,f,g=Array(c),h=8*c-b-1,i=(1<<h)-1,j=i>>1,k=23===b?y(2,-24)-y(2,-77):0,l=0,m=a<0||0===a&&1/a<0?1:0;for(a=x(a),a!=a||a===v?(e=a!=a?1:0,d=i):(d=z(A(a)/B),a*(f=y(2,-d))<1&&(d--,f*=2),a+=d+j>=1?k/f:k*y(2,1-j),a*f>=2&&(d++,f/=2),d+j>=i?(e=0,d=i):d+j>=1?(e=(a*f-1)*y(2,b),d+=j):(e=a*y(2,j-1)*y(2,b),d=0));b>=8;g[l++]=255&e,e/=256,b-=8);for(d=d<<b|e,h+=b;h>0;g[l++]=255&d,d/=256,h-=8);return g[--l]|=128*m,g}function d(a,b,c){var d,e=8*c-b-1,f=(1<<e)-1,g=f>>1,h=e-7,i=c-1,j=a[i--],k=127&j;for(j>>=7;h>0;k=256*k+a[i],i--,h-=8);for(d=k&(1<<-h)-1,k>>=-h,h+=b;h>0;d=256*d+a[i],i--,h-=8);if(0===k)k=1-g;else{if(k===f)return d?NaN:j?-v:v;d+=y(2,b),k-=g}return(j?-1:1)*d*y(2,k-b)}function e(a){return a[3]<<24|a[2]<<16|a[1]<<8|a[0]}function f(a){return[255&a]}function g(a){return[255&a,a>>8&255]}function h(a){return[255&a,a>>8&255,a>>16&255,a>>24&255]}function i(a){return c(a,52,8)}function j(a){return c(a,23,4)}function k(a,b,c){o(a[p],b,{get:function(){return this[c]}})}function l(a,b,c,d){var e=+c,f=Yf(e);if(f+b>a[D])throw u(q);var g=a[C]._b,h=f+a[E],i=g.slice(h,h+b);return d?i:i.reverse()}function m(a,b,c,d,e,f){var g=+c,h=Yf(g);if(h+b>a[D])throw u(q);for(var i=a[C]._b,j=h+a[E],k=d(+e),l=0;l<b;l++)i[j+l]=k[f?l:b-l-1]}var n=Sd.f,o=Oc.f,p="prototype",q="Wrong index!",r=zc.ArrayBuffer,s=zc.DataView,t=zc.Math,u=zc.RangeError,v=zc.Infinity,w=r,x=t.abs,y=t.pow,z=t.floor,A=t.log,B=t.LN2,C=Dc?"_b":"buffer",D=Dc?"_l":"byteLength",E=Dc?"_o":"byteOffset";if(Vf.ABV){if(!Cc(function(){r(1)})||!Cc(function(){new r(-1)})||Cc(function(){return new r,new r(1.5),new r(NaN),"ArrayBuffer"!=r.name})){r=function(a){return Xf(this,r),new w(Yf(a))};for(var F,G=r[p]=w[p],H=n(w),I=0;H.length>I;)(F=H[I++])in r||Qc(r,F,w[F]);G.constructor=r}var J=new s(new r(2)),K=s[p].setInt8;J.setInt8(0,2147483648),J.setInt8(1,2147483649),!J.getInt8(0)&&J.getInt8(1)||Wf(s[p],{setInt8:function(a,b){K.call(this,a,b<<24>>24)},setUint8:function(a,b){K.call(this,a,b<<24>>24)}},!0)}else r=function(a){Xf(this,r,"ArrayBuffer");var b=Yf(a);this._b=Ff.call(Array(b),0),this[D]=b},s=function(a,b,c){Xf(this,s,"DataView"),Xf(a,r,"DataView");var d=a[D],e=od(b);if(e<0||e>d)throw u("Wrong offset!");if(c=void 0===c?d-e:qd(c),e+c>d)throw u("Wrong length!");this[C]=a,this[E]=e,this[D]=c},Dc&&(k(r,"byteLength","_l"),k(s,"buffer","_b"),k(s,"byteLength","_l"),k(s,"byteOffset","_o")),Wf(s[p],{getInt8:function(a){return l(this,1,a)[0]<<24>>24},getUint8:function(a){return l(this,1,a)[0]},getInt16:function(a){var b=l(this,2,a,arguments[1]);return(b[1]<<8|b[0])<<16>>16},getUint16:function(a){var b=l(this,2,a,arguments[1]);return b[1]<<8|b[0]},getInt32:function(a){return e(l(this,4,a,arguments[1]))},getUint32:function(a){return e(l(this,4,a,arguments[1]))>>>0},getFloat32:function(a){return d(l(this,4,a,arguments[1]),23,4)},getFloat64:function(a){return d(l(this,8,a,arguments[1]),52,8)},setInt8:function(a,b){m(this,1,a,f,b)},setUint8:function(a,b){m(this,1,a,f,b)},setInt16:function(a,b){m(this,2,a,g,b,arguments[2])},setUint16:function(a,b){m(this,2,a,g,b,arguments[2])},setInt32:function(a,b){m(this,4,a,h,b,arguments[2])},setUint32:function(a,b){m(this,4,a,h,b,arguments[2])},setFloat32:function(a,b){m(this,4,a,j,b,arguments[2])},setFloat64:function(a,b){m(this,8,a,i,b,arguments[2])}});dd(r,"ArrayBuffer"),dd(s,"DataView"),Qc(s[p],Vf.VIEW,!0),b.ArrayBuffer=r,b.DataView=s}),$f=ad("species"),_f=function(a,b){var c,d=Gc(a).constructor;return void 0===d||void 0==(c=Gc(d)[$f])?b:Vc(c)},ag=zc.ArrayBuffer,bg=Zf.ArrayBuffer,cg=Zf.DataView,dg=Vf.ABV&&ag.isView,eg=bg.prototype.slice,fg=Vf.VIEW;Yc(Yc.G+Yc.W+Yc.F*(ag!==bg),{ArrayBuffer:bg}),Yc(Yc.S+Yc.F*!Vf.CONSTR,"ArrayBuffer",{isView:function(a){return dg&&dg(a)||Fc(a)&&fg in a}}),Yc(Yc.P+Yc.U+Yc.F*Cc(function(){return!new bg(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(a,b){if(void 0!==eg&&void 0===b)return eg.call(Gc(this),a);for(var c=Gc(this).byteLength,d=td(a,c),e=td(void 0===b?c:b,c),f=new(_f(this,bg))(qd(e-d)),g=new cg(this),h=new cg(f),i=0;d<e;)h.setUint8(i++,g.getUint8(d++));return f}}),Lf("ArrayBuffer"),Yc(Yc.G+Yc.W+Yc.F*!Vf.ABV,{DataView:Zf.DataView});var gg=d(function(a){if(Dc){var b=zc,c=Cc,d=Yc,e=Vf,f=Zf,h=Wc,i=Xf,j=Pc,k=Qc,l=Wf,m=od,n=qd,o=Yf,p=td,q=Lc,r=Bc,s=Ie,t=Fc,u=Ne,v=Ze,w=Pd,x=Qe,y=Sd.f,z=af,A=Tc,B=ad,C=of,D=ud,E=_f,F=Nf,G=Ke,H=ef,I=Lf,J=Ff,K=Bf,L=Oc,M=_d,N=L.f,O=M.f,P=b.RangeError,Q=b.TypeError,R=b.Uint8Array,S=Array.prototype,T=f.ArrayBuffer,U=f.DataView,V=C(0),W=C(2),X=C(3),Y=C(4),Z=C(5),$=C(6),_=D(!0),aa=D(!1),ba=F.values,ca=F.keys,da=F.entries,ea=S.lastIndexOf,fa=S.reduce,ga=S.reduceRight,ha=S.join,ia=S.sort,ja=S.slice,ka=S.toString,la=S.toLocaleString,ma=B("iterator"),na=B("toStringTag"),oa=A("typed_constructor"),pa=A("def_constructor"),qa=e.CONSTR,ra=e.TYPED,sa=e.VIEW,ta=C(1,function(a,b){return ya(E(a,a[pa]),b)}),ua=c(function(){return 1===new R(new Uint16Array([1]).buffer)[0]}),va=!!R&&!!R.prototype.set&&c(function(){new R(1).set({})}),wa=function(a,b){var c=m(a);if(c<0||c%b)throw P("Wrong offset!");return c},xa=function(a){if(t(a)&&ra in a)return a;throw Q(a+" is not a typed array!")},ya=function(a,b){if(!(t(a)&&oa in a))throw Q("It is not a typed array constructor!");return new a(b)},za=function(a,b){return Aa(E(a,a[pa]),b)},Aa=function(a,b){for(var c=0,d=b.length,e=ya(a,d);d>c;)e[c]=b[c++];return e},Ba=function(a,b,c){N(a,b,{get:function(){return this._d[c]}})},Ca=function(a){var b,c,d,e,f,g,i=u(a),j=arguments.length,k=j>1?arguments[1]:void 0,l=void 0!==k,m=z(i);if(void 0!=m&&!v(m)){for(g=m.call(i),d=[],b=0;!(f=g.next()).done;b++)d.push(f.value);i=d}for(l&&j>2&&(k=h(k,arguments[2],2)),b=0,c=n(i.length),e=ya(this,c);c>b;b++)e[b]=l?k(i[b],b):i[b];return e},Da=function(){for(var a=0,b=arguments.length,c=ya(this,b);b>a;)c[a]=arguments[a++];return c},Ea=!!R&&c(function(){la.call(new R(1))}),Fa=function(){return la.apply(Ea?ja.call(xa(this)):xa(this),arguments)},Ga={copyWithin:function(a,b){return K.call(xa(this),a,b,arguments.length>2?arguments[2]:void 0)},every:function(a){return Y(xa(this),a,arguments.length>1?arguments[1]:void 0)},fill:function(a){return J.apply(xa(this),arguments)},filter:function(a){return za(this,W(xa(this),a,arguments.length>1?arguments[1]:void 0))},find:function(a){return Z(xa(this),a,arguments.length>1?arguments[1]:void 0)},findIndex:function(a){return $(xa(this),a,arguments.length>1?arguments[1]:void 0)},forEach:function(a){V(xa(this),a,arguments.length>1?arguments[1]:void 0)},indexOf:function(a){return aa(xa(this),a,arguments.length>1?arguments[1]:void 0)},includes:function(a){return _(xa(this),a,arguments.length>1?arguments[1]:void 0)},join:function(a){return ha.apply(xa(this),arguments)},lastIndexOf:function(a){return ea.apply(xa(this),arguments)},map:function(a){return ta(xa(this),a,arguments.length>1?arguments[1]:void 0)},reduce:function(a){return fa.apply(xa(this),arguments)},reduceRight:function(a){return ga.apply(xa(this),arguments)},reverse:function(){for(var a,b=this,c=xa(b).length,d=Math.floor(c/2),e=0;e<d;)a=b[e],b[e++]=b[--c],b[c]=a;return b},some:function(a){return X(xa(this),a,arguments.length>1?arguments[1]:void 0)},sort:function(a){return ia.call(xa(this),a)},subarray:function(a,b){var c=xa(this),d=c.length,e=p(a,d);return new(E(c,c[pa]))(c.buffer,c.byteOffset+e*c.BYTES_PER_ELEMENT,n((void 0===b?d:p(b,d))-e))}},Ha=function(a,b){return za(this,ja.call(xa(this),a,b))},Ia=function(a){xa(this);var b=wa(arguments[1],1),c=this.length,d=u(a),e=n(d.length),f=0;if(e+b>c)throw P("Wrong length!");for(;f<e;)this[b+f]=d[f++]},Ja={entries:function(){return da.call(xa(this))},keys:function(){return ca.call(xa(this))},values:function(){return ba.call(xa(this))}},Ka=function(a,b){return t(a)&&a[ra]&&"symbol"!=(void 0===b?"undefined":g(b))&&b in a&&String(+b)==String(b)},La=function(a,b){return Ka(a,b=q(b,!0))?j(2,a[b]):O(a,b)},Ma=function(a,b,c){return!(Ka(a,b=q(b,!0))&&t(c)&&r(c,"value"))||r(c,"get")||r(c,"set")||c.configurable||r(c,"writable")&&!c.writable||r(c,"enumerable")&&!c.enumerable?N(a,b,c):(a[b]=c.value,a)};qa||(M.f=La,L.f=Ma),d(d.S+d.F*!qa,"Object",{getOwnPropertyDescriptor:La,defineProperty:Ma}),c(function(){ka.call({})})&&(ka=la=function(){return ha.call(this)});var Na=l({},Ga);l(Na,Ja),k(Na,ma,Ja.values),l(Na,{slice:Ha,set:Ia,constructor:function(){},toString:ka,toLocaleString:Fa}),Ba(Na,"buffer","b"),Ba(Na,"byteOffset","o"),Ba(Na,"byteLength","l"),Ba(Na,"length","e"),N(Na,na,{get:function(){return this[ra]}}),a.exports=function(a,f,g,h){h=!!h;var j=a+(h?"Clamped":"")+"Array",l="get"+a,m="set"+a,p=b[j],q=p||{},r=p&&x(p),u=!p||!e.ABV,v={},z=p&&p.prototype,A=function(a,b){var c=a._d;return c.v[l](b*f+c.o,ua)},B=function(a,b,c){var d=a._d;h&&(c=(c=Math.round(c))<0?0:c>255?255:255&c),d.v[m](b*f+d.o,c,ua)},C=function(a,b){N(a,b,{get:function(){return A(this,b)},set:function(a){return B(this,b,a)},enumerable:!0})};u?(p=g(function(a,b,c,d){i(a,p,j,"_d");var e,g,h,l,m=0,q=0;if(t(b)){if(!(b instanceof T||"ArrayBuffer"==(l=s(b))||"SharedArrayBuffer"==l))return ra in b?Aa(p,b):Ca.call(p,b);e=b,q=wa(c,f);var r=b.byteLength;if(void 0===d){if(r%f)throw P("Wrong length!");if((g=r-q)<0)throw P("Wrong length!")}else if((g=n(d)*f)+q>r)throw P("Wrong length!");h=g/f}else h=o(b),g=h*f,e=new T(g);for(k(a,"_d",{b:e,o:q,l:g,e:h,v:new U(e)});m<h;)C(a,m++)}),z=p.prototype=w(Na),k(z,"constructor",p)):c(function(){p(1)})&&c(function(){new p(-1)})&&H(function(a){new p,new p(null),new p(1.5),new p(a)},!0)||(p=g(function(a,b,c,d){i(a,p,j);var e;return t(b)?b instanceof T||"ArrayBuffer"==(e=s(b))||"SharedArrayBuffer"==e?void 0!==d?new q(b,wa(c,f),d):void 0!==c?new q(b,wa(c,f)):new q(b):ra in b?Aa(p,b):Ca.call(p,b):new q(o(b))}),V(r!==Function.prototype?y(q).concat(y(r)):y(q),function(a){a in p||k(p,a,q[a])}),p.prototype=z,z.constructor=p);var D=z[ma],E=!!D&&("values"==D.name||void 0==D.name),F=Ja.values;k(p,oa,!0),k(z,ra,j),k(z,sa,!0),k(z,pa,p),(h?new p(1)[na]==j:na in z)||N(z,na,{get:function(){return j}}),v[j]=p,d(d.G+d.W+d.F*(p!=q),v),d(d.S,j,{
BYTES_PER_ELEMENT:f}),d(d.S+d.F*c(function(){q.of.call(p,1)}),j,{from:Ca,of:Da}),"BYTES_PER_ELEMENT"in z||k(z,"BYTES_PER_ELEMENT",f),d(d.P,j,Ga),I(j),d(d.P+d.F*va,j,{set:Ia}),d(d.P+d.F*!E,j,Ja),z.toString!=ka&&(z.toString=ka),d(d.P+d.F*c(function(){new p(1).slice()}),j,{slice:Ha}),d(d.P+d.F*(c(function(){return[1,2].toLocaleString()!=new p([1,2]).toLocaleString()})||!c(function(){z.toLocaleString.call([1,2])})),j,{toLocaleString:Fa}),G[j]=E?D:F,E||k(z,ma,F)}}else a.exports=function(){}});gg("Int8",1,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Uint8",1,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Uint8",1,function(a){return function(b,c,d){return a(this,b,c,d)}},!0),gg("Int16",2,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Uint16",2,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Int32",4,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Uint32",4,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Float32",4,function(a){return function(b,c,d){return a(this,b,c,d)}}),gg("Float64",8,function(a){return function(b,c,d){return a(this,b,c,d)}});var hg=Math.log1p||function(a){return(a=+a)>-1e-8&&a<1e-8?a-a*a/2:Math.log(1+a)},ig=Math.sqrt,jg=Math.acosh;Yc(Yc.S+Yc.F*!(jg&&710==Math.floor(jg(Number.MAX_VALUE))&&jg(1/0)==1/0),"Math",{acosh:function(a){return(a=+a)<1?NaN:a>94906265.62425156?Math.log(a)+Math.LN2:hg(a-1+ig(a-1)*ig(a+1))}});var kg=Math.asinh;Yc(Yc.S+Yc.F*!(kg&&1/kg(0)>0),"Math",{asinh:e});var lg=Math.atanh;Yc(Yc.S+Yc.F*!(lg&&1/lg(-0)<0),"Math",{atanh:function(a){return 0==(a=+a)?a:Math.log((1+a)/(1-a))/2}});var mg=Math.sign||function(a){return 0==(a=+a)||a!=a?a:a<0?-1:1};Yc(Yc.S,"Math",{cbrt:function(a){return mg(a=+a)*Math.pow(Math.abs(a),1/3)}}),Yc(Yc.S,"Math",{clz32:function(a){return(a>>>=0)?31-Math.floor(Math.log(a+.5)*Math.LOG2E):32}});var ng=Math.exp;Yc(Yc.S,"Math",{cosh:function(a){return(ng(a=+a)+ng(-a))/2}});var og=Math.expm1,pg=!og||og(10)>22025.465794806718||og(10)<22025.465794806718||-2e-17!=og(-2e-17)?function(a){return 0==(a=+a)?a:a>-1e-6&&a<1e-6?a+a*a/2:Math.exp(a)-1}:og;Yc(Yc.S+Yc.F*(pg!=Math.expm1),"Math",{expm1:pg});var qg=Math.pow,rg=qg(2,-52),sg=qg(2,-23),tg=qg(2,127)*(2-sg),ug=qg(2,-126),vg=function(a){return a+1/rg-1/rg},wg=Math.fround||function(a){var b,c,d=Math.abs(a),e=mg(a);return d<ug?e*vg(d/ug/sg)*ug*sg:(b=(1+sg/rg)*d,c=b-(b-d),c>tg||c!=c?e*(1/0):e*c)};Yc(Yc.S,"Math",{fround:wg});var xg=Math.abs;Yc(Yc.S,"Math",{hypot:function(a,b){for(var c,d,e=0,f=0,g=arguments.length,h=0;f<g;)c=xg(arguments[f++]),h<c?(d=h/c,e=e*d*d+1,h=c):c>0?(d=c/h,e+=d*d):e+=c;return h===1/0?1/0:h*Math.sqrt(e)}});var yg=Math.imul;Yc(Yc.S+Yc.F*Cc(function(){return-5!=yg(4294967295,5)||2!=yg.length}),"Math",{imul:function(a,b){var c=+a,d=+b,e=65535&c,f=65535&d;return 0|e*f+((65535&c>>>16)*f+e*(65535&d>>>16)<<16>>>0)}}),Yc(Yc.S,"Math",{log10:function(a){return Math.log(a)*Math.LOG10E}}),Yc(Yc.S,"Math",{log1p:hg}),Yc(Yc.S,"Math",{log2:function(a){return Math.log(a)/Math.LN2}}),Yc(Yc.S,"Math",{sign:mg});var zg=Math.exp;Yc(Yc.S+Yc.F*Cc(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(a){return Math.abs(a=+a)<1?(pg(a)-pg(-a))/2:(zg(a-1)-zg(-a-1))*(Math.E/2)}});var Ag=Math.exp;Yc(Yc.S,"Math",{tanh:function(a){var b=pg(a=+a),c=pg(-a);return b==1/0?1:c==1/0?-1:(b-c)/(Ag(a)+Ag(-a))}}),Yc(Yc.S,"Math",{trunc:function(a){return(a>0?Math.floor:Math.ceil)(a)}});var Bg=function(a,b){if(Gc(a),!Fc(b)&&null!==b)throw TypeError(b+": can't set as prototype!")},Cg={set:Object.setPrototypeOf||("__proto__"in{}?function(a,b,c){try{c=Wc(Function.call,_d.f(Object.prototype,"__proto__").set,2),c(a,[]),b=!(a instanceof Array)}catch(a){b=!0}return function(a,d){return Bg(a,d),b?a.__proto__=d:c(a,d),a}}({},!1):void 0),check:Bg},Dg=Cg.set,Eg=function(a,b,c){var d,e=b.constructor;return e!==c&&"function"==typeof e&&(d=e.prototype)!==c.prototype&&Fc(d)&&Dg&&Dg(a,d),a},Fg="\t\n\v\f\r \u2028\u2029\ufeff",Gg="["+Fg+"]",Hg="",Ig=RegExp("^"+Gg+Gg+"*"),Jg=RegExp(Gg+Gg+"*$"),Kg=function(a,b,c){var d={},e=Cc(function(){return!!Fg[a]()||Hg[a]()!=Hg}),f=d[a]=e?b(Lg):Fg[a];c&&(d[c]=f),Yc(Yc.P+Yc.F*e,"String",d)},Lg=Kg.trim=function(a,b){return a=String(kd(a)),1&b&&(a=a.replace(Ig,"")),2&b&&(a=a.replace(Jg,"")),a},Mg=Kg,Ng=Sd.f,Og=_d.f,Pg=Oc.f,Qg=Mg.trim,Rg=zc.Number,Sg=Rg,Tg=Rg.prototype,Ug="Number"==id(Pd(Tg)),Vg="trim"in String.prototype,Wg=function(a){var b=Lc(a,!1);if("string"==typeof b&&b.length>2){b=Vg?b.trim():Qg(b,3);var c,d,e,f=b.charCodeAt(0);if(43===f||45===f){if(88===(c=b.charCodeAt(2))||120===c)return NaN}else if(48===f){switch(b.charCodeAt(1)){case 66:case 98:d=2,e=49;break;case 79:case 111:d=8,e=55;break;default:return+b}for(var g,h=b.slice(2),i=0,j=h.length;i<j;i++)if((g=h.charCodeAt(i))<48||g>e)return NaN;return parseInt(h,d)}}return+b};if(!Rg(" 0o1")||!Rg("0b1")||Rg("+0x1")){Rg=function(a){var b=arguments.length<1?0:a,c=this;return c instanceof Rg&&(Ug?Cc(function(){Tg.valueOf.call(c)}):"Number"!=id(c))?Eg(new Sg(Wg(b)),c,Rg):Wg(b)};for(var Xg,Yg=Dc?Ng(Sg):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),Zg=0;Yg.length>Zg;Zg++)Bc(Sg,Xg=Yg[Zg])&&!Bc(Rg,Xg)&&Pg(Rg,Xg,Og(Sg,Xg));Rg.prototype=Tg,Tg.constructor=Rg,Uc(zc,"Number",Rg)}var $g=function(a,b){if("number"!=typeof a&&"Number"!=id(a))throw TypeError(b);return+a},_g=function(a){var b=String(kd(this)),c="",d=od(a);if(d<0||d==1/0)throw RangeError("Count can't be negative");for(;d>0;(d>>>=1)&&(b+=b))1&d&&(c+=b);return c},ah=1..toFixed,bh=Math.floor,ch=[0,0,0,0,0,0],dh="Number.toFixed: incorrect invocation!",eh=function(a,b){for(var c=-1,d=b;++c<6;)d+=a*ch[c],ch[c]=d%1e7,d=bh(d/1e7)},fh=function(a){for(var b=6,c=0;--b>=0;)c+=ch[b],ch[b]=bh(c/a),c=c%a*1e7},gh=function(){for(var a=6,b="";--a>=0;)if(""!==b||0===a||0!==ch[a]){var c=String(ch[a]);b=""===b?c:b+_g.call("0",7-c.length)+c}return b},hh=function a(b,c,d){return 0===c?d:c%2==1?a(b,c-1,d*b):a(b*b,c/2,d)},ih=function(a){for(var b=0,c=a;c>=4096;)b+=12,c/=4096;for(;c>=2;)b+=1,c/=2;return b};Yc(Yc.P+Yc.F*(!!ah&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!Cc(function(){ah.call({})})),"Number",{toFixed:function(a){var b,c,d,e,f=$g(this,dh),g=od(a),h="",i="0";if(g<0||g>20)throw RangeError(dh);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(h="-",f=-f),f>1e-21)if(b=ih(f*hh(2,69,1))-69,c=b<0?f*hh(2,-b,1):f/hh(2,b,1),c*=4503599627370496,(b=52-b)>0){for(eh(0,c),d=g;d>=7;)eh(1e7,0),d-=7;for(eh(hh(10,d,1),0),d=b-1;d>=23;)fh(1<<23),d-=23;fh(1<<d),eh(1,1),fh(2),i=gh()}else eh(0,c),eh(1<<-b,0),i=gh()+_g.call("0",g);return g>0?(e=i.length,i=h+(e<=g?"0."+_g.call("0",g-e)+i:i.slice(0,e-g)+"."+i.slice(e-g))):i=h+i,i}});var jh=1..toPrecision;Yc(Yc.P+Yc.F*(Cc(function(){return"1"!==jh.call(1,void 0)})||!Cc(function(){jh.call({})})),"Number",{toPrecision:function(a){var b=$g(this,"Number#toPrecision: incorrect invocation!");return void 0===a?jh.call(b):jh.call(b,a)}}),Yc(Yc.S,"Number",{EPSILON:Math.pow(2,-52)});var kh=zc.isFinite;Yc(Yc.S,"Number",{isFinite:function(a){return"number"==typeof a&&kh(a)}});var lh=Math.floor,mh=function(a){return!Fc(a)&&isFinite(a)&&lh(a)===a};Yc(Yc.S,"Number",{isInteger:mh}),Yc(Yc.S,"Number",{isNaN:function(a){return a!=a}});var nh=Math.abs;Yc(Yc.S,"Number",{isSafeInteger:function(a){return mh(a)&&nh(a)<=9007199254740991}}),Yc(Yc.S,"Number",{MAX_SAFE_INTEGER:9007199254740991}),Yc(Yc.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991});var oh=zc.parseFloat,ph=Mg.trim,qh=1/oh(Fg+"-0")!=-1/0?function(a){var b=ph(String(a),3),c=oh(b);return 0===c&&"-"==b.charAt(0)?-0:c}:oh;Yc(Yc.S+Yc.F*(Number.parseFloat!=qh),"Number",{parseFloat:qh});var rh=zc.parseInt,sh=Mg.trim,th=/^[-+]?0[xX]/,uh=8!==rh(Fg+"08")||22!==rh(Fg+"0x16")?function(a,b){var c=sh(String(a),3);return rh(c,b>>>0||(th.test(c)?16:10))}:rh;Yc(Yc.S+Yc.F*(Number.parseInt!=uh),"Number",{parseInt:uh});var vh=Object.assign,wh=!vh||Cc(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=vh({},a)[c]||Object.keys(vh({},b)).join("")!=d})?function(a,b){for(var c=Ne(a),d=arguments.length,e=1,f=Ed.f,g=Gd.f;d>e;)for(var h,i=jd(arguments[e++]),j=f?Bd(i).concat(f(i)):Bd(i),k=j.length,l=0;k>l;)g.call(i,h=j[l++])&&(c[h]=i[h]);return c}:vh;Yc(Yc.S+Yc.F,"Object",{assign:wh});var xh={uniforms:{color1:{type:"v3",value:new b.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new b.Vector3(1/255,2/255,3/255)},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},uCamDir:{type:"v3",value:new b.Vector3},uCamUp:{type:"v3",value:new b.Vector3},uResolution:{type:"v2",value:new b.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0}},vertexShader:"uniform vec3 color1;\nuniform vec3 color2;\nvarying vec2 vUv;\nvarying vec3 vColor;\nvoid main() {\n    if (uv.y == 0.0)\n        vColor = color2;\n    else\n        vColor = color1;\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"varying vec3 vColor;\nvarying vec2 vUv;\nuniform samplerCube envMap;\nuniform vec3 uCamDir;\nuniform vec3 uCamUp;\nuniform vec2 uResolution;\nuniform float uHalfFovTan;\nuniform bool envMapBackground;\n#include<env_sample>\nconst int bloomRange = 4;\n#include<ordered_dither>\nuniform float envMapExposure;\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\nvec3 rayDir(in vec2 vUv) {\n    vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);\n    vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);\n    vec3 C = normalize(uCamDir);\n    vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );\n    return ray;\n}\nvec3 getColor(in vec3 rd) {\n    return RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), envMapExposure);\n}\nvoid main() {\n    vec3 rd = rayDir(vUv);\n    vec3 outColor;\n    if (envMapBackground) {\n        outColor = getColor(rd);\n#if TONEMAP_OUTPUT == 1\n        outColor = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * outColor);\n#elif TONEMAP_OUTPUT == 2\n        outColor = toneMapCanonFilmic_WithGamma(exposureBias * outColor);\n#endif\n    }\n    else {\n        outColor = vColor;\n    }\n    gl_FragColor = vec4(orderedDithering(outColor), 1.0);\n}\n"},yh="#if defined( PRISMWOOD )\n#define ONE 0.00390625\nfloat GetIndexedValue(vec4 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else if (index == 2)\n        return array[2];\n    else if (index == 3)\n        return array[3];\n    else\n        return 0.0;\n}\nint GetIndexedValue(ivec2 array, int index)\n{\n    if (index == 0)\n        return array[0];\n    else if (index == 1)\n        return array[1];\n    else\n        return 0;\n}\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nfloat SampleCurlyPattern(vec2 uv)\n{\n    vec2 uv_wood_curly_distortion_map = (wood_curly_distortion_map_texMatrix * vec3(uv, 1.0)).xy;\n    WOOD_CURLY_DISTORTION_CLAMP_TEST;\n    vec3 curlyDistortion = texture2D(wood_curly_distortion_map, uv_wood_curly_distortion_map).xyz;\n    if(wood_curly_distortion_map_invert) curlyDistortion = vec3(1.0) - curlyDistortion;\n    return curlyDistortion.r;\n}\nvec3 DistortCurly(vec3 p)\n{\n    if (!wood_curly_distortion_enable) return p;\n    float r = length(p.xy);\n    if (r < 0.00001) return p;\n    const float INV_ANGLE_INTERVAL = 1.27323954;\n    const float NUM_INTERVAL = 8.0;\n    float theta = atan(p.y, p.x);\n    if (theta < 0.0)\n        theta += PI2;\n    float intIdx = theta * INV_ANGLE_INTERVAL;\n    int idx0 = int(mod(floor(intIdx), NUM_INTERVAL));\n    int idx1 = int(mod(ceil(intIdx), NUM_INTERVAL));\n    const vec4 HASH_TABLE1 = vec4(0.450572,0.114598, 0.886043, 0.315119);\n    const vec4 HASH_TABLE2 = vec4(0.216133,0.306264, 0.685616, 0.317907);\n    float offset0 = idx0 < 4 ? GetIndexedValue(HASH_TABLE1, idx0) : GetIndexedValue(HASH_TABLE2, idx0-4);\n    float offset1 = idx1 < 4 ? GetIndexedValue(HASH_TABLE1, idx1) : GetIndexedValue(HASH_TABLE2, idx1-4);\n    const float maxOffset = 100.0;\n    offset0 = (offset0 - 0.5) * maxOffset;\n    offset1 = (offset1 - 0.5) * maxOffset;\n    vec2 uv0 = vec2(p.z + offset0, r);\n    float shiftWeight0 =  SampleCurlyPattern(uv0);\n    vec2 uv1 = vec2(p.z + offset1, r);\n    float shiftWeight1 =  SampleCurlyPattern(uv1);\n    float interpWeight = fract(intIdx);\n    float shiftWeight = mix(shiftWeight0, shiftWeight1, interpWeight);\n    const float INV_MIN_RADIUS = 2.0;\n    float shiftWeightAdjust = smoothstep(0.0, 1.0, r * INV_MIN_RADIUS);\n    r -= wood_curly_distortion_scale * (shiftWeight * shiftWeightAdjust);\n    float thetaNew = atan(p.y, p.x);\n    vec3 pNew = p;\n    pNew.x = r * cos(thetaNew);\n    pNew.y = r * sin(thetaNew);\n    return pNew;\n}\n#endif\nvec3 un2sn(vec3 range)\n{\n    return range * 2.0 - 1.0;\n}\nfloat inoise(vec3 p)\n{\n    vec3 modp = mod(floor(p), 256.0);\n    modp.xy = modp.xy * ONE;\n    vec4 AA = texture2D(perm2DMap, vec2(modp.x, modp.y), 0.0) * 255.0;\n    AA = AA + modp.z;\n    AA = mod(floor(AA), 256.0);\n    AA *= ONE;\n    vec3 gradx1 = un2sn(texture2D(permGradMap,vec2(AA.x,0.0),0.0).xyz);\n    vec3 grady1 = un2sn(texture2D(permGradMap,vec2(AA.y,0.0),0.0).xyz);\n    vec3 gradz1 = un2sn(texture2D(permGradMap,vec2(AA.z,0.0),0.0).xyz);\n    vec3 gradw1 = un2sn(texture2D(permGradMap,vec2(AA.w,0.0),0.0).xyz);\n    vec3 gradx2 = un2sn(texture2D(permGradMap,vec2(AA.x + ONE,0.0),0.0).xyz);\n    vec3 grady2 = un2sn(texture2D(permGradMap,vec2(AA.y + ONE,0.0),0.0).xyz);\n    vec3 gradz2 = un2sn(texture2D(permGradMap,vec2(AA.z + ONE,0.0),0.0).xyz);\n    vec3 gradw2 = un2sn(texture2D(permGradMap,vec2(AA.w + ONE,0.0),0.0).xyz);\n    p -= floor(p);\n    vec3 fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix( mix( mix( dot(gradx1, p ),\n                          dot(gradz1, p + vec3(-1.0, 0.0, 0.0)), fadep.x),\n                     mix( dot(grady1, p + vec3(0.0, -1.0, 0.0)),\n                          dot(gradw1, p + vec3(-1.0, -1.0, 0.0)), fadep.x), fadep.y),\n                mix( mix( dot(gradx2, p + vec3(0.0, 0.0, -1.0)),\n                          dot(gradz2, p + vec3(-1.0, 0.0, -1.0)), fadep.x),\n                     mix( dot(grady2, p + vec3(0.0, -1.0, -1.0)),\n                          dot(gradw2, p + vec3(-1.0, -1.0, -1.0)), fadep.x), fadep.y), fadep.z);\n}\nfloat inoise(float p)\n{\n    float modp = mod(floor(p), 256.0);\n    modp = (modp + 256.0) * ONE;\n    float permx = texture2D(permutationMap, vec2(modp, 0.0), 0.0).r;\n    float gradx = texture2D(gradientMap, vec2(permx, 0.0), 0.0).r*2.0-1.0;\n    float permy = texture2D(permutationMap, vec2(modp + ONE, 0.0), 0.0).r;\n    float grady = texture2D(gradientMap, vec2(permy, 0.0), 0.0).r*2.0-1.0;\n    p -= floor(p);\n    float fadep = p * p * p * (p * (p * 6.0 - 15.0) + 10.0);\n    return mix(gradx * p, grady * (p - 1.0), fadep);\n}\nfloat multiband_inoise(vec3 p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nfloat multiband_inoise(float p, int bands, vec4 w, vec4 f)\n{\n    float noise = 0.0;\n    for(int i = 0; i < 4; ++i)\n    {\n        if (i >= bands) break;\n        noise += GetIndexedValue(w, i) * inoise(p * GetIndexedValue(f, i));\n    }\n    return noise;\n}\nvec3 Distort3DCosineRadialDir(vec3 p)\n{\n    float radius = length(p.xy);\n    if (radius < 0.00001) return p;\n    vec2 theta = p.xy / radius;\n    float radiusShift = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= wood_fiber_cosine_bands) break;\n        radiusShift += GetIndexedValue(wood_fiber_cosine_weights, i) * cos(p.z * RECIPROCAL_PI2 * GetIndexedValue(wood_fiber_cosine_frequencies, i));\n    }\n    const float MIN_RADIUS = 1.5;\n    float weight = clamp(radius / MIN_RADIUS, 0.0, 1.0);\n    if(weight >= 0.5)\n        weight = weight * weight * (3.0 - (weight + weight));\n    p.xy += theta * radiusShift * weight;\n    return p;\n}\nvec3 Distort3DPerlin(vec3 p)\n{\n    vec3 pAniso = vec3(p.xy, p.z * wood_fiber_perlin_scale_z);\n    p.xy += multiband_inoise(pAniso, wood_fiber_perlin_bands, wood_fiber_perlin_weights, wood_fiber_perlin_frequencies);\n    return p;\n}\nvec3 Distort(vec3 p)\n{\n    if(wood_fiber_cosine_enable)\n        p = Distort3DCosineRadialDir(p);\n    if(wood_fiber_perlin_enable)\n        p = Distort3DPerlin(p);\n    return p;\n}\nfloat DistortRadiusLength(float radiusLength)\n{\n    radiusLength += multiband_inoise(radiusLength, wood_growth_perlin_bands, wood_growth_perlin_weights, wood_growth_perlin_frequencies);\n    if (radiusLength < 0.0) radiusLength = 0.0;\n    return radiusLength;\n}\nfloat ComputeEarlyWoodRatio(float radiusLength)\n{\n    float fraction = mod(radiusLength, wood_ring_thickness) / wood_ring_thickness;\n    if (fraction <= wood_ring_fraction.y)\n       return 1.0;\n    else if(fraction <= wood_ring_fraction.x)\n       return (1.0 - (fraction - wood_ring_fraction.y) / wood_fall_rise.x);\n    else if(fraction <= wood_ring_fraction.w)\n       return 0.0;\n    else\n       return ((fraction - wood_ring_fraction.w) / wood_fall_rise.y);\n}\nvec3 DistortEarlyColor(vec3 earlyColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_earlycolor_perlin_bands,wood_earlycolor_perlin_weights,wood_earlycolor_perlin_frequencies);\n    earlyColor = pow(abs(earlyColor), vec3(expValue));\n    return earlyColor;\n}\nvec3 DistortLateColor(vec3 lateColor, float radiusLength)\n{\n    float expValue = 1.0 + multiband_inoise(radiusLength,wood_latecolor_perlin_bands,wood_latecolor_perlin_weights,wood_latecolor_perlin_frequencies);\n    lateColor = pow(abs(lateColor), vec3(expValue));\n    return lateColor;\n}\nvec3 DistortDiffuseColor(vec3 diffAlbedo, vec3 p)\n{\n    p.z *= wood_diffuse_perlin_scale_z;\n    float expValue = 1.0 + multiband_inoise(p, wood_diffuse_perlin_bands, wood_diffuse_perlin_weights, wood_diffuse_perlin_frequencies);\n    diffAlbedo = pow(abs(diffAlbedo), vec3(expValue));\n    return diffAlbedo;\n}\nfloat LayerRoughnessVar(float roughness, float earlyWoodRatio)\n{\n    return earlyWoodRatio * wood_groove_roughness + (1.0 - earlyWoodRatio) * roughness;\n}\nfloat hashword(vec2 k)\n{\n    k = mod(k, vec2(256.0)) * ONE;\n    float a = texture2D(permutationMap, vec2(k.x, 0.0)).x + k.y ;\n    a = texture2D(permutationMap, vec2(a, 0.0)).x ;\n    return a*255.0;\n}\nfloat wyvillsq(float rsq)\n{\n    if (rsq >= 1.0) return 0.0;\n    float tmp = 1.0 - rsq;\n    return tmp*tmp*tmp;\n}\nfloat Weight2DNeighborImpulses(vec3 p, float woodWeight)\n{\n    if(woodWeight <= 0.0) return 0.0;\n    float poreRadius = wood_pore_radius * woodWeight;\n    vec2 left = floor((p.xy - poreRadius) / wood_pore_cell_dim);\n    vec2 right = floor((p.xy + poreRadius) / wood_pore_cell_dim);\n    float weight = 0.0;\n    float invRsq = 1.0 / (poreRadius * poreRadius);\n    const float norm =  1.0 / 15.0;\n    for (int j = 0; j <= 4; j++)\n    {\n        if (j > int(right.y - left.y)) continue;\n        for (int i = 0; i <= 4; i++)\n        {\n            if (i > int(right.x - left.x)) continue;\n            vec2 pij = vec2(float(i) + left.x,float(j) + left.y);\n            float hRNum = hashword(pij);\n            float impPosX = mod(hRNum, 16.0) * norm;\n            float impPosY = floor(hRNum / 16.0) * norm;\n            impPosX = (pij.x + impPosX)* wood_pore_cell_dim;\n            impPosY = (pij.y + impPosY)* wood_pore_cell_dim;\n            float dsq = (p.x - impPosX) * (p.x - impPosX) + (p.y - impPosY) * (p.y - impPosY);\n            weight += wyvillsq(dsq * invRsq);\n        }\n    }\n    return weight;\n}\nfloat Weight3DRayImpulses(vec3 p)\n{\n    int segIdx = int(floor(p.z / wood_ray_seg_length_z));\n    float factor = p.z / wood_ray_seg_length_z - float(segIdx);\n    int segIdx1 = segIdx - 1;\n    if ( factor > 0.5 )\n        segIdx1 = segIdx + 1;\n    float theta = atan(p.y, p.x);\n    float sliceIdx = floor(((theta + PI) * RECIPROCAL_PI2) * wood_ray_num_slices);\n    if ( sliceIdx == wood_ray_num_slices)\n        sliceIdx-=1.0;\n    ivec2 arrSegs = ivec2(segIdx, segIdx1);\n    float weight = 0.0;\n    const float norm =  1.0 / 15.0;\n    float radialOffset = 5.0;\n    float radialLength = length(p.xy);\n    for (int seg = 0; seg < 2; seg++)\n    {\n        float hRNum = hashword(vec2(sliceIdx, GetIndexedValue(arrSegs, seg)));\n        float rn1 = mod(hRNum,16.0) * norm;\n        if (radialLength < radialOffset * rn1)\n            continue;\n        float rayTheta = rn1;\n        rayTheta = ( ( sliceIdx + rayTheta ) / wood_ray_num_slices ) * ( 2.0 * PI ) - PI;\n        float rayPosZ = (hRNum/16.0)* norm;\n        rayPosZ = ( float(GetIndexedValue(arrSegs, seg)) + rayPosZ ) * wood_ray_seg_length_z;\n        vec3 pt1 = vec3(0.0);\n        vec3 pt2 = vec3(cos(rayTheta), sin(rayTheta), 0.0);\n        vec3 p1 = p;\n        p1.z -= rayPosZ;\n        p1.z /=  wood_ray_ellipse_z2x;\n        vec3 v1 = pt2 - pt1;\n        vec3 v2 = pt1 - p1;\n        v2 = cross(v1, v2);\n        float dist = length(v2) / length(v1);\n        float invRsq = 1.0 / ( wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x);\n        weight += wyvillsq( (dist * dist) * invRsq );\n    }\n    return weight;\n}\nvec3 DarkenColorWithPores(vec3 p, vec3 diffColor, float woodWeight)\n{\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float a = wood_pore_color_power - 1.0;\n    float b = 1.0;\n    float y = a * poresWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nvec3 DarkenColorWithRays(vec3 p, vec3 diffColor)\n{\n    float raysWeight = Weight3DRayImpulses(p);\n    float a = wood_ray_color_power - 1.0;\n    float b = 1.0;\n    float y = a * raysWeight + b;\n    return pow(abs(diffColor), vec3(y));\n}\nfloat ComputeWoodWeight(float earlyWoodRatio)\n{\n    float woodWeight = 0.0;\n    if (wood_pore_type == 0)\n        woodWeight = 1.0;\n    else if (wood_pore_type == 1)\n        woodWeight = earlyWoodRatio;\n    else if (wood_pore_type == 2)\n        woodWeight = 1.0 - earlyWoodRatio;\n    else\n        woodWeight = -1.0;\n    return woodWeight;\n}\n#if defined( PRISMWOODBUMP )\nfloat ComputeEarlyWoodRatioAA(float radiusLength, float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    float samplesf = clamp(4.0 / transPixels, 1.0, 4.0);\n    int samples = int(samplesf);\n    float inverseSamples = 1.0 / float(samples);\n    vec2 rdelta = vec2(dFdx(radiusLength), dFdy(radiusLength)) * inverseSamples;\n    float earlywoodRatio = 0.0;\n    for (int i = 0; i < 4; ++i)\n    {\n        if (i >= samples) break;\n        for (int j = 0; j < 4; ++j)\n        {\n            if (j >= samples) break;\n            float r = radiusLength + dot(vec2(i, j), rdelta);\n            earlywoodRatio += ComputeEarlyWoodRatio(r);\n        }\n    }\n    return earlywoodRatio * (inverseSamples * inverseSamples);\n}\nfloat LatewoodDepthVariation(float invUnitExt)\n{\n    float transPixels = min(wood_fall_rise.x, wood_fall_rise.y) * wood_ring_thickness * invUnitExt;\n    return clamp(transPixels * 0.5, 0.0, 1.0);\n}\nfloat LatewoodHeightVariation(float earlyWoodRatio, float latewoodBumpDepth,\n                              float depthVar)\n{\n    return ( 1.0 - earlyWoodRatio ) * latewoodBumpDepth * depthVar;\n}\nfloat PoreDepthVariation(float woodWeight, float invUnitExt)\n{\n    float porePixels = woodWeight * wood_pore_radius * invUnitExt;\n    return clamp(porePixels, 0.0, 1.0);\n}\nfloat PoreHeightVariation(float earlyWoodRatio, float poresWeight, float poreDepth,\n                          float depthVar)\n{\n    return poresWeight * (-1.0 * poreDepth) * depthVar;\n}\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvec3 WoodBumpHeight(float heightLeft, float heightRight, float heightBack, float heightFront)\n{\n    const float epsilon = 0.001;\n    float heightDeltaX = heightRight - heightLeft;\n    vec3 Tu = vec3(2.0 * epsilon, 0.0, heightDeltaX);\n    float heightDeltaY = heightFront - heightBack;\n    vec3 Tv = vec3(0.0, 2.0 * epsilon, heightDeltaY);\n    return cross(Tu, Tv);\n}\nvec3 SelectNormal(vec3 N, vec3 bumpN, vec3 V)\n{\n    float bumpNdotV = dot(bumpN, V);\n    if(bumpNdotV > 0.0)\n        return bumpN;\n    else return N;\n}\nfloat MinInverseUnitExtent(vec3 p)\n{\n    return 1.0 / max(max(length(dFdx(p.xy)), length(dFdy(p.xy))), 0.000001);\n}\nfloat HeightVariation(vec3 pos)\n{\n    vec3 p = Distort(pos);\n    float radiusLength = length(p.xy);\n    if (wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n    float invUnitExt = MinInverseUnitExtent(p);\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n    float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n    float poresWeight = Weight2DNeighborImpulses(p, woodWeight);\n    float depthVar = PoreDepthVariation(woodWeight, invUnitExt);\n    float poreHeightVariation = -1.0 * poresWeight * wood_pore_depth * depthVar;\n    float latewoodHeightVariation = 0.0;\n    if (wood_use_latewood_bump)\n    {\n        float latewoodDepthVar = LatewoodDepthVariation(invUnitExt);\n        latewoodHeightVariation = (1.0 - earlyWoodRatio) * wood_latewood_bump_depth * latewoodDepthVar;\n    }\n    float sumHeightVariation = poreHeightVariation + latewoodHeightVariation;\n    return sumHeightVariation;\n}\n#endif\nvec3 NoiseWood(vec3 p, inout float roughness)\n{\n    p = Distort(p);\n    float radiusLength = length(p.xy);\n    if(wood_growth_perlin_enable)\n        radiusLength = DistortRadiusLength(radiusLength);\n#if defined( PRISMWOODBUMP )\n    float invUnitExt = MinInverseUnitExtent( p );\n    float earlyWoodRatio = ComputeEarlyWoodRatioAA(radiusLength, invUnitExt);\n#else\n    float earlyWoodRatio = ComputeEarlyWoodRatio(radiusLength);\n#endif\n    vec3 earlyColor = wood_early_color;\n    if (wood_earlycolor_perlin_enable)\n        earlyColor = DistortEarlyColor(earlyColor, radiusLength);\n    vec3 lateColor;\n    if (wood_use_manual_late_color)\n        lateColor = wood_manual_late_color;\n    else\n        lateColor = pow(abs(earlyColor), vec3(wood_late_color_power));\n    if(wood_latecolor_perlin_enable)\n        lateColor = DistortLateColor(lateColor, radiusLength);\n    vec3 diffAlbedo = earlyWoodRatio * earlyColor + (1.0 - earlyWoodRatio) * lateColor;\n    if(wood_diffuse_perlin_enable)\n        diffAlbedo = DistortDiffuseColor(diffAlbedo, p);\n    if (wood_use_pores)\n    {\n        float woodWeight = ComputeWoodWeight(earlyWoodRatio);\n        diffAlbedo = DarkenColorWithPores(p, diffAlbedo, woodWeight);\n    }\n    if (wood_use_rays)\n        diffAlbedo = DarkenColorWithRays(p, diffAlbedo);\n    if(wood_use_groove_roughness)\n        roughness = LayerRoughnessVar(roughness, earlyWoodRatio);\n    return clamp(diffAlbedo, vec3(0.0), vec3(1.0));\n}\n#if defined(PRISMWOODBUMP)\nvoid getFinalWoodContext(\n    inout vec3 N, vec3 V, inout vec3 Tu, inout vec3 Tv, vec3 p,\n    vec3 geoNormal, vec3 tNormal, mat3 normalMatrix\n) {\n    vec3 offsetTuLeft = p - 0.001 * Tu;\n    vec3 offsetTuRight = p + 0.001 * Tu;\n    vec3 offsetTvLeft = p - 0.001 * Tv;\n    vec3 offsetTvRight = p + 0.001 * Tv;\n    float heightVariationTuLeft = HeightVariation(offsetTuLeft);\n    float heightVariationTuRight = HeightVariation(offsetTuRight);\n    float heightVariationTvLeft = HeightVariation(offsetTvLeft);\n    float heightVariationTvRight = HeightVariation(offsetTvRight);\n    vec3 bumpHeight = WoodBumpHeight(heightVariationTuLeft, heightVariationTuRight, heightVariationTvLeft, heightVariationTvRight);\n    vec3 newNormal = normalize(bumpHeight.x * Tu + bumpHeight.y * Tv + bumpHeight.z * vtNormal);\n    vec3 newNormalView = normalize(vNormalMatrix * newNormal);\n    vec3 selectedNormal = SelectNormal(geoNormal, newNormalView, V);\n    ComputeTangents(selectedNormal, Tu, Tv);\n    Tu = normalize(Tu);\n    Tv = normalize(Tv);\n    N = faceforward(selectedNormal, -V, selectedNormal);\n}\n#endif\n#endif\n",zh="void applyPrismTransparency(\n    inout vec4 color,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    float fsLevel = max(max(color.r, color.g), color.b);\n    color = vec4(color.rgb/fsLevel, fsLevel);\n    float transLevel = min(min(transparentColor.r, transparentColor.g), transparentColor.b);\n    transLevel = min( (1.0 - surface_roughness), transLevel );\n    float transAlpha = (1.0 - transLevel) * 0.4 + surface_roughness * 0.55;\n    vec3 tr_g_color = sqrt(transparentColor);\n    vec4 transColor = vec4(0.5 * vec3(tr_g_color), transAlpha);\n    float strength = 1.0 - (1.0 - fsLevel) * (1.0 - fsLevel);\n    color = mix(transColor, color, strength);\n    color.a = max(color.a, 0.05);\n    if (transparentIor == 1.0 && tr_g_color == vec3(1.0)) {\n        color.a = 0.0;\n    }\n}",Ah="#if defined(USE_SURFACE_NORMAL_MAP) || defined( USE_LAYERED_NORMAL_MAP )\nvoid heightMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    mat3 mtxTangent = mat3(T, B, N);\n    T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));\n    B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));\n    const float oneThird = 1.0 / 3.0;\n    vec3 avg = vec3(oneThird, oneThird, oneThird);\n    vec2 offset = fwidth(st);\n    float h0 = dot(texture2D(bumpTexture, st).xyz, avg);\n    float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);\n    float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);\n    vec2 diff = vec2(h0 - hx, h0 - hy) / offset;\n    N = normalize(\n        N + (\n            diff.x * T * bumpScale.x +\n            diff.y * B * bumpScale.y\n        )\n    );\n}\nvoid normalMapTransform(\n    sampler2D bumpTexture,\n    vec2 uv,\n    mat3 transform,\n    vec2 bumpScale,\n    inout vec3 T,\n    inout vec3 B,\n    inout vec3 N\n) {\n    vec2 st = (transform * vec3(uv, 1.0)).xy;\n    vec3 mapN =  2.0 * texture2D(bumpTexture, st).xyz - 1.0;\n    mapN.xy *= bumpScale.x;\n    mapN.z *= bumpScale.y;\n    vec3 v = vec3(mapN.y, -mapN.x, 0.0);\n    float c = -mapN.z;\n    mat3 skewV = mat3(\n        0.0, v.z, -v.y,\n        -v.z, 0.0, v.x,\n        v.y, -v.x, 0.0\n    );\n    mat3 rot = mat3(1.0) + skewV + skewV*skewV * 1.0/(1.0-c);\n    N *= rot;\n    T *= rot;\n    B *= rot;\n}\n#endif\n",Bh={cutplanes:{type:"v4v",value:[]},hatchParams:{type:"v2",value:new b.Vector2(1,10)},hatchTintColor:{type:"c",value:new b.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},Ch={dbId:{type:"v3",value:new b.Vector3(0,0,0)},modelId:{type:"v3",value:new b.Vector3(0,0,0)}},Dh={themingColor:{type:"v4",value:new b.Vector4(0,0,0,0)}},Eh={shadowESMConstant:{type:"f",value:0}},Fh=b.UniformsUtils.merge([{shadowMap:{type:"t",value:null},shadowMapSize:{type:"v2",value:new b.Vector2(0,0)},shadowBias:{type:"f",value:0},shadowDarkness:{type:"f",value:0},shadowMatrix:{type:"m4",value:new b.Matrix4},shadowLightDir:{type:"v3",value:new b.Vector3}},Eh]),Gh={
point_size:{type:"f",value:1}},Hh={view_size:{type:"v2",value:new b.Vector2(640,480)}},Ih={tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new b.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new b.Matrix4}},Jh={};for(var Kh in b.ShaderChunk)Jh[Kh]=b.ShaderChunk[Kh];Jh.pack_depth="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n",Jh.depth_texture="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n",Jh.tonemap="\nfloat luminance_post(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\n    return dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\n    vec3 R = vec3( 3.240479, -1.537150, -0.498535);\n    vec3 G = vec3(-0.969256,  1.875992,  0.041556);\n    vec3 B = vec3( 0.055648, -0.204043,  1.057311);\n    vec3 rgb;\n    rgb.b = dot(xyz, B);\n    rgb.g = dot(xyz, G);\n    rgb.r = dot(xyz, R);\n    return rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\n    vec3 X = vec3(0.412453, 0.35758, 0.180423);\n    vec3 Y = vec3(0.212671, 0.71516, 0.0721688);\n    vec3 Z = vec3(0.0193338, 0.119194, 0.950227);\n    vec3 xyz;\n    xyz.x = dot(rgb, X);\n    xyz.y = dot(rgb, Y);\n    xyz.z = dot(rgb, Z);\n    return xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\n    float sum = xyz.x + xyz.y + xyz.z;\n    sum = 1.0 / sum;\n    vec3 xyY;\n    xyY.z = xyz.y;\n    xyY.x = xyz.x * sum;\n    xyY.y = xyz.y * sum;\n    return xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\n    float x = xyY.x;\n    float y = xyY.y;\n    float Y = xyY.z;\n    vec3 xyz;\n    xyz.y = Y;\n    xyz.x = x * (Y / y);\n    xyz.z = (1.0 - x - y) * (Y / y);\n    return xyz;\n}\nfloat toneMapCanon_T(float x)\n{\n    float xpow = pow(x, 1.60525727);\n    float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);\n    return clamp(tmp, 0.0, 1.0);\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\n    x *= Shift;\n    const float A = 0.2;\n    const float B = 0.34;\n    const float C = 0.002;\n    const float D = 1.68;\n    const float E = 0.0005;\n    const float F = 0.252;\n    const float scale = 1.0/0.833837;\n    return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\n    x *= Shift;\n    const float A = 0.27;\n    const float B = 0.29;\n    const float C = 0.052;\n    const float D = 0.2;\n    const float F = 0.18;\n    const float scale = 1.0/0.897105;\n    return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}\nvec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {\n    vec3 outColor = x.rgb;\n    outColor = min(outColor, vec3(3.0));\n    float inLum = luminance_pre(outColor);\n    if (inLum > 0.0) {\n        float outLum = toneMapCanon_T(inLum);\n        outColor = outColor * (outLum / inLum);\n        outColor = clamp(outColor, vec3(0.0), vec3(1.0));\n    }\n    float gamma = 1.0/2.2;\n    outColor = pow(outColor, vec3(gamma));\n    return outColor;\n}\n",Jh.ordered_dither="vec3 orderedDithering(vec3 col) {\n    const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\n    const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\n    const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\n    const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\n    int i = int(mod(float(gl_FragCoord.x), 4.0));\n    int j = int(mod(float(gl_FragCoord.y), 4.0));\n    vec4 biasRow;\n    if      (i==0) biasRow = m0;\n    else if (i==1) biasRow = m1;\n    else if (i==2) biasRow = m2;\n    else           biasRow = m3;\n    float bias;\n    if      (j==0) bias = biasRow.x;\n    else if (j==1) bias = biasRow.y;\n    else if (j==2) bias = biasRow.z;\n    else           bias = biasRow.w;\n    return col + bias / 17.0 / 256.0;\n}\n",Jh.cutplanes="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\nvoid checkCutPlanes(vec3 worldPosition) {\n    for (int i=0; i<NUM_CUTPLANES; i++) {\n        if (dot(vec4(worldPosition, 1.0), cutplanes[i]) > 0.0) {\n            discard;\n        }\n    }\n}\n#endif\n",Jh.pack_normals="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n",Jh.hatch_pattern="#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nuniform vec3 hatchTintColor;\nuniform float hatchTintIntensity;\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 3.5;\n    return exp(-exponent*exponent);\n}\nvec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {\n    float hatchSlope = hatchParams.x;\n    float hatchPeriod = hatchParams.y;\n    if (abs(hatchSlope) <= 1.0) {\n        float hatchPhase = coord.y - hatchSlope * coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    } else {\n        float hatchPhase = - coord.y / hatchSlope + coord.x;\n        float dist = abs(mod((hatchPhase), (hatchPeriod)));\n        if (dist < 1.0) {\n            fragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);\n        }\n    }\n    return fragColor;\n}\n#endif\n",Jh.env_sample="\nuniform float envRotationSin;\nuniform float envRotationCos;\nvec3 adjustLookupVector(in vec3 lookup) {\n    return vec3(\n            envRotationCos * lookup.x - envRotationSin * lookup.z,\n            lookup.y,\n            envRotationSin * lookup.x + envRotationCos * lookup.z);\n}\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    ret *= exposure;\n    return ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\n    return vRGBA.xyz * vRGBA.xyz * exposure;\n}\nvec3 sampleIrradianceMap(vec3 dirWorld, samplerCube irrMap, float exposure) {\n    vec4 cubeColor4 = textureCube(irrMap, adjustLookupVector(dirWorld));\n#ifdef IRR_GAMMA\n    vec3 indirectDiffuse = GammaDecode(cubeColor4, exposure);\n#elif defined(IRR_RGBM)\n    vec3 indirectDiffuse = RGBMDecode(cubeColor4, exposure);\n#else\n    vec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\n    indirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\n    return indirectDiffuse;\n}\n",Jh.id_decl_vert="#ifdef USE_VERTEX_ID\nattribute vec3 id;\nvarying   vec3 vId;\n#endif\n",Jh.id_vert="\n#ifdef USE_VERTEX_ID\nvId = id;\n#endif\n",Jh.id_decl_frag="#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)\nvarying highp float depth;\n#define gl_FragColor gl_FragData[0]\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\n#ifdef USE_VERTEX_ID\nvarying vec3 vId;\n#else\nuniform vec3 dbId;\n#endif\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\n",Jh.id_frag="\n#if defined(USE_VERTEX_ID) && (defined(MRT_ID_BUFFER) || defined(ID_COLOR))\nvec3 dbId = vId;\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\n#ifndef ENABLE_ID_DISCARD\nconst float writeId = 1.0;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, writeId);\n#ifdef MODEL_COLOR\ngl_FragData[index+1] = vec4(modelId.rgb, writeId);\n#endif\n#elif defined(ID_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(dbId.rgb, 1.0);\n#elif defined(MODEL_COLOR)\n#ifdef ENABLE_ID_DISCARD\nif (writeId==0.0) {\n    discard;\n}\n#endif\ngl_FragColor = vec4(modelId.rgb, 1.0);\n#endif\n",Jh.final_frag="#ifdef HATCH_PATTERN\ngl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(normal.x, normal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#include<id_frag>\n",Jh.theming_decl_frag="uniform vec4 themingColor;\n",Jh.theming_frag="gl_FragColor.rgb = mix(gl_FragColor.rgb, themingColor.rgb, themingColor.a);\n",Jh.instancing_decl_vert="\n#ifdef USE_INSTANCING\nattribute vec3 instOffset;\nattribute vec4 instRotation;\nattribute vec3 instScaling;\nvec3 applyQuaternion(vec3 p, vec4 q) {\n    return p + 2.0 * cross(q.xyz, cross(q.xyz, p) + q.w * p);\n}\nvec3 getInstancePos(vec3 pos) {\n    return instOffset + applyQuaternion(instScaling * pos, instRotation);\n}\nvec3 getInstanceNormal(vec3 normal) {\n    return applyQuaternion(normal/instScaling, instRotation);\n}\n#else\nvec3 getInstancePos(vec3 pos)       { return pos;    }\nvec3 getInstanceNormal(vec3 normal) { return normal; }\n#endif\n",Jh.shadowmap_decl_common="\nuniform float shadowESMConstant;\nuniform float shadowMapRangeMin;\nuniform float shadowMapRangeSize;\n",Jh.shadowmap_decl_vert="\n#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord;\nuniform mat4 shadowMatrix;\n#endif\n",Jh.shadowmap_vert="\n#ifdef USE_SHADOWMAP\n{\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vShadowCoord = shadowMatrix * worldPosition;\n}\n#endif\n",Jh.shadowmap_decl_frag="\n#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap;\nuniform vec2      shadowMapSize;\nuniform float     shadowDarkness;\nuniform float     shadowBias;\nuniform vec3      shadowLightDir;\nvarying vec4 vShadowCoord;\n#include<shadowmap_decl_common>\nfloat getShadowValue() {\n    float fDepth;\n    vec3 shadowColor = vec3( 1.0 );\n    vec3 shadowCoord = vShadowCoord.xyz / vShadowCoord.w;\n    shadowCoord.xyz = 0.5 * (shadowCoord.xyz + vec3(1.0, 1.0, 1.0));\n    bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n    bool inFrustum = all( inFrustumVec );\n    float shadowValue = 1.0;\n    if (inFrustum) {\n        shadowCoord.z = min(0.999, shadowCoord.z);\n        shadowCoord.z -= shadowBias;\n#ifdef USE_HARD_SHADOWS\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float fDepth = rgbaDepth.r;\n        if ( fDepth < shadowCoord.z ) {\n            shadowValue = 1.0 - shadowDarkness;\n        }\n#else\n        vec4 rgbaDepth = texture2D( shadowMap, shadowCoord.xy );\n        float shadowMapValue = rgbaDepth.r;\n        shadowValue = exp(-shadowESMConstant * shadowCoord.z) * shadowMapValue;\n        shadowValue = min(shadowValue, 1.0);\n        shadowValue = mix(1.0 - shadowDarkness, 1.0, shadowValue);\n#endif\n    }\n    return shadowValue;\n}\n#else\nfloat getShadowValue() { return 1.0; }\n#endif\nvec3 applyEnvShadow(vec3 colorWithoutShadow, vec3 worldNormal) {\n#if defined(USE_SHADOWMAP)\n    float dp  = dot(shadowLightDir, worldNormal);\n    float dpValue = (dp + 1.0) / 2.0;\n    dpValue = min(1.0, dpValue * 1.5);\n    float sv = getShadowValue();\n    vec3 result = colorWithoutShadow * min(sv, dpValue);\n    return result;\n#else\n    return colorWithoutShadow;\n#endif\n}\n",Jh.float3_average="float averageOfFloat3(in vec3 value) { \n    const float oneThird = 1.0 / 3.0; \n    return dot(value, vec3(oneThird, oneThird, oneThird)); \n} \n",Jh.line_decl_common="\n#define TAU     6.28318530718\n#define PI      3.14159265358979\n#define HALF_PI 1.57079632679\n#define PI_0_5  HALF_PI\n#define PI_1_5  4.71238898038\n#define ENABLE_ID_DISCARD\n#define VBB_GT_TRIANGLE_INDEXED  0.0\n#define VBB_GT_LINE_SEGMENT      1.0\n#define VBB_GT_ARC_CIRCULAR      2.0\n#define VBB_GT_ARC_ELLIPTICAL    3.0\n#define VBB_GT_TEX_QUAD          4.0\n#define VBB_GT_ONE_TRIANGLE      5.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  0.0\n#define VBB_SEG_START_LEFT   1.0\n#define VBB_SEG_END_RIGHT    2.0\n#define VBB_SEG_END_LEFT     3.0\nvarying vec4 fsColor;\nvarying vec4 dbId;\nvarying vec2 fsOffsetDirection;\nvarying vec4 fsMultipurpose;\nvarying float fsHalfWidth;\nvarying vec2 fsVpTC;\nvarying float fsGhosting;\n",Jh.prism_wood=yh,Jh.prism_transparency=zh,Jh.normal_map=Ah,Jh.decl_point_size="uniform float point_size;",Jh.point_size="gl_PointSize = point_size;",Jh.wide_lines_decl="\n#ifdef WIDE_LINES\nattribute vec3 prev;\nattribute vec3 next;\nattribute float side;\nuniform vec2 view_size;\nvec2 to2d(vec4 i) {\n  return i.xy / i.w;\n}\n#endif\n",Jh.wide_lines_vert="\n#ifdef WIDE_LINES\nvec4 mvpPosition = projectionMatrix * mvPosition; \nmat3 vectorMatrix = mat3(modelViewMatrix);\nvec2 _pos = to2d(mvpPosition) * view_size;\nvec2 _prev = to2d(projectionMatrix * vec4(mvPosition.xyz + vectorMatrix * (prev * 0.01), 1.0)) * view_size;\nvec2 _next = to2d(projectionMatrix * vec4(mvPosition.xyz - vectorMatrix * (next * 0.01), 1.0)) * view_size;\nvec2 dir1 = _pos - _next;\nvec2 dir2 = _prev - _pos;\ndir2 = (length(dir2) > 0.0000001) ? normalize(dir2) : vec2(0.0, 0.0);\ndir1 = (length(dir1) > 0.0000001) ? normalize(dir1) : dir2;\nvec2 dir_sharp = normalize(dir1 + dir2);\nvec2 dir = normalize(dir1 + dir_sharp);\nvec2 offset = vec2(-dir.y, dir.x);\nfloat len = 1.0 / cross(vec3(offset, 0), vec3(dir1, 0)).z;\noffset *= len;\noffset /= view_size;\noffset *= side;\noffset *= mvpPosition.w;\nmvpPosition.xy += offset;\ngl_Position = mvpPosition;\n#endif\n",Jh.hsv="vec3 rgb2hsv(vec3 color)\n{\n    float delta;\n    float colorMax, colorMin;\n    float h,s,v;\n    vec3 hsv;\n    colorMax = max(color.r,color.g);\n    colorMax = max(colorMax,color.b);\n    colorMin = min(color.r,color.g);\n    colorMin = min(colorMin,color.b);\n    v = colorMax;\n    if(colorMax != 0.0)\n    {\n        s = (colorMax - colorMin)/colorMax;\n    }\n    else\n    {\n        s = 0.0;\n    }\n    if(s != 0.0)\n    {\n        delta = colorMax-colorMin;\n        if (color.r == colorMax)\n        {\n            h = (color.g-color.b)/delta;\n        }\n        else if (color.g == colorMax)\n        {\n            h = 2.0 + (color.b-color.r) / delta;\n        }\n        else\n        {\n            h = 4.0 + (color.r-color.g)/delta;\n        }\n        h /= 6.0;\n        if( h < 0.0)\n        {\n            h +=1.0;\n        }\n    }\n    else\n    {\n        h = 0.0;\n    }\n    hsv = vec3(h,s,v);\n    return hsv;\n}\nvec3 hsv2rgb(vec3 hsv)\n{\n    vec3 color;\n    float f,p,q,t;\n    float h,s,v;\n    float i,hi;\n    {\n        h = hsv.x*6.0;\n        s = hsv.y;\n        v = hsv.z;\n        i = floor(h);\n        f = h-i;\n        p = v * (1.0 - s);\n        q = v * (1.0 - (s * f));\n        t = v * (1.0 - (s * (1.0 - f)));\n        float r,g,b;\n        if (i == 0.0)\n        {\n            r = v;\n            g = t;\n            b = p;\n        }\n        else if (i == 1.0)\n        {\n            r = q;\n            g = v;\n            b = p;\n        }\n        else if (i == 2.0)\n        {\n            r = p;\n            g = v;\n            b = t;\n        }\n        else if (i == 3.0)\n        {\n            r = p;\n            g = q;\n            b = v;\n        }\n        else if (i == 4.0)\n        {\n            r = t;\n            g = p;\n            b = v;\n        }\n        else\n        {\n            r = v;\n            g = p;\n            b = q;\n        }\n        color = vec3(r,g,b);\n    }\n    return color;\n}";var Lh={};Lh.prism_check=f,Lh.prism_sample_texture=function(a,b,c,d){return h(a,b,"true"===c,"true"===d)},Lh.prism_uniforms=i,Lh.prism_bump_uniforms=j;var Mh={};for(Kh in Lh)Mh[Kh]=new RegExp("#"+Kh+" *<([\\w\\d., ]*)>","g");var Nh=function a(b){for(var c in Lh){var d=Mh[c];b=b.replace(d,function(a,b){var d=b.split(",").map(function(a){return a.trim()});return Lh[c].apply(null,d)})}var e=/#include *<([\w\d.]+)>/g,f=function(b,c){if(!Jh[c])throw new Error("Cannot resolve #include<"+c+">");return a(Jh[c])};return b.replace(e,f)},Oh=Jh.pack_depth,Ph=Jh.tonemap,Qh=Jh.ordered_dither,Rh=Jh.cutplanes,Sh=Jh.pack_normals,Th=Jh.hatch_pattern,Uh=Jh.env_sample,Vh=Jh.id_decl_vert,Wh=Jh.id_vert,Xh=Jh.id_decl_frag,Yh=Jh.id_frag,Zh=Jh.final_frag,$h=Jh.theming_decl_frag,_h=Jh.theming_frag,ai=Jh.instancing_decl_vert,bi=Jh.shadowmap_decl_common,ci=Jh.shadowmap_decl_vert,di=Jh.shadowmap_vert,ei=Jh.shadowmap_decl_frag,fi=Jh.decl_point_size,gi=Jh.point_size,hi={IdUniforms:Ch,ThemingUniform:Dh,CutPlanesUniforms:Bh,ShadowMapCommonUniforms:Eh,ShadowMapUniforms:Fh,PointSizeUniforms:Gh,WideLinesUniforms:Hh,DepthTextureUniforms:Ih,PackDepthShaderChunk:Oh,TonemapShaderChunk:Ph,OrderedDitheringShaderChunk:Qh,CutPlanesShaderChunk:Rh,PackNormalsShaderChunk:Sh,HatchPatternShaderChunk:Th,EnvSamplingShaderChunk:Uh,IdVertexDeclaration:Vh,IdVertexShaderChunk:Wh,IdFragmentDeclaration:Xh,IdOutputShaderChunk:Yh,FinalOutputShaderChunk:Zh,ThemingFragmentDeclaration:$h,ThemingFragmentShaderChunk:_h,InstancingVertexDeclaration:ai,ShadowMapDeclareCommonUniforms:bi,ShadowMapVertexDeclaration:ci,ShadowMapVertexShaderChunk:di,ShadowMapFragmentDeclaration:ei,PointSizeDeclaration:fi,PointSizeShaderChunk:gi,GetPrismMapSampleChunk:h,GetPrismMapUniformChunk:i,resolve:Nh},ii={uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.fog,b.UniformsLib.shadowmap,hi.CutPlanesUniforms,hi.IdUniforms,hi.ThemingUniform,hi.PointSizeUniforms,hi.WideLinesUniforms]),vertexShader:"#include<id_decl_vert>\n#include<decl_point_size>\n#include<common>\n#include<map_pars_vertex>\n#include<lightmap_pars_vertex>\n#include<envmap_pars_vertex>\n#include<color_pars_vertex>\n#include<morphtarget_pars_vertex>\n#include<skinning_pars_vertex>\n#include<logdepthbuf_pars_vertex>\n#include<wide_lines_decl>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n#include<map_vertex>\n#include<lightmap_vertex>\n#include<color_vertex>\n#include<skinbase_vertex>\n#ifdef USE_ENVMAP\n#include<morphnormal_vertex>\n#include<skinnormal_vertex>\n#include<defaultnormal_vertex>\n#endif\n#include<morphtarget_vertex>\n#include<skinning_vertex>\n#include<default_vertex>\n#include<wide_lines_vert>\n#include<logdepthbuf_vertex>\n#include<worldpos_vertex>\n#if NUM_CUTPLANES > 0\n    vec4 _worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = _worldPosition.xyz;\n#endif\n#include<envmap_vertex>\n#include<id_vert>\n#include<point_size>\n}\n",fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\n#include<common>\n#include<color_pars_fragment>\n#include<map_pars_fragment>\n#include<alphamap_pars_fragment>\n#include<lightmap_pars_fragment>\n#include<envmap_pars_fragment>\n#include<fog_pars_fragment>\n#include<specularmap_pars_fragment>\n#include<logdepthbuf_pars_fragment>\n#if NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#include<cutplanes>\n#include<id_decl_frag>\n#include<theming_decl_frag>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 outgoingLight = vec3( 0.0 );\n    vec4 diffuseColor = vec4( diffuse, opacity );\n#include<logdepthbuf_fragment>\n#include<map_fragment>\n#include<color_fragment>\n#include<alphamap_fragment>\n#include<alphatest_fragment>\n#include<specularmap_fragment>\n    outgoingLight = diffuseColor.rgb;\n#include<lightmap_fragment>\n#include<envmap_fragment>\n#include<linear_to_gamma_fragment>\n#include<fog_fragment>\n    gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n#include<theming_frag>\n#include<final_frag>\n}\n"};b.ShaderLib.firefly_basic=ii;var ji="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",ki={uniforms:{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},aoOpacity:{type:"f",value:1},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},objID:{type:"i",value:0},objIDv3:{type:"v3",value:new b.Vector3(0,0,0)},highlightIntensity:{type:"f",value:1},selectionColor:{type:"c",value:new b.Color(0,0,0)},resolution:{type:"v2",value:new b.Vector2(1/1024,1/512)},highlightRange:{type:"i",value:0},objIDStart:{type:"i",value:0},objIDEnd:{type:"i",value:0}},vertexShader:ji,fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform float aoOpacity;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform int objID;\nuniform vec3 objIDv3;\nuniform sampler2D tID;\nuniform float highlightIntensity;\nuniform vec3 selectionColor;\nuniform int highlightRange;\nuniform int objIDStart;\nuniform int objIDEnd;\nvarying vec2 vUv;\n#include<tonemap>\nbool isSelected(vec3 C) {\n    float minS = min(selectionColor.r, min(selectionColor.g, selectionColor.b));\n    float maxS = max(selectionColor.r, max(selectionColor.g, selectionColor.b));\n    float satS = maxS - minS;\n    float minC = min(C.r, min(C.g, C.b));\n    float maxC = max(C.r, max(C.g, C.b));\n    float satC = maxC - minC;\n    if (satC < .01 || satS < .01)\n        return false;\n    vec3 S = (selectionColor - minS) / satS;\n    vec3 H = (C - minC) / satC;\n    vec3 D = H - S;\n    float eps = .15;\n    return (abs(D.r) + abs(D.g) + abs(D.b) < eps)\n        || (maxC >= (1.0 - eps) && D.r >= -eps && D.g >= -eps && D.b >= -eps);\n}\nvec4 overlayEdgeDetect(vec2 vUv) {\n#define IS_SELECTION(C) isSelected((C).rgb)\n#define CHECK_EDGE_ALPHA(I, J)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; selectionPixel = c; } }\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a <= 0.0) hasEdge++; }\n    int hasEdge = 0;\n    vec4 center = texture2D(tOverlay, vUv);\n    vec4 selectionPixel = vec4(0.0);\n    float maxAlpha = 0.0;\n    bool paintOutline = false;\n    if (center.a <= 0.0) {\n        CHECK_EDGE_ALPHA(-1.0,-1.0);\n        CHECK_EDGE_ALPHA( 0.0,-1.0);\n        CHECK_EDGE_ALPHA( 1.0,-1.0);\n        CHECK_EDGE_ALPHA(-1.0, 0.0);\n        CHECK_EDGE_ALPHA( 1.0, 0.0);\n        CHECK_EDGE_ALPHA(-1.0, 1.0);\n        CHECK_EDGE_ALPHA( 0.0, 1.0);\n        CHECK_EDGE_ALPHA( 1.0, 1.0);\n        if (hasEdge != 0) {\n            center = selectionPixel;\n            paintOutline = true;\n        }\n    }\n    else if (center.a > 0.0 && IS_SELECTION(center)) {\n        CHECK_EDGE_SELECTION(-1.0,-1.0);\n        CHECK_EDGE_SELECTION( 0.0,-1.0);\n        CHECK_EDGE_SELECTION( 1.0,-1.0);\n        CHECK_EDGE_SELECTION(-1.0, 0.0);\n        CHECK_EDGE_SELECTION( 1.0, 0.0);\n        CHECK_EDGE_SELECTION(-1.0, 1.0);\n        CHECK_EDGE_SELECTION( 0.0, 1.0);\n        CHECK_EDGE_SELECTION( 1.0, 1.0);\n        if (hasEdge != 0)\n            paintOutline = true;\n        else\n            center.a = -center.a;\n    }\n    if (paintOutline) {\n        float maxComponent = max(center.r, max(center.g, center.b));\n        center.rgb /= maxComponent;\n        center.rgb = sqrt(center.rgb);\n        center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n    }\n    return center;\n}\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return (useAO != 0) ? sqrt(texture2D(tAO, vUv).r) : 1.0;\n}\nvoid applyHighlighting(inout vec3 rgb) {\n#ifdef IS_2D\n    rgb = mix(rgb, vec3(1.0,1.0,0.0), highlightIntensity * 0.25);\n#else\n    rgb += highlightIntensity * 0.20;\n#endif\n}\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    if (useOverlay != 0) {\n        vec4 overlay = overlayEdgeDetect(vUv);\n        if (overlay.a < 0.0) {\n            overlay.a = -overlay.a;\n            if (overlay.a >= 0.99) {\n                overlay.a = 0.75;\n                texel.rgb = vec3(luminance_post(texel.rgb));\n            }\n        }\n        texel.rgb = mix(texel.rgb, sqrt(overlay.rgb), overlay.a);\n    }\n    if (highlightRange == 0) {\n        if (objID != 0) {\n            vec4 idAtPixel = texture2D(tID, vUv);\n            vec3 idDelta = abs(idAtPixel.rgb - objIDv3.rgb);\n            if (max(max(idDelta.r, idDelta.g), idDelta.b) < 1e-3) {\n                applyHighlighting(texel.rgb);\n            }\n        }\n    } else {\n        vec4 idAtPixel = texture2D(tID, vUv);\n        int dbId = int(idAtPixel.r * 255.0 + idAtPixel.g * 255.0 * 256.0 + idAtPixel.b * 255.0 * 256.0 * 256.0);\n        if (dbId >= objIDStart && dbId <= objIDEnd) {\n            applyHighlighting(texel.rgb);\n        }\n    }\n    gl_FragColor = texel;\n}\n"},li={uniforms:b.UniformsUtils.merge([hi.DepthTextureUniforms,{tDiffuse:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new b.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},tFill:{type:"t",value:null},tPaper:{type:"t",value:null},style:{type:"i",value:0},idEdges:{type:"i",value:1},normalEdges:{type:"i",value:1},depthEdges:{type:"i",value:1},brightness:{type:"f",value:0},contrast:{type:"f",value:0},grayscale:{type:"i",value:0},preserveColor:{type:"i",value:0},levels:{type:"f",value:6},repeats:{type:"f",value:3},rotation:{type:"f",value:0},tGraphite1:{type:"t",value:null},tGraphite2:{type:"t",value:null},tGraphite3:{type:"t",value:null},tGraphite4:{type:"t",value:null},tGraphite5:{type:"t",value:null},tGraphite6:{type:"t",value:null},tGraphite7:{type:"t",value:null},tGraphite8:{type:"t",value:null}}]),vertexShader:ji,
fragmentShader:"#extension GL_OES_standard_derivatives : enable\n#include<depth_texture>\nuniform sampler2D tDiffuse;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform sampler2D tFill;\nuniform sampler2D tPaper;\nuniform int style;\nuniform int idEdges;\nuniform int normalEdges;\nuniform int depthEdges;\nuniform float brightness;\nuniform float contrast;\nuniform int grayscale;\nuniform int preserveColor;\nuniform float levels;\nuniform float repeats;\nuniform float rotation;\nuniform sampler2D tGraphite1;\nuniform sampler2D tGraphite2;\nuniform sampler2D tGraphite3;\nuniform sampler2D tGraphite4;\nuniform sampler2D tGraphite5;\nuniform sampler2D tGraphite6;\nuniform sampler2D tGraphite7;\nuniform sampler2D tGraphite8;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\n    float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\n    nrmz.w = -(nrmz.z + cameraNear) / (cameraFar - cameraNear);\n    nrmz.z = z;\n    return nrmz;\n}\n#include<tonemap>\n#include<hsv>\nvec3 quantize(vec3 c) {\n    float L = max(c.r, max(c.g, c.b));\n    c *= floor(L * (levels-1.0) + 0.5) / (L * (levels-1.0));\n    return c;\n}\nvec3 quantizeRGB(vec3 c) {\n    c *= c;\n    c *= floor(c * levels * 0.9999) / (levels-1.0);\n    return sqrt(c);\n}\nvec3 clampHue(vec3 c, float hues, float sats, float vals) {\n    vec3 hsv = rgb2hsv(c);\n    hsv.x = floor(hsv.x * hues + 0.5) / hues;\n    hsv.y = floor(hsv.y * sats + 0.5) / sats;\n    hsv.z = floor(hsv.z * vals + 0.5) / vals;\n    vec3 col = hsv2rgb(hsv);\n    return col;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nint isObjectEdge() {\n    vec4 MM = texture2D(tID, vUv);\n    vec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\n    if (MM != LL) return 1;\n    vec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\n    if (MM != LM) return 1;\n    vec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\n    if (MM != LR) return 1;\n    vec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\n    if (MM != ML) return 1;\n    vec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\n    if (MM != MR) return 1;\n    vec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\n    if (MM != UL) return 1;\n    vec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\n    if (MM != UM) return 1;\n    vec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\n    if (MM != UR) return 1;\n    return (MM.x + MM.y + MM.z + MM.w) >= 4.0 ? 0 : -1;\n}\nconst float r = 1.0;\nfloat normalDiff(vec3 n1, vec3 n2) {\n    float d = dot(n1.xyz, n2.xyz);\n    return acos(clamp(d, -1.0, 1.0));\n}\nint isNormalDepthEdge() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 MM = texture2D(tDepth, vUv);\n    vec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\n    vec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\n    vec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\n    vec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\n    vec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\n    vec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\n    vec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\n    vec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\n    LL = recoverNZ(LL);\n    LM = recoverNZ(LM);\n    LR = recoverNZ(LR);\n    ML = recoverNZ(ML);\n    MM = recoverNZ(MM);\n    MR = recoverNZ(MR);\n    UL = recoverNZ(UL);\n    UM = recoverNZ(UM);\n    UR = recoverNZ(UR);\n    float dd = 0.0;\n    if ( depthEdges == 1 ) {\n        float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\n        dd = abs(dFdx(G)) + abs(dFdy(G));\n    }\n    float Gn = 0.0;\n    if ( normalEdges == 1 ) {\n        float pLL = normalDiff(LL.xyz, MM.xyz);\n        float pLM = normalDiff(LM.xyz, MM.xyz);\n        float pLR = normalDiff(LR.xyz, MM.xyz);\n        float pML = normalDiff(ML.xyz, MM.xyz);\n        float pMM = normalDiff(MM.xyz, MM.xyz);\n        float pMR = normalDiff(MR.xyz, MM.xyz);\n        float pUL = normalDiff(UL.xyz, MM.xyz);\n        float pUM = normalDiff(UM.xyz, MM.xyz);\n        float pUR = normalDiff(UR.xyz, MM.xyz);\n        Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\n    }\n    \n    return (dd > 0.004 || Gn > 2.0) ? 1 : 0;\n}\nvec3 computeGraphite( vec3 color, vec2 loc ) {\n    float lum = 0.299 * color.r + 0.587 * color.g + 0.114 * color.b;\n    float offset;\n    vec3 col1, col2;\n    if ( lum > 6.0/7.0 ) {\n        col1 = texture2D(tGraphite1, loc ).xyz;\n        col2 = texture2D(tGraphite2, loc ).xyz;\n        offset = 6.0/7.0;\n    } else if ( lum > 5.0/7.0 ) {\n        col1 = texture2D(tGraphite2, loc ).xyz;\n        col2 = texture2D(tGraphite3, loc ).xyz;\n        offset = 5.0/7.0;\n    } else if ( lum > 4.0/7.0 ) {\n        col1 = texture2D(tGraphite3, loc ).xyz;\n        col2 = texture2D(tGraphite4, loc ).xyz;\n        offset = 4.0/7.0;\n    } else if ( lum > 3.0/7.0 ) {\n        col1 = texture2D(tGraphite4, loc ).xyz;\n        col2 = texture2D(tGraphite5, loc ).xyz;\n        offset = 3.0/7.0;\n    } else if ( lum > 2.0/7.0 ) {\n        col1 = texture2D(tGraphite5, loc ).xyz;\n        col2 = texture2D(tGraphite6, loc ).xyz;\n        offset = 2.0/7.0;\n    } else if ( lum > 1.0/7.0 ) {\n        col1 = texture2D(tGraphite6, loc ).xyz;\n        col2 = texture2D(tGraphite7, loc ).xyz;\n        offset = 1.0/7.0;\n    } else {\n        col1 = texture2D(tGraphite7, loc ).xyz;\n        col2 = texture2D(tGraphite8, loc ).xyz;\n        offset = 0.0;\n    }\n    if ( col1.r == 0.0 && col2.r == 0.0 ) {\n        return vec3(lum,lum,lum);\n    }\n    float t = (lum-offset)*7.0;\n    return (col1 * t + col2 * (1.0 - t));\n}\nvec3 colorWithAdjustments() {\n    vec3 sceneRGB = texture2D(tDiffuse, vUv).xyz;\n    if ( brightness != 0.0 || contrast != 0.0) {\n        if ( brightness < 0.0 )\n        {\n            sceneRGB = sceneRGB * (1.0 + brightness);\n        }\n        else\n        {\n            sceneRGB = sceneRGB + ((1.0 - sceneRGB) * brightness);\n        }\n        float slant = tan(( clamp(contrast,-1.0,1.0) + 1.0) * 3.141592/4.001);\n        sceneRGB = (sceneRGB - 0.5) * slant + 0.5;\n        if ( preserveColor == 1 )\n        {\n            float maxval = max( sceneRGB.r, sceneRGB.g );\n            maxval = max( maxval, sceneRGB.b );\n            if ( maxval > 1.0 )\n            {\n                sceneRGB /= maxval;\n            }\n        }\n        sceneRGB = clamp(sceneRGB,0.0,1.0);\n    }\n    if ( grayscale == 1 ) {\n        sceneRGB.rgb = vec3(luminance_post(sceneRGB.rgb));\n    }\n    return sceneRGB;\n}\nvoid main() {\n    int foundEdge = 0;\n    foundEdge = ( idEdges == 1 && isObjectEdge() == 1 ) ? 1 : 0;\n    if ( foundEdge == 0 && (normalEdges == 1 || depthEdges == 1) ) {\n        foundEdge = isNormalDepthEdge();\n    }\n    vec2 loc = vec2((vUv.x-0.5)*(resolution.y/resolution.x),vUv.y-0.5)*repeats;\n    if ( style > 2 && rotation != 0.0 ) {\n        float rot = 3.14159*rotation;\n        float sinr = sin(rot);\n        float cosr = cos(rot);\n        loc = vec2(loc.x*cosr + -loc.y*sinr, loc.x*sinr + loc.y*cosr);\n    }\n    loc += vec2(0.5,0.5);\n    vec3 color;\n    if ( style == 2 ) {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(quantize(colorWithAdjustments()),1.0);\n        }\n    } else if ( style == 3 ) {\n        color = colorWithAdjustments();\n        vec3 graphColor = computeGraphite( color, loc );\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.16,0.16,0.16,1.0) + vec4(0.18 * graphColor,0.0);\n        } else {\n            gl_FragColor = vec4(graphColor,1.0);\n        }\n        return;\n    } else if ( style == 4 ) {\n        float fill = texture2D(tFill, loc ).r;\n        float paperStrength = 0.3;\n        vec3 paper = texture2D(tPaper, loc ).rgb;\n        paper = paperStrength * paper + (1.0-paperStrength)*vec3(1.0,1.0,1.0);\n        if ( foundEdge == 1 ) {\n            gl_FragColor = 0.75 * vec4(paper * fill, 1.0);\n        } else {\n            fill = pow(fill,1.6);\n            gl_FragColor = vec4(colorWithAdjustments() * (1.0 - fill) + paper * fill, 1.0);\n        }\n    } else {\n        if ( foundEdge == 1 ) {\n            gl_FragColor = vec4(0.0,0.0,0.0,1.0);\n        } else {\n            gl_FragColor = vec4(colorWithAdjustments(),1.0);\n        }\n        return;        \n    }\n}\n"},mi={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:ji,fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D(tDiffuse, vUv);\n}\n"},ni={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new b.Vector2(1/1024,1/512)}},vertexShader:"uniform vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nvoid main() {\n    vPos = uv;\n    vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;\n    vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:"#define FXAA_EDGE_SHARPNESS (8.0)\n#define FXAA_EDGE_THRESHOLD (0.125)\n#define FXAA_EDGE_THRESHOLD_MIN (0.05)\n#define FXAA_RCP_FRAME_OPT (0.50)\n#define FXAA_RCP_FRAME_OPT2 (2.0)\nuniform sampler2D tDiffuse;\nuniform highp vec2 uResolution;\nvarying vec2 vPos;\nvarying vec4 vPosPos;\nfloat FxaaLuma(vec3 rgb) {\n    return dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nvoid main() {\n    float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);\n    float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);\n    float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;\n    float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);\n    vec3 rgbM = texture2D(tDiffuse, vPos.xy).rgb;\n    float lumaM = FxaaLuma(rgbM.rgb);\n    float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));\n    float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));\n    float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);\n    float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);\n    if (lumaMaxSubMinM < lumaMaxScaledClamped) {\n        gl_FragColor = vec4(rgbM, 1.0);\n        return;\n    }\n    float dirSwMinusNe = lumaSw - lumaNe;\n    float dirSeMinusNw = lumaSe - lumaNw;\n    vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));\n    vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;\n    float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;\n    vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);\n    vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;\n    vec3 rgbA = rgbN1 + rgbP1;\n    vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);\n    float lumaB = FxaaLuma(rgbB);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        gl_FragColor = vec4(rgbA * 0.5, 1.0);\n    else\n        gl_FragColor = vec4(rgbB, 1.0);\n}\n"},oi={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new b.Vector2(512,512)},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)},axis:{type:"v2",value:new b.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:ji,fragmentShader:"\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},pi={uniforms:b.UniformsUtils.merge([hi.DepthTextureUniforms,{size:{type:"v2",value:new b.Vector2(512,512)},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:.4},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:ji,fragmentShader:"\n#include<depth_texture>\n#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include<pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n    vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\n    int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\n    if (mipLevel == 0) {\n        P.z = texture2D(tDepth, screenUV).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\n    else if (mipLevel == 2)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\n    else if (mipLevel == 3)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\n    else if (mipLevel == 4)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\n    else if (mipLevel == 5)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\n    P.z = texture2D(tDepth, screenUV).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return 6.28318 * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},qi={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:"varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}\n",fragmentShader:"varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}\n"},ri={uniforms:{color:{type:"v4",value:new b.Vector4(0,0,0,.3)},cutplanes:{type:"v4v",value:[]}},vertexShader:"\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<instancing_decl_vert>\nvoid main() {\n    vec3 instPos = getInstancePos(position);\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}",fragmentShader:"\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nuniform vec4 color;\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = color;\n}"},si={uniforms:{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new b.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new b.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new b.Vector4(0,0,1,1)},modelId:{type:"v3",value:new b.Vector3(0,0,0)},viewportId:{type:"f",value:0},swap:{type:"f",value:0}},attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0},defines:{},
vertexShader:"\n#include<line_decl_common>\nattribute vec3 fields1;\nattribute vec3 fields2;\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nattribute vec4 flags4b;\nattribute vec4 layerVp4b;\n#ifdef HAS_ELLIPTICALS\nattribute vec3 extraParams;\n#endif\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\nuniform float viewportId;\nuniform float swap;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\n#ifdef SELECTION_RENDERER\nuniform vec4 selectionColor;\n#endif\nvec2 centralVertex;\nvec2 offsetPosition;\nvec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }\nvoid min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {\n    minPt = min(minPt, p);\n    maxPt = max(maxPt, p);\n}\n#if defined(USE_INSTANCING)\nfloat getVertexId() { return instFlags4b.x; }\n#else\nfloat getVertexId() { return flags4b.x; }\n#endif\nbool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }\nbool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }\nstruct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };\nvoid decodeSegmentData(out SegmentData seg) {\n    seg.angle         = fields1.z;\n    seg.distAlong     = fields2.x;\n    seg.distTotal     = fields2.z;\n    seg.lineWidthHalf = fields2.y;\n    seg.lineType      = flags4b.z;\n}\nvoid strokeLineSegment() {\n    SegmentData seg; decodeSegmentData(seg);\n    float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;\n    float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;\n    float angleTransverse = seg.angle + isLeftSide * HALF_PI;\n    float lwAdjustment = fsHalfWidth + aaRange;\n    vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;\n    offsetPosition.xy += transverseOffset;\n    float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;\n    vec2 along = distanceFromStart * cos_sin(seg.angle);\n    offsetPosition.xy += along;\n    centralVertex.xy  += along;\n    vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\n    offsetPosition.xy -= moveOffset;\n    centralVertex.xy  -= moveOffset;\n    fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\n    fsMultipurpose.y = seg.distAlong;\n    fsMultipurpose.z = seg.distTotal;\n    fsMultipurpose.w = seg.lineType;\n    if (seg.lineWidthHalf < 0.0)\n        fsHalfWidth = -fsHalfWidth;\n}\n#ifdef HAS_TRIANGLE_GEOMS\nstruct TriangleData { vec2 p0, p1, p2; };\nvoid decodeTriangleData(out TriangleData tri) {\n    tri.p1 = vec2(fields1.z, fields2.x);\n    tri.p2 = fields2.yz;\n}\nvoid strokeOneTriangle() {\n    TriangleData tri; decodeTriangleData(tri);\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n    float vertexId = getVertexId();\n    if (vertexId == VBB_SEG_END_RIGHT)\n        offsetPosition.xy = tri.p1;\n    else if (vertexId == VBB_SEG_END_LEFT)\n        offsetPosition.xy = tri.p2;\n}\n#endif\n#ifdef HAS_RASTER_QUADS\nstruct TexQuadData { float angle; vec2 size; };\nvoid decodeTexQuadData(out TexQuadData quad) {\n    quad.angle     = fields1.z;\n    quad.size   = fields2.xy;\n}\nvoid strokeTexQuad() {\n    TexQuadData quad; decodeTexQuadData(quad);\n    vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);\n    vec2 p      = 0.5 * corner * quad.size;\n    vec2 rot    = cos_sin(quad.angle);\n    vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);\n    offsetPosition.xy += offset;\n    fsMultipurpose.xy = max(vec2(0.0), corner);\n    fsMultipurpose.z = 1.0;\n    fsHalfWidth = 0.0;\n}\n#endif\n#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)\nstruct ArcData { vec2 c; float start, end, major, minor, tilt; };\nvoid decodeArcData(out ArcData arc) {\n    arc.c     = fields1.xy;\n    arc.start = fields1.z;\n    arc.end   = fields2.x;\n    arc.major = fields2.z;\n#if defined(HAS_ELLIPTICALS)\n    arc.minor = extraParams.x;\n    arc.tilt  = extraParams.y;\n#endif\n}\nvoid strokeArc(const ArcData arc) {\n    float isStart = isStartVertex() ? -1.0 : 1.0;\n    float isLeft  = isLeftVertex()  ? -1.0 : 1.0;\n    vec2 minPt;\n    vec2 maxPt;\n    vec2 angles = vec2(arc.start, arc.end);\n    vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);\n    vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);\n    minPt = maxPt = vec2(endsX.x, endsY.x);\n    min_max(minPt, maxPt, vec2(endsX.y, endsY.y));\n    if (arc.end > arc.start) {\n        if (arc.start < PI_0_5 && arc.end > PI_0_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\n        }\n        if (arc.start < PI && arc.end > PI) {\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\n        }\n        if (arc.start < PI_1_5 && arc.end > PI_1_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\n        }\n    } else {\n        min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));\n        if (arc.start < PI_0_5 || arc.end > PI_0_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));\n        }\n        if (arc.start < PI || arc.end > PI) {\n            min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));\n        }\n        if (arc.start < PI_1_5 || arc.end > PI_1_5) {\n            min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));\n        }\n    }\n    minPt -= fsHalfWidth + aaRange;\n    maxPt += fsHalfWidth + aaRange;\n    offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;\n    offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;\n    fsMultipurpose.x = arc.start;\n    fsMultipurpose.y = -arc.major;\n    fsMultipurpose.z = arc.end;\n    fsMultipurpose.w = arc.minor;\n}\n#endif\n#if defined(HAS_CIRCLES)\nvoid strokeCircularArc() {\n    ArcData arc; decodeArcData(arc);\n    float r = arc.major;\n    if (r * pixelsPerUnit < 0.125)\n        r = 0.25 * aaRange;\n    arc.major = arc.minor = r;\n    strokeArc(arc);\n}\n#endif\n#if defined(HAS_ELLIPTICALS)\nvoid strokeEllipticalArc() {\n    ArcData arc; decodeArcData(arc);\n    strokeArc(arc);\n}\n#endif\nstruct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType, ghosting; };\nvoid decodeCommonAttribs(out CommonAttribs attribs) {\n    attribs.pos           = fields1.xy;\n    attribs.color         = color4b;\n    attribs.geomType      = flags4b.y;\n    attribs.layerTC       = layerVp4b.xy / 255.0;\n    attribs.vpTC          = layerVp4b.zw / 255.0;\n    attribs.lineWidthHalf = fields2.y;\n    attribs.ghosting      = flags4b.w;\n}\nvoid strokeIndexedTriangle() {\n    fsHalfWidth = 0.0;\n    fsMultipurpose.z = 0.0;\n}\n#ifdef SELECTION_RENDERER\nbool isSelected(const CommonAttribs attribs) {\n    vec3 oid = dbId4b.rgb;\n    float id01 = oid.r + oid.g * 256.0;\n    float t = (id01 + 0.5) * (1.0 / 4096.0);\n    float flrt = floor(t);\n    float texU = t - flrt;\n    float id23 = oid.b * (65536.0 / 4096.0) + flrt;\n    t = (id23 + 0.5) / vSelTexSize.y;\n    float texV = fract(t);\n    vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\n    return selBit.r == 1.0;\n}\n#endif\nbool isLayerOff(const CommonAttribs attribs) {\n#ifdef HAS_LAYERS\n    vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);\n    return (layerBit.r == 0.0);\n#else\n    return false;\n#endif\n}\nvec4 getColor(const CommonAttribs attribs) {\n    if (isLayerOff(attribs)) { return vec4(0.0); }\n#ifdef SELECTION_RENDERER\n    if (isSelected(attribs)) { return selectionColor; }\n    return vec4(0.0);\n#else\n    return attribs.color;\n#endif\n}\nvoid main() {\n    CommonAttribs attribs; decodeCommonAttribs(attribs);\n    fsColor = getColor(attribs);\n    if (swap != 0.0 ) {\n        if ( fsColor.r == 0.0 && fsColor.g == 0.0 && fsColor.b == 0.0 )\n            fsColor.rgb = vec3(1.0,1.0,1.0);\n        else if ( fsColor.r == 1.0 && fsColor.g == 1.0 && fsColor.b == 1.0 )\n            fsColor.rgb = vec3(0.0,0.0,0.0);\n    }\n    centralVertex = offsetPosition = attribs.pos;\n    float lineWeight = attribs.lineWidthHalf;\n    if (lineWeight > 0.0) {\n        if(lineWeight < 0.5 / pixelsPerUnit) {\n            lineWeight = 0.5 / pixelsPerUnit;\n        }\n    }\n    else {\n        lineWeight = abs(lineWeight) / pixelsPerUnit;\n    }\n    fsHalfWidth = lineWeight;\n    dbId = dbId4b / 255.0;\n    fsVpTC     = attribs.vpTC;\n    fsGhosting = attribs.ghosting;\n    if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();\n#ifdef HAS_CIRCLES\n    else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n    else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();\n#endif\n#ifdef HAS_RASTER_QUADS\n    else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();\n#endif\n#ifdef HAS_TRIANGLE_GEOMS\n    else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();\n#endif\n    else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();\n    fsOffsetDirection = offsetPosition - centralVertex;\n    gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n}\n",fragmentShader:"\n#include<line_decl_common>\nuniform highp float pixelsPerUnit;\nuniform highp float aaRange;\nuniform float opacity;\nuniform highp float viewportId;\nuniform highp float swap;\n#ifdef HAS_RASTER_QUADS\nuniform sampler2D tRaster;\n#endif\n#ifdef HAS_LINESTYLES\nuniform sampler2D tLineStyle;\nuniform vec2 vLineStyleTexSize;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(MODEL_COLOR)\nuniform vec3 modelId;\n#endif\nfloat curveGaussian(float r, float invWidth) {\n    float amt = clamp(r * invWidth, 0.0, 1.0);\n    float exponent = amt * 2.0;\n    return exp(-exponent*exponent);\n}\n#ifdef HAS_LINESTYLES\nfloat getLinePatternPixel(int i, int j) {\n    return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;\n}\nfloat getPatternLength(int whichPattern) {\n    float p1 = getLinePatternPixel(0, whichPattern);\n    float p2 = getLinePatternPixel(1, whichPattern);\n    return (p2 * 256.0 + p1);\n}\n#endif\nvoid fillLineSegment() {\n    float radius = abs(fsHalfWidth);\n    float parametricDistance = fsMultipurpose.x;\n    float segmentLength      = fsMultipurpose.y;\n    float totalDistance      = fsMultipurpose.z;\n#ifdef HAS_LINESTYLES\n    int whichPattern         = int(fsMultipurpose.w);\n    if (whichPattern > 0) {\n        const float TEX_TO_UNIT = 1.0 / 96.0;\n        float LTSCALE = 1.0;\n        float patternScale;\n        if (fsHalfWidth < 0.0) {\n            patternScale = LTSCALE;\n        } else {\n            patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;\n        }\n        float patLen = patternScale * getPatternLength(whichPattern);\n        float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);\n        bool onPixel = true;\n        float radiusPixels = radius * pixelsPerUnit;\n        for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {\n            float on = getLinePatternPixel(i, whichPattern);\n            if (on == 1.0) on = 0.0;\n            on *= patternScale;\n            onPixel = true;\n            phase -= on;\n            if (phase < 0.0) {\n                break;\n            }\n            else if (phase <= radiusPixels) {\n                onPixel = false;\n                break;\n            }\n            float off = getLinePatternPixel(i+1, whichPattern);\n            if (off <= 1.0) off = 0.0;\n            off *= patternScale;\n            onPixel = false;\n            phase -= off;\n            if (phase < -radiusPixels)\n                discard;\n            if (phase <= 0.0)\n                break;\n        }\n        if (!onPixel && (abs(phase) <= radiusPixels)) {\n            segmentLength = 0.0;\n            parametricDistance = phase / pixelsPerUnit;\n        }\n    }\n#endif\n    float dist;\n    float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);\n    float ltz = max(0.0, sign(-parametricDistance));\n    float gtsl = max(0.0, sign(parametricDistance - segmentLength));\n    float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\n    dist = sqrt(max(0.0, offsetLength2 + d*d));\n    float range =  dist - radius;\n    if (range > aaRange) {\n        discard;\n    }\n    gl_FragColor = fsColor;\n    gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\n#ifdef HAS_CIRCLES\nvoid fillCircularArc() {\n    float dist   = length(fsOffsetDirection);\n    vec2 angles  = fsMultipurpose.xz;\n    float radius = abs(fsMultipurpose.y);\n    float range  =  abs(dist - radius);\n    range -= fsHalfWidth;\n    if (range > aaRange) {\n        discard;\n    }\n    vec2 direction = fsOffsetDirection;\n    float angle = atan(direction.y, direction.x);\n    if (angles.x > angles.y) {\n        if (angle > angles.x && angle < PI) {\n            angle -= TAU;\n        }\n        angles.x -= TAU;\n        if (angle < angles.x ) {\n            angle += TAU;\n        }\n    }\n    else if (angle < 0.0)\n        angle += TAU;\n    if (angle > angles.x && angle < angles.y) {\n        gl_FragColor = fsColor;\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n    }\n    else {\n        discard;\n    }\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nfloat EllipticalApprox(\n        const int iters,\n        inout float t0, inout float t1,\n        const vec2 y,   out   vec2 x,\n        const vec2 e,   const vec2 ey, const vec2 esqr\n        ) {\n    vec2 r;\n    for (int i = 0; i < 10; ++i) {\n        if(i >= iters) break;\n        float t = mix(t0, t1, 0.5);\n        r = ey / (vec2(t) + esqr);\n        vec2 rsq = r * r;\n        float f = rsq.x + rsq.y - 1.0;\n        if(f > 0.0) { t0 = t; } else { t1 = t; }\n    }\n    x = e * r;\n    return distance(x, y);\n}\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\n    float dist;\n    vec2 esqr = e * e;\n    vec2 ey   = e * y;\n    float t0 = -esqr[1] + ey[1];\n    float t1 = -esqr[1] + length(ey);\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\n    if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\n        return dist;\n    dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);\n    float ecc = 1.0 +  0.1 * e[0] / e[1];\n    if (dist > max(ecc * (width + aaRange), e[0] * 0.001))\n        return dist;\n    if (dist < (width - aaRange) / ecc)\n        return dist;\n    dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);\n    return dist;\n}\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\n    vec2 locE, locY;\n    float diff = sign(e[0] - e[1]);\n    vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\n    locE.x = dot(e, swizzle.xy);\n    locE.y = dot(e, swizzle.yx);\n    locY.x = dot(y, swizzle.xy);\n    locY.y = dot(y, swizzle.yx);\n    vec2 refl = sign(locY);\n    locY *= refl;\n    vec2 x;\n    float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\n    x *= refl;\n    locX.x = dot(x, swizzle.xy);\n    locX.y = dot(x, swizzle.yx);\n    return distance;\n}\nvoid fillEllipticalArc() {\n    vec2 angles = fsMultipurpose.xz;\n    vec2 radii  = abs(fsMultipurpose.yw);\n    vec2 dir    = fsOffsetDirection;\n    vec2 pos;\n    float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);\n    range -= fsHalfWidth;\n    if (range > aaRange)\n        discard;\n    float ar = radii[0] / radii[1];\n    float angle = atan(ar * pos.y, pos.x);\n    if (angles.x > angles.y) {\n        if (angle > angles.x && angle < PI) {\n            angle -= TAU;\n        }\n        angles.x -= TAU;\n        if (angle < angles.x ) {\n            angle += TAU;\n        }\n    }\n    else if (angle < 0.0)\n        angle += TAU;\n    if (angle > angles.x && angle < angles.y) {\n        gl_FragColor = fsColor;\n        gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n    }\n    else {\n        discard;\n    }\n}\n#endif\n#ifdef HAS_RASTER_QUADS\nvoid fillTexQuad() { gl_FragColor = texture2D(tRaster, fsMultipurpose.xy); }\n#endif\nvoid fillTriangle() { gl_FragColor = fsColor; }\nvoid main() {\n    if (fsColor == vec4(0.0)) {\n        discard;\n    }\n    if (fsHalfWidth == 0.0) {\n#ifdef HAS_RASTER_QUADS\n        if (fsMultipurpose.z != 0.0)\n            fillTexQuad();\n        else\n#endif\n            fillTriangle();\n    }\n    else if (fsMultipurpose.y < 0.0) {\n#ifdef HAS_CIRCLES\n#ifdef HAS_ELLIPTICALS\n        if (abs(fsMultipurpose.y) == fsMultipurpose.w)\n#endif\n            fillCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n#ifdef HAS_CIRCLES\n        else\n#endif\n            fillEllipticalArc();\n#endif\n    }\n    else\n        fillLineSegment();\n#ifdef MRT_NORMALS\n    gl_FragData[1] = vec4(0.0);\n#endif\n    float writeId = 1.0;\n    if (fsGhosting != 0.0 || \n            ((viewportId != 0.0) && (abs(fsVpTC.x * 255.0 + fsVpTC.y) >= 0.5 && abs(fsVpTC.x * 255.0 + fsVpTC.y - viewportId) >= 0.5))) {\n        writeId = 0.0;\n        gl_FragColor.a *= opacity * ((swap == 1.0) ? 0.21 : 0.1);\n    } else {\n        gl_FragColor.a *= opacity;\n    }\n#include<id_frag>\n}\n"},ti={uniforms:{color:{type:"v3",value:new b.Vector3(0,0,0)},opacity:{type:"f",value:1}},rawShader:!0,vertexShader:"\n#include<instancing_decl_vert>\nvarying vec4 finalColor;\nuniform vec3 color;\nuniform float opacity;\nvoid main() {\n    gl_Position = projectionMatrix * (viewMatrix * vec4(getInstancePos(position), 1.0));\n    finalColor = vec4(color, opacity);\n}\n",fragmentShader:"precision lowp float;\nvarying vec4 finalColor;\nvoid main() {\n    gl_FragColor = finalColor;\n}\n"},ui=function(a){var c={vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};return a.uniforms&&(c.uniforms=b.UniformsUtils.clone(a.uniforms)),a.defines&&(c.defines=Object.assign({},a.defines)),a.attributes&&(c.attributes=a.attributes),new b.ShaderMaterial(c)},vi=function(a,b,c){c=c||"",a.defines||(a.defines={}),a.defines[b]!=c&&(a.defines[b]=c,a.needsUpdate=!0)},wi=function(a,b){(a.defines||a.defines[b])&&(delete a.defines[b],a.needsUpdate=!0)},xi={createShaderMaterial:ui,setMacro:vi,removeMacro:wi},yi=function(a,c){this.textureID=void 0!==c?c:"tDiffuse",this.material=xi.createShaderMaterial(a),this.uniforms=this.material.uniforms,this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new b.OrthographicCamera(-1,1,1,-1,0,1);var d=new b.BufferGeometry,e=new Float32Array(9);e[0]=-1,e[1]=-1,e[2]=0,e[3]=3,e[4]=-1,e[5]=0,e[6]=-1,e[7]=3,e[8]=0;var f=new Float32Array(6);f[0]=0,f[1]=0,f[2]=2,f[3]=0,f[4]=0,f[5]=2;var g=new Float32Array(9);g[0]=0,g[1]=0,g[2]=1,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=1,d.addAttribute("position",new b.BufferAttribute(e,3)),d.addAttribute("normal",new b.BufferAttribute(g,3)),d.addAttribute("uv",new b.BufferAttribute(f,2)),this.quad=new b.Mesh(d,this.material),this.scene=new b.Scene,this.scene.add(this.quad)};yi.prototype={render:function(a,b,c,d){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c.texture||c),this.renderToScreen||!b?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}};var zi={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new b.Vector4(1,1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n#ifdef HAS_ALPHA\n        texCol.rgb *= texCol.a;\n#endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n#ifdef HAS_ALPHA\n    texColSum.rgb /= (texColSum.a == 0.0 ? 0.0001 : texColSum.a);\n#endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}\n"},Ai=function(a,c,d,e,f){var g,h,i,j=a,k=c,l=d||3,m=e||1,n={hasAlpha:f.hasAlpha||!1,blending:f.blending||!1,flipUV:f.flipUV||!1};this.render=function(a,b,c){g.render(a,i,c),h.render(a,b,i)},this.setSize=function(a,c){this.cleanup(),j=a,k=c,i=new b.WebGLRenderTarget(a,c,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:void 0!==f.format?f.format:b.RGBAFormat,type:void 0!==f.type?f.type:b.UnsignedByteType,stencilBuffer:!1}),i.generateMipmaps=!1,g.material.defines.KERNEL_SCALE_H=h.material.defines.KERNEL_SCALE_H=(m/j).toFixed(4),g.material.defines.KERNEL_SCALE_V=h.material.defines.KERNEL_SCALE_V=(m/k).toFixed(4),g.material.needsUpdate=h.material.needsUpdate=!0},this.cleanup=function(){i&&i.dispose()},this.setColor=function(a){h.material.uniforms.uColor.value.x=a.r,h.material.uniforms.uColor.value.y=a.g,h.material.uniforms.uColor.value.z=a.b},this.setAlpha=function(a){h.material.uniforms.uColor.value.w=a},g=new yi(zi),h=new yi(zi),this.setSize(a,c),g.material.blending=h.material.blending=b.NoBlending,g.material.depthWrite=h.material.depthWrite=!1,g.material.depthTest=h.material.depthTest=!1,g.material.defines.HORIZONTAL=1,g.material.defines.KERNEL_RADIUS=h.material.defines.KERNEL_RADIUS=l.toFixed(1),n.blending&&(h.material.transparent=!0,h.material.blending=b.NormalBlending),n.hasAlpha&&(g.material.defines.HAS_ALPHA=h.material.defines.HAS_ALPHA=""),n.flipUV&&(g.material.defines.FLIP_UV="")},Bi="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",Ci=function(){return Bi.match(/ip(ad|hone|od)/)},Di=function(){return-1!==Bi.indexOf("android")},Ei=function(){return Ci()||Di()},Fi=function(){return-1!==Bi.indexOf("chrome")},Gi=function(){return-1!==Bi.indexOf("safari")&&-1===Bi.indexOf("chrome")},Hi=function(){return-1!==Bi.indexOf("firefox")},Ii=function(){return-1!==Bi.indexOf("mac os")},Ji=function(){return-1!==Bi.indexOf("win32")||-1!==Bi.indexOf("windows")},Ki=function(){return"undefined"==typeof navigator},Li=function(){return Gi()?function(a){if(!window.Polymer)return a;for(var b in a)if(-1!==b.indexOf("__impl"))return a[b];return a}:function(a){return a}}(),Mi=function(a){if(-1!==a.indexOf("://")||0===a.indexOf("urn:"))return a;if("undefined"==typeof window)return a;var b=window.location.pathname,c=b.lastIndexOf("/");return b=b.substr(0,c+1),window.location.protocol+"//"+window.location.host+b+a};a.assets=[];var Ni=function(){a.assets=null};a.memoryOptimizedLoading=!0;var Oi=function(b){a.memoryOptimizedLoading=b},Pi=1024*(Ei()?64:256)*1024,Qi=Ei()?2500:1e4,Ri=1,Si=1,Ti=2,Ui=0,Vi=1,Wi=2,Xi=4,Yi=16,Zi=32,$i=64,_i=128,aj=0,bj=1,cj=2,dj={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:ji,fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tDiffuse, vUv );\n    gl_FragColor = texel;\n}\n"},ej=function(a,c,d,e){var f,g,h,i,j,k,l=a,m=l.getContext(),n=c||512,o=d||512,p=!1,q=new b.Color(0,0,0),r=!1,s=!1;this.inTarget=void 0,this.outTarget=void 0;var t=!0,u=0,v={color:new b.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18},w=function(a){var c=a.normal,d=a.constant;return(new b.Matrix4).set(1-2*c.x*c.x,-2*c.y*c.x,-2*c.x*c.z,-2*d*c.x,-2*c.x*c.y,1-2*c.y*c.y,-2*c.y*c.z,-2*d*c.y,-2*c.x*c.z,-2*c.y*c.z,1-2*c.z*c.z,-2*d*c.z,0,0,0,1)};if(this.setTransform=function(a,b,c){i=a,h.normal=b,h.constant=-a.dot(b)},this.cleanup=function(){f&&f.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(a,c){n=a,o=c,this.cleanup(),this.inTarget=new b.WebGLRenderTarget(n*v.texScale,o*v.texScale,{magFilter:b.LinearFilter,minFilter:b.LinearFilter,format:b.RGBAFormat,stencilBuffer:!1}),this.inTarget.generateMipmaps=!1,this.outTarget=new b.WebGLRenderTarget(n*v.texScale,o*v.texScale,{magFilter:b.LinearFilter,minFilter:b.LinearFilter,format:b.RGBAFormat,stencilBuffer:!1}),this.outTarget.generateMipmaps=!1,f?f.setSize(n*v.texScale*v.blurTexScale,o*v.texScale*v.blurTexScale):f=new Ai(n*v.texScale*v.blurTexScale,o*v.texScale*v.blurTexScale,v.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(a){var c;c=a.isPerspective?i.clone():a.target.clone();var d=a.position.clone().sub(c).normalize(),e=Math.PI/2-d.angleTo(h.normal);if(!(p=e<0)){if(v.fadeAngle>0){var g=Math.min(v.fadeAngle,e)/v.fadeAngle;f.setAlpha(g*v.alpha)}var k=w(h);j=a.clone(),j.applyMatrix(k),j.projectionMatrix.elements[5]*=-1,j.matrixWorldNeedsUpdate=!0,a.worldUpTransform?j.worldUpTransform=a.worldUpTransform.clone():j.worldUpTransform=new b.Matrix4}},this.renderIntoReflection=function(a){p||l.render(a,j,this.inTarget)},this.prepareGroundReflection=function(){var a,b=0,c=0,d=0;return function(e,f,g,h,i,j){var k=f.modelQueue();if(0!==u||k.isEmpty())return u=1,i;if(a!=k.getGeomScenes()&&(t=!0),t){if(t=!1,this.updateCamera(f.camera),this.isGroundCulled())return u=1,i;this.clear(),a=k.getGeomScenes(),b=a.length,c=0,d=h?Math.max(Math.ceil(b/100),h):b,u=0}else{if(0!==u)return u=1,i;0===h&&(d=b)}var l,m;i&&(l=performance.now(),j=void 0===j?1:j,m=j*i);for(var n,o=0;o<d&&c<b;){var p=a[c++];if(p&&(o++,p.forceVisible=!0,this.renderIntoReflection(p),p.forceVisible=!1,i)){var q=performance.now()-l;if(m<q&&c<b){u=0,n=i-q;break}}}return c<b&&(u=0,n=i?i-performance.now()+l:1),void 0===n||g?(this.postprocess(f.camera,f.matman()),e&&e.enabled&&f.renderGroundShadow(this.outTarget),this.renderReflection(f.camera,f.renderer().getColorTarget()),void 0===n&&(u=2),i?i-performance.now()+l:1):n}}(),this.renderReflection=function(a,b){p||(m.depthRange(.999999,1),g.render(l,b,this.outTarget),m.depthRange(0,1))},this.toggleEnvMapBackground=function(a){s=a,k.uniforms.envMapBackground.value=a},this.postprocess=function(a){p||(r||s?(k.uniforms.uCamDir.value=a.worldUpTransform?a.getWorldDirection().clone().applyMatrix4(a.worldUpTransform):a.getWorldDirection(),k.uniforms.uCamUp.value=a.worldUpTransform?a.up.clone().applyMatrix4(a.worldUpTransform):a.up,k.uniforms.uResolution.value.set(n,o),k.uniforms.uHalfFovTan.value=Math.tan(b.Math.degToRad(.5*a.fov)),k.render(l,this.outTarget),l.clearTarget(this.outTarget,!1,!0,!1)):(l.setClearColor(q,1),l.clearTarget(this.outTarget,!0,!0,!1)),f.render(l,this.outTarget,this.inTarget))},this.clear=function(){l.setClearColor(q,0),l.clearTarget(this.inTarget,!0,!0,!1),l.clearBlend()},this.setClearColors=function(a,b,c){b?(q.setRGB(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)),r=!a.equals(b)&&!c):(q.copy(a),r=!1),r&&(k.uniforms.color1.value.copy(a),k.uniforms.color2.value.copy(b))},this.setEnvRotation=function(a){k.material.envRotationSin=Math.sin(a),k.material.envRotationCos=Math.cos(a)},this.isGroundCulled=function(){return p},this.getStatus=function(){return u},this.setDirty=function(){t=!0,u=0},this.setColor=function(a){f.setColor(v.color),v.color.set(a)},this.setAlpha=function(a){f.setAlpha(v.alpha),v.alpha=a},e)for(var x in v)v[x]=void 0!==e[x]?e[x]:v[x];g=new yi(dj),g.material.blending=b.NoBlending,g.material.depthTest=!0,g.material.depthWrite=!1,g.scene.position.z=-.999999,e.clearPass?k=e.clearPass:(k=new yi(xh),k.material.blending=b.NoBlending,k.material.depthWrite=!1,k.material.depthTest=!1),this.setSize(n,o),f.setAlpha(v.color),f.setAlpha(v.alpha),h=new b.Plane(new b.Vector3(0,1,0),0),i=new b.Vector3(0,0,0)},fj=function(a,b,c){var d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),d},gj={uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.bump,b.UniformsLib.normalmap,b.UniformsLib.lights,b.UniformsLib.fog,hi.CutPlanesUniforms,hi.IdUniforms,hi.ThemingUniform,hi.ShadowMapUniforms,hi.WideLinesUniforms,{emissive:{type:"c",value:new b.Color(0)},specular:{type:"c",value:new b.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},texMatrix:{type:"m3",value:new b.Matrix3},texMatrixBump:{type:"m3",value:new b.Matrix3},texMatrixAlpha:{type:"m3",value:new b.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying vec3 vNormal;\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<wide_lines_decl>\n#include<shadowmap_decl_vert>\nvoid main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n    vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\n    vColor = color * color;\n#else\n    vColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n    vec3 transformedNormal = normalMatrix * objectNormal;\n#ifndef FLAT_SHADED\n    vNormal = normalize( transformedNormal );\n#endif\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n#include<wide_lines_vert>\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<shadowmap_vert>\n#include<id_vert>\n}\n",
fragmentShader:"uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\n#include<env_sample>\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 InputToLinear(vec3 c) {\n    return c * c;\n}\nfloat InputToLinear(float c) {\n    return c * c;\n}\n#else\nvec3 InputToLinear(vec3 c) {\n    return c;\n}\nfloat InputToLinear(float c) {\n    return c;\n}\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#include<id_decl_frag>\n#include<theming_decl_frag>\n#include<shadowmap_decl_frag>\n#ifdef USE_ENVMAP\nuniform float reflMipIndex;\nuniform float reflectivity;\nuniform samplerCube envMap;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\nvec3 sampleReflection(vec3 dir, float mipIndex) {\n    vec3 adjDir = adjustLookupVector(dir);\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\n#endif\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );\n#endif\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = textureCube( envMap, adjDir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef USE_IRRADIANCEMAP\nuniform samplerCube irradianceMap;\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\nvarying highp vec3 vViewPosition;\n#ifndef FLAT_SHADED\nvarying highp vec3 vNormal;\n#endif\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\n    vec2 dSTdx = dFdx( vUvBump );\n    vec2 dSTdy = dFdy( vUvBump );\n    float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;\n    float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;\n    float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;\n    return vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n    vec3 vSigmaX = dFdx( surf_pos );\n    vec3 vSigmaY = dFdy( surf_pos );\n    vec3 vN = surf_norm;\n    vec3 R1 = cross( vSigmaY, vN );\n    vec3 R2 = cross( vN, vSigmaX );\n    float fDet = dot( vSigmaX, R1 );\n    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n    return normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n    vec3 q0 = dFdx( eye_pos.xyz );\n    vec3 q1 = dFdy( eye_pos.xyz );\n    vec2 st0 = dFdx( vUvBump.st );\n    vec2 st1 = dFdy( vUvBump.st );\n    vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n    vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n    vec3 N = normalize( surf_norm );\n    vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;\n    mapN.xy = normalScale * mapN.xy;\n    mat3 tsn = mat3( S, T, N );\n    return normalize( tsn * mapN );\n}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif\n#include<hatch_pattern>\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\nvec3 Schlick_v3(vec3 v, float cosHV) {\n    float facing = max(1.0 - cosHV, 0.0);\n    float facing2 = facing * facing;\n    return v + (1.0 - v) * facing * facing2 * facing2;\n}\nfloat Schlick_f(float v, float cosHV) {\n    float facing = max(1.0 - cosHV, 0.0);\n    float facing2 = facing * facing;\n    return v + ( 1.0 - v ) * facing2 * facing2 * facing;\n}\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n#ifdef USE_MAP\n    vec4 texelColor = GET_MAP(vUv);\n#ifdef MAP_INVERT\n    texelColor.xyz = 1.0-texelColor.xyz;\n#endif\n#ifdef GAMMA_INPUT\n    texelColor.xyz *= texelColor.xyz;\n#endif\n    gl_FragColor = gl_FragColor * texelColor;\n#endif\n#ifdef USE_ALPHAMAP\n    vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);\n    gl_FragColor.a *= texelAlpha.r;\n#endif\n#ifdef ALPHATEST\n    if ( gl_FragColor.a < ALPHATEST ) discard;\n#endif\n    float specularStrength;\n#ifdef USE_SPECULARMAP\n    vec4 texelSpecular = GET_SPECULARMAP(vUv);\n    specularStrength = texelSpecular.r;\n#else\n    specularStrength = 1.0;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n    vec3 geomNormal = normal;\n#ifdef USE_NORMALMAP\n    normal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n    normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n    vec3 viewDirection;\n    if (projectionMatrix[3][3] == 0.0) {\n        viewDirection = normalize( vViewPosition );\n    } else {\n        viewDirection = vec3(0.0, 0.0, 1.0);\n    }\n    vec3 totalDiffuse = vec3( 0.0 );\n    vec3 totalSpecular = vec3( 0.0 );\n    float shininessB = shininess * 4.0;\n#if MAX_POINT_LIGHTS > 0\n    vec3 pointDiffuse  = vec3( 0.0 );\n    vec3 pointSpecular = vec3( 0.0 );\n    for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lVector = normalize( lVector );\n        float dotProduct = dot( normal, lVector );\n        float pointDiffuseWeight = max( dotProduct, 0.0 );\n        pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\n        vec3 pointHalfVector = normalize( lVector + viewDirection );\n        float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n        float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\n        float specularNormalization = shininessB * 0.125 + 0.25;\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\n        pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\n    }\n    totalDiffuse += pointDiffuse;\n    totalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    vec3 spotDiffuse  = vec3( 0.0 );\n    vec3 spotSpecular = vec3( 0.0 );\n    for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        lVector = normalize( lVector );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] ) {\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n            float dotProduct = dot( normal, lVector );\n            float spotDiffuseWeight = max( dotProduct, 0.0 );\n            spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\n            vec3 spotHalfVector = normalize( lVector + viewDirection );\n            float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n            float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\n            float specularNormalization = shininessB * 0.125 + 0.25;\n            vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\n            spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n        }\n    }\n    totalDiffuse += spotDiffuse;\n    totalSpecular += spotSpecular;\n#endif\n#if MAX_DIR_LIGHTS > 0\n    vec3 dirDiffuse  = vec3( 0.0 );\n    vec3 dirSpecular = vec3( 0.0 );\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        vec3 dirVector = normalize( lDirection.xyz );\n        float dotProduct = dot( normal, dirVector );\n        float dirDiffuseWeight = max( dotProduct, 0.0 );\n        dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\n        vec3 dirHalfVector = normalize( dirVector + viewDirection );\n        float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n        float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\n        float specularNormalization = shininessB * 0.125 + 0.25;\n        vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\n        dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n    }\n    totalDiffuse += dirDiffuse;\n    totalSpecular += dirSpecular;\n#endif\n#ifdef USE_IRRADIANCEMAP\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 indirectDiffuse = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    indirectDiffuse = applyEnvShadow(indirectDiffuse, worldNormal);\n    totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\n#endif\n#ifdef METAL\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\n#else\n    gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\n#endif\n#ifdef USE_COLOR\n    gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif\n#if defined(USE_ENVMAP)\n    vec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n#ifdef ENVMAP_MODE_REFLECTION\n    reflectVec = reflect( -viewDirection, normal );\n#else \n    reflectVec = refract( -viewDirection, normal, refractionRatio );\n#endif\n#else\n    reflectVec = reflect( -viewDirection, normal );\n#endif\n    reflectVec = mat3(viewMatrixInverse) * reflectVec;\n    float reflectScale = 1.0;\n    vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\n    cubeColor *= reflectScale;\n    float facing = dot( viewDirection, geomNormal );\n    if (facing < -1e-2)\n        facing = 1.0;\n    else\n        facing = max(1e-6, facing);\n    vec3 schlickRefl;\n#ifdef METAL\n    schlickRefl = InputToLinear(specular);\n#else\n    schlickRefl = Schlick_v3(InputToLinear(specular), facing);\n    gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\n    float invSchlick = (1.0 - facing * 0.5);\n    float invSchlick2 = invSchlick * invSchlick;\n    float norm_factor = 1.0 - invSchlick * invSchlick2 * invSchlick2;\n    norm_factor = (28.0 / 23.0) * norm_factor;\n    gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\n#endif\n    gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\n#ifdef CLEARCOAT\n    vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\n    reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;\n    vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\n    float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\n    gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\n#endif\n#endif\n#if TONEMAP_OUTPUT == 1\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#include<theming_frag>\n#include<final_frag>\n}\n"};b.ShaderLib.firefly_phong=gj;var hj,ij,jj,kj,lj,mj,nj,oj,pj,qj="undefined"!=typeof self&&self.LmvVector3?self.LmvVector3:b.Vector3,rj={getVertexCount:k,enumMeshVertices:l,enumMeshTriangles:m,enumMeshLines:n},sj=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};sj.prototype={constructor:sj,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){if(0!==a){var b=1/a;this.x*=b,this.y*=b,this.z*=b}else this.x=0,this.y=0,this.z=0;return this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this.z>a.z&&(this.z=a.z),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this.z<a.z&&(this.z=a.z),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this.z<a.z?this.z=a.z:this.z>b.z&&(this.z=b.z),this},clampScalar:function(){var a,b;return function(c,d){return void 0===a&&(a=new sj,b=new sj),a.set(c,c,c),b.set(d,d,d),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new sj),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new sj),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new sj),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setEulerFromRotationMatrix:function(a,b){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(a,b){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(a,b)},setFromMatrixPosition:function(a){return this.x=a.elements[12],this.y=a.elements[13],this.z=a.elements[14],this},setFromMatrixScale:function(a){var b=this.set(a.elements[0],a.elements[1],a.elements[2]).length(),c=this.set(a.elements[4],a.elements[5],a.elements[6]).length(),d=this.set(a.elements[8],a.elements[9],a.elements[10]).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){var c=4*a,d=b.elements;return this.x=d[c],this.y=d[c+1],this.z=d[c+2],this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this}};var tj=function(a,b){this.min=void 0!==a?a:new sj(1/0,1/0,1/0),this.max=void 0!==b?b:new sj(-1/0,-1/0,-1/0)};tj.prototype={constructor:tj,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromArray:function(a,b){return this.min.x=a[b],this.min.y=a[b+1],this.min.z=a[b+2],this.max.x=a[b+3],this.max.y=a[b+4],this.max.z=a[b+5],this},copyToArray:function(a,b){a[b]=this.min.x,a[b+1]=this.min.y,a[b+2]=this.min.z,a[b+3]=this.max.x,a[b+4]=this.max.y,a[b+5]=this.max.z},setFromCenterAndSize:function(){var a=new sj;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new sj).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new sj).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new sj).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},clampPoint:function(a,b){return(b||new sj).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new sj;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new sj,new sj,new sj,new sj,new sj,new sj,new sj,new sj];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};var uj,vj,wj,xj,yj,zj=rj.getVertexCount,Aj=rj.enumMeshTriangles,Bj=rj.enumMeshVertices,Cj={createWireframe:q},Dj=function(a,b){return a.distance-b.distance},Ej={meshRayCast:s,lineRayCast:t,rayCast:v,intersectObject:x};y.prototype.getGeometry=function(a){return this.geoms[a]},y.prototype.chooseMemoryType=function(a,b,c,d){var e=Pi,f=2*e,g=Qi;if(this.isf2d&&(f*=2),this.disableStreaming||d<e&&c<g)a.streamingDraw=!1,a.streamingIndex=!1;else if(d>=f)a.streamingDraw=!0,a.streamingIndex=!0;else{var h;h=this.is2d?100001:a.byteSize*(b||1),h<1e5&&(a.streamingDraw=!0,a.streamingIndex=!0)}},y.prototype.addGeometry=function(c,d,e){this.chooseMemoryType(c,d,this.gpuNumMeshes,this.gpuMeshMemory);var f=c.byteSize+464;c.streamingDraw||(Ei()&&(f+=c.byteSize),this.gpuMeshMemory+=c.byteSize,this.gpuNumMeshes+=1),this.numGeomsInMemory++,(void 0===e||e<=0)&&(e=this.geoms.length),this.geoms[e]=c;var g=this.geomBoxes.length/6|0;if(g<this.geoms.length){var h=3*this.geoms.length/2|0,i=new Float32Array(6*h);i.set(this.geomBoxes);var j=new b.Box3;for(j.makeEmpty();g<h;)i[6*g]=j.min.x,i[6*g+1]=j.min.y,i[6*g+2]=j.min.z,i[6*g+3]=j.max.x,i[6*g+4]=j.max.y,i[6*g+++5]=j.max.z;this.geomBoxes=i}var k=c.boundingBox;this.geomBoxes[6*e]=k.min.x,this.geomBoxes[6*e+1]=k.min.y,this.geomBoxes[6*e+2]=k.min.z,this.geomBoxes[6*e+3]=k.max.x,this.geomBoxes[6*e+4]=k.max.y,this.geomBoxes[6*e+5]=k.max.z,a.memoryOptimizedLoading&&!this.is2d&&(c.boundingBox=null,c.boundingSphere=null),this.geomMemory+=f;var l=c.attributes.index.array||c.ib,m=c.isLines?l.length/2:l.length/3;return this.geomPolyCount+=m,this.instancePolyCount+=m*(d||1),c.polyCount=m,c.instanceCount=d||1,c.svfid=e,c.lockCount=0,e},y.prototype.removeGeometry=function(a,b){var c=this.getGeometry(a);if(!c||c.lockCount>0)return 0;var d=c.byteSize+464;return b&&b.deallocateGeometry(c),c.streamingDraw||(Ei()&&(d+=c.byteSize),this.gpuMeshMemory-=c.byteSize,this.gpuNumMeshes-=1),this.geoms[a]=null,this.geomMemory-=d,this.numGeomsInMemory--,this.geomPolyCount-=c.polyCount,this.instancePolyCount-=c.instanceCount*c.polyCount,d},y.prototype.lockGeometry=function(a){var b=this.getGeometry(a);return!!b&&(++b.lockCount,!0)},y.prototype.unlockGeometry=function(a){var b=this.getGeometry(a);return!(!b||b.lockCount<=0)&&(--b.lockCount,!0)},y.prototype.getLockCount=function(a){var b=this.getGeometry(a);return b?b.lockCount:-1},y.prototype.getModelBox=function(a,b){if(this.geomBoxes.length/6<=a)return void b.makeEmpty();var c=6*a,d=this.geomBoxes;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},y.prototype.dispose=function(a){if(a)for(var b=0,c=this.geoms.length;b<c;b++)this.geoms[b]&&a.deallocateGeometry(this.geoms[b])},y.prototype.printStats=function(){b.log("Total geometry size: "+this.geomMemory/1048576+" MB"),b.log("Number of meshes: "+this.geoms.length),b.log("Num Meshes on GPU: "+this.gpuNumMeshes),b.log("Net GPU geom memory used: "+this.gpuMeshMemory)};var Fj=[[1,5,4,7,3,2,6],[0,3,2,1,5,4,6],[0,3,2,6,5,4,6],[0,4,7,3,2,1,6],[0,3,2,1,-1,-1,4],[0,3,2,6,5,1,6],[0,4,7,6,2,1,6],[0,3,7,6,2,1,6],[0,3,7,6,5,1,6],[0,1,5,4,7,3,6],[0,1,5,4,-1,-1,4],[0,1,2,6,5,4,6],[0,4,7,3,-1,-1,4],[-1,-1,-1,-1,-1,-1,0],[1,2,6,5,-1,-1,4],[0,4,7,6,2,3,6],[2,3,7,6,-1,-1,4],[1,2,3,7,6,5,6],[0,1,5,6,7,3,6],[0,1,5,6,7,4,6],[0,1,2,6,7,4,6],[0,4,5,6,7,3,6],[4,5,6,7,-1,-1,4],[1,2,6,7,4,5,6],[0,4,5,6,2,3,6],[2,3,7,4,5,6,6],[1,2,3,7,4,5,6]],Gj=function(){this.frustum=new b.Frustum,this.viewProj=new b.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new b.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1,this.eye=new b.Vector3};Object.defineProperty(Gj,"OUTSIDE",{value:0}),Object.defineProperty(Gj,"INTERSECTS",{value:1}),Object.defineProperty(Gj,"CONTAINS",{value:2}),Object.defineProperty(Gj,"CONTAINMENT_UNKNOWN",{value:-1}),Gj.prototype.reset=function(a){this.viewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this.frustum.setFromMatrix(this.viewProj);var b=a.matrixWorldInverse.elements;this.ar=a.aspect,this.viewDir[0]=-b[2],this.viewDir[1]=-b[6],this.viewDir[2]=-b[10],this.eye.x=a.position.x,this.eye.y=a.position.y,this.eye.z=a.position.z,this.areaConv=a.clientWidth*a.clientHeight/4},Gj.prototype.projectedArea=function(){function a(){d||(d=[new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3,new b.Vector3],e=new b.Box2)}function c(a,b){var c=a.x,d=a.y,e=a.z,f=b.elements,g=f[3]*c+f[7]*d+f[11]*e+f[15];g<0&&(g=-g);var h=1/g;a.x=(f[0]*c+f[4]*d+f[8]*e+f[12])*h,a.y=(f[1]*c+f[5]*d+f[9]*e+f[13])*h}var d,e;return function(b){if(b.empty())return 0;a();var f=this.viewProj;d[0].set(b.min.x,b.min.y,b.min.z),d[1].set(b.min.x,b.min.y,b.max.z),d[2].set(b.min.x,b.max.y,b.min.z),d[3].set(b.min.x,b.max.y,b.max.z),d[4].set(b.max.x,b.min.y,b.min.z),d[5].set(b.max.x,b.min.y,b.max.z),d[6].set(b.max.x,b.max.y,b.min.z),d[7].set(b.max.x,b.max.y,b.max.z);for(var g=0;g<8;g++)c(d[g],f);return e.makeEmpty(),e.setFromPoints(d),e.min.x<-1&&(e.min.x=-1),e.min.x>1&&(e.min.x=1),e.min.y<-1&&(e.min.y=-1),e.min.y>1&&(e.min.y=1),e.max.x>1&&(e.max.x=1),e.max.x<-1&&(e.max.x=-1),e.max.y>1&&(e.max.y=1),e.max.y<-1&&(e.max.y=-1),(e.max.x-e.min.x)*(e.max.y-e.min.y)}}(),Gj.prototype.projectedBoxArea=function(){function a(){if(!e){e=[],f=[];for(var a=0;a<10;a++)e.push(new b.Vector3),f.push(new b.Vector3)}}function c(a,b){var c=a.x,d=a.y,e=a.z,f=b.elements,g=f[3]*c+f[7]*d+f[11]*e+f[15];g<0&&(g=-g);var h=1/g;a.x=(f[0]*c+f[4]*d+f[8]*e+f[12])*h,a.y=(f[1]*c+f[5]*d+f[9]*e+f[13])*h}function d(a,b){var c,d,e,h,i,j,k,l,m=a,n=f,o=function(a){switch(k){case 0:return a.x>=-1;case 1:return a.x<=1;case 2:return a.y>=-1;case 3:return a.y<=1}},p=function(a){n[l].x=a.x,n[l++].y=a.y},q=function(){var a,b;switch(k){case 0:a=-1,b=d.y+(e.y-d.y)*(a-d.x)/(e.x-d.x);break;case 1:a=1,b=d.y+(e.y-d.y)*(a-d.x)/(e.x-d.x);break;case 2:b=-1,a=d.x+(e.x-d.x)*(b-d.y)/(e.y-d.y);break;case 3:b=1,a=d.x+(e.x-d.x)*(b-d.y)/(e.y-d.y)}n[l].x=a,n[l++].y=b};for(k=0;k<4&&b>2;k++){for(l=0,d=m[b-1],h=o(d),j=0;j<b;j++)e=m[j],i=o(e),h?i?p(e):q():i&&(q(),p(e)),d=e,h=i;b=l,c=m,m=n,n=c}return g=b,m}var e,f,g;return function(b,f){if(b.empty())return 0;a();var h,i=this.viewProj;if(h=this.eye.x>=b.min.x?this.eye.x>b.max.x?2:1:0,this.eye.y>=b.min.y&&(h+=this.eye.y>b.max.y?6:3),this.eye.z>=b.min.z&&(h+=this.eye.z>b.max.z?18:9),13===h)return 4;var j,k=Fj[h][6];for(j=0;j<k;j++){var l=Fj[h][j];e[j].set((l+1)%4<2?b.min.x:b.max.x,l%4<2?b.min.y:b.max.y,l<4?b.min.z:b.max.z),c(e[j],i)}var m=0;if(f)for(m=(e[k-1].x-e[0].x)*(e[k-1].y+e[0].y),j=0;j<k-1;j++)m+=(e[j].x-e[j+1].x)*(e[j].y+e[j+1].y);else{var n=d(e,k);if(g>=3)for(m=(n[g-1].x-n[0].x)*(n[g-1].y+n[0].y),j=0;j<g-1;j++)m+=(n[j].x-n[j+1].x)*(n[j].y+n[j+1].y)}return Math.abs(.5*m)}}(),Gj.prototype.estimateDepth=function(a){var b=this.viewProj.elements,c=(a.min.x+a.max.x)/2,d=(a.min.y+a.max.y)/2,e=(a.min.z+a.max.z)/2,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]);return(b[2]*c+b[6]*d+b[10]*e+b[14])*f},Gj.prototype.intersectsBox=function(){function a(){c||(c=new b.Vector3,d=new b.Vector3)}var c,d;return function(b){a();for(var e=this.frustum.planes,f=0,g=0;g<6;g++){var h=e[g]
;c.x=h.normal.x>0?b.min.x:b.max.x,d.x=h.normal.x>0?b.max.x:b.min.x,c.y=h.normal.y>0?b.min.y:b.max.y,d.y=h.normal.y>0?b.max.y:b.min.y,c.z=h.normal.z>0?b.min.z:b.max.z,d.z=h.normal.z>0?b.max.z:b.min.z;var i=h.distanceToPoint(c),j=h.distanceToPoint(d);if(i<0&&j<0)return Gj.OUTSIDE;i>0&&j>0&&f++}return 6==f?Gj.CONTAINS:Gj.INTERSECTS}}(),Object.defineProperty(Gj,"OUTSIDE",{value:0}),Object.defineProperty(Gj,"INTERSECTS",{value:1}),Object.defineProperty(Gj,"CONTAINS",{value:2}),Object.defineProperty(Gj,"CONTAINMENT_UNKNOWN",{value:-1});var Hj;A.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices},A.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var a=this.frags,c=this.getIndices();if(!c)return void b.warn("Only indexed RenderSubsets can be sorted.");var d=c.subarray(this.start,this.start+this.count);Array.prototype.sort.call(d,function(b,c){var d=a.getMaterialId(b),e=a.getMaterialId(c);return void 0===d?e?1:0:void 0===e?-1:d-e}),this.numAdded=0,this.sortDone=!0}},A.prototype.sortByShader=function(){if(this.sortDone&&!this.sortByShaderDone){var a=this.frags,b=this.getIndices(),c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(b,c){var d=a.getMaterial(b),e=a.getMaterial(c),f=d.program.id-e.program.id;return f||d.id-e.id}),this.numAdded=0,this.sortByShaderDone=!0}},A.prototype.sortByDepth=function(){function a(a,b){c.getGeometry(a)?(c.getWorldBounds(a,f),g[b]=e.estimateDepth(f)):g[b]=-1/0}var c,d,e,f,g;return function(h){if(c=this.frags,d=this.getIndices(),e=h,f=Hj,!d)return void b.warn("Only indexed RenderSubsets can be sorted.");(!this.indicesView||this.indicesView.length<this.count)&&(this.indicesView=d.subarray(this.start,this.start+this.count)),(!this.depths||this.depths.length<this.count)&&(this.depths=new Float32Array(this.count)),g=this.depths,this.forEachNoMesh(a);for(var i,j,k=1;k<g.length;k++)for(var l=k;l>0&&g[l-1]<g[l];)i=g[l-1],g[l-1]=g[l],g[l]=i,j=this.indicesView[l-1],this.indicesView[l-1]=this.indicesView[l],this.indicesView[l]=j,l--}}(),A.prototype.onFragmentAdded=function(){return function(a){this.frags.getWorldBounds(a,Hj),this.boundingBox.union(Hj),this.sortDone=!1,this.lastItem<=a&&(this.lastItem=a+1,void 0!==this.visibleStats&&(this.visibleStats=0),this.numAdded++)}}(),A.prototype.forEach=function(a,b,c){var d,e,f,g,d,f,e,g,h=this.getIndices(),i=this.frags,j=!this.sortByShaderDone;if(b||c||j)for(d=b==_i&&this.hasOwnProperty("drawStart")?this.drawStart:this.start,f=this.lastItem;d<f;d++){e=h?h[d]:d;var g=i.getVizmesh(e,this.renderImportance);!j||g&&g.material&&g.material.program&&!g.geometry_proxy||(j=!1),!(c||g&&g.geometry)||b&&!i.isFlagSet(e,b)||a(g,e)}else for(d=this.start,f=this.lastItem;d<f;d++){e=h?h[d]:d;var g=i.getVizmesh(e,this.renderImportance);g&&g.geometry&&a(g,e)}j&&this.sortByShader()},A.prototype.forEachNoMesh=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=this.start,g=this.lastItem;f<g;f++){var h,i=d?d[f]:f;if(e.useThreeMesh){var j=e.getVizmesh(i);j&&(h=j.geometry)}else h=e.getGeometry(i);!c&&!h||b&&!e.isFlagSet(i,b)||a(i,f-this.start)}},A.prototype.raycast=function(){return function(a,b,c){if(!1!==a.ray.isIntersectionBox(this.boundingBox)){var d=this,e=Hj;this.forEach(function(f,g){if(!d.frags.isFlagSet(g,Xi)){if(c&&c.length){var h=0|d.frags.getDbIds(g);if(-1===c.indexOf(h))return}d.frags.getWorldBounds(g,e),e.expandByScalar(.5),a.ray.isIntersectionBox(e)&&Ej.rayCast(f,a,b)}},Vi)}}}(),A.prototype.calculateBounds=function(){function a(a){e.getWorldBounds(a,f),1&b[a]?c.union(f):d.union(f)}var b,c,d,e,f;return function(){this.boundingBox.makeEmpty(),this.boundingBoxHidden.makeEmpty(),b=this.frags.vizflags,c=this.boundingBox,d=this.boundingBoxHidden,e=this.frags,f=Hj,this.forEachNoMesh(a,0,this.frags.onDemandLoadingEnabled())}}(),A.prototype.evalVisbility=function(a,b,c){var d,e=b[c]&~_i;switch(a){case 2:d=!(e&Vi);break;case 1:d=e&Wi;break;default:d=1==(e&(Vi|Wi|Xi))}return b[c]=e|(d?_i:0),d},A.prototype.applyVisibility=function(){function a(a,c){if(!a&&d.useThreeMesh||!a.geometry)return void(h&&h(c));if(B(i,f,d,c))return a?a.visible=!1:b.warn("Unexpected null mesh"),void(e[c]=e[c]&~_i);var k=this.evalVisbility(g,e,c);a&&(a.visible=!!k),j=j&&!k}function c(a){if(!d.getGeometryId(a))return void(h&&h(a));if(B(i,f,d,a))return void(e[a]=e[a]&~_i);var b=this.evalVisbility(g,e,a);j=j&&!b}var d,e,f,g,h,i,j;return function(b,k,l){j=!0,f=k,g=b,h=l;var m=f.intersectsBox(2===g?this.boundingBoxHidden:this.boundingBox);return m===Gj.OUTSIDE?j:(e=this.frags.vizflags,d=this.frags,i=m!==Gj.CONTAINS,l||d.useThreeMesh?this.forEach(a.bind(this),null,h):this.forEachNoMesh(c.bind(this),null),j)}}();var Ij,Jj,Kj,Lj={},Mj={},Nj=1,Oj={meshToGeometry:G,createBufferGeometry:F},Pj=1,Qj=function(a,b,c,d,e,f,g){for(var h=a.posOffset,i=d;i<e;i++){var j=i*a.vbstride+h;g.set(a.vb[j],a.vb[j+1],a.vb[j+2]),g.applyMatrix4(c),a.vb[j]=g.x,a.vb[j+1]=g.y,a.vb[j+2]=g.z}if(-1!==a.normalOffset){var k=2*a.vbstride,l=2*a.normalOffset,m=M(c,f);for(i=d;i<e;i++){var n=i*k+l;g.set(b[n],b[n+1],0),g.divideScalar(65535),K(g),g.applyMatrix4(m),g.normalize(),J(g),g.multiplyScalar(65535),b[n]=g.x,b[n+1]=g.y}}};I.prototype.run=function(a,b){for(var c=this.vb,d=c.length/this.vbstride,e=a.clone(),f=new Uint8Array(3*d),g=-1!==this.normalOffset,h=g?new Uint16Array(c.buffer,c.byteOffset,2*c.length):null,i=this.ranges,j=this.matrices,k=i.length-1,l=0;l<k;l++){var m=i[l],n=i[l+1];N(l,j,a),Qj(this,h,a,m,n,e,b);for(var o=3*m,p=n-m,q=this.dbIds[l],r=0;r<p;r++)L(q,f,o),o+=3}return{taskId:this.id,vb:this.vb,vertexIds:f}};var Rj=rj.getVertexCount,Sj=function a(b){function c(a){for(var b=a.data,c=0;c<b.length;c++){var f=b[c],i=f.taskId;Q(f,e[i]),delete e[i]}if(0===--d)for(g.inProgress=!1,c=0;c<h.length;c++)h[c].clearAllEventListenerWithIntercept(),h[c].terminate(),h[c]=null}var d=0,e={},f=[],g=b,h=new Array(2);this.addMergeTask=function(a,b,c,d){var g=P(a,b,c,d);f.push(g),e[g.id]=b},this.runTasks=function(){for(var b=0;b<2;b++)h[b]=a.createWorker(),h[b].addEventListenerWithIntercept(c);for(var e=f.length,i=Math.floor(e/2),j=0;j<2;j++){var k=1===j,l=j*i,m=k?e:l+i,n=m-l,o=[],p=new Array(4*n),q=0;for(b=l;b<m;b++){var r=f[b];p[q++]=r.vb.buffer,p[q++]=r.matrices.buffer,p[q++]=r.ranges.buffer,p[q++]=r.dbIds.buffer,o.push(r)}var s={operation:"MERGE_GEOMETRY",tasks:o};h[j].doOperation(s,p),d++}g.inProgress=!0}},Tj={ParallelGeomMerge:Sj,runMergeSingleThreaded:R},Uj=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],Vj=function(){for(var a=Uj.length,c=0,d=0;d<a;d++){var e=Uj[d];e.def.length>c&&(c=e.def.length)}for(var f=c+3,g=a,h=1;h<f;)h*=2;for(f=h,h=1;h<g;)h*=2;g=h;for(var i=new Uint8Array(f*g),j=0;j<a;j++){for(var k=j*f,e=Uj[j],l=e.unit&&"mm"==e.unit?1/25.4:1,m=e.pen_width||0,n=e.def,o=0,d=0;d<n.length;d++){var p=Math.abs(n[d]);p<=.5*m&&(p=0);var q=0|96*p*l;o+=q,i[k+d+2]=q||1}i[k]=o%256,i[k+1]=o/256,i[k+n.length+2]=0}var r=new b.DataTexture(i,f,g,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.ClampToEdgeWrapping,b.ClampToEdgeWrapping,b.NearestFilter,b.NearestFilter,0);return r.generateMipmaps=!1,r.flipY=!1,r.needsUpdate=!0,r},Wj={LineStyleDefs:Uj,CreateLinePatternTexture:Vj},Xj={uniforms:b.UniformsUtils.merge([b.UniformsLib.common,b.UniformsLib.lights,b.UniformsLib.fog,hi.CutPlanesUniforms,hi.IdUniforms,hi.ThemingUniform,hi.ShadowMapUniforms,S("surface_albedo_map"),S("surface_roughness_map"),S("surface_cutout_map"),S("surface_anisotropy_map"),S("surface_rotation_map"),S("opaque_albedo_map"),S("opaque_f0_map"),S("opaque_luminance_modifier_map"),S("layered_bottom_f0_map"),S("layered_f0_map"),S("layered_diffuse_map"),S("layered_fraction_map"),S("layered_roughness_map"),S("layered_anisotropy_map"),S("layered_rotation_map"),S("metal_f0_map"),S("wood_curly_distortion_map"),T("surface_normal_map"),T("layered_normal_map"),{surface_albedo:{type:"c",value:new b.Color(1118481)},surface_roughness:{type:"f",value:1},surface_anisotropy:{type:"f",value:1},surface_rotation:{type:"f",value:1},opaque_albedo:{type:"c",value:new b.Color(1118481)},opaque_f0:{type:"f",value:1},opaque_luminance_modifier:{type:"c",value:new b.Color(1118481)},opaque_luminance:{type:"f",value:1},metal_f0:{type:"c",value:new b.Color(1118481)},layered_f0:{type:"f",value:1},layered_diffuse:{type:"c",value:new b.Color(0)},layered_fraction:{type:"f",value:1},layered_bottom_f0:{type:"c",value:new b.Color(1118481)},layered_roughness:{type:"f",value:1},layered_anisotropy:{type:"f",value:1},layered_rotation:{type:"f",value:1},transparent_ior:{type:"f",value:2},transparent_color:{type:"c",value:new b.Color(1118481)},transparent_distance:{type:"f",value:1},wood_fiber_cosine_enable:{type:"i",value:1},wood_fiber_cosine_bands:{type:"i",value:2},wood_fiber_cosine_weights:{type:"v4",value:new b.Vector4(2.5,.5,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new b.Vector4(15,4,1,1)},wood_fiber_perlin_enable:{type:"i",value:1},wood_fiber_perlin_bands:{type:"i",value:3},wood_fiber_perlin_weights:{type:"v4",value:new b.Vector4(3,1,.2,1)},wood_fiber_perlin_frequencies:{type:"v4",value:new b.Vector4(40,20,3.5,1)},wood_fiber_perlin_scale_z:{type:"f",value:.3},wood_growth_perlin_enable:{type:"i",value:1},wood_growth_perlin_bands:{type:"i",value:3},wood_growth_perlin_weights:{type:"v4",value:new b.Vector4(1,2,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new b.Vector4(1,5,13,1)},wood_latewood_ratio:{type:"f",value:.238},wood_earlywood_sharpness:{type:"f",value:.395},wood_latewood_sharpness:{type:"f",value:.109},wood_ring_thickness:{type:"f",value:.75},wood_earlycolor_perlin_enable:{type:"i",value:1},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new b.Vector4(.3,.5,.15,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new b.Vector4(8,3,.35,1)},wood_early_color:{type:"c",value:new b.Color(.286,.157,.076)},wood_use_manual_late_color:{type:"i",value:0},wood_manual_late_color:{type:"c",value:new b.Color(.62,.35,.127)},wood_latecolor_perlin_enable:{type:"i",value:1},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new b.Vector4(.75,.55,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new b.Vector4(4.5,.05,1,1)},wood_late_color_power:{type:"f",value:1.25},wood_diffuse_perlin_enable:{type:"i",value:1},wood_diffuse_perlin_bands:{type:"i",value:3},wood_diffuse_perlin_weights:{type:"v4",value:new b.Vector4(.15,.2,.05,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new b.Vector4(.05,.1,3,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:1},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:1},wood_ray_color_power:{type:"f",value:1.1},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:1},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:1},wood_groove_roughness:{type:"f",value:.85},wood_diffuse_lobe_weight:{type:"f",value:.9},wood_curly_distortion_enable:{type:"i",value:0},wood_curly_distortion_scale:{type:"f",value:.25},wood_ring_fraction:{type:"v4",value:new b.Vector4(0,0,0,0)},wood_fall_rise:{type:"v2",value:new b.Vector2(0,0)},permutationMap:{type:"t",value:null},gradientMap:{type:"t",value:null},perm2DMap:{type:"t",value:null},permGradMap:{type:"t",value:null},importantSamplingRandomMap:{type:"t",value:null},importantSamplingSolidAngleMap:{type:"t",value:null},irradianceMap:{type:"t",value:null},envMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},envExponentMin:{type:"f",value:1},envExponentMax:{type:"f",value:512},envExponentCount:{type:"f",value:10}}]),vertexShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#if defined(PRISMWOODBUMP)\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#prism_check<USE_MAP>\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif\n#include<pack_normals>\n#include<instancing_decl_vert>\n#include<id_decl_vert>\n#include<shadowmap_decl_vert>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nvoid ComputeTangents(vec3 normal, out vec3 u, out vec3 v)\n{\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e    = temp.z;\n    float h    = 1.0/(1.0 + e);\n    float hvx  = h   *  temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);\n    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\n#endif\nvoid main() {\n#ifdef USE_MAP\n    vUv = uv;\n#endif\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = getInstanceNormal(objectNormal);\n    vec3 instPos = getInstancePos(position);\n#if defined(PRISMWOOD) && !defined(NO_UVW)\n#if defined(PRISMWOODBUMP)\n    vUvw = instPos;\n    vtNormal = normalize(objectNormal);\n    mNormalMatrix = normalMatrix;\n#else\n    vUvw = uvw;\n#endif\n#endif\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    vViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( instPos, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\n    vec3 Tu, Tv;\n#if defined(PRISMWOODBUMP)\n    ComputeTangents(vtNormal, Tu, Tv);\n#else\n    ComputeTangents(vNormal, Tu, Tv);\n#endif\n    vTangent = Tu;\n    vBitangent = Tv;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    if (projectionMatrix[3][3] == 0.0) {\n        gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n#else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n    } else {\n#ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n    }\n#endif\n#ifdef MRT_NORMALS\n    depth = mvPosition.z;\n#endif\n#include<id_vert>\n#include<shadowmap_vert>\n}\n",
fragmentShader:"\n#include<common>\n#define RECIPROCAL_PI 0.318309886\n#define ONE 0.00390625\nuniform float opacity;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform sampler2D importantSamplingRandomMap;\nuniform sampler2D importantSamplingSolidAngleMap;\n#if defined( PRISMOPAQUE )\nuniform vec3 opaque_albedo;\nuniform float opaque_f0;\nuniform vec3 opaque_luminance_modifier;\nuniform float opaque_luminance;\n#elif defined( PRISMMETAL )\nuniform vec3 metal_f0;\n#elif defined( PRISMLAYERED )\nuniform float layered_f0;\nuniform vec3 layered_diffuse;\nuniform float layered_fraction;\nuniform vec3 layered_bottom_f0;\nuniform float layered_roughness;\nuniform float layered_anisotropy;\nuniform float layered_rotation;\n#elif defined( PRISMTRANSPARENT )\nuniform float transparent_ior;\nuniform vec3 transparent_color;\nuniform float transparent_distance;\n#elif defined( PRISMWOOD )\nuniform bool wood_fiber_cosine_enable;\nuniform int wood_fiber_cosine_bands;\nuniform vec4 wood_fiber_cosine_weights;\nuniform vec4 wood_fiber_cosine_frequencies;\nuniform bool wood_fiber_perlin_enable;\nuniform int wood_fiber_perlin_bands;\nuniform vec4 wood_fiber_perlin_weights;\nuniform vec4 wood_fiber_perlin_frequencies;\nuniform float wood_fiber_perlin_scale_z;\nuniform bool wood_growth_perlin_enable;\nuniform int wood_growth_perlin_bands;\nuniform vec4 wood_growth_perlin_weights;\nuniform vec4 wood_growth_perlin_frequencies;\nuniform float wood_latewood_ratio;\nuniform float wood_earlywood_sharpness;\nuniform float wood_latewood_sharpness;\nuniform float wood_ring_thickness;\nuniform bool wood_earlycolor_perlin_enable;\nuniform int wood_earlycolor_perlin_bands;\nuniform vec4 wood_earlycolor_perlin_weights;\nuniform vec4 wood_earlycolor_perlin_frequencies;\nuniform vec3 wood_early_color;\nuniform bool wood_use_manual_late_color;\nuniform vec3 wood_manual_late_color;\nuniform bool wood_latecolor_perlin_enable;\nuniform int wood_latecolor_perlin_bands;\nuniform vec4 wood_latecolor_perlin_weights;\nuniform vec4 wood_latecolor_perlin_frequencies;\nuniform float wood_late_color_power;\nuniform bool wood_diffuse_perlin_enable;\nuniform int wood_diffuse_perlin_bands;\nuniform vec4 wood_diffuse_perlin_weights;\nuniform vec4 wood_diffuse_perlin_frequencies;\nuniform float wood_diffuse_perlin_scale_z;\nuniform bool wood_use_pores;\nuniform int wood_pore_type;\nuniform float wood_pore_radius;\nuniform float wood_pore_cell_dim;\nuniform float wood_pore_color_power;\nuniform float wood_pore_depth;\nuniform bool wood_use_rays;\nuniform float wood_ray_color_power;\nuniform float wood_ray_seg_length_z;\nuniform float wood_ray_num_slices;\nuniform float wood_ray_ellipse_z2x;\nuniform float wood_ray_ellipse_radius_x;\nuniform bool wood_use_latewood_bump;\nuniform float wood_latewood_bump_depth;\nuniform bool wood_use_groove_roughness;\nuniform float wood_groove_roughness;\nuniform float wood_diffuse_lobe_weight;\nuniform sampler2D permutationMap;\nuniform sampler2D gradientMap;\nuniform sampler2D perm2DMap;\nuniform sampler2D permGradMap;\nuniform vec4 wood_ring_fraction;\nuniform vec2 wood_fall_rise;\n#endif\nuniform float envExponentMin;\nuniform float envExponentMax;\nuniform float envExponentCount;\n#include<env_sample>\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\n#include<tonemap>\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\n#include<id_decl_frag>\n#include<theming_decl_frag>\n#include<shadowmap_decl_frag>\n#ifdef USE_FOG\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#prism_check<USE_MAP>\n#ifdef USE_MAP\nvarying vec2 vUv;\n#endif\n#if defined(PRISMWOOD) && !defined(NO_UVW)\nvarying vec3 vUvw;\n#endif\n#prism_uniforms<surface_albedo_map>\n#prism_uniforms<surface_roughness_map>\n#prism_uniforms<surface_cutout_map>\n#prism_uniforms<surface_anisotropy_map>\n#prism_uniforms<surface_rotation_map>\n#prism_uniforms<opaque_albedo_map>\n#prism_uniforms<opaque_f0_map>\n#prism_uniforms<opaque_luminance_modifier_map>\n#prism_uniforms<layered_bottom_f0_map>\n#prism_uniforms<layered_f0_map>\n#prism_uniforms<layered_diffuse_map>\n#prism_uniforms<layered_fraction_map>\n#prism_uniforms<layered_roughness_map>\n#prism_uniforms<layered_anisotropy_map>\n#prism_uniforms<layered_rotation_map>\n#prism_uniforms<metal_f0_map>\n#prism_uniforms<wood_curly_distortion_map>\n#if defined( USE_WOOD_CURLY_DISTORTION_MAP )\nuniform bool wood_curly_distortion_enable;\nuniform float wood_curly_distortion_scale;\n#endif\n#prism_bump_uniforms<surface_normal_map>\n#prism_bump_uniforms<layered_normal_map>\nfloat SRGBToLinearComponent(float color) {\n    float result = color;\n    if (result<=0.04045)\n        result *= 0.07739938;\n    else\n        result = pow(abs((result+0.055)*0.947867298), 2.4);\n    return result;\n}\nvec3 SRGBToLinear(vec3 color) {\n    vec3 result = color;\n    result.x = SRGBToLinearComponent(result.x);\n    result.y = SRGBToLinearComponent(result.y);\n    result.z = SRGBToLinearComponent(result.z);\n    return result;\n}\n#if defined( USE_ENVMAP )\nuniform float envMapExposure;\nuniform samplerCube envMap;\n#endif\n#include<normal_map>\n#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0) || defined ( PRISMWOODBUMP )\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#if defined( PRISMWOODBUMP )\nvarying vec3 vtNormal;\nvarying mat3 mNormalMatrix;\n#endif\n#endif\n#if defined( USE_ENVMAP )\nvec3 sampleReflection(vec3 N, vec3 V, float mipIndex) {\n    vec3 dir = (2.0 * dot(V, N)) * N - V;\n    dir = adjustLookupVector(mat3(viewMatrixInverse) * dir);\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\n    vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\n    vec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\n    return RGBMDecode(envTexColor, envMapExposure);\n#else\n    vec4 envTexColor = textureCube( envMap, dir );\n    vec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\n    cubeColor *= cubeColor;\n#endif\n    return cubeColor;\n#endif\n}\n#endif\n#include<hatch_pattern>\n#if defined( USE_ENVMAP ) && defined( USE_IRRADIANCEMAP )\nuniform samplerCube irradianceMap;\nvec3 sampleNormal(vec3 normal) {\n    vec3 worldNormal = mat3(viewMatrixInverse) * normal;\n    vec3 irradiance = sampleIrradianceMap(worldNormal, irradianceMap, envMapExposure);\n    irradiance = applyEnvShadow(irradiance, worldNormal);\n    return irradiance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\nfloat sqr(float x) {return x*x;}\nfloat aSqrd(float maxAlphaSqr, float cosTheta)\n{\n    if (abs(cosTheta) < 1e-10)\n    {\n        return 1e10;\n    }\n    float tan2 = 1.0/sqr(cosTheta) - 1.0;\n    return maxAlphaSqr * tan2;\n}\nvec3 Fresnel_Schlick(vec3 f0, float cosAngle)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    return f0 + (1.0 - f0) * x5;\n}\nvec3 Fresnel_Rough(vec3 f0, float cosAngle, float alpha)\n{\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);\n    return f0 + (maxReflectance - f0) * x5;\n}\nfloat IORToReflectance(float ior)\n{\n    return sqr((1.0 - ior)/(1.0 + ior));\n}\nvec2 RoughnessToAlpha(float roughness, float anisotropy)\n{\n    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n    alpha = alpha * alpha;\n    alpha = clamp(alpha, 0.001, 1.0);\n    return alpha;\n}\nfloat AlphaToPhong(float alpha)\n{\n    return max(0.0, 2.56/alpha - 7.0);\n}\nfloat ExponentToReflMipIndex(float exponent)\n{\n    float targetLog = log2(exponent);\n    float minLog = log2(envExponentMin);\n    float maxLog = log2(envExponentMax);\n    float deltaLog = clamp(targetLog - minLog, 0.0, maxLog - minLog);\n    float level = clamp((1.0-(deltaLog + 0.5) / envExponentCount), 0.0, 1.0) * 6.0;\n    return level;\n}\n#include<prism_wood>\n#if defined( ENABLEIMPORTANTSAMPLING ) && (defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ))\n#define IMPORTANTSAMPLING\n#endif\n#if defined( IMPORTANTSAMPLING )\n#define SAMPLECOUNT 32\nvec2 Hammersley(int index)\n{\n    float u = (float(index) + 0.5) / 32.0;\n    float v = 0.5;\n    float noise = texture2D(importantSamplingRandomMap, vec2(u, v), 0.0).r;\n   return vec2(2.0 * PI * float(index/SAMPLECOUNT), noise);\n}\nvec3 ImportanceSampleAnisotropicGGX(int index, vec2 alpha, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec2 uniformSample2D = Hammersley(index);\n    float coef = sqrt(uniformSample2D.y / (1.0 - uniformSample2D.y));\n    float sinSigma, cosSigma;\n    sinSigma = sin(uniformSample2D.x);\n    cosSigma = cos(uniformSample2D.x);\n    vec3 H = coef * ((alpha.x * cosSigma) * Tu + (alpha.y * sinSigma) * Tv) + N;\n    H = normalize(H);\n    return H;\n}\nfloat ComputePDF(vec2 alpha, float NdotH, float HdotTu, float HdotTv, float VdotH)\n{\n    float factor1 = HdotTu / alpha.x;\n    float factor2 = HdotTv / alpha.y;\n    float factor3 = factor1 * factor1 + factor2 * factor2 + NdotH * NdotH;\n    float factor = factor3 * factor3 * alpha.x * alpha.y * VdotH * 4.0 * PI;\n    if (factor > 0.0)\n    {\n        return (NdotH / factor);\n    }\n    else\n    {\n        return 0.0;\n    }\n}\n#define INVFACESIZE 0.0078125\nfloat DirectionToSolidAngle(vec3 dir)\n{\n    dir = abs(dir);\n    float first = min(dir.x, dir.y);\n    float temp = max(dir.x, dir.y);\n    float second = min(temp, dir.z);\n    float third = max(temp, dir.z);\n    first /= third;\n    second /= third;\n    float u = (first+1.0)/2.0;\n    float v = (second + 1.0) / 2.0;\n    float solidAngle = texture2D(importantSamplingSolidAngleMap, vec2(u, v), 0.0).r * 0.000255;\n    return solidAngle;\n}\nfloat Smith_GGX(float value)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + value));\n}\nvec2 RoughnessAnisotropyToAlpha(float roughness, float anisotropy)\n{\n    float aspect = sqrt(1.0 - 0.9 * anisotropy);\n    vec2 alpha = vec2(roughness * roughness / aspect, roughness * roughness * aspect);\n    return alpha;\n}\nvec3 ImportanceSamplingSpecular(float angle, vec3 reflectance, float roughness, float anisotropy, vec3 V, vec3 N, vec3 Tu, vec3 Tv)\n{\n    vec3 specular = vec3(0.0);\n    float radAngle;\n    if (anisotropy < 1e-10)\n    {\n        radAngle = 0.0;\n    }\n    else\n    {\n        radAngle = -PI * angle;\n    }\n    vec2 alpha = RoughnessAnisotropyToAlpha(roughness, anisotropy);\n    float alpha2 = max(alpha.x * alpha.x, alpha.y * alpha.y);\n    float NdotV = dot(N, V);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    vec2 sincosTheta;\n    sincosTheta.x = sin(radAngle);\n    sincosTheta.y = cos(radAngle);\n    vec3 Tu1, Tv1;\n    Tu1 = sincosTheta.y * Tu - sincosTheta.x * Tv;\n    Tv1 = sincosTheta.x * Tu + sincosTheta.y * Tv;\n    vec3 H;\n    vec3 sampleLightIntensity;\n    vec3 L;\n    float effectiveSample = 0.0;\n    for (int i = 0; i < SAMPLECOUNT; i++)\n    {\n        H = ImportanceSampleAnisotropicGGX(i, alpha, N, Tu1, Tv1);\n        float VdotH = dot(V, H);\n        L = 2.0 * VdotH * H - V;\n        float NdotH = dot(N, H);\n        float NdotL = dot(N, L);\n        if (NdotL >= 0.0 && NdotV > 0.0 && NdotH > 0.0)\n        {\n            float alpha2NL = aSqrd(alpha2, NdotL);\n            float HdotTu = dot(H, Tu1);\n            float HdotTv = dot(H, Tv1);\n            float pdf = ComputePDF(alpha, NdotH, HdotTu, HdotTv, VdotH);\n            float mipmapLevel = 0.0;\n            if (pdf > 0.0)\n            {\n                mipmapLevel = 0.3 * log2(1.0 / (float(SAMPLECOUNT) * pdf * DirectionToSolidAngle(L)));\n            }\n            mipmapLevel = clamp(mipmapLevel, 0.0, 4.0);\n            L = normalize(L);\n            sampleLightIntensity = sampleReflection(L, L, mipmapLevel).rgb;\n            float G = Smith_GGX(alpha2NL) * Smith_GGX(alpha2NV);\n            vec3 F = Fresnel_Schlick(reflectance, VdotH);\n            float factor = G * VdotH / (NdotH * NdotV);\n            if (factor >= 0.0)\n            {\n                specular += abs(sampleLightIntensity * F * factor);\n                effectiveSample += 1.0;\n            }\n        }\n    }\n    if (effectiveSample > 0.0)\n    {\n        specular /= effectiveSample;\n    }\n    return specular;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\nvec3 DiffuseLobe(vec3 diffuseColor)\n{\n    return diffuseColor * RECIPROCAL_PI;\n}\nvec3 Rotate(vec3 vec, float angle)\n{\n    float s = sin(angle);\n    float c = cos(angle);\n    return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\nfloat NDF_GGX(float alphaU, float alphaV, vec3 normal)\n{\n    float nx2 = sqr(normal.x);\n    float ny2 = sqr(normal.y);\n    float nz2 = sqr(normal.z);\n    float scale = 1.0/(alphaU * alphaV * PI);\n    return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);\n}\nfloat G1_GGX(float aSqrd)\n{\n    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\nvec3 MicrofacetLobe(\n        vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        float roughness, float anisotropy, float rotation, vec3 reflectance)\n{\n    vec2 alpha = RoughnessToAlpha(roughness, anisotropy);\n    Hlocal = Rotate(Hlocal, rotation);\n    vec3 F = Fresnel_Schlick(reflectance, VdotH);\n    float D = NDF_GGX(alpha.x, alpha.y, Hlocal);\n    float alpha2 = max(sqr(alpha.x), sqr(alpha.y));\n    float alpha2NL = aSqrd(alpha2, NdotL);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);\n    return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));\n}\n#if defined( PRISMOPAQUE )\nvec3 BRDF_Opaque(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float opaqueF0, vec3 opaqueAlbedo)\n{\n    vec3 diffuse = DiffuseLobe(opaqueAlbedo);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, vec3(opaqueF0));\n    return (specular+diffuse)*NdotL;\n}\n#elif defined( PRISMMETAL )\nvec3 BRDF_Metal(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        vec3 metalF0)\n{\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0);\n    return specular*NdotL;\n}\n#elif defined( PRISMLAYERED )\nvec3 BRDF_Layered(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 Hlocal2, float N2dotL, float N2dotH, float N2dotV,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,\n        float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,\n        float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 Fl = Fresnel_Schlick(vec3(layeredF0), NdotL);\n    vec3 Fv = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    vec3 amount = (1.0 - Fl) * (1.0 - Fv);\n    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n            vec3(layeredF0));\n    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);\n    vec3 botSpecular = MicrofacetLobe(\n            Hlocal2, N2dotL, N2dotH, N2dotV, VdotH,\n            layeredRoughness, layeredAnisotropy, layeredRotation,\n            bottom_f0);\n    return topSpecular*NdotL + amount * mix(topDiffuse*NdotL, botSpecular*N2dotL, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 BRDF_Transparent(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, surfaceAnisotropy, surfaceRotation, reflectance);\n    return specular*NdotL;\n}\n#elif defined( PRISMWOOD )\nvec3 BRDF_Wood(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,\n        vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)\n{\n    vec3 diffuse = DiffuseLobe(woodDiffuse);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n            Hlocal, NdotL, NdotH, NdotV, VdotH,\n            surfaceRoughness, 0.0, 0.0, vec3(0.04));\n    return (specular+diffuse)*NdotL;\n}\n#endif\n#endif\n#if defined( USE_ENVMAP )\n#if defined( PRISMOPAQUE )\nvec3 Environment_Opaque(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float opaqueF0, vec3 opaqueAlbedo, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 T)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(opaqueF0), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(opaqueF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F* surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;\n    vec3 luminanceModifier;\n#prism_sample_texture<opaque_luminance_modifier, luminanceModifier, false, true>\n    vec3 emission = luminanceModifier * opaque_luminance;\n    return diffuse + specular + emission;\n}\n#elif defined( PRISMMETAL )\nvec3 Environment_Metal(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 metalF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, metalF0, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 F = Fresnel_Rough(metalF0, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n    return specular;\n}\n#elif defined( PRISMLAYERED )\nvec3 Environment_Layered(vec3 N, vec3 V, float NdotV, vec3 N2, float N2dotV, vec3 surfaceAlbedo, float surfaceRoughness,\n        float layeredF0, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv, vec3 layeredDiffuse, float layeredRoughness,\n        float layeredAnisotropy, float layeredRotation, vec3 bottom_f0, float layeredFraction)\n{\n    vec3 F = Fresnel_Schlick(vec3(layeredF0), NdotV);\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n#if defined( IMPORTANTSAMPLING )\n    vec3 topSpecular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(layeredF0), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 topSpecular = F * surfaceAlbedo * envSpecular;\n#endif\n    vec3 amount = (1.0 - F);\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 topDiffuse = layeredDiffuse * envIrradiance;\n#if defined( IMPORTANTSAMPLING )\n    vec3 botSpecular = ImportanceSamplingSpecular(layeredRotation, bottom_f0, layeredRoughness, layeredAnisotropy, V, N2, Tu, Tv);\n#else\n    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;\n    exponent = AlphaToPhong(alpha);\n    reflMipIndex = ExponentToReflMipIndex(exponent);\n    envSpecular = sampleReflection(N2, V, reflMipIndex);\n    F = Fresnel_Rough(bottom_f0, N2dotV, alpha);\n    vec3 botSpecular = F * envSpecular;\n#endif\n    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);\n}\n#elif defined( PRISMTRANSPARENT )\nvec3 Environment_Transparent(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    vec3 reflectance = vec3(IORToReflectance(transparent_ior));\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(reflectance, NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, reflectance, surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 color = F * surfaceRoughness * transparent_color * envIrradiance;\n    return specular + color;\n}\n#elif defined( PRISMWOOD )\nvec3 Environment_Wood(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse, float surfaceAnisotropy, float surfaceRotation, vec3 Tu, vec3 Tv)\n{\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = Fresnel_Rough(vec3(0.04), NdotV, alpha);\n#if defined( IMPORTANTSAMPLING )\n    vec3 specular = surfaceAlbedo * ImportanceSamplingSpecular(surfaceRotation, vec3(0.04), surfaceRoughness, surfaceAnisotropy, V, N, Tu, Tv);\n#else\n    float exponent = AlphaToPhong(alpha);\n    float reflMipIndex = ExponentToReflMipIndex(exponent);\n    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n#endif\n#if defined( USE_IRRADIANCEMAP )\n    vec3 envIrradiance = sampleNormal(N);\n#else\n    vec3 envIrradiance = vec3(1.0);\n#endif\n    vec3 diffuse = (1.0 - F) * woodDiffuse * envIrradiance;\n    return diffuse + specular;\n}\n#endif\n#endif\nvarying vec3 vNormal;\nvarying vec3 vViewPosition;\n#include<cutplanes>\n#include<prism_transparency>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n    vec3 N = normalize(vNormal);\n    vec3 Tu = vec3(0.0);\n    vec3 Tv = vec3(0.0);\n#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP ) || MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0 || defined( PRISMWOODBUMP ) || defined( IMPORTANTSAMPLING )\n#if !defined(USE_MAP) || defined( PRISMWOODBUMP )\n    Tu = normalize(vTangent);\n    Tv = normalize(vBitangent);\n#else\n    vec3 q0 = dFdx( -vViewPosition );\n    vec3 q1 = dFdy( -vViewPosition );\n    vec2 st0 = dFdx( vUv );\n    vec2 st1 = dFdy( vUv );\n    Tu = normalize(  q0 * st1.t - q1 * st0.t );\n    Tv = normalize( -q0 * st1.s + q1 * st0.s );\n#endif\n#endif\n    vec3 V;\n    if (projectionMatrix[3][3] == 0.0) {\n        V = normalize( vViewPosition );\n    } else {\n        V = vec3(0.0, 0.0, 1.0);\n    }\n    N = faceforward(N, -V, N);\n#if defined(PRISMLAYERED)\n    vec3 N2 = N;\n#endif\n#ifndef FLAT_SHADED\n    vec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\n    normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#else\n    vec3 fdx = dFdx( vViewPosition );\n    vec3 fdy = dFdy( vViewPosition );\n    vec3 normal = normalize( cross( fdx, fdy ) );\n#endif\n#if defined( USE_SURFACE_NORMAL_MAP )\n    if (surface_normal_map_bumpmapType == 0)\n        heightMapTransform(surface_normal_map, vUv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    else\n        normalMapTransform(surface_normal_map, vUv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n#endif\n#if defined( USE_LAYERED_NORMAL_MAP )\n    if (layered_normal_map_bumpmapType == 0)\n        heightMapTransform(layered_normal_map, vUv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n    else\n        normalMapTransform(layered_normal_map, vUv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);\n#endif\n#if defined( PRISMWOOD )\n#ifdef NO_UVW\n    vec3 p = vec3(0.0);\n#elif defined( USE_WOOD_CURLY_DISTORTION_MAP )\n    vec3 p = DistortCurly(vUvw);\n#else\n    vec3 p = vUvw;\n#endif\n#if !defined( NO_UVW ) && defined( PRISMWOODBUMP )\n    getFinalWoodContext(\n        N, V, Tu, Tv, p,\n        normal, vtNormal, vNormalMatrix\n    );\n#endif\n#endif\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n#if defined(PRISMLAYERED)\n    float N2dotV = clamp(dot(N2, V), EPSILON, 1.0);\n#endif\n    vec3 surfaceAlbedo;\n#prism_sample_texture<surface_albedo, surfaceAlbedo, false, true>\n    float surfaceRoughness;\n#prism_sample_texture<surface_roughness, surfaceRoughness, true, false>\n    float surfaceAnisotropy;\n#prism_sample_texture<surface_anisotropy, surfaceAnisotropy, true, false>\n    float surfaceRotation;\n#prism_sample_texture<surface_rotation, surfaceRotation, true, false>\n#if defined(PRISMOPAQUE)\n    float opaqueF0;\n#prism_sample_texture<opaque_f0, opaqueF0, true, false>\n    vec3 opaqueAlbedo;\n#prism_sample_texture<opaque_albedo, opaqueAlbedo, false, true>\n#elif defined(PRISMMETAL)\n    vec3 metalF0;\n#prism_sample_texture<metal_f0, metalF0, false, true>\n#elif defined(PRISMLAYERED)\n    float layeredF0;\n#prism_sample_texture<layered_f0, layeredF0, true, false>\n    vec3 layeredDiffuse;\n#prism_sample_texture<layered_diffuse, layeredDiffuse, false, true>\n    float layeredRoughness;\n#prism_sample_texture<layered_roughness, layeredRoughness, true, false>\n    float layeredAnisotropy;\n#prism_sample_texture<layered_anisotropy, layeredAnisotropy, true, false>\n    float layeredRotation;\n#prism_sample_texture<layered_rotation, layeredRotation, true, false>\n    vec3 bottom_f0;\n#prism_sample_texture<layered_bottom_f0, bottom_f0, false, true>\n    float layeredFraction;\n#prism_sample_texture<layered_fraction, layeredFraction, true, false>\n#elif defined(PRISMWOOD)\n    vec3 woodDiffuse = NoiseWood(p, surfaceRoughness);\n#endif\n    vec3 outRadianceLight = vec3(0.0);\n#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0\n    vec3 lightDirection[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n    vec3 lightColor[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];\n#if MAX_DIR_LIGHTS > 0\n    for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n        vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n        lightDirection[i] = normalize( lDirection.xyz );\n        lightColor[i] = SRGBToLinear(directionalLightColor[ i ]);\n    }\n#endif\n#if MAX_POINT_LIGHTS > 0\n    for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( pointLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n        lightColor[MAX_DIR_LIGHTS + i] = SRGBToLinear(pointLightColor[ i ]) * lDistance;\n    }\n#endif\n#if MAX_SPOT_LIGHTS > 0\n    for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n        vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n        vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n        lightDirection[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = normalize( lVector );\n        float lDistance = 1.0;\n        if ( spotLightDistance[ i ] > 0.0 )\n            lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n        float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n        if ( spotEffect > spotLightAngleCos[ i ] )\n            spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n        lightColor[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = SRGBToLinear(spotLightColor[ i ]) * lDistance * spotEffect;\n    }\n#endif\n    for( int i = 0; i < MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS; i ++ ) {\n        vec3 L = lightDirection[i];\n        float NdotL = max(EPSILON, dot(N, L));\n        vec3 H = normalize(L + V);\n        float NdotH = dot(N, H);\n        float VdotH = dot(V, H);\n        float Hu = dot(H, Tu);\n        float Hv = dot(H, Tv);\n        vec3 Hlocal = vec3(Hu, Hv, NdotH);\n#if defined(PRISMLAYERED)\n        float N2dotL = dot(N2, L);\n        float N2dotH = dot(N2, H);\n        vec3 Hlocal2 = vec3(Hu, Hv, N2dotH);\n#endif\n        vec3 brdf = lightColor[i] *\n#if defined(PRISMOPAQUE)\n            BRDF_Opaque(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                    surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                    opaqueF0, opaqueAlbedo);\n#elif defined(PRISMMETAL)\n        BRDF_Metal(Hlocal, NdotL, NdotH, NdotV, VdotH,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                metalF0);\n#elif defined(PRISMLAYERED)\n        BRDF_Layered(Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal2, N2dotL, N2dotH, N2dotV,\n                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,\n                layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n                layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n        BRDF_Transparent(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation);\n#elif defined(PRISMWOOD)\n        BRDF_Wood(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, woodDiffuse);\n#endif\n        outRadianceLight += max(vec3(0.0), brdf);\n    }\n#endif\n    vec3 outRadianceEnv = vec3(0.0);\n#if defined( USE_ENVMAP )\n    outRadianceEnv =\n#if defined(PRISMOPAQUE)\n        Environment_Opaque(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n                opaqueF0, opaqueAlbedo, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMMETAL)\n    Environment_Metal(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, metalF0, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMLAYERED)\n    Environment_Layered(N, V, clamp(NdotV, 0.0, 1.0), N2, clamp(N2dotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,\n            layeredF0, surfaceAnisotropy, surfaceRotation, Tu, Tv, layeredDiffuse, layeredRoughness, layeredAnisotropy,\n            layeredRotation, bottom_f0, layeredFraction);\n#elif defined(PRISMTRANSPARENT)\n    Environment_Transparent(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#elif defined(PRISMWOOD)\n    Environment_Wood(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, woodDiffuse, surfaceAnisotropy, surfaceRotation, Tu, Tv);\n#endif\n#endif\n    float surface_cutout = 1.0;\n#prism_sample_texture<surface_cutout, surface_cutout, true, false>\n#if defined( USE_SURFACE_CUTOUT_MAP )\n    if(surface_cutout < 0.01) discard;\n#endif\n    gl_FragColor = vec4( outRadianceLight + outRadianceEnv, opacity*surface_cutout );\n#if TONEMAP_OUTPUT == 1\n    gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);\n#elif TONEMAP_OUTPUT == 2\n    gl_FragColor.xyz = toneMapCanonFilmic_WithGamma(exposureBias * gl_FragColor.xyz);\n#endif\n#ifdef USE_FOG\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = smoothstep( fogNear, fogFar, depth );\n    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif\n#if defined(PRISMTRANSPARENT)\n    applyPrismTransparency(gl_FragColor, transparent_color, transparent_ior);\n    gl_FragColor.a *= surface_cutout;\n#endif\n#include<theming_frag>\n#include<final_frag>\n}\n"
};b.ShaderLib.prism=Xj;var Yj=function(){var a=xi.createShaderMaterial(Xj);return a.defaultAttributeValues.uvw=[0,0,0],a.enable3DWoodBump=!1,a.enableImportantSampling=!1,a.mapList={},a.isPrismMaterial=!0,a},Zj=function(a){var c=Yj();switch(c.name=a.name,c.side=a.side,c.opacity=a.opacity,c.transparent=a.transparent,c.blending=a.blending,c.blendSrc=a.blendSrc,c.blendDst=a.blendDst,c.blendEquation=a.blendEquation,c.blendSrcAlpha=a.blendSrcAlpha,c.blendDstAlpha=a.blendDstAlpha,c.blendEquationAlpha=a.blendEquationAlpha,c.depthTest=a.depthTest,c.depthWrite=a.depthWrite,c.polygonOffset=a.polygonOffset,c.polygonOffsetFactor=a.polygonOffsetFactor,c.polygonOffsetUnits=a.polygonOffsetUnits,c.alphaTest=a.alphaTest,c.overdraw=a.overdraw,c.visible=a.visible,c.mapList=a.mapList,c.prismType=a.prismType,c.surface_albedo=a.surface_albedo,void 0!==a.surface_albedo_map&&(c.surface_albedo_map=a.surface_albedo_map),c.surface_roughness=a.surface_roughness,void 0!==a.surface_roughness_map&&(c.surface_roughness_map=a.surface_roughness_map),c.surface_anisotropy=a.surface_anisotropy,void 0!==a.surface_anisotropy_map&&(c.surface_anisotropy_map=a.surface_anisotropy_map),c.surface_rotation=a.surface_rotation,void 0!==a.surface_rotation_map&&(c.surface_rotation_map=a.surface_rotation_map),void 0!==a.surface_cutout_map&&(c.surface_cutout_map=a.surface_cutout_map),void 0!==a.surface_normal_map&&(c.surface_normal_map=a.surface_normal_map),c.uniforms.importantSamplingRandomMap.value=a.uniforms.importantSamplingRandomMap.value,c.uniforms.importantSamplingSolidAngleMap.value=a.uniforms.importantSamplingSolidAngleMap.value,c.prismType){case"PrismOpaque":c.opaque_albedo=(new b.Color).copy(a.opaque_albedo),c.opaque_luminance_modifier=(new b.Color).copy(a.opaque_luminance_modifier),c.opaque_f0=a.opaque_f0,c.opaque_luminance=a.opaque_luminance,void 0!==a.opaque_albedo_map&&(c.opaque_albedo_map=a.opaque_albedo_map),void 0!==a.opaque_luminance_modifier_map&&(c.opaque_luminance_modifier_map=a.opaque_luminance_modifier_map),void 0!==a.opaque_f0_map&&(c.opaque_f0_map=a.opaque_f0_map);break;case"PrismMetal":c.metal_f0=(new b.Color).copy(a.metal_f0),void 0!==a.metal_f0_map&&(c.metal_f0_map=a.metal_f0_map);break;case"PrismLayered":c.layered_f0=a.layered_f0,c.layered_diffuse=(new b.Color).copy(a.layered_diffuse),c.layered_fraction=a.layered_fraction,c.layered_bottom_f0=(new b.Color).copy(a.layered_bottom_f0),c.layered_roughness=a.layered_roughness,c.layered_anisotropy=a.layered_anisotropy,c.layered_rotation=a.layered_rotation,void 0!==a.layered_bottom_f0_map&&(c.layered_bottom_f0_map=a.layered_bottom_f0_map),void 0!==a.layered_f0_map&&(c.layered_f0_map=a.layered_f0_map),void 0!==a.layered_diffuse_map&&(c.layered_diffuse_map=a.layered_diffuse_map),void 0!==a.layered_fraction_map&&(c.layered_fraction_map=a.layered_fraction_map),void 0!==a.layered_rotationlayered_roughness_map&&(c.layered_rotationlayered_roughness_map=a.layered_rotationlayered_roughness_map),void 0!==a.layered_anisotropy_map&&(c.layered_anisotropy_map=a.layered_anisotropy_map),void 0!==a.layered_rotation_map&&(c.layered_rotation_map=a.layered_rotation_map),void 0!==a.layered_normal_map&&(c.layered_normal_map=a.layered_normal_map);break;case"PrismTransparent":c.transparent_color=(new b.Color).copy(a.transparent_color),c.transparent_distance=a.transparent_distance,c.transparent_ior=a.transparent_ior,c.transparent=a.transparent,c.twoPassTransparency=a.twoPassTransparency;break;case"PrismWood":c.wood_fiber_cosine_enable=a.wood_fiber_cosine_enable,c.wood_fiber_cosine_bands=a.wood_fiber_cosine_bands,c.wood_fiber_cosine_weights=(new b.Vector4).copy(a.wood_fiber_cosine_weights),c.wood_fiber_cosine_frequencies=(new b.Vector4).copy(a.wood_fiber_cosine_frequencies),c.wood_fiber_perlin_enable=a.wood_fiber_perlin_enable,c.wood_fiber_perlin_bands=a.wood_fiber_perlin_bands,c.wood_fiber_perlin_weights=(new b.Vector4).copy(a.wood_fiber_perlin_weights),c.wood_fiber_perlin_frequencies=(new b.Vector4).copy(a.wood_fiber_perlin_frequencies),c.wood_fiber_perlin_scale_z=a.wood_fiber_perlin_scale_z,c.wood_growth_perlin_enable=a.wood_growth_perlin_enable,c.wood_growth_perlin_bands=a.wood_growth_perlin_bands,c.wood_growth_perlin_weights=(new b.Vector4).copy(a.wood_growth_perlin_weights),c.wood_growth_perlin_frequencies=(new b.Vector4).copy(a.wood_growth_perlin_frequencies),c.wood_latewood_ratio=a.wood_latewood_ratio,c.wood_earlywood_sharpness=a.wood_earlywood_sharpness,c.wood_latewood_sharpness=a.wood_latewood_sharpness,c.wood_ring_thickness=a.wood_ring_thickness,c.wood_earlycolor_perlin_enable=a.wood_earlycolor_perlin_enable,c.wood_earlycolor_perlin_bands=a.wood_earlycolor_perlin_bands,c.wood_earlycolor_perlin_weights=(new b.Vector4).copy(a.wood_earlycolor_perlin_weights),c.wood_earlycolor_perlin_frequencies=(new b.Vector4).copy(a.wood_earlycolor_perlin_frequencies),c.wood_early_color=(new b.Color).copy(a.wood_early_color),c.wood_use_manual_late_color=a.wood_use_manual_late_color,c.wood_manual_late_color=(new b.Color).copy(a.wood_manual_late_color),c.wood_latecolor_perlin_enable=a.wood_latecolor_perlin_enable,c.wood_latecolor_perlin_bands=a.wood_latecolor_perlin_bands,c.wood_latecolor_perlin_weights=(new b.Vector4).copy(a.wood_latecolor_perlin_weights),c.wood_latecolor_perlin_frequencies=(new b.Vector4).copy(a.wood_latecolor_perlin_frequencies),c.wood_late_color_power=a.wood_late_color_power,c.wood_diffuse_perlin_enable=a.wood_diffuse_perlin_enable,c.wood_diffuse_perlin_bands=a.wood_diffuse_perlin_bands,c.wood_diffuse_perlin_weights=(new b.Vector4).copy(a.wood_diffuse_perlin_weights),c.wood_diffuse_perlin_frequencies=(new b.Vector4).copy(a.wood_diffuse_perlin_frequencies),c.wood_diffuse_perlin_scale_z=a.wood_diffuse_perlin_scale_z,c.wood_use_pores=a.wood_use_pores,c.wood_pore_type=a.wood_pore_type,c.wood_pore_radius=a.wood_pore_radius,c.wood_pore_cell_dim=a.wood_pore_cell_dim,c.wood_pore_color_power=a.wood_pore_color_power,c.wood_pore_depth=a.wood_pore_depth,c.wood_use_rays=a.wood_use_rays,c.wood_ray_color_power=a.wood_ray_color_power,c.wood_ray_seg_length_z=a.wood_ray_seg_length_z,c.wood_ray_num_slices=a.wood_ray_num_slices,c.wood_ray_ellipse_z2x=a.wood_ray_ellipse_z2x,c.wood_ray_ellipse_radius_x=a.wood_ray_ellipse_radius_x,c.wood_use_latewood_bump=a.wood_use_latewood_bump,c.wood_latewood_bump_depth=a.wood_latewood_bump_depth,c.wood_use_groove_roughness=a.wood_use_groove_roughness,c.wood_groove_roughness=a.wood_groove_roughness,c.wood_diffuse_lobe_weight=a.wood_diffuse_lobe_weight,c.uniforms.permutationMap.value=a.uniforms.permutationMap.value,c.uniforms.gradientMap.value=a.uniforms.gradientMap.value,c.uniforms.perm2DMap.value=a.uniforms.perm2DMap.value,c.uniforms.permGradMap.value=a.uniforms.permGradMap.value,void 0!==a.wood_curly_distortion_map&&(c.wood_curly_distortion_map=a.wood_curly_distortion_map,c.wood_curly_distortion_enable=a.wood_curly_distortion_enable,c.wood_curly_distortion_scale=a.wood_curly_distortion_scale),c.wood_ring_fraction=a.wood_ring_fraction,c.wood_fall_rise=a.wood_fall_rise;break;default:b.warn("Unknown prism type: "+a.prismType)}return c.envExponentMin=a.envExponentMin,c.envExponentMax=a.envExponentMax,c.envExponentCount=a.envExponentCount,c.envMap=a.envMap,c.defines=a.defines,c},$j={PrismShader:Xj,GetPrismMapUniforms:S,createPrismMaterial:Yj,clonePrismMaterial:Zj};!function(a){a[a.DEBUG=5]="DEBUG",a[a.LOG=4]="LOG",a[a.INFO=3]="INFO",a[a.WARNING=2]="WARNING",a[a.ERROR=1]="ERROR",a[a.NONE=0]="NONE"}(a.LogLevels||(a.LogLevels={})),a.logger={initialize:function(a){},shutdown:function(){},track:function(a){},logToADP:function(a){return!1},updateRuntimeStats:function(a){},reportRuntimeStats:function(){},setLevel:function(a){},error:function(){},warn:function(){},info:function(){},log:function(){},debug:function(){}};var _j,ak,bk={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,in:39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361},ck={convertMaterial:ia,convertTexture:la,isPrismMaterial:ma,convertMaterialGltf:na,applyAppearanceHeuristics:pa,applyGeometryFlagsToMaterial:qa},dk=Wj.CreateLinePatternTexture,ek=$j.clonePrismMaterial,fk=function(a){this._renderer=a,this._textures={},this._texturesToUpdate=[],this._materials={},this._materialsNonHDR={},this._exposureBias=0,this._tonemapMethod=0,this._envMapExposure=1,this._envRotationSin=0,this._envRotationCos=1,this._reflectionMap=null,this._irradianceMap=null,this._cutplanes=[],this._mrtNormals=!1,this._mrtIdBuffer=void 0,this._pixelsPerUnit=1,this._layerMaskTex=null,this._layersMap=null,this._lineStyleTex=null,this._selectionTex=null,this._swapBlackAndWhite=0,this._depthWriteTransparent=!0,this._needsTwoSided=!1,this._hasTransparentMaterial=!1,this.hasPrism=!1,this.defaultMaterial=new b.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:b.SmoothShading,reflectivity:0}),this.addMaterial("__defaultMaterial__",this.defaultMaterial)};fk.MATERIAL_VARIANT={INSTANCED:0,VERTEX_IDS:1},fk.prototype.dtor=function(){this.cleanup(),b.Cache.clear()},fk.prototype._getModelHash=function(a){return"model:"+(a?a.id:"")+"|"},fk.prototype._getMaterialHash=function(a,b){return this._getModelHash(a)+"mat:"+b},fk.prototype._getTextureHash=function(a,b,c){return this._getModelHash(a)+"tex:"+b+"|map:"+c},fk.prototype.addNonHDRMaterial=function(a,b){b.doNotCut||(b.cutplanes=this._cutplanes),this._materialsNonHDR[a]=b},fk.prototype.addMaterialNonHDR=function(a,b){this.addNonHDRMaterial.call(this,a,b)},fk.prototype.addHDRMaterial=function(a,b){this._reflectionMap&&!b.disableEnvMap&&(b.envMap=this._reflectionMap),this._irradianceMap&&(b.irradianceMap=this._irradianceMap),b.exposureBias=Math.pow(2,this._exposureBias),b.tonemapOutput=this._tonemapMethod,b.envMapExposure=this._envMapExposure,b.envRotationSin=this._envRotationSin,b.envRotationCos=this._envRotationCos,b.doNotCut||(b.cutplanes=this._cutplanes),this._applyMRTFlags(b),this._applyPolygonOffset(b,this._polygonOffsetOn),this._materials[a]=b},fk.prototype.addMaterial=function(a,c,d){var e=c.prismType&&-1!==c.prismType.indexOf("Prism");this.hasPrism=e||this.hasPrism,ck.applyAppearanceHeuristics(c,e||d,this.isDepthWriteTransparentEnabled()),c.side===b.DoubleSide&&(this._needsTwoSided=!0),this.addHDRMaterial(a,c)},fk.prototype.addObjectMaterial=function(a,c,d){a.getData().doubleSided&&(c.side=b.DoubleSide);var d=this._getMaterialHash(a,d);return this.addMaterial(d,c),this._hasTransparentMaterial=this._hasTransparentMaterial||c.transparent,d},fk.prototype.addLineMaterial=function(a,b){this._layerMaskTex&&(b.defines.HAS_LAYERS=1,b.uniforms.tLayerMask.value=this._layerMaskTex),this._lineStyleTex&&(b.defines.HAS_LINESTYLES=1,b.defines.MAX_LINESTYLE_LENGTH=this._lineStyleTex.image.width,b.uniforms.tLineStyle.value=this._lineStyleTex,b.uniforms.vLineStyleTexSize.value.set(this._lineStyleTex.image.width,this._lineStyleTex.image.height)),b.uniforms.aaRange.value=.5/(this._pixelsPerUnit*b.modelScale),b.uniforms.pixelsPerUnit.value=this._pixelsPerUnit*b.modelScale,b.uniforms.swap.value=this._swapBlackAndWhite,this._materials[a]=b},fk.prototype.addOverrideMaterial=function(a,b){if(this.addNonHDRMaterial(a,b),b.variants)for(var c=0;c<b.variants.length;c++){var d=b.variants[c];if(d){var e=a+"_variant_"+c;this.addNonHDRMaterial(e,d)}}},fk.prototype.getMaterialVariant=function(a,b,c){var d=this._getModelHash(c)+a.id+"|"+b,e=this._materials[d];return e||(e=this.cloneMaterial(a,c),b===fk.MATERIAL_VARIANT.INSTANCED?(e.useInstancing=!0,e.vertexIds=!0):b===fk.MATERIAL_VARIANT.VERTEX_IDS&&(e.vertexIds=!0),this.addHDRMaterial(d,e)),e},fk.prototype.addInstancingSupport=function(a){var b=a.clone();b.useInstancing=!0;var c=a.clone();c.wideLines=!0,a.variants=[b,c],a.getCustomOverrideMaterial=function(a){return a.useInstancing?this.variants[0]:a.wideLines?this.variants[1]:null}},fk.prototype.removeMaterial=function(a){delete this._materials[a]},fk.prototype.findMaterial=function(a,c){var d=this._getMaterialHash(a,c),e=this._materials[d];return e||(b.warn("Unknown material "+c+". Using default."),e=this.defaultMaterial),e},fk.prototype.lookupMaterial=function(a,b){var c=this._getMaterialHash(a,b);return this._materials[c]},fk.prototype.hasTransparentMaterial=function(){return this._hasTransparentMaterial},fk.prototype.convertOneMaterial=function(a,b,c){var d=ck.convertMaterial(b),e=this.addObjectMaterial(a,d,c);if(b.decals){d.decals=[];for(var f=0,g=b.decals.length;f<g;f++){var h=b.decals[f],i=ck.convertMaterial(h.material);d.decals.push({uv:h.uv||0,material:i}),this.addMaterial(e+"|decal|"+f,i)}}},fk.prototype.forEach=function(a){var b=this._materials;for(var c in b)a(b[c])},fk.prototype.updateMaterials=function(){for(var a={needsClear:!1,needsRender:!1,overlayDirty:!1};this._texturesToUpdate.length;){var b=this._texturesToUpdate.pop();for(var c in b.slots)for(var d=b.slots[c],e=0;e<d.length;e++)d[e][c]=b.tex,d[e].needsUpdate=!0,a.needsClear=!0}return a},fk.prototype.clearTextureFromMaterial=function(a,b,c,d){var e=this._getTextureHash(a,c.uri,c.mapName),f=this._textures[e];f&&sa(f,b,d)},fk.prototype.setTextureInCache=function(a,b,c,d){var e=this._getTextureHash(a,b.uri,b.mapName),f=this._textures[e];if(f){var g=f.urls.findIndex(function(a){return a.url==d});if(-1==g&&(f.urls.unshift({url:d}),g=0),!(g<=f.loaded)){f.tex=c,f.loaded=g;for(var h in f.slots)for(var i=f.slots[h],j=0;j<i.length;j++)i[j][h]=c;for(var k=0;k<=g;++k){var l=f.urls[k].callback;delete f.urls[k].callback,l&&l.forEach(function(a){a(c)})}this._texturesToUpdate.push(f)}}},fk.prototype.loadTextureFromCache=function(a,b,c,d,e,f){var g=this._getTextureHash(a,c.uri,c.mapName),h=this._textures[g];if(h){var i=0;if(e&&-1==(i=h.urls.findIndex(function(a){return a.url==e}))){var j={url:e};return f&&(j.callback=[f]),h.urls.push(j),!1}if(ra(h,b,d),h.tex&&(b[d]=h.tex,b.needsUpdate=!0),h.loaded>=i)f&&f(h.tex);else if(f&&h.urls.length>0){var k=h.urls[i],l=k.callback=k.callback||[];l.push(f)}}else{var m={};m[d]=[b];var n=this._textures[g]={slots:m,tex:null,loaded:-1,url:e,urls:[]};if(e){var o={url:e};n.urls.push(o),f&&(o.callback=[f])}}return!!h},fk.prototype.exportModelMaterials=function(a,b){var c=this._getModelHash(a),d={};for(var e in this._materials)if(-1!==e.indexOf(c)){var f=this._materials[e],g=f.defines&&f.defines.hasOwnProperty("SELECTION_RENDERER");g||(d[e]=f)}var h={};for(var e in this._materialsNonHDR)-1!==e.indexOf(c)&&(h[e]=this._materialsNonHDR[e]);var i={};for(var j in this._textures)-1!==j.indexOf(c)&&(i[j]=this._textures[j]);return this.cleanup(a),{mats:d,matsNonHDR:h,textures:i}},fk.prototype.importModelMaterials=function(a){for(var b in a.mats){var c=a.mats[b];c.is2d?this.addLineMaterial(b,c):this.addHDRMaterial(b,c)}for(var b in a.matsNonHDR)this.addMaterialNonHDR(b,a.matsNonHDR[b]);for(var d in a.textures)this._textures[d]=a.textures[d]},fk.prototype.cloneMaterial=function(c,d){var e=c.isPrismMaterial?ek(c):c.clone();if(c.defines&&(e.defines=Object.assign({},c.defines)),(e instanceof b.MeshPhongMaterial||e.isPrismMaterial)&&(e.packedNormals=c.packedNormals,e.exposureBias=c.exposureBias,e.irradianceMap=c.irradianceMap,e.envMapExposure=c.envMapExposure,e.envRotationSin=c.envRotationSin,e.envRotationCos=c.envRotationCos,e.proteinType=c.proteinType,e.proteinMat=c.proteinMat,e.proteinCategories=c.proteinCategories,e.tonemapOutput=c.tonemapOutput,e.cutplanes=c.cutplanes,e.textureMaps=c.textureMaps,e.texturesLoaded=c.texturesLoaded),c.is2d&&(e.is2d=!0),c.textureMaps)for(var f in c.textureMaps)if(c[f])e[f]=c[f];else if(d){var g=e.textureMaps[f],h=g.uri,i=g.mapName,j=this._getTextureHash(d,h,i),k=this._textures[j];k?ra(k,e,f):a.logger.error("Missing texture receiver",j)}else a.logger.error("Cannot connect pending texture maps because cloneMaterial was called without a model");return this._applyMRTFlags(e),e},fk.prototype.setupMaterial=function(a,c,d){var e,f=a.getData();if(c.isLines||c.isPoints){var g=!!c.attributes.color,h=this.findMaterial(a,d);c.isPoints?e=new b.PointCloudMaterial({vertexColors:g,size:c.pointSize}):c.isWideLines?(e=new b.MeshBasicMaterial({vertexColors:g}),e.wideLines=!0,c.isLines=!1,e.polygonOffset=h.polygonOffset,e.polygonOffsetFactor=h.polygonOffsetFactor,e.polygonOffsetUnits=h.polygonOffsetUnits):g?(h.cachedLineMaterialVC||(h.cachedLineMaterialVC=new b.LineBasicMaterial({vertexColors:g})),e=h.cachedLineMaterialVC):(h.cachedLineMaterial||(h.cachedLineMaterial=new b.LineBasicMaterial({vertexColors:g})),e=h.cachedLineMaterial),g||(e.color=h.color),e.svfMatId=d,this.addMaterialNonHDR(f.basePath+d+"_line_"+e.id,e),f.hasLines=!0}else e=this.findMaterial(a,d),e&&(e.svfMatId=d),ck.applyGeometryFlagsToMaterial(e,c);return e},fk.prototype.cleanup=function(a){var c=this._getModelHash(a),d={};for(var e in this._textures){var f=this._textures[e];-1===e.indexOf(c)?d[e]=f:f.tex&&(f.tex.dispose(),f.tex.needsUpdate=!0)}this._textures=d;var g={},h={type:"dispose"};for(var i in this._materials)if(a&&-1===i.indexOf(c))g[i]=this._materials[i];else{var j=this._materials[i];if(j.dispatchEvent(h),j.needsUpdate=!0,j.envMap=null,j.is2d){j.uniforms.tLayerMask.value=null,j.uniforms.tLineStyle.value=null;var k=j.uniforms.tRaster;k&&k.value instanceof b.Texture&&(k.value.dispose(),k.value.needsUpdate=!0)}}this._materials=g;var l={};for(var i in this._materialsNonHDR)if(a&&-1===i.indexOf(c))l[i]=this._materialsNonHDR[i];else{var j=this._materialsNonHDR[i];j.dispatchEvent(h),j.needsUpdate=!0}this._materialsNonHDR=l},fk.prototype.toggleDepthWriteTransparent=function(a){this._depthWriteTransparent!=a&&(this._depthWriteTransparent=a,this.forEach(function(b){b.lmv_depthWriteTransparent&&(b.depthWrite=a)}))},fk.prototype.isDepthWriteTransparentEnabled=function(){return this._depthWriteTransparent},fk.prototype.hasTwoSidedMaterials=function(){return this._needsTwoSided},fk.prototype.texturesLoaded=function(){return 0===this._texturesToUpdate.length},fk.prototype.setTonemapExposureBias=function(a){this._exposureBias=a;var b=Math.pow(2,a);this.forEach(function(a){a.exposureBias=b,a.needsUpdate=!0})},fk.prototype.setTonemapMethod=function(a){this._tonemapMethod=a,this.forEach(function(b){b.tonemapOutput=a,b.needsUpdate=!0})},fk.prototype.setEnvExposure=function(a){var b=Math.pow(2,a);this._envMapExposure=b,this.forEach(function(a){a.envMapExposure=b,a.needsUpdate=!0})},fk.prototype.setEnvRotation=function(a){var b=this._envRotationSin=Math.sin(a),c=this._envRotationCos=Math.cos(a);this.forEach(function(a){a.envRotationSin=b,a.envRotationCos=c,a.needsUpdate=!0})},fk.prototype.setReflectionMap=function(a){this._reflectionMap=a,this.forEach(function(b){b.disableEnvMap||(b.envMap=a,b.needsUpdate=!0)})},fk.prototype.setIrradianceMap=function(a){this._irradianceMap=a,this.forEach(function(b){b.disableEnvMap||(b.irradianceMap=a,b.needsUpdate=!0)})},fk.prototype.setCutPlanes=function(a){if(this._cutplanes.length!==(a?a.length||0:0)){this.forEach(function(c){c.doNotCut||(c.needsUpdate=!0,a&&a.length>0&&(c.side=b.DoubleSide))});for(var c in this._materialsNonHDR)this._materialsNonHDR[c].doNotCut||(this._materialsNonHDR[c].needsUpdate=!0)}for(;this._cutplanes.length>0;)this._cutplanes.pop();if(a)for(var d=0;d<a.length;d++)this._cutplanes.push(a[d].clone())},fk.prototype.getCutPlanes=function(){return this._cutplanes.slice()},fk.prototype.getCutPlanesRaw=function(){return this._cutplanes},fk.prototype._applyPolygonOffset=function(a){(a instanceof b.MeshPhongMaterial||a.isPrismMaterial)&&(a.polygonOffset=this._polygonOffsetOn,a.polygonOffsetFactor=this._polygonOffsetFactor,a.polygonOffsetUnits=this._polygonOffsetUnits,a.extraDepthOffset&&(a.polygonOffsetFactor+=a.extraDepthOffset),a.needsUpdate=!0)},fk.prototype.getPolygonOffsetOn=function(){return this._polygonOffsetOn},fk.prototype.getPolygonOffsetFactor=function(){return this._polygonOffsetFactor},fk.prototype.getPolygonOffsetUnits=function(){return this._polygonOffsetUnits},fk.prototype.togglePolygonOffset=function(a,b,c){this._polygonOffsetOn=a,this._polygonOffsetFactor=a?b||1:0,this._polygonOffsetUnits=a?c||.1:0;var d=this;this.forEach(function(a){d._applyPolygonOffset(a)})},fk.prototype._applyMRTFlags=function(a){var c=a.supportsMrtNormals||a instanceof b.MeshPhongMaterial||a.isPrismMaterial,d=a.mrtNormals,e=a.mrtIdBuffer,f=this._renderer&&this._renderer.supportsMRT();a.mrtNormals=c&&f&&this._mrtNormals,a.mrtIdBuffer=f?this._mrtIdBuffer:void 0,a.mrtNormals===d&&a.mrtIdBuffer===e||(a.needsUpdate=!0)},fk.prototype.toggleMRTSetting=function(a){this._mrtNormals=a.mrtNormals,this._mrtIdBuffer=a.mrtIdBuffer;var b=this;this.forEach(function(a){a.is2d||b._applyMRTFlags(a)})},fk.prototype.initLineStyleTexture=function(){this._lineStyleTex=dk()},fk.prototype.initLayersTexture=function(a,c){for(var d=this._layerMaskTex?this._layerMaskTex.image.data:new Uint8Array(65536),e=0,f=a;e<f;e++)d[e]=255;if(!this._layerMaskTex){var g=new b.DataTexture(d,256,256,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.ClampToEdgeWrapping,b.ClampToEdgeWrapping,b.NearestFilter,b.NearestFilter,0);g.generateMipmaps=!1,g.flipY=!1,this._layerMaskTex=g}this._layerMaskTex.needsUpdate=!0,this._layersMap=c},fk.prototype.setLayerVisible=function(a,b){for(var c=this._layerMaskTex,d=c.image.data,e=this._layersMap,f=b?255:0,g=0;g<a.length;++g){d[e[a[g]]]=f}c.needsUpdate=!0,this.forEach(function(a){a.is2d&&(a.needsUpdate=!0)})},fk.prototype.isLayerVisible=function(a){return!!this._layerMaskTex.image.data[this._layersMap[a]]},fk.prototype.initSelectionTexture=function(a){for(var c=a||1,d=0|Math.ceil(c/4096),e=1;e<d;)e*=2;d=e;for(var f=new Uint8Array(4096*d),g=0;g<c;g++)f[g]=0;var h=new b.DataTexture(f,4096,d,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.ClampToEdgeWrapping,b.ClampToEdgeWrapping,b.NearestFilter,b.NearestFilter,0);return h.generateMipmaps=!1,h.flipY=!1,h.needsUpdate=!0,this._selectionTex=h,h},fk.prototype.highlightObject2D=function(a,b){var c=this._selectionTex;if(c){c.image.data[a]=b?255:0,c.needsUpdate=!0}},fk.prototype.updatePixelScale=function(a){var b=this._pixelsPerUnit=a;this.forEach(function(a){a.is2d&&(a.uniforms.aaRange.value=.5/(b*a.modelScale),a.uniforms.pixelsPerUnit.value=b*a.modelScale)})},fk.prototype.updateSwapBlackAndWhite=function(a){var b=this._swapBlackAndWhite=a?1:0;this.forEach(function(a){a.is2d&&(a.uniforms.swap.value=b)})},fk.prototype.updateViewportId=function(a){this.forEach(function(b){b.is2d&&(b.uniforms.viewportId.value=a,b.needsUpdate=!0)})};var gk=rj.getVertexCount,hk=Tj.runMergeSingleThreaded,ik=Tj.ParallelGeomMerge,jk=fk.MATERIAL_VARIANT,kk={UNKNOWN:0,TRIANGLES:1,LINES:2,WIDE_LINES:3,POINTS:4};va.prototype={constructor:va,addGeom:function(a,c,d){this.geoms.push(a),this.fragIds.push(d),this.worldBox.union(c),this.vertexCount+=gk(a);var e=this.geoms.length;return 1==e?0:(void 0===a.byteSize&&b.warn("Error in consolidation: Geometry must contain byteSize."),a.byteSize+(2==e?this.geoms[0].byteSize:0))}},Ca.prototype={constructor:Ca,addContainerMesh:function(a,c,d,e,f){var g=new b.Mesh(a,c);this.meshes.push(g),this.byteSize+=a.byteSize;var h=e||0,i=f||d.length,j=h+i;g.frustumCulled=!1;for(var k=this.meshes.length-1,l=h;l<j;l++){var m=d[l];this.fragId2MeshIndex[m]=k}},addSingleMesh:function(a,c,d,e,f){var g=new b.Mesh(a,c);g.matrix.copy(e),g.matrixAutoUpdate=!1,g.dbId=f,g.fragId=d,this.meshes.push(g),g.frustumCulled=!1,this.fragId2MeshIndex[d]=this.meshes.length-1},addSingleFragment:function(a,b){var c=a.getVizmesh(b);this.addSingleMesh(c.geometry,c.material,b,c.matrixWorld,c.dbId)}},Da.prototype={addGeom:function(a,b,c,d){var e=null,f=this.buckets[b.id];if(f)for(var g=0;g<f.length;g++){var h=f[g],i=h.geoms[0];if(Ba(i,a)){var j=gk(a);if(!(j+h.vertexCount>65535)){e=h;break}}}e||(e=new va(b),this.bucketCount++,this.buckets[b.id]?this.buckets[b.id].push(e):this.buckets[b.id]=[e]),this.costs+=e.addGeom(a,c,d)},createConsolidationMap:function(a,b){var c=a.length,d=new Ea(c,this.bucketCount),e=0,f=0;for(var g in this.buckets)for(var h=this.buckets[g],i=0;i<h.length;i++){var j=h[i];d.ranges[f]=e,d.boxes[f]=j.worldBox,d.fragOrder.set(j.fragIds,e),e+=j.fragIds.length,f++}d.numConsolidated=b;for(var k=b;k<a.length;k++)d.fragOrder[k]=a[k];return d}},Ea.prototype={buildConsolidation:function(a,c,d){var e=this.fragOrder,f=a.getCount(),g=this.ranges.length,h=new Ca(f),i=null;Ga()&&(i=new ik(h));for(var j=[],k=new b.Matrix4,l=0;l<g;l++){var m=this.ranges[l],n=l===g-1?this.numConsolidated:this.ranges[l+1],o=n-m;if(1===o){var p=e[m];h.addSingleFragment(a,p,h)}j.length=o;for(var q=new Float32Array(16*o),r=new Uint32Array(o),s=0;s<o;s++)p=e[m+s],j[s]=a.getGeometry(p),a.getOriginalWorldMatrix(p,k),q.set(k.elements,16*s),r[s]=a.getDbIds(p);var t=this.boxes[l],u=e[m],v=a.getMaterial(u),w=Aa(j,q,r,t,i),x=c.getMaterialVariant(v,jk.VERTEX_IDS,d);h.addContainerMesh(w,x,e,m,o)}return i&&i.runTasks(),h.consolidationMap=this,h}};var lk={copyVertexFormat:wa,copyPrimitiveProps:xa,mergeGeometries:Aa,Consolidation:Ca,ConsolidationBuilder:Da,registerWorkerSupport:Fa,multithreadingSupported:Ga},mk=hi.resolve,nk="undefined"!=typeof navigator&&!!navigator.userAgent.match(/Trident\/7\./),ok=["opaque_luminance_modifier","surface_albedo","surface_roughness","surface_anisotropy","surface_rotation","opaque_f0","opaque_albedo","metal_f0","layered_f0","layered_diffuse","layered_roughness","layered_anisotropy","layered_rotation","layered_bottom_f0","layered_fraction","surface_cutout","wood_curly_distortion"],pk=function(a,b,c){var d="uv_"+a+"_map",e="";return b&&c?e="if ("+d+".x < 0.0 || "+d+".x > 1.0 || "+d+".y < 0.0 || "+d+".y > 1.0) { discard; }":b?e="if ("+d+".x < 0.0 || "+d+".x > 1.0) { discard; }":c&&(e="if ("+d+".y < 0.0 || "+d+".y > 1.0) { discard; }"),"#define "+a.toUpperCase()+"_CLAMP_TEST "+e},qk=function(){var a=0,c=function(a){var b,c,d=[];for(var e in a)!1!==(b=a[e])&&(c="#define "+e+" "+b,d.push(c));return d.join("\n")},d=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getUniformLocation(b,g)}return d},e=function(a,b,c){for(var d={},e=0,f=c.length;e<f;e++){var g=c[e];d[g]=a.getAttribLocation(b,g)}return d},f=function(a,b,c,d,e){var f=d?"1.0-":"",g="texture2D("+a+", (UV))",h="";return e=e||"vec4(0.0)",b&&c?h="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : ":b?h="((UV).x < 0.0 || (UV).x > 1.0) ? "+e+" : ":c&&(h="((UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : "),"#define GET_"+a.toUpperCase()+"(UV) ("+h+f+g+")"},g=function(a){for(var b="\n",c=0;c<ok.length;c++){var d=a[ok[c]];d&&(b+=pk(ok[c],d.S,d.T)+"\n")}return b};return function(h,i,j,k){var l=h,m=l.context,n=j.defines,o=j.__webglShader.uniforms,p=j.attributes,q=mk(j.__webglShader.vertexShader),r=mk(j.__webglShader.fragmentShader),s=j.index0AttributeName;void 0===s&&!0===k.morphTargets&&(s="position");k.envMap;var t,u,v=h.gammaFactor>0?h.gammaFactor:1,w=c(n),x=m.createProgram();j instanceof b.RawShaderMaterial?(t="",u=""):(t=["precision "+k.precision+" float;","precision "+k.precision+" int;",w,k.vertexPrefix,k.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+v,k.mrtNormals?"#define MRT_NORMALS":"",k.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+k.maxDirLights,"#define MAX_POINT_LIGHTS "+k.maxPointLights,"#define MAX_SPOT_LIGHTS "+k.maxSpotLights,"#define MAX_HEMI_LIGHTS "+k.maxHemiLights,"#define MAX_BONES "+k.maxBones,"#define NUM_CUTPLANES "+k.numCutplanes,k.map?"#define USE_MAP":"",k.envMap?"#define USE_ENVMAP":"",k.envMap?"#define ENVMAP_MODE_REFLECTION":"",k.irradianceMap?"#define USE_IRRADIANCEMAP":"",k.lightMap?"#define USE_LIGHTMAP":"",k.bumpMap?"#define USE_BUMPMAP":"",k.normalMap?"#define USE_NORMALMAP":"",k.specularMap?"#define USE_SPECULARMAP":"",k.alphaMap?"#define USE_ALPHAMAP":"",k.vertexColors?"#define USE_COLOR":"",k.vertexIds?"#define USE_VERTEX_ID":"",k.useInstancing?"#define USE_INSTANCING":"",k.wideLines?"#define WIDE_LINES":"",k.skinning?"#define USE_SKINNING":"",k.useVertexTexture?"#define BONE_TEXTURE":"",k.morphTargets?"#define USE_MORPHTARGETS":"",k.morphNormals?"#define USE_MORPHNORMALS":"",k.wrapAround?"#define WRAP_AROUND":"",k.doubleSided?"#define DOUBLE_SIDED":"",k.flipSided?"#define FLIP_SIDED":"",k.sizeAttenuation?"#define USE_SIZEATTENUATION":"",k.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",k.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",k.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef PRISMWOOD","attribute vec3 uvw;","#endif","#ifdef USE_COLOR","   attribute vec3 color;","#endif",""].join("\n"),u=[k.bumpMap||k.normalMap?"#extension GL_OES_standard_derivatives : enable":"",!k.mrtIdBuffer&&!k.mrtNormals||nk?"":"#extension GL_EXT_draw_buffers : enable",k.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",k.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",w,k.fragmentPrefix,"#define MAX_DIR_LIGHTS "+k.maxDirLights,"#define MAX_POINT_LIGHTS "+k.maxPointLights,"#define MAX_SPOT_LIGHTS "+k.maxSpotLights,"#define MAX_HEMI_LIGHTS "+k.maxHemiLights,"#define NUM_CUTPLANES "+k.numCutplanes,k.alphaTest?"#define ALPHATEST "+k.alphaTest:"",l.gammaInput?"#define GAMMA_INPUT":"",l.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+v,k.mrtNormals?"#define MRT_NORMALS":"",k.mrtIdBuffer?"#define MRT_ID_BUFFER":"",k.mrtIdBuffer>1?"#define MODEL_COLOR":"","#define TONEMAP_OUTPUT "+(k.tonemapOutput||0),k.useFog&&k.fog?"#define USE_FOG":"",k.useFog&&k.fogExp?"#define FOG_EXP2":"",k.map?"#define USE_MAP":"",k.envMap?"#define USE_ENVMAP":"",k.envMap?"#define ENVMAP_TYPE_CUBE":"",k.envMap?"#define ENVMAP_MODE_REFLECTION":"",k.envMap?"#define ENVMAP_BLENDING_MULTIPLY":"",k.irradianceMap?"#define USE_IRRADIANCEMAP":"",k.envGammaEncoded?"#define ENV_GAMMA":"",k.irrGammaEncoded?"#define IRR_GAMMA":"",k.envRGBM?"#define ENV_RGBM":"",k.irrRGBM?"#define IRR_RGBM":"",k.lightMap?"#define USE_LIGHTMAP":"",k.bumpMap?"#define USE_BUMPMAP":"",k.normalMap?"#define USE_NORMALMAP":"",k.specularMap?"#define USE_SPECULARMAP":"",k.alphaMap?"#define USE_ALPHAMAP":"",k.vertexColors?"#define USE_COLOR":"",k.vertexIds?"#define USE_VERTEX_ID":"",k.metal?"#define METAL":"",k.clearcoat?"#define CLEARCOAT":"",k.wrapAround?"#define WRAP_AROUND":"",k.doubleSided?"#define DOUBLE_SIDED":"",k.flipSided?"#define FLIP_SIDED":"",k.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",k.hatchPattern?"#define HATCH_PATTERN":"",k.mapInvert?"#define MAP_INVERT":"",f("map",k.mapClampS,k.mapClampT),f("bumpMap",k.bumpMapClampS,k.bumpMapClampT),f("normalMap",k.normalMapClampS,k.normalMapClampT),f("specularMap",k.specularMapClampS,k.specularMapClampT),f("alphaMap",k.alphaMapClampS,k.alphaMapClampT,k.alphaMapInvert),"#ifdef USE_ENVMAP","#ifdef HAVE_TEXTURE_LOD","#extension GL_EXT_shader_texture_lod : enable","#endif","#endif","#extension GL_OES_standard_derivatives : enable","precision "+k.precisionFragment+" float;","precision "+k.precisionFragment+" int;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#if defined(USE_ENVMAP) || defined(USE_IRRADIANCEMAP)","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"),k.isPrism&&(u+=g(k)));var y=new fj(m,m.VERTEX_SHADER,t+q),z=new fj(m,m.FRAGMENT_SHADER,u+r);m.attachShader(x,y),m.attachShader(x,z),void 0!==s&&m.bindAttribLocation(x,0,s),m.linkProgram(x),m.deleteShader(y),m.deleteShader(z);var A=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];k.logarithmicDepthBuffer&&A.push("logDepthBufFC")
;for(var B in o)A.push(B);this.uniforms=d(m,x,A),A=["position","normal","uv","uv2","tangent","color","lineDistance","uvw","id","instOffset","instScaling","instRotation","prev","next","side"];for(var C in p)A.push(C);return this.attributes=e(m,x,A),this.attributesKeys=Object.keys(this.attributes),this.id=a++,this.code=i,this.usedTimes=1,this.program=x,this.vertexShader=y,this.fragmentShader=z,this}}(),rk={PrismMaps:ok,GetPrismMapChunk:pk,WebGLProgram:qk},sk={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:"#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n#else\n    gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n#endif\n}\n",fragmentShader:"#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying float vFragDepth;\n#endif\n#endif\n#include<pack_depth>\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#include<cutplanes>\nvoid main() {\n#if NUM_CUTPLANES > 0\n    checkCutPlanes(vWorldPosition);\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\n    float depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\n    depth = 1.0 - depth;\n    gl_FragColor = packDepth(depth);\n}\n"},tk={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new b.Vector3(1,1,1)}},defines:{},vertexShader:ji,fragmentShader:"#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\nfloat rand(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\n    return rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\n    float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\n    vec2 sampleOffset = unitDirection * radius;\n    float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\n    float depth = 1.0 - idepth;\n    if (depth < 1e-6) {\n        if (radius == 0.0)\n            return vec2(1.0, 1.0);\n        else\n            return vec2(0.0, 1.0);\n    }\n    vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\n    float distance2 = dot(dir,dir);\n    float idistance = 1.0 / sqrt(distance2);\n    vec3 ndir = dir * idistance;\n#ifdef PRESET_2\n    float importance = ndir.y * idistance;\n#else\n    float importance = ndir.y / distance2;\n#endif\n    vec2 ret;\n    ret.x = (idepth == 0.0) ? 0.0 : importance;\n    ret.y = importance;\n    return ret;\n}\nvoid main() {\n    vec2 sum = vec2(0.0);\n    float angle = getRandomAngle(vUv);\n    for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\n        float ssR;\n        vec2 uv = tapLocation(i, angle, ssR);\n        sum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n    }\n    float ao = sum.x / sum.y;\n    gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}\n"},uk={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:ji,fragmentShader:"uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif\n#include<pack_depth>\n#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\n    float depthVal = 0.0;\n    float sum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\n        sum += KERNEL_VAL(x);\n    }\n    gl_FragColor = packDepth(depthVal/sum);\n}\n"},vk={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new b.Vector4(0,0,0,1)}},vertexShader:ji,fragmentShader:"uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;\n#include<pack_depth>\nvoid main() {\n    float depthVal = unpackDepth(texture2D(tDepth, vUv));\n    gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}\n"},wk=function(){var a,c,d;return function(e,f,g,h,i){a||(a=new b.Matrix4),c||(c=new b.Vector3),d||(d=new b.Vector3),c.subVectors(f,h),a.lookAt(c,f,i),d.copy(h).multiplyScalar(-.5*g.y).add(f),e.position.copy(d),e.rotation.setFromRotationMatrix(a),e.scale.set(g.z,g.x,g.y)}}(),xk=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o=a,p=!1,q=!0,r=1,s={texSize:64,pixScale:1,blurRadius:7,debug:!1};if(this.setTransform=function(){var a=new b.Vector3(0,0,0),c=new b.Vector3(0,0,0),e=new b.Vector3(0,0,0),g=new b.Vector3(0,0,0);return function(b,h,i,j){b.equals(a)&&h.equals(c)&&i.equals(e)&&j.equals(g)||(a.copy(b),c.copy(h),e.copy(i),g.copy(j),this.setDirty(),d.left=-h.z/2,d.right=h.z/2,d.top=h.x/2,d.bottom=-h.x/2,d.near=1,d.far=h.y+d.near,d.updateProjectionMatrix(),wk(f,b,h,i,j),d.position.addVectors(b,i.clone().multiplyScalar(-h.y/2-d.near)),j&&d.up.set(j.x,j.y,j.z),d.lookAt(b),s.debug&&(n.position.set(b.x,b.y,b.z),n.rotation.set(d.rotation.x,d.rotation.y,d.rotation.z),n.scale.set(h.z,h.x,h.y)),m.uniforms.worldSize.value.copy(h))}}(),this.renderIntoShadow=function(a){if(!a.overrideMaterial||!a.overrideMaterial.transparent){var b=a.overrideMaterial;a.overrideMaterial=i,o.render(a,d,g,!1),a.overrideMaterial=b}},this.prepareGroundShadow=function(){var a,b=0,c=0,d=0;return function(e,f,g,h){if(!this.enabled||e.isEmpty())return r=1,g;if(a!=e.getGeomScenes()&&(q=!0),q)this.clear(),q=!1,a=e.getGeomScenes(),b=a.length,c=0,d=f?Math.max(Math.ceil(b/100),f):b;else{if(2===r||1===r)return r=1,g;0===f&&(d=b)}var i,j;g&&(i=performance.now(),h=void 0===h?1:h,j=h*g);for(var k,l=0;l<d&&c<b;){var m=a[c++];if(m&&(l++,m.forceVisible=!0,this.renderIntoShadow(m),m.forceVisible=!1,g)){var n=performance.now()-i;if(j<n){r=0,k=g-n;break}}}return c<b&&(r=0,k=g?g-performance.now()+i:1),void 0!==k?k:(this.postprocess(),r=2,g?g-performance.now()+i:1)}}(),this.renderShadow=function(a,b){p&&(b?o.render(e,a,b,!1):o.render(e,a))},this.postprocess=function(){l.render(o,h,g),k.render(o,g,h),p=!0},this.clear=function(){var a=o.getClearColor().getHex(),b=o.getClearAlpha();o.setClearColor(0,0),o.clearTarget(g,!0,!0,!1),o.setClearColor(a,b),o.clearBlend(),p=!1},this.setColor=function(a){j.uniforms.uShadowColor.value.x=a.r,j.uniforms.uShadowColor.value.y=a.g,j.uniforms.uShadowColor.value.z=a.b},this.getColor=function(){return new b.Color(j.uniforms.uShadowColor.value.x,j.uniforms.uShadowColor.value.y,j.uniforms.uShadowColor.value.z)},this.setAlpha=function(a){j.uniforms.uShadowColor.value.w=a},this.getAlpha=function(){return j.uniforms.uShadowColor.value.w},this.isValid=function(){return p},this.getStatus=function(){return r},this.setDirty=function(){q=!0,r=0},this.getDepthMaterial=function(){return i},c)for(var t in s)s[t]=c[t]||s[t];e=new b.Scene,d=new b.OrthographicCamera,g=new b.WebGLRenderTarget(s.texSize,s.texSize,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,stencilBuffer:!1}),g.generateMipmaps=!1,h=new b.WebGLRenderTarget(s.texSize,s.texSize,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,stencilBuffer:!1}),h.generateMipmaps=!1,i=xi.createShaderMaterial(sk),i.side=b.DoubleSide,i.blending=b.NoBlending,k=new yi(uk,"tDepth"),l=new yi(uk,"tDepth"),m=new yi(tk,"tDepth"),k.material.defines.KERNEL_SCALE=l.material.defines.KERNEL_SCALE=(s.pixScale/s.texSize).toFixed(4),k.material.defines.KERNEL_RADIUS=l.material.defines.KERNEL_RADIUS=s.blurRadius.toFixed(2),m.material.blending=k.material.blending=l.material.blending=b.NoBlending,m.material.depthWrite=k.material.depthWrite=l.material.depthWrite=!1,m.material.depthTest=k.material.depthTest=l.material.depthTest=!1,k.material.defines.HORIZONTAL=1,j=xi.createShaderMaterial(vk),j.uniforms.tDepth.value=g,j.depthWrite=!1,j.transparent=!0,f=Ia(j),e.add(f),s.debug&&(n=new b.Mesh(new b.BoxGeometry(1,1,1),new b.MeshBasicMaterial({color:65280,wireframe:!0})),e.add(n)),this.setTransform(new b.Vector3(0,0,0),new b.Vector3(1,1,1),new b.Vector3(0,1,0),b.Object3D.DefaultUp)};xk.prototype.constructor=xk;var yk={GroundShadow:xk,createGroundShape:Ia,setGroundShapeTransform:wk},zk={uniforms:b.UniformsUtils.merge([hi.ShadowMapCommonUniforms,{shadowMapRangeMin:{type:"f",value:0},shadowMapRangeSize:{type:"f",value:0},shadowMinOpacity:{type:"f",value:0},map:{type:"t",value:null},alphaMap:{type:"t",value:null},texMatrix:{type:"m3",value:new b.Matrix3},texMatrixAlpha:{type:"m3",value:new b.Matrix3}},$j.GetPrismMapUniforms("surface_cutout_map")]),vertexShader:"#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#endif\nvoid passCutoutUVCoords() {\n#ifdef USE_SURFACE_CUTOUT_MAP\n    vUv = uv;\n#else\n#ifdef USE_MAP\n    vUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_ALPHAMAP\n    vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#endif\n}\nvoid main() {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n    depth = -mvPosition.z;\n    passCutoutUVCoords();\n}\n",fragmentShader:"#include<shadowmap_decl_common>\nvarying float depth;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#include<float3_average>\n#prism_uniforms<surface_cutout_map>\nvarying vec2 vUv;\n#else\n#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\nvarying vec2 vUvAlpha;\nuniform sampler2D alphaMap;\n#endif\n#endif\nuniform float shadowMinOpacity;\nvoid applyCutoutMaps() {\n    float opacity = 1.0;\n#ifdef USE_SURFACE_CUTOUT_MAP\n#prism_sample_texture<surface_cutout, opacity, true, false>\n#else\n#ifdef USE_MAP\n    opacity *= GET_MAP(vUv).a;\n#endif\n#ifdef USE_ALPHAMAP\n    opacity *= GET_ALPHAMAP(vUvAlpha).r;\n#endif\n#endif\n#if defined(USE_SURFACE_CUTOUT_MAP) || defined(USE_MAP) || defined(USE_ALPHAMAP)\n    if (opacity < shadowMinOpacity) discard;\n#endif\n}\nvoid main() {\n    float normalizedLinearDepth = (depth - shadowMapRangeMin) / shadowMapRangeSize;\n    float val = exp(shadowESMConstant * normalizedLinearDepth);\n#ifdef USE_HARD_SHADOWS\n    val = normalizedLinearDepth;\n#endif\n    applyCutoutMaps();\n    gl_FragColor = vec4(val, 0, 0, 1);\n}\n"},Ak={uniforms:hi.ShadowMapUniforms,vertexShader:"#include<shadowmap_decl_vert>\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n#include<shadowmap_vert>\n}\n",fragmentShader:"#include<shadowmap_decl_frag>\nvoid main() {\n    float shadowIntensity = 0.5 * (1.0 - getShadowValue());\n    gl_FragColor = vec4(0.0, 0.0, 0.0, shadowIntensity);\n}\n"},Bk=function(){function a(){this.init=function(){this.isPrism=!1,this.alphaMap=!1,this.alphaClampS=!1,this.alphaClampT=!1,this.alphaInvert=!1,this.rgbaMap=!1,this.rgbaClampS=!1,this.rgbaClampT=!1,this.rgbaInvert=!1,this.instanced=!1,this.decalIndex=-1},this.init(),this.getMaterialIndex=function(){return(this.isPrism?1:0)|(this.alphaMap?2:0)|(this.alphaClampS?4:0)|(this.alphaClampT?8:0)|(this.alphaInvert?16:0)|(this.rgbaMap?32:0)|(this.rgbaClampS?64:0)|(this.rgbaClampT?128:0)|(this.rgbaInvert?256:0)|(this.instanced?512:0)|1024*(this.decalIndex+1)}}function c(a,b){var c=a.getMaterialIndex();if(!f[c]){var d=g.clone();a.isPrism&&a.alphaMap&&(xi.setMacro(d,"USE_SURFACE_CUTOUT_MAP"),d.fragmentShader=rk.GetPrismMapChunk("surface_cutout",a.alphaClampS,a.alphaClampT)+"\n"+d.fragmentShader),a.instanced&&(d.useInstancing=!0),f[c]=d}return f[c]}function d(a){return a instanceof b.MeshPhongMaterial?a.opacity<Ck.ShadowMinOpacity:a.isPrismMaterial?"PrismTransparent"===a.prismType:!a.visible}function e(a,e){if(d(a))return h;var f=a instanceof b.MeshPhongMaterial,g=a.isPrismMaterial;if(!f&&!g)return null;var i=f?a.alphaMap:a.surface_cutout_map,k=f&&a.alphaTest?a.map:null;if(!i&&!k&&!a.useInstancing)return null;var l=j;l.init(),l.isPrism=g,l.alphaMap=!!i,l.rgbaMap=!!k,l.instanced=a.useInstancing,l.decalIndex=void 0===e?-1:e,i&&(l.alphaClampS=i.clampS,l.alphaClampT=i.clampT,l.alphaInvert=i.invert),k&&(l.rgbaClampS=k.clampS,l.rgbaClampT=k.clampT,l.rgbaInvert=k.invert);var m=c(l,e);return i&&(f?(m.uniforms.alphaMap.value=i,m.uniforms.texMatrixAlpha.value=i.matrix,m.alphaMap=i,m.side=a.side):(m.uniforms.surface_cutout_map.value=i,m.uniforms.surface_cutout_map_texMatrix.value.copy(i.matrix),m.uniforms.surface_cutout_map_invert.value=i.invert,m.side=b.DoubleSide)),k&&(m.uniforms.map.value=k,m.uniforms.texMatrix.value=k.matrix,m.map=k),m}var f=[],g=xi.createShaderMaterial(zk),h=new b.Material;h.visible=!1;var i=[],j=new a;this.forEachMaterial=function(a){for(var b=0;b<f.length;b++){var c=f[b];c&&a(c)}a(g)},this.getCustomOverrideMaterial=function(a){var b=e(a);if(!b)return null;if(!a.decals)return b.decals=null,b;if(a.decals){i.length=0;for(var c=0;c<a.decals.length;c++){var d=a.decals[c],f=e(d.material,c);if(!f)return null;i.push({uv:d.uv,material:f})}}return b.decals=i,b},this.dispose=function(){this.forEachMaterial(function(a){a.dispose()})}},Ck={ShadowMapSize:1024,ShadowESMConstant:80,ShadowBias:.001,ShadowDarkness:.7,ShadowMapBlurRadius:4,ShadowMinOpacity:.9,UseHardShadows:!1,BlurShadowMap:!0},Dk=0,Ek=1,Fk=2,Gk=new Ja,Hk=function(){};Hk.RefreshUniformsShadow=function(a,b){a.shadowMap&&(a.shadowMap.value=b.shadowMap),a.shadowMatrix&&(a.shadowMatrix.value=b.shadowMatrix),a.shadowLightDir&&(a.shadowLightDir.value=b.shadowLightDir),a.shadowESMConstant&&(a.shadowESMConstant.value=Ck.ShadowESMConstant),a.shadowBias&&(a.shadowBias.value=Ck.ShadowBias),a.shadowMapSize&&(a.shadowMapSize.value=Ck.ShadowMapSize),a.shadowDarkness&&(a.shadowDarkness.value=Ck.ShadowDarkness)};var Ik={ShadowMapOverrideMaterials:Bk,SHADOWMAP_NEEDS_UPDATE:0,SHADOWMAP_INCOMPLETE:1,SHADOWMAP_VALID:2,ShadowConfig:Ck,ShadowRender:Hk,ShadowMaps:Ka},Jk=function(a){function c(a){a.__webglVertexBuffer=Pa.createBuffer(),a.__webglColorBuffer=Pa.createBuffer(),a.__webglLineDistanceBuffer=Pa.createBuffer(),Ta.info.memory.geometries++}function d(a){a.__webglVertexBuffer=Pa.createBuffer(),a.__webglColorBuffer=Pa.createBuffer(),Ta.info.memory.geometries++}function e(a){a.__webglVertexBuffer=Pa.createBuffer(),a.__webglNormalBuffer=Pa.createBuffer(),a.__webglTangentBuffer=Pa.createBuffer(),a.__webglColorBuffer=Pa.createBuffer(),a.__webglUVBuffer=Pa.createBuffer(),a.__webglUV2Buffer=Pa.createBuffer(),a.__webglSkinIndicesBuffer=Pa.createBuffer(),a.__webglSkinWeightsBuffer=Pa.createBuffer(),a.__webglFaceBuffer=Pa.createBuffer(),a.__webglLineBuffer=Pa.createBuffer(),Ta.info.memory.geometries++}function f(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=Pa.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function g(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__lineDistanceArray=new Float32Array(1*c),a.__webglLineCount=c,f(a,b)}function h(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__webglPointCount=c,f(a,b)}function i(a,b){var c=b.geometry,d=a.faces3,e=3*d.length,f=1*d.length,g=3*d.length,h=j(b,a),i=n(h),k=l(h),o=m(h);a.__vertexArray=new Float32Array(3*e),k&&(a.__normalArray=new Float32Array(3*e)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*e)),o&&(a.__colorArray=new Float32Array(3*e)),i&&(c.faceVertexUvs.length>0&&(a.__uvArray=new Float32Array(2*e)),c.faceVertexUvs.length>1&&(a.__uv2Array=new Float32Array(2*e))),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*e),a.__skinWeightArray=new Float32Array(4*e));var p=null!==qb.get("OES_element_index_uint")&&f>21845?Uint32Array:Uint16Array;if(a.__typeArray=p,a.__faceArray=new p(3*f),a.__lineArray=new p(2*g),a.__webglFaceCount=3*f,a.__webglLineCount=2*g,h.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var q in h.attributes){var r=h.attributes[q],s={};for(var t in r)s[t]=r[t];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var u=1;"v2"===s.type?u=2:"v3"===s.type?u=3:"v4"===s.type?u=4:"c"===s.type&&(u=3),s.size=u,s.array=new Float32Array(e*u),s.buffer=Pa.createBuffer(),s.buffer.belongsToAttribute=q,r.needsUpdate=!0,s.__original=r}a.__webglCustomAttributesList.push(s)}}a.__inittedArrays=!0}function j(a,c){return a.material instanceof b.MeshFaceMaterial?a.material.materials[c.materialIndex]:a.material}function k(a){return a&&void 0!==a.shading&&a.shading===b.SmoothShading}function l(a){return!(a instanceof b.MeshBasicMaterial&&!a.envMap||a instanceof b.MeshDepthMaterial)&&(k(a)?b.SmoothShading:b.FlatShading)}function m(a){return!!a.vertexColors&&a.vertexColors}function n(a){return!!(a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a instanceof b.ShaderMaterial)}function o(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=a.colors,q=a.lineDistances,r=o.length,s=p.length,t=q.length,u=a.__vertexArray,v=a.__colorArray,w=a.__lineDistanceArray,x=a.verticesNeedUpdate,y=a.colorsNeedUpdate,z=a.lineDistancesNeedUpdate,A=a.__webglCustomAttributesList;if(x){for(c=0;c<r;c++)f=o[c],g=3*c,u[g]=f.x,u[g+1]=f.y,u[g+2]=f.z;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglVertexBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,u,b)}if(y){for(d=0;d<s;d++)h=p[d],g=3*d,v[g]=h.r,v[g+1]=h.g,v[g+2]=h.b;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglColorBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,v,b)}if(z){for(e=0;e<t;e++)w[e]=q[e];Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,w,b)}if(A)for(i=0,j=A.length;i<j;i++)if(n=A[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,l=n.value.length,1===n.size)for(k=0;k<l;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;k<l;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Pa.bindBuffer(Pa.ARRAY_BUFFER,n.buffer),Pa.bufferData(Pa.ARRAY_BUFFER,n.array,b)}}function p(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=a.vertices,o=a.colors,p=n.length,q=o.length,r=a.__vertexArray,s=a.__colorArray,t=a.verticesNeedUpdate,u=a.colorsNeedUpdate,v=a.__webglCustomAttributesList;if(t){for(c=0;c<p;c++)e=n[c],f=3*c,r[f]=e.x,r[f+1]=e.y,r[f+2]=e.z;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglVertexBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,r,b)}if(u){for(d=0;d<q;d++)g=o[d],f=3*d,s[f]=g.r,s[f+1]=g.g,s[f+2]=g.b;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglColorBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,s,b)}if(v)for(h=0,i=v.length;h<i;h++)if(m=v[h],m.needsUpdate&&(void 0===m.boundTo||"vertices"===m.boundTo)){if(f=0,k=m.value.length,1===m.size)for(j=0;j<k;j++)m.array[j]=m.value[j];else if(2===m.size)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,f+=2;else if(3===m.size)if("c"===m.type)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.r,m.array[f+1]=l.g,m.array[f+2]=l.b,f+=3;else for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,m.array[f+2]=l.z,f+=3;else if(4===m.size)for(j=0;j<k;j++)l=m.value[j],m.array[f]=l.x,m.array[f+1]=l.y,m.array[f+2]=l.z,m.array[f+3]=l.w,f+=4;Pa.bindBuffer(Pa.ARRAY_BUFFER,m.buffer),Pa.bufferData(Pa.ARRAY_BUFFER,m.array,b)}}function q(a,c,d,e,f){if(a.__inittedArrays){var g,h,i,j,k,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K=l(f),L=m(f),M=n(f),N=K===b.SmoothShading,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=a.__vertexArray,Z=a.__uvArray,$=a.__uv2Array,_=a.__normalArray,aa=a.__tangentArray,ba=a.__colorArray,ca=a.__webglCustomAttributesList,da=a.__faceArray,ea=a.__lineArray,fa=c.geometry,ga=fa.verticesNeedUpdate,ha=fa.elementsNeedUpdate,ia=fa.uvsNeedUpdate,ja=fa.normalsNeedUpdate,ka=fa.tangentsNeedUpdate,la=fa.colorsNeedUpdate,ma=fa.vertices,na=a.faces3,oa=fa.faces,pa=fa.faceVertexUvs[0],qa=fa.faceVertexUvs[1];if(ga){for(g=0,h=na.length;g<h;g++)j=oa[na[g]],u=ma[j.a],v=ma[j.b],w=ma[j.c],Y[P]=u.x,Y[P+1]=u.y,Y[P+2]=u.z,Y[P+3]=v.x,Y[P+4]=v.y,Y[P+5]=v.z,Y[P+6]=w.x,Y[P+7]=w.y,Y[P+8]=w.z,P+=9;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglVertexBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,Y,d)}if(la&&L){for(g=0,h=na.length;g<h;g++)j=oa[na[g]],p=j.vertexColors,q=j.color,3===p.length&&L===b.VertexColors?(A=p[0],B=p[1],C=p[2]):(A=q,B=q,C=q),ba[W]=A.r,ba[W+1]=A.g,ba[W+2]=A.b,ba[W+3]=B.r,ba[W+4]=B.g,ba[W+5]=B.b,ba[W+6]=C.r,ba[W+7]=C.g,ba[W+8]=C.b,W+=9;W>0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglColorBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,ba,d))}if(ka&&fa.hasTangents){for(g=0,h=na.length;g<h;g++)j=oa[na[g]],r=j.vertexTangents,x=r[0],y=r[1],z=r[2],aa[U]=x.x,aa[U+1]=x.y,aa[U+2]=x.z,aa[U+3]=x.w,aa[U+4]=y.x,aa[U+5]=y.y,aa[U+6]=y.z,aa[U+7]=y.w,aa[U+8]=z.x,aa[U+9]=z.y,aa[U+10]=z.z,aa[U+11]=z.w,U+=12;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglTangentBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,aa,d)}if(ja&&K){for(g=0,h=na.length;g<h;g++)if(j=oa[na[g]],k=j.vertexNormals,o=j.normal,3===k.length&&N)for(D=0;D<3;D++)F=k[D],_[T]=F.x,_[T+1]=F.y,_[T+2]=F.z,T+=3;else for(D=0;D<3;D++)_[T]=o.x,_[T+1]=o.y,_[T+2]=o.z,T+=3;Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglNormalBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,_,d)}if(ia&&pa&&M){for(g=0,h=na.length;g<h;g++)if(i=na[g],void 0!==(s=pa[i]))for(D=0;D<3;D++)G=s[D],Z[Q]=G.x,Z[Q+1]=G.y,Q+=2;Q>0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglUVBuffer),Pa.bufferData(Pa.ARRAY_BUFFER,Z,d))}if(ia&&qa&&M){for(g=0,h=na.length;g<h;g++)if(i=na[g],void 0!==(t=qa[i]))for(D=0;D<3;D++)H=t[D],$[R]=H.x,$[R+1]=H.y,R+=2;R>0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,a.__webglUV2Buffer),Pa.bufferData(Pa.ARRAY_BUFFER,$,d))}if(ha){for(g=0,h=na.length;g<h;g++)da[S]=O,da[S+1]=O+1,da[S+2]=O+2,S+=3,ea[V]=O,ea[V+1]=O+1,ea[V+2]=O,ea[V+3]=O+2,ea[V+4]=O+1,ea[V+5]=O+2,V+=6,O+=3;Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,da,d),Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,ea,d)}if(ca)for(D=0,E=ca.length;D<E;D++)if(J=ca[D],J.__original.needsUpdate){if(X=0,1===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)j=oa[na[g]],J.array[X]=J.value[j.a],J.array[X+1]=J.value[j.b],J.array[X+2]=J.value[j.c],X+=3;else if("faces"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],J.array[X]=I,J.array[X+1]=I,J.array[X+2]=I,X+=3}else if(2===J.size){if(void 0===J.boundTo||"vertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)j=oa[na[g]],u=J.value[j.a],v=J.value[j.b],w=J.value[j.c],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=v.x,J.array[X+3]=v.y,J.array[X+4]=w.x,J.array[X+5]=w.y,X+=6;else if("faces"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],u=I,v=I,w=I,J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=v.x,J.array[X+3]=v.y,J.array[X+4]=w.x,J.array[X+5]=w.y,X+=6}else if(3===J.size){var ra;if(ra="c"===J.type?["r","g","b"]:["x","y","z"],void 0===J.boundTo||"vertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)j=oa[na[g]],u=J.value[j.a],v=J.value[j.b],w=J.value[j.c],J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9;else if("faces"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],u=I,v=I,w=I,J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9;else if("faceVertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],u=I[0],v=I[1],w=I[2],J.array[X]=u[ra[0]],J.array[X+1]=u[ra[1]],J.array[X+2]=u[ra[2]],J.array[X+3]=v[ra[0]],J.array[X+4]=v[ra[1]],J.array[X+5]=v[ra[2]],J.array[X+6]=w[ra[0]],J.array[X+7]=w[ra[1]],J.array[X+8]=w[ra[2]],X+=9}else if(4===J.size)if(void 0===J.boundTo||"vertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)j=oa[na[g]],u=J.value[j.a],v=J.value[j.b],w=J.value[j.c],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;else if("faces"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],u=I,v=I,w=I,J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;else if("faceVertices"===J.boundTo)for(g=0,h=na.length;g<h;g++)I=J.value[na[g]],u=I[0],v=I[1],w=I[2],J.array[X]=u.x,J.array[X+1]=u.y,J.array[X+2]=u.z,J.array[X+3]=u.w,J.array[X+4]=v.x,J.array[X+5]=v.y,J.array[X+6]=v.z,J.array[X+7]=v.w,J.array[X+8]=w.x,J.array[X+9]=w.y,J.array[X+10]=w.z,J.array[X+11]=w.w,X+=12;Pa.bindBuffer(Pa.ARRAY_BUFFER,J.buffer),Pa.bufferData(Pa.ARRAY_BUFFER,J.array,d)}e&&(delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__tangentArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray,delete a.__skinIndexArray,delete a.__skinWeightArray)}}function r(a){if(a.streamingDraw){if(!a.streamingIndex){var b=a.attributes.index;b&&(b.buffer=Pa.createBuffer(),Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,b.buffer),Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,b.array||a.ib,Pa.STATIC_DRAW))}}else{a.vb&&void 0===a.vbbuffer&&(a.vbbuffer=Pa.createBuffer(),a.vbNeedsUpdate=!0),a.ib&&void 0===a.ibbuffer&&(a.ibbuffer=Pa.createBuffer(),Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,a.ibbuffer),Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,a.ib,Pa.STATIC_DRAW)),a.iblines&&void 0===a.iblinesbuffer&&(a.iblinesbuffer=Pa.createBuffer(),Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,a.iblinesbuffer),Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,a.iblines,Pa.STATIC_DRAW));for(var c=a.attributes,d=a.attributesKeys,e=0,f=d.length;e<f;e++){var g=d[e],h=c[g],i="index"===g;if(h.array&&void 0===h.buffer&&(h.buffer=Pa.createBuffer(),h.needsUpdate=!0),!0===h.needsUpdate){var j=i?Pa.ELEMENT_ARRAY_BUFFER:Pa.ARRAY_BUFFER;Pa.bindBuffer(j,h.buffer),Pa.bufferData(j,h.array,Pa.STATIC_DRAW),h.needsUpdate=!1}}a.vbNeedsUpdate&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,a.vbbuffer),Pa.bufferData(Pa.ARRAY_BUFFER,a.vb,Pa.STATIC_DRAW),a.vbNeedsUpdate=!1,a.discardAfterUpload&&(a.vb=null))}}function s(a,b,c,d){var e;if(c.streamingDraw)return c.vaos=null,!1;if(c.offsets&&c.offsets.length>1)return c.vaos=null,!1;if(!Sa)return c.vaos=null,!1;if(void 0===c.vaos&&(c.vaos=[]),e=Sa.createVertexArrayOES(),c.vaos.push({geomhash:b.id,uv:d,vao:e}),Sa.bindVertexArrayOES(e),a.isEdgeMaterial)Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,c.iblinesbuffer);else{var f=c.attributes.index;f&&Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,c.ibbuffer||f.buffer)}for(var g=null,h=b.attributes,i=b.attributesKeys,j=c.vbstride,k=c.offsets&&c.offsets.length?c.offsets[0].index:0,l=0,m=i.length;l<m;l++){var n=i[l],o=h[n];if(o>=0){var p=c.attributes[n];if("uv"===n&&d&&(p=c.attributes["uv"+(d+1)]),!p){Sa.bindVertexArrayOES(null);for(var q=0;q<c.vaos.length;q++)Sa.deleteVertexArrayOES(c.vaos[q].vao);return c.vaos=null,!1}var r=Pa.FLOAT,s=p.bytesPerItem||4;1===s?r=Pa.UNSIGNED_BYTE:2===s&&(r=Pa.UNSIGNED_SHORT),Pa.enableVertexAttribArray(o),void 0!==p.itemOffset?(g!=c.vbbuffer&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,c.vbbuffer),g=c.vbbuffer),Pa.vertexAttribPointer(o,p.itemSize,r,!!p.normalize,4*j,4*(p.itemOffset+k*j))):(Pa.bindBuffer(Pa.ARRAY_BUFFER,p.buffer),g=p.buffer,Pa.vertexAttribPointer(o,p.itemSize,r,!!p.normalize,0,k*p.itemSize*s)),Ra&&Ra.vertexAttribDivisorANGLE(o,c.numInstances?p.divisor||0:0)}}return!0}function t(a,b,c,d){var e=c.vaos;if(e)for(var f=0,g=e.length;f<g;f++){var h=e[f];if(h.geomhash===b.id&&h.uv===d)return Sa.bindVertexArrayOES(h.vao),!0}else if(null===e)return!1;return s(a,b,c,d)}function u(a,b){var c=gb[a];return c||(c=Pa.createBuffer(),gb[a]=c),Pa.bindBuffer(Pa.ARRAY_BUFFER,c),Pa.bufferData(Pa.ARRAY_BUFFER,b,Pa.DYNAMIC_DRAW),c}function v(a,b,c,d,e,f){var g,h=b.attributes,i=b.attributesKeys,j=0;if(e)if(!e.buffer&&c.streamingDraw){var k=gb.index;k||(k=Pa.createBuffer(),gb.index=k),Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,k),a.isEdgeMaterial?Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,c.iblines,Pa.DYNAMIC_DRAW):Pa.bufferData(Pa.ELEMENT_ARRAY_BUFFER,e.array||c.ib,Pa.DYNAMIC_DRAW)}else a.isEdgeMaterial?Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,c.iblinesbuffer):Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,c.ibbuffer||e.buffer);for(var l=0,m=i.length;l<m;l++){var n=i[l],o=h[n];if(o>=0){var p=c.attributes[n];if("uv"===n&&f&&(p=c.attributes["uv"+(f+1)]),p){var q,r,s=void 0!==p.itemOffset;s?(q=c.vbstride,r=p.itemOffset,j!==g&&(c.streamingDraw?j=u("interleavedVB",c.vb):(j=c.vbbuffer,Pa.bindBuffer(Pa.ARRAY_BUFFER,j)),g=j)):(q=p.itemSize,r=0,c.streamingDraw?j=u(n,p.array):(j=p.buffer,Pa.bindBuffer(Pa.ARRAY_BUFFER,j)));var t=Pa.FLOAT,v=p.bytesPerItem||4;1===v?t=Pa.UNSIGNED_BYTE:2===v&&(t=Pa.UNSIGNED_SHORT),s&&(v=4),pb.enableAttribute(o),Pa.vertexAttribPointer(o,p.itemSize,t,p.normalize,q*v,(r+d*q)*v),Ra&&Ra.vertexAttribDivisorANGLE(o,c.numInstances?p.divisor||0:0)}else if(a.defaultAttributeValues){var w=a.defaultAttributeValues[n];w&&2===w.length?Pa.vertexAttrib2fv(o,a.defaultAttributeValues[n]):w&&3===w.length?Pa.vertexAttrib3fv(o,a.defaultAttributeValues[n]):w&&4===w.length&&Pa.vertexAttrib4fv(o,a.defaultAttributeValues[n])}}}pb.disableUnusedAttributes()}function w(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?a.z-b.z:a.id-b.id}function x(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?b.z-a.z:a.id-b.id}function y(a){B(a,!0)}function z(a){B(a,!1)}function B(a,c,d){var e,f;if(d||!1!==a.visible){if(a instanceof b.Scene||a instanceof b.Group);else if(a instanceof A)a.forEach(c?y:z);else if(J(a),a instanceof b.Light)Ia.push(a);else{var g=Ja[a.id];if(g&&(!1===a.frustumCulled||!0===hb.intersectsObject(a)))for(e=0,f=g.length;e<f;e++){var h=g[e];I(h),h.render=!0,!0===c&&(kb.setFromMatrixPosition(a.matrixWorld),kb.applyProjection(ib),h.z=kb.z)}}if(a.children)for(e=0,f=a.children.length;e<f;e++)B(a.children[e],c,d)}}function C(a,b){if(!b.getCustomOverrideMaterial)return b;var c=b.getCustomOverrideMaterial(a);return c||b}function D(a,c,d,e,f){for(var g,h=0,i=a.length;h<i;h++){var j=a[h],k=j.object,l=j.buffer
;if(f)g=C(j.material,f);else{if(!(g=j.material))continue;V(g)}if(g.twoPassTransparency){var m=g.side;g.side=b.BackSide,E(g,c,d,e,l,f,k),g.side=b.FrontSide,E(g,c,d,e,l,f,k),g.side=m}else E(g,c,d,e,l,f,k)}}function E(a,c,d,e,f,g,h){if(Ta.setMaterialFaces(a),f instanceof b.BufferGeometry?Ta.renderBufferDirect(c,d,e,a,f,h):Ta.renderBuffer(c,d,e,a,f,h),a.decals)for(var i=a.decals,j=0,k=i.length;j<k;j++){var l=i[j];a=l.material,V(a),Ta.setMaterialFaces(a),f instanceof b.BufferGeometry&&Ta.renderBufferDirect(c,d,e,a,f,h,l.uv)}}function F(a,c){if(a.visible&&!a.hide){var d;if(Xb)d=C(a.material,Xb);else{if(!(d=a.material))return;V(d)}if(d.twoPassTransparency){var e=d.side;d.side=b.BackSide,G(a,d),d.side=b.FrontSide,G(a,d),d.side=e}else G(a,d)}}function G(a,b){if(Ta.setMaterialFaces(b),Ta.renderBufferDirect(Ub,Vb,Wb,b,a.geometry,a),b.decals)for(var c=b.decals,d=0,e=c.length;d<e;d++){var f=c[d];b=f.material,V(b),Ta.setMaterialFaces(b),Ta.renderBufferDirect(Ub,Vb,Wb,b,a.geometry,a,f.uv)}}function H(a,b,c,d,e,f){Ub=c,Vb=d,Wb=e,Xb=f||null,a.forEach(F,a.forceVisible?1:128,!1)}function I(a){var c=a.object,d=a.buffer,e=c.geometry,f=c.material;if(f instanceof b.MeshFaceMaterial){var g=e instanceof b.BufferGeometry?0:d.materialIndex;f=f.materials[g],a.material=f,f.transparent?Oa.push(a):Na.push(a)}else f&&(a.material=f,f.transparent?Oa.push(a):Na.push(a))}function J(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("removed",Kb));var e=a.geometry;if(void 0===e||void 0===e.__webglInit&&(e.__webglInit=!0,e.addEventListener("dispose",Lb),e instanceof b.BufferGeometry||(a instanceof b.Mesh?L(a,e):a instanceof b.Line?void 0===e.__webglVertexBuffer&&(c(e),g(e,a),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0,e.lineDistancesNeedUpdate=!0):a instanceof b.PointCloud&&void 0===e.__webglVertexBuffer&&(d(e),h(e,a),e.verticesNeedUpdate=!0,e.colorsNeedUpdate=!0))),void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof b.Mesh){if(e instanceof b.BufferGeometry)M(Ja,e,a);else if(e instanceof b.Geometry)for(var f=Yb[e.id],i=0,j=f.length;i<j;i++)M(Ja,f[i],a)}else a instanceof b.Line||a instanceof b.PointCloud?M(Ja,e,a):(a instanceof b.ImmediateRenderObject||a.immediateRenderCallback)&&N(Ka,a)}function K(a,b){for(var c,d,e=qb.get("OES_element_index_uint")?4294967296:65535,f={},g=a.morphTargets?a.morphTargets.length:0,h=a.morphNormals?a.morphNormals.length:0,i={},j=[],k=0,l=a.faces.length;k<l;k++){var m=a.faces[k],n=b?m.materialIndex:0;n in f||(f[n]={hash:n,counter:0}),c=f[n].hash+"_"+f[n].counter,c in i||(d={id:Zb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d)),i[c].vertices+3>e&&(f[n].counter+=1,(c=f[n].hash+"_"+f[n].counter)in i||(d={id:Zb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d))),i[c].faces3.push(k),i[c].vertices+=3}return j}function L(a,c){var d=a.material,f=!1;void 0!==Yb[c.id]&&!0!==c.groupsNeedUpdate||(delete Ja[a.id],Yb[c.id]=K(c,d instanceof b.MeshFaceMaterial),c.groupsNeedUpdate=!1);for(var g=Yb[c.id],h=0,j=g.length;h<j;h++){var k=g[h];void 0===k.__webglVertexBuffer?(e(k),i(k,a),c.verticesNeedUpdate=!0,c.morphTargetsNeedUpdate=!0,c.elementsNeedUpdate=!0,c.uvsNeedUpdate=!0,c.normalsNeedUpdate=!0,c.tangentsNeedUpdate=!0,c.colorsNeedUpdate=!0,f=!0):f=!1,(f||void 0===a.__webglActive)&&M(Ja,k,a)}a.__webglActive=!0}function M(a,b,c){var d=c.id;a[d]=a[d]||[],a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function N(a,b){a.push({id:null,object:b,opaque:null,transparent:null,z:0})}function O(a){var c,d,e=a.geometry;if(e instanceof b.BufferGeometry)r(e);else if(a instanceof b.Mesh){!0===e.groupsNeedUpdate&&L(a,e);for(var f=Yb[e.id],g=0,h=f.length;g<h;g++){var i=f[g];d=j(a,i),c=d.attributes&&P(d),(e.verticesNeedUpdate||e.morphTargetsNeedUpdate||e.elementsNeedUpdate||e.uvsNeedUpdate||e.normalsNeedUpdate||e.colorsNeedUpdate||e.tangentsNeedUpdate||c)&&q(i,a,Pa.DYNAMIC_DRAW,!e.dynamic,d)}e.verticesNeedUpdate=!1,e.morphTargetsNeedUpdate=!1,e.elementsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.tangentsNeedUpdate=!1,d.attributes&&Q(d)}else a instanceof b.Line?(d=j(a,e),c=d.attributes&&P(d),(e.verticesNeedUpdate||e.colorsNeedUpdate||e.lineDistancesNeedUpdate||c)&&o(e,Pa.DYNAMIC_DRAW),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1,e.lineDistancesNeedUpdate=!1,d.attributes&&Q(d)):a instanceof b.PointCloud&&(d=j(a,e),c=d.attributes&&P(d),(e.verticesNeedUpdate||e.colorsNeedUpdate||c)&&p(e,Pa.DYNAMIC_DRAW),e.verticesNeedUpdate=!1,e.colorsNeedUpdate=!1,d.attributes&&Q(d))}function P(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function Q(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function R(a){a instanceof b.Mesh||a instanceof b.PointCloud||a instanceof b.Line?delete Ja[a.id]:(a instanceof b.ImmediateRenderObject||a.immediateRenderCallback)&&S(Ka,a),delete a.__webglInit,delete a.__webglActive}function S(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function T(a,b){if(b.textureMaps)for(var c=0;c<rk.PrismMaps.length;c++){var d=rk.PrismMaps[c],e=b.textureMaps[d+"_map"];if(e){var f=e.textureObj.properties.booleans;a[d]={S:!f.texture_URepeat.values[0],T:!f.texture_VRepeat.values[0]}}}}function U(a,c,d,e){a.addEventListener("dispose",Ob);var f=$b[a.type];if(f){var g=b.ShaderLib[f];a.__webglShader={uniforms:b.UniformsUtils.clone(g.uniforms),vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}}else a.__webglShader={uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};var h=ta(c),i={precision:wa,precisionFragment:xa,supportsVertexTextures:yb,haveTextureLod:!!qb.get("EXT_shader_texture_lod"),map:!!a.map,envMap:!!a.envMap,irradianceMap:!!a.irradianceMap,envIsSpherical:a.envMap&&a.envMap.mapping==b.SphericalReflectionMapping,envGammaEncoded:a.envMap&&a.envMap.GammaEncoded,irrGammaEncoded:a.irradianceMap&&a.irradianceMap.GammaEncoded,envRGBM:a.envMap&&a.envMap.RGBM,irrRGBM:a.irradianceMap&&a.irradianceMap.RGBM,lightMap:!!a.lightMap,bumpMap:qb.get("OES_standard_derivatives")&&!!a.bumpMap,normalMap:qb.get("OES_standard_derivatives")&&!!a.normalMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,vertexColors:a.vertexColors,vertexIds:a.vertexIds,useInstancing:a.useInstancing,wideLines:a.wideLines,fog:d,useFog:a.fog,fogExp:d instanceof b.FogExp2,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:Da,maxDirLights:h.directional,maxPointLights:h.point,maxSpotLights:h.spot,maxHemiLights:h.hemi,alphaTest:a.alphaTest,metal:a.metal,clearcoat:a.clearcoat,wrapAround:a.wrapAround,doubleSided:a.side===b.DoubleSide,flipSided:a.side===b.BackSide,mrtNormals:a.mrtNormals,mrtIdBuffer:a.mrtIdBuffer,vertexPrefix:_a,fragmentPrefix:ab,tonemapOutput:a.tonemapOutput,packedNormals:a.packedNormals,hatchPattern:!!a.hatchParams,numCutplanes:a.cutplanes?a.cutplanes.length:0,mapInvert:a.map&&a.map.invert,mapClampS:a.map&&a.map.clampS,mapClampT:a.map&&a.map.clampT,bumpMapClampS:a.bumpMap&&a.bumpMap.clampS,bumpMapClampT:a.bumpMap&&a.bumpMap.clampT,normalMapClampS:a.normalMap&&a.normalMap.clampS,normalMapClampT:a.normalMap&&a.normalMap.clampT,specularMapClampS:a.specularMap&&a.specularMap.clampS,specularMapClampT:a.specularMap&&a.specularMap.clampT,alphaMapInvert:a.alphaMap&&a.alphaMap.invert,alphaMapClampS:a.alphaMap&&a.alphaMap.clampS,alphaMapClampT:a.alphaMap&&a.alphaMap.clampT};a.isPrismMaterial&&(T(i,a),i.isPrism=!0);var j=[];f?j.push(f):(j.push(a.fragmentShader),j.push(a.vertexShader));for(var k in a.defines)j.push(k),j.push(a.defines[k]);var l,m;for(l in i)j.push(l),j.push(i[l]);var n,o=j.join();for(l=0,m=Ua.length;l<m;l++){var p=Ua[l];if(p.code===o){n=p,n.usedTimes++;break}}void 0===n&&(n=new rk.WebGLProgram(Ta,o,a,i),Ua.push(n),Ta.info.memory.programs=Ua.length),a.programs||(a.programs=[]),a.programs[$a]=n,a.uniformsLists||(a.uniformsLists=[]),a.uniformsList=a.uniformsLists[$a]=[];for(var q in a.__webglShader.uniforms){var r=n.uniforms[q];r&&a.uniformsList.push([a.__webglShader.uniforms[q],r])}}function V(a){!0===a.transparent&&pb.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha),pb.setDepthTest(a.depthTest),pb.setDepthWrite(a.depthWrite),pb.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function W(a,c,d,e,f){bb=0,e.needsUpdate?(e.program&&Tb(e),U(e,c,d,f),e.needsUpdate=!1):e.programs[$a]||U(e,c,d,f);var g=!1,h=!1,i=!1;e.uniformsList=e.uniformsLists[$a];var j=e.program=e.programs[$a],k=j.uniforms,l=e.__webglShader.uniforms;if(j.id!==Va&&(Pa.useProgram(j.program),Va=j.id,g=!0,h=!0,i=!0),e.id!==Xa&&(-1===Xa&&(i=!0),Xa=e.id,h=!0),(g||a!==Ya)&&(Pa.uniformMatrix4fv(k.projectionMatrix,!1,a.projectionMatrix.elements),Da&&Pa.uniform1f(k.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Ya&&(Ya=a),(e instanceof b.ShaderMaterial||e instanceof b.MeshPhongMaterial||e.isPrismMaterial||e.envMap)&&null!==k.cameraPosition&&(kb.setFromMatrixPosition(a.matrixWorld),Pa.uniform3f(k.cameraPosition,kb.x,kb.y,kb.z)),(e instanceof b.MeshPhongMaterial||e instanceof b.MeshLambertMaterial||e instanceof b.ShaderMaterial||e.isPrismMaterial||e.skinning)&&(null!==k.viewMatrix&&Pa.uniformMatrix4fv(k.viewMatrix,!1,a.matrixWorldInverse.elements),null!==k.viewMatrixInverse&&Pa.uniformMatrix4fv(k.viewMatrixInverse,!1,jb.elements),k.mvpMatrix&&Pa.uniformMatrix4fv(k.mvpMatrix,!1,ib.elements),i?(aa(l,e),ba(l,!0)):ba(l,!1))),h){d&&e.fog&&_(l,d),(e instanceof b.MeshPhongMaterial||e instanceof b.MeshLambertMaterial||e.isPrismMaterial||e.lights)&&(mb&&(i=!0,la(c),mb=!1),i?(fa(l,nb),ga(l,!0)):ga(l,!1)),(e instanceof b.MeshBasicMaterial||e instanceof b.MeshLambertMaterial||e instanceof b.MeshPhongMaterial)&&(X(l,e),aa(l,e)),e instanceof b.PointCloudMaterial?Y(l,e):e instanceof b.LineBasicMaterial?Z(l,e):e instanceof b.LineDashedMaterial?(Z(l,e),$(l,e)):e instanceof b.MeshPhongMaterial?ca(l,e):e instanceof b.MeshLambertMaterial?ea(l,e):e instanceof b.MeshDepthMaterial?(l.mNear.value=a.near,l.mFar.value=a.far,l.opacity.value=e.opacity):e instanceof b.MeshNormalMaterial?l.opacity.value=e.opacity:e.isPrismMaterial&&(da(l,e),aa(l,e)),e.wideLines&&(l.view_size.value=new b.Vector2(window.innerWidth,window.innerHeight)),Ik.ShadowRender&&e.shadowMap&&Ik.ShadowRender.RefreshUniformsShadow(l,e);var m=l.cutplanes;e.cutplanes&&e.cutplanes.length>0&&m&&(m.value=e.cutplanes,m._array&&m._array.length!=4*e.cutplanes&&(m._array=void 0)),e.hatchParams&&l.hatchParams&&(l.hatchParams.value.copy(e.hatchParams),l.hatchTintColor.value.copy(e.hatchTintColor),l.hatchTintIntensity.value=e.hatchTintIntensity),ja(e.uniformsList)}ha(k,f,a),null!==k.modelMatrix&&Pa.uniformMatrix4fv(k.modelMatrix,!1,f.matrixWorld.elements);var n;if(k.modelId){k.dbId&&(n=f.dbId||f.fragId||0,Pa.uniform3f(k.dbId,(255&n)/255,(n>>8&255)/255,(n>>16&255)/255));var o=f.modelId;Pa.uniform3f(k.modelId,(255&o)/255,(o>>8&255)/255,(n>>24&255)/255)}else null!==k.dbId&&(n=!Ea&&f.dbId||f.fragId||0,Pa.uniform3f(k.dbId,(255&n)/255,(n>>8&255)/255,(n>>16&255)/255));if(k.themingColor){var p=f.themingColor;p instanceof b.Vector4?Pa.uniform4f(k.themingColor,p.x,p.y,p.z,p.w):Pa.uniform4f(k.themingColor,0,0,0,0)}return j}function X(a,b){function c(a,b,c){var d=c.offset,e=c.repeat;if(b){var f=b.value;c.matrix?f.copy(c.matrix):f.identity(),f.elements[6]+=d.x,f.elements[7]+=d.y,f.elements[0]*=e.x,f.elements[3]*=e.x,f.elements[1]*=e.y,f.elements[4]*=e.y}else a.offsetRepeat.value.set(d.x,d.y,e.x,e.y)}a.opacity.value=b.opacity,a.diffuse.value.copy(b.color),a.map.value=b.map,a.lightMap.value=b.lightMap,a.specularMap.value=b.specularMap,a.alphaMap.value=b.alphaMap,b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale)),b.alphaMap&&c(a,a.texMatrixAlpha,b.alphaMap);var d;b.normalMap?d=b.normalMap:b.bumpMap&&(d=b.bumpMap),void 0!==d&&c(a,a.texMatrixBump,d);var e;b.map?e=b.map:b.specularMap&&(e=b.specularMap),void 0!==e&&c(a,a.texMatrix,e),a.envMap.value=b.envMap,a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio}function Y(a,b){Z(a,b),a.point_size.value=b.size}function Z(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function $(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function _(a,c){a.fogColor.value=c.color,c instanceof b.Fog?(a.fogNear.value=c.near,a.fogFar.value=c.far):c instanceof b.FogExp2&&(a.fogDensity.value=c.density)}function aa(a,b){a.envMap&&(a.envMap.value=b.envMap),a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.envMapExposure&&(a.envMapExposure.value=b.envMapExposure),a.envRotationSin&&a.envRotationCos&&(a.envRotationSin.value=b.envRotationSin,a.envRotationCos.value=b.envRotationCos)}function ba(a,b){a.envMap&&(a.envMap.needsUpdate=b),a.irradianceMap&&(a.irradianceMap.needsUpdate=b),a.envMapExposure&&(a.envMapExposure.needsUpdate=b)}function ca(a,b){if(a.shininess.value=b.shininess,a.reflMipIndex){var c=Math.log(Math.max(1+1e-10,b.shininess));a.reflMipIndex.value=Math.max(0,-.72134752*c+5.5)}a.emissive&&a.emissive.value.copy(b.emissive),a.specular.value.copy(b.specular),a.exposureBias&&(a.exposureBias.value=b.exposureBias)}function da(a,c){function d(a,c,d){a[d].value=c[d],null!=c[d]&&(a[d+"_texMatrix"].value=(new b.Matrix3).copy(c[d].matrix),a[d+"_invert"].value=c[d].invert)}function e(a,c,d){a[d].value=c[d],null!=c[d]&&(a[d+"_texMatrix"].value=(new b.Matrix3).copy(c[d].matrix),a[d+"_bumpScale"].value=(new b.Vector2).copy(c[d].bumpScale),a[d+"_bumpmapType"].value=c[d].bumpmapType)}switch(a.exposureBias.value=c.exposureBias,a.opacity.value=c.opacity,a.surface_albedo.value=(new b.Color).copy(c.surface_albedo),a.surface_roughness.value=c.surface_roughness,a.surface_anisotropy.value=c.surface_anisotropy,a.surface_rotation.value=c.surface_rotation,d(a,c,"surface_albedo_map"),d(a,c,"surface_roughness_map"),d(a,c,"surface_cutout_map"),d(a,c,"surface_anisotropy_map"),d(a,c,"surface_rotation_map"),e(a,c,"surface_normal_map"),c.prismType){case"PrismOpaque":a.opaque_albedo.value=(new b.Color).copy(c.opaque_albedo),a.opaque_luminance_modifier.value=(new b.Color).copy(c.opaque_luminance_modifier),a.opaque_f0.value=c.opaque_f0,a.opaque_luminance.value=c.opaque_luminance,d(a,c,"opaque_albedo_map"),d(a,c,"opaque_luminance_modifier_map"),d(a,c,"opaque_f0_map");break;case"PrismMetal":a.metal_f0.value=(new b.Color).copy(c.metal_f0),d(a,c,"metal_f0_map");break;case"PrismLayered":a.layered_f0.value=c.layered_f0,a.layered_diffuse.value=(new b.Color).copy(c.layered_diffuse),a.layered_fraction.value=c.layered_fraction,a.layered_bottom_f0.value=(new b.Color).copy(c.layered_bottom_f0),a.layered_roughness.value=c.layered_roughness,a.layered_anisotropy.value=c.layered_anisotropy,a.layered_rotation.value=c.layered_rotation,d(a,c,"layered_bottom_f0_map"),d(a,c,"layered_f0_map"),d(a,c,"layered_diffuse_map"),d(a,c,"layered_fraction_map"),d(a,c,"layered_roughness_map"),d(a,c,"layered_anisotropy_map"),d(a,c,"layered_rotation_map"),e(a,c,"layered_normal_map");break;case"PrismTransparent":a.transparent_color.value=(new b.Color).copy(c.transparent_color),a.transparent_distance.value=c.transparent_distance,a.transparent_ior.value=c.transparent_ior;break;case"PrismWood":a.wood_fiber_cosine_enable.value=c.wood_fiber_cosine_enable,a.wood_fiber_cosine_bands.value=c.wood_fiber_cosine_bands,a.wood_fiber_cosine_weights.value=(new b.Vector4).copy(c.wood_fiber_cosine_weights),a.wood_fiber_cosine_frequencies.value=(new b.Vector4).copy(c.wood_fiber_cosine_frequencies),a.wood_fiber_perlin_enable.value=c.wood_fiber_perlin_enable,a.wood_fiber_perlin_bands.value=c.wood_fiber_perlin_bands,a.wood_fiber_perlin_weights.value=(new b.Vector4).copy(c.wood_fiber_perlin_weights),a.wood_fiber_perlin_frequencies.value=(new b.Vector4).copy(c.wood_fiber_perlin_frequencies),a.wood_fiber_perlin_scale_z.value=c.wood_fiber_perlin_scale_z,a.wood_growth_perlin_enable.value=c.wood_growth_perlin_enable,a.wood_growth_perlin_bands.value=c.wood_growth_perlin_bands,a.wood_growth_perlin_weights.value=(new b.Vector4).copy(c.wood_growth_perlin_weights),a.wood_growth_perlin_frequencies.value=(new b.Vector4).copy(c.wood_growth_perlin_frequencies),a.wood_latewood_ratio.value=c.wood_latewood_ratio,a.wood_earlywood_sharpness.value=c.wood_earlywood_sharpness,a.wood_latewood_sharpness.value=c.wood_latewood_sharpness,a.wood_ring_thickness.value=c.wood_ring_thickness,a.wood_earlycolor_perlin_enable.value=c.wood_earlycolor_perlin_enable,a.wood_earlycolor_perlin_bands.value=c.wood_earlycolor_perlin_bands,a.wood_earlycolor_perlin_weights.value=(new b.Vector4).copy(c.wood_earlycolor_perlin_weights),a.wood_earlycolor_perlin_frequencies.value=(new b.Vector4).copy(c.wood_earlycolor_perlin_frequencies),a.wood_early_color.value=(new b.Color).copy(c.wood_early_color),a.wood_use_manual_late_color.value=c.wood_use_manual_late_color,a.wood_manual_late_color.value=(new b.Color).copy(c.wood_manual_late_color),a.wood_latecolor_perlin_enable.value=c.wood_latecolor_perlin_enable,a.wood_latecolor_perlin_bands.value=c.wood_latecolor_perlin_bands,a.wood_latecolor_perlin_weights.value=(new b.Vector4).copy(c.wood_latecolor_perlin_weights),a.wood_latecolor_perlin_frequencies.value=(new b.Vector4).copy(c.wood_latecolor_perlin_frequencies),a.wood_late_color_power.value=c.wood_late_color_power,a.wood_diffuse_perlin_enable.value=c.wood_diffuse_perlin_enable,a.wood_diffuse_perlin_bands.value=c.wood_diffuse_perlin_bands,a.wood_diffuse_perlin_weights.value=(new b.Vector4).copy(c.wood_diffuse_perlin_weights),a.wood_diffuse_perlin_frequencies.value=(new b.Vector4).copy(c.wood_diffuse_perlin_frequencies),a.wood_diffuse_perlin_scale_z.value=c.wood_diffuse_perlin_scale_z,a.wood_use_pores.value=c.wood_use_pores,a.wood_pore_type.value=c.wood_pore_type,a.wood_pore_radius.value=c.wood_pore_radius,a.wood_pore_cell_dim.value=c.wood_pore_cell_dim,a.wood_pore_color_power.value=c.wood_pore_color_power,a.wood_pore_depth.value=c.wood_pore_depth,a.wood_use_rays.value=c.wood_use_rays,a.wood_ray_color_power.value=c.wood_ray_color_power,a.wood_ray_seg_length_z.value=c.wood_ray_seg_length_z,a.wood_ray_num_slices.value=c.wood_ray_num_slices,a.wood_ray_ellipse_z2x.value=c.wood_ray_ellipse_z2x,a.wood_ray_ellipse_radius_x.value=c.wood_ray_ellipse_radius_x,a.wood_use_latewood_bump.value=c.wood_use_latewood_bump,a.wood_latewood_bump_depth.value=c.wood_latewood_bump_depth,a.wood_use_groove_roughness.value=c.wood_use_groove_roughness,a.wood_groove_roughness.value=c.wood_groove_roughness,a.wood_diffuse_lobe_weight.value=c.wood_diffuse_lobe_weight,d(a,c,"wood_curly_distortion_map"),null!=a.wood_curly_distortion_map.value&&(a.wood_curly_distortion_map.value.minFilter=b.NearestFilter,a.wood_curly_distortion_map.value.magFilter=b.NearestFilter,a.wood_curly_distortion_enable.value=c.wood_curly_distortion_enable,a.wood_curly_distortion_scale.value=c.wood_curly_distortion_scale);var f=1-c.wood_latewood_ratio,g=c.wood_earlywood_sharpness*f,h=c.wood_latewood_sharpness*c.wood_latewood_ratio,i=f+h;a.wood_ring_fraction.value=new b.Vector4(f,g,h,i),a.wood_fall_rise.value=new b.Vector2(f-g,c.wood_latewood_ratio-h);break;default:b.warn("Unknown prism type: "+c.prismType)}a.envExponentMin.value=c.envExponentMin,a.envExponentMax.value=c.envExponentMax,a.envExponentCount.value=c.envExponentCount}function ea(a,b){a.emissive.value.copy(b.emissive),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function fa(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function ga(a,b){a.ambientLightColor.needsUpdate=b,a.directionalLightColor.needsUpdate=b,a.directionalLightDirection.needsUpdate=b,a.pointLightColor.needsUpdate=b,a.pointLightPosition.needsUpdate=b,a.pointLightDistance.needsUpdate=b,a.spotLightColor.needsUpdate=b,a.spotLightPosition.needsUpdate=b,a.spotLightDistance.needsUpdate=b,a.spotLightDirection.needsUpdate=b,a.spotLightAngleCos.needsUpdate=b,a.spotLightExponent.needsUpdate=b,a.hemisphereLightSkyColor.needsUpdate=b,a.hemisphereLightGroundColor.needsUpdate=b,a.hemisphereLightDirection.needsUpdate=b}function ha(a,b,c){La.multiplyMatrices(c.matrixWorldInverse,b.matrixWorld),Pa.uniformMatrix4fv(a.modelViewMatrix,!1,La.elements),a.normalMatrix&&(Ma.getNormalMatrix(La),Pa.uniformMatrix3fv(a.normalMatrix,!1,Ma.elements))}function ia(){var a=bb;return a>=ub&&b.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+ub),bb+=1,a}function ja(a){for(var c,d,e,f=0,g=a.length;f<g;f++){var h=a[f][0];if(!1!==h.needsUpdate){var i,j,k=h.type,l=h.value,m=a[f][1];switch(k){case"1i":Pa.uniform1i(m,l);break;case"1f":Pa.uniform1f(m,l);break;case"2f":Pa.uniform2f(m,l[0],l[1]);break;case"3f":Pa.uniform3f(m,l[0],l[1],l[2]);break;case"4f":Pa.uniform4f(m,l[0],l[1],l[2],l[3]);break;case"1iv":Pa.uniform1iv(m,l);break;case"3iv":Pa.uniform3iv(m,l);break;case"1fv":Pa.uniform1fv(m,l);break;case"2fv":Pa.uniform2fv(m,l);break;case"3fv":Pa.uniform3fv(m,l);break;case"4fv":Pa.uniform4fv(m,l);break;case"Matrix3fv":Pa.uniformMatrix3fv(m,!1,l);break;case"Matrix4fv":Pa.uniformMatrix4fv(m,!1,l);break;case"i":Pa.uniform1i(m,l);break;case"f":Pa.uniform1f(m,l);break;case"v2":Pa.uniform2f(m,l.x,l.y);break;case"v3":Pa.uniform3f(m,l.x,l.y,l.z);break;case"v4":Pa.uniform4f(m,l.x,l.y,l.z,l.w);break;case"c":Pa.uniform3f(m,l.r,l.g,l.b);break;case"iv1":Pa.uniform1iv(m,l);break;case"iv":Pa.uniform3iv(m,l);break;case"fv1":Pa.uniform1fv(m,l);break;case"fv":Pa.uniform3fv(m,l);break;case"v2v":for(void 0===h._array&&(h._array=new Float32Array(2*l.length)),i=0,j=l.length;i<j;i++)e=2*i,h._array[e]=l[i].x,h._array[e+1]=l[i].y;Pa.uniform2fv(m,h._array);break;case"v3v":for(void 0===h._array&&(h._array=new Float32Array(3*l.length)),i=0,j=l.length;i<j;i++)e=3*i,h._array[e]=l[i].x,h._array[e+1]=l[i].y,h._array[e+2]=l[i].z;Pa.uniform3fv(m,h._array);break;case"v4v":for(void 0===h._array&&(h._array=new Float32Array(4*l.length)),i=0,j=l.length;i<j;i++)e=4*i,h._array[e]=l[i].x,h._array[e+1]=l[i].y,h._array[e+2]=l[i].z,h._array[e+3]=l[i].w;Pa.uniform4fv(m,h._array);break;case"m3":Pa.uniformMatrix3fv(m,!1,l.elements);break;case"m3v":for(void 0===h._array&&(h._array=new Float32Array(9*l.length)),i=0,j=l.length;i<j;i++)l[i].flattenToArrayOffset(h._array,9*i);Pa.uniformMatrix3fv(m,!1,h._array);break;case"m4":Pa.uniformMatrix4fv(m,!1,l.elements);break;case"m4v":for(void 0===h._array&&(h._array=new Float32Array(16*l.length)),i=0,j=l.length;i<j;i++)l[i].flattenToArrayOffset(h._array,16*i);Pa.uniformMatrix4fv(m,!1,h._array);break;case"t":if(c=l,d=ia(),Pa.uniform1i(m,d),!c)continue;Array.isArray(c.image)&&6===c.image.length||c instanceof b.CubeTexture?c.needsUpdate?oa(c,d):(Pa.activeTexture(Pa.TEXTURE0+d),Pa.bindTexture(Pa.TEXTURE_CUBE_MAP,c.__webglTextureCube)):c instanceof b.WebGLRenderTargetCube?pa(c,d):Ta.setTexture(c,d);break;case"tv":for(void 0===h._array&&(h._array=[]),i=0,j=h.value.length;i<j;i++)h._array[i]=ia();for(Pa.uniform1iv(m,h._array),i=0,j=h.value.length;i<j;i++)c=h.value[i],d=h._array[i],c&&Ta.setTexture(c,d);break;default:b.warn("THREE.WebGLRenderer: Unknown uniform type: "+k)}}}}function ka(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function la(a){var c,d,e,f,g,h,i,j,k=0,l=0,m=0,n=nb,o=n.directional.colors,p=n.directional.positions,q=n.point.colors,r=n.point.positions,s=n.point.distances,t=n.spot.colors,u=n.spot.positions,v=n.spot.distances,w=n.spot.directions,x=n.spot.anglesCos,y=n.spot.exponents,z=n.hemi.skyColors,A=n.hemi.groundColors,B=n.hemi.positions,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0,N=0;for(c=0,d=a.length;c<d;c++)if(e=a[c],!e.onlyShadow)if(f=e.color,i=e.intensity,j=e.distance,e instanceof b.AmbientLight){if(!e.visible)continue;k+=f.r,l+=f.g,m+=f.b}else if(e instanceof b.DirectionalLight){if(G+=1,!e.visible)continue;lb.setFromMatrixPosition(e.matrixWorld),kb.setFromMatrixPosition(e.target.matrixWorld),lb.sub(kb),lb.normalize(),K=3*C,p[K]=lb.x,p[K+1]=lb.y,p[K+2]=lb.z,ka(o,K,f,i),C+=1}else if(e instanceof b.PointLight){if(H+=1,!e.visible)continue;L=3*D,ka(q,L,f,i),kb.setFromMatrixPosition(e.matrixWorld),r[L]=kb.x,r[L+1]=kb.y,r[L+2]=kb.z,s[D]=j,D+=1}else if(e instanceof b.SpotLight){if(I+=1,!e.visible)continue;M=3*E,ka(t,M,f,i),kb.setFromMatrixPosition(e.matrixWorld),u[M]=kb.x,u[M+1]=kb.y,u[M+2]=kb.z,v[E]=j,lb.copy(kb),kb.setFromMatrixPosition(e.target.matrixWorld),lb.sub(kb),lb.normalize(),w[M]=lb.x,w[M+1]=lb.y,w[M+2]=lb.z,x[E]=Math.cos(e.angle),y[E]=e.exponent,E+=1}else if(e instanceof b.HemisphereLight){if(J+=1,!e.visible)continue;lb.setFromMatrixPosition(e.matrixWorld),lb.normalize(),N=3*F,B[N]=lb.x,B[N+1]=lb.y,B[N+2]=lb.z,g=e.color,h=e.groundColor,ka(z,N,g,i),ka(A,N,h,i),F+=1}for(c=3*C,d=Math.max(o.length,3*G);c<d;c++)o[c]=0;for(c=3*D,d=Math.max(q.length,3*H);c<d;c++)q[c]=0;for(c=3*E,d=Math.max(t.length,3*I);c<d;c++)t[c]=0;for(c=3*F,d=Math.max(z.length,3*J);c<d;c++)z[c]=0;for(c=3*F,d=Math.max(A.length,3*J);c<d;c++)A[c]=0;n.directional.length=C,n.point.length=D,n.spot.length=E,n.hemi.length=F,n.ambient[0]=k,n.ambient[1]=l,n.ambient[2]=m}function ma(a,c,d){var e;d?(Pa.texParameteri(a,Pa.TEXTURE_WRAP_S,sa(c.wrapS)),Pa.texParameteri(a,Pa.TEXTURE_WRAP_T,sa(c.wrapT)),Pa.texParameteri(a,Pa.TEXTURE_MAG_FILTER,sa(c.magFilter)),Pa.texParameteri(a,Pa.TEXTURE_MIN_FILTER,sa(c.minFilter))):(Pa.texParameteri(a,Pa.TEXTURE_WRAP_S,Pa.CLAMP_TO_EDGE),Pa.texParameteri(a,Pa.TEXTURE_WRAP_T,Pa.CLAMP_TO_EDGE),c.wrapS===b.ClampToEdgeWrapping&&c.wrapT===b.ClampToEdgeWrapping||b.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+c.sourceFile+" )"),Pa.texParameteri(a,Pa.TEXTURE_MAG_FILTER,ra(c.magFilter)),Pa.texParameteri(a,Pa.TEXTURE_MIN_FILTER,ra(c.minFilter)),c.minFilter!==b.NearestFilter&&c.minFilter!==b.LinearFilter&&b.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+c.sourceFile+" )")),(e=qb.get("EXT_texture_filter_anisotropic"))&&c.type!==b.FloatType&&c.type!==b.HalfFloatType&&(c.anisotropy>1||c.__oldAnisotropy)&&(Pa.texParameterf(a,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(c.anisotropy,Ta.getMaxAnisotropy())),c.__oldAnisotropy=c.anisotropy)}function na(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),e=Math.floor(a.height*b/c),f=document.createElement("canvas");return f.width=d,f.height=e,f.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d,e),f}function oa(a,c){if(6===a.image.length)if(a.needsUpdate){a.__webglTextureCube||(a.addEventListener("dispose",Mb),a.__webglTextureCube=Pa.createTexture(),Ta.info.memory.textures++),Pa.activeTexture(Pa.TEXTURE0+c),Pa.bindTexture(Pa.TEXTURE_CUBE_MAP,a.__webglTextureCube),Pa.pixelStorei(Pa.UNPACK_FLIP_Y_WEBGL,a.flipY);var d,e=a instanceof b.CompressedTexture,f=a.image[0]instanceof b.DataTexture,g=[];for(d=0;d<6;d++)!Ta.autoScaleCubemaps||e||f?g[d]=f?a.image[d].image:a.image[d]:g[d]=na(a.image[d],xb);var h=g[0],i=b.Math.isPowerOfTwo(h.width)&&b.Math.isPowerOfTwo(h.height),j=sa(a.format),k=sa(a.type);for(ma(Pa.TEXTURE_CUBE_MAP,a,i),d=0;d<6;d++)if(e)for(var l,m=g[d].mipmaps,n=0,o=m.length;n<o;n++)l=m[n],a.format!==b.RGBAFormat&&a.format!==b.RGBFormat?Gb().indexOf(j)>-1?Pa.compressedTexImage2D(Pa.TEXTURE_CUBE_MAP_POSITIVE_X+d,n,j,l.width,l.height,0,l.data):b.warn("Attempt to load unsupported compressed texture format"):Pa.texImage2D(Pa.TEXTURE_CUBE_MAP_POSITIVE_X+d,n,j,l.width,l.height,0,j,k,l.data);else f?Pa.texImage2D(Pa.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,j,g[d].width,g[d].height,0,j,k,g[d].data):Pa.texImage2D(Pa.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,j,j,k,g[d]);a.generateMipmaps&&i&&Pa.generateMipmap(Pa.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Pa.activeTexture(Pa.TEXTURE0+c),Pa.bindTexture(Pa.TEXTURE_CUBE_MAP,a.__webglTextureCube)}function pa(a,b){Pa.activeTexture(Pa.TEXTURE0+b),Pa.bindTexture(Pa.TEXTURE_CUBE_MAP,a.__webglTexture)}function qa(a){Pa.bindTexture(Pa.TEXTURE_2D,a.__webglTexture),Pa.generateMipmap(Pa.TEXTURE_2D),Pa.bindTexture(Pa.TEXTURE_2D,null)}function ra(a){return a===b.NearestFilter||a===b.NearestMipMapNearestFilter||a===b.NearestMipMapLinearFilter?Pa.NEAREST:Pa.LINEAR}function sa(a){var c;if(a===b.RepeatWrapping)return Pa.REPEAT;if(a===b.ClampToEdgeWrapping)return Pa.CLAMP_TO_EDGE;if(a===b.MirroredRepeatWrapping)return Pa.MIRRORED_REPEAT;if(a===b.NearestFilter)return Pa.NEAREST;if(a===b.NearestMipMapNearestFilter)return Pa.NEAREST_MIPMAP_NEAREST;if(a===b.NearestMipMapLinearFilter)return Pa.NEAREST_MIPMAP_LINEAR;if(a===b.LinearFilter)return Pa.LINEAR;if(a===b.LinearMipMapNearestFilter)return Pa.LINEAR_MIPMAP_NEAREST;if(a===b.LinearMipMapLinearFilter)return Pa.LINEAR_MIPMAP_LINEAR;if(a===b.UnsignedByteType)return Pa.UNSIGNED_BYTE;if(a===b.UnsignedShort4444Type)return Pa.UNSIGNED_SHORT_4_4_4_4;if(a===b.UnsignedShort5551Type)return Pa.UNSIGNED_SHORT_5_5_5_1;if(a===b.UnsignedShort565Type)return Pa.UNSIGNED_SHORT_5_6_5;if(a===b.ByteType)return Pa.BYTE;if(a===b.ShortType)return Pa.SHORT;if(a===b.UnsignedShortType)return Pa.UNSIGNED_SHORT;if(a===b.IntType)return Pa.INT;if(a===b.UnsignedIntType)return Pa.UNSIGNED_INT;if(a===b.FloatType)return Pa.FLOAT;if(a===b.HalfFloatType)return 36193;if(a===b.AlphaFormat)return Pa.ALPHA;if(a===b.RGBFormat)return Pa.RGB;if(a===b.RGBAFormat)return Pa.RGBA;if(a===b.LuminanceFormat)return Pa.LUMINANCE;if(a===b.LuminanceAlphaFormat)return Pa.LUMINANCE_ALPHA;if(a===b.AddEquation)return Pa.FUNC_ADD;if(a===b.SubtractEquation)return Pa.FUNC_SUBTRACT;if(a===b.ReverseSubtractEquation)return Pa.FUNC_REVERSE_SUBTRACT;if(a===b.ZeroFactor)return Pa.ZERO;if(a===b.OneFactor)return Pa.ONE;if(a===b.SrcColorFactor)return Pa.SRC_COLOR;if(a===b.OneMinusSrcColorFactor)return Pa.ONE_MINUS_SRC_COLOR;if(a===b.SrcAlphaFactor)return Pa.SRC_ALPHA;if(a===b.OneMinusSrcAlphaFactor)return Pa.ONE_MINUS_SRC_ALPHA;if(a===b.DstAlphaFactor)return Pa.DST_ALPHA;if(a===b.OneMinusDstAlphaFactor)return Pa.ONE_MINUS_DST_ALPHA;if(a===b.DstColorFactor)return Pa.DST_COLOR;if(a===b.OneMinusDstColorFactor)return Pa.ONE_MINUS_DST_COLOR;if(a===b.SrcAlphaSaturateFactor)return Pa.SRC_ALPHA_SATURATE;if(null!==(c=qb.get("WEBGL_compressed_texture_s3tc"))){if(a===b.RGB_S3TC_DXT1_Format)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT1_Format)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===b.RGBA_S3TC_DXT3_Format)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===b.RGBA_S3TC_DXT5_Format)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(c=qb.get("WEBGL_compressed_texture_pvrtc"))){if(a===b.RGB_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===b.RGB_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===b.RGBA_PVRTC_4BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===b.RGBA_PVRTC_2BPPV1_Format)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(c=qb.get("EXT_blend_minmax"))){if(a===b.MinEquation)return c.MIN_EXT;if(a===b.MaxEquation)return c.MAX_EXT}return 0}function ta(a){for(var c=0,d=0,e=0,f=0,g=0,h=a.length;g<h;g++){var i=a[g];i.onlyShadow||(i instanceof b.DirectionalLight&&c++,i instanceof b.PointLight&&d++,i instanceof b.SpotLight&&e++,i instanceof b.HemisphereLight&&f++)}return{directional:c,point:d,spot:e,hemi:f}}b.log("THREE.WebGLRenderer",b.REVISION),a=a||{}
;var ua=void 0!==a.canvas?a.canvas:document.createElement("canvas"),va=window.devicePixelRatio||1,wa=void 0!==a.precision?a.precision:"highp",xa=wa,ya=void 0!==a.alpha&&a.alpha,za=void 0===a.premultipliedAlpha||a.premultipliedAlpha,Aa=void 0!==a.antialias&&a.antialias,Ba=void 0===a.stencil||a.stencil,Ca=void 0===a.preserveDrawingBuffer||a.preserveDrawingBuffer,Da=void 0!==a.logarithmicDepthBuffer&&a.logarithmicDepthBuffer,Ea=!1,Fa=new b.Color(0),Ga=0,Ha=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS"),Ia=[],Ja={},Ka=[],La=new b.Matrix4,Ma=new b.Matrix3,Na=[],Oa=[];this.domElement=ua,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Pa,Qa,Ra,Sa,Ta=this,Ua=[],Va=null,Wa=null,Xa=-1,Ya=null,Za="",$a=0,_a="",ab="",bb=0,cb=0,db=0,eb=ua.width,fb=ua.height,gb={},hb=new b.Frustum,ib=new b.Matrix4,jb=new b.Matrix4,kb=new b.Vector3,lb=new b.Vector3,mb=!0,nb={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var ob={alpha:ya,premultipliedAlpha:za,antialias:Aa,stencil:Ba,preserveDrawingBuffer:Ca};if(null===(Pa=ua.getContext("webgl",ob)||ua.getContext("experimental-webgl",ob)))throw null!==ua.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";0==Pa.getShaderPrecisionFormat(Pa.FRAGMENT_SHADER,Pa.HIGH_FLOAT).precision&&(xa="mediump"),Pa=Li(Pa),ua.addEventListener("webglcontextlost",function(a){a.preventDefault(),tb(),sb(),Ja={}},!1)}catch(a){return void b.error(a)}var pb=new b.WebGLState(Pa,sa);void 0===Pa.getShaderPrecisionFormat&&(Pa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var qb=new b.WebGLExtensions(Pa);qb.get("OES_texture_float"),qb.get("OES_texture_float_linear"),qb.get("OES_texture_half_float"),qb.get("OES_texture_half_float_linear"),qb.get("OES_standard_derivatives"),qb.get("EXT_shader_texture_lod"),qb.get("EXT_texture_filter_anisotropic"),qb.get("WEBGL_compressed_texture_s3tc"),Qa=qb.get("WEBGL_draw_buffers"),Ra=qb.get("ANGLE_instanced_arrays"),Sa=qb.get("OES_vertex_array_object"),Da&&qb.get("EXT_frag_depth");var rb=function(a,b,c,d){!0===za&&(a*=d,b*=d,c*=d),Pa.clearColor(a,b,c,d)},sb=function(){Pa.clearColor(0,0,0,1),Pa.clearDepth(1),Pa.clearStencil(0),Pa.enable(Pa.DEPTH_TEST),Pa.depthFunc(Pa.LEQUAL),Pa.frontFace(Pa.CCW),Pa.cullFace(Pa.BACK),Pa.enable(Pa.CULL_FACE),Pa.enable(Pa.BLEND),Pa.blendEquation(Pa.FUNC_ADD),Pa.blendFunc(Pa.SRC_ALPHA,Pa.ONE_MINUS_SRC_ALPHA),Pa.viewport(cb,db,eb,fb),rb(Fa.r,Fa.g,Fa.b,Ga)},tb=function(){Va=null,Ya=null,Za="",Xa=-1,mb=!0,pb.reset(),pb.disableUnusedAttributes()};sb(),this.context=Pa,this.state=pb;for(var ub=Pa.getParameter(Pa.MAX_TEXTURE_IMAGE_UNITS),vb=Pa.getParameter(Pa.MAX_VERTEX_TEXTURE_IMAGE_UNITS),wb=Pa.getParameter(Pa.MAX_TEXTURE_SIZE),xb=Pa.getParameter(Pa.MAX_CUBE_MAP_TEXTURE_SIZE),yb=vb>0,zb=Pa.getShaderPrecisionFormat(Pa.VERTEX_SHADER,Pa.HIGH_FLOAT),Ab=Pa.getShaderPrecisionFormat(Pa.VERTEX_SHADER,Pa.MEDIUM_FLOAT),Bb=Pa.getShaderPrecisionFormat(Pa.FRAGMENT_SHADER,Pa.HIGH_FLOAT),Cb=Pa.getShaderPrecisionFormat(Pa.FRAGMENT_SHADER,Pa.MEDIUM_FLOAT),Db=new Uint8Array(16),Eb=0;Eb<4;Eb++)Db[4*Eb]=Db[4*Eb+1]=Db[4*Eb+2]=0,Db[4*Eb+3]=255;var Fb=new b.DataTexture(Db,2,2,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter);Fb.needsUpdate=!0;var Gb=function(){var a;return function(){if(void 0!==a)return a;if(a=[],qb.get("WEBGL_compressed_texture_pvrtc")||qb.get("WEBGL_compressed_texture_s3tc"))for(var b=Pa.getParameter(Pa.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),Hb=zb.precision>0,Ib=Ab.precision>0;"highp"!==wa||Hb||(Ib?(wa="mediump",b.warn("WebGLRenderer: highp not supported, using mediump")):(wa="lowp",b.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==wa||Ib||(wa="lowp",b.warn("WebGLRenderer: mediump not supported, using lowp")),Hb=Bb.precision>0,Ib=Cb.precision>0,"highp"!==xa||Hb||(Ib?(xa="mediump",b.warn("WebGLRenderer: highp not supported, using mediump")):(xa="lowp",b.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==xa||Ib||(xa="lowp",b.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Pa},this.forceContextLoss=function(){qb.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return yb},this.supportsFloatTextures=function(){return qb.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return qb.get("OES_texture_half_float_linear")},this.supportsStandardDerivatives=function(){return qb.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return qb.get("WEBGL_compressed_texture_s3tc")},this.supportsMRT=function(){return!Ha&&Qa},this.supportsInstancedArrays=function(){return!!Ra},this.supportsBlendMinMax=function(){return qb.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=qb.get("EXT_texture_filter_anisotropic");return a=null!==b?Pa.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPixelRatio=function(){return va},this.setPixelRatio=function(a){va=a},this.getCurrentFramebuffer=function(){return Wa},this.setIdBufferSource=function(a){switch(a){case 0:Ea=!1;break;case 1:Ea=!0;break;default:return!1}return!0},this.setSize=function(a,b,c){ua.width=a*va,ua.height=b*va,!1!==c&&(ua.style.width=a+"px",ua.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){cb=a*va,db=b*va,eb=c*va,fb=d*va,Pa.viewport(cb,db,eb,fb)};var Jb=[];this.pushViewport=function(){Jb.push(cb),Jb.push(db),Jb.push(eb),Jb.push(fb)},this.popViewport=function(){var a=Jb.length-4;cb=Jb[a],db=Jb[a+1],eb=Jb[a+2],fb=Jb[a+3],Pa.viewport(cb,db,eb,fb),Jb.length=a},this.setScissor=function(a,b,c,d){Pa.scissor(a*va,b*va,c*va,d*va)},this.enableScissorTest=function(a){a?Pa.enable(Pa.SCISSOR_TEST):Pa.disable(Pa.SCISSOR_TEST)},this.getClearColor=function(){return Fa},this.setClearColor=function(a,b){Fa.set(a),Ga=void 0!==b?b:1,rb(Fa.r,Fa.g,Fa.b,Ga)},this.getClearAlpha=function(){return Ga},this.setClearAlpha=function(a){Ga=a,rb(Fa.r,Fa.g,Fa.b,Ga)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Pa.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Pa.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Pa.STENCIL_BUFFER_BIT),Pa.clear(d)},this.clearColor=function(){Pa.clear(Pa.COLOR_BUFFER_BIT)},this.clearDepth=function(){Pa.clear(Pa.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Pa.clear(Pa.STENCIL_BUFFER_BIT)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.resetGLState=tb;var Kb=function a(b){b.target.traverse(function(b){b.removeEventListener("remove",a),R(b)})},Lb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Qb(c)},Mb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Rb(c),Ta.info.memory.textures--},Nb=function a(b){var c=b.target;c.removeEventListener("dispose",a),Sb(c),Ta.info.memory.textures--},Ob=function a(b){var c=b.target;c.removeEventListener("dispose",a),Tb(c)},Pb=function(a){if(void 0!==a.__webglVertexBuffer&&(Pa.deleteBuffer(a.__webglVertexBuffer),a.__webglVertexBuffer=void 0),void 0!==a.__webglNormalBuffer&&(Pa.deleteBuffer(a.__webglNormalBuffer),a.__webglNormalBuffer=void 0),void 0!==a.__webglTangentBuffer&&(Pa.deleteBuffer(a.__webglTangentBuffer),a.__webglTangentBuffer=void 0),void 0!==a.__webglColorBuffer&&(Pa.deleteBuffer(a.__webglColorBuffer),a.__webglColorBuffer=void 0),void 0!==a.__webglUVBuffer&&(Pa.deleteBuffer(a.__webglUVBuffer),a.__webglUVBuffer=void 0),void 0!==a.__webglUV2Buffer&&(Pa.deleteBuffer(a.__webglUV2Buffer),a.__webglUV2Buffer=void 0),void 0!==a.__webglSkinIndicesBuffer&&(Pa.deleteBuffer(a.__webglSkinIndicesBuffer),a.__webglSkinIndicesBuffer=void 0),void 0!==a.__webglSkinWeightsBuffer&&(Pa.deleteBuffer(a.__webglSkinWeightsBuffer),a.__webglSkinWeightsBuffer=void 0),void 0!==a.__webglFaceBuffer&&(Pa.deleteBuffer(a.__webglFaceBuffer),a.__webglFaceBuffer=void 0),void 0!==a.__webglLineBuffer&&(Pa.deleteBuffer(a.__webglLineBuffer),a.__webglLineBuffer=void 0),void 0!==a.__webglLineDistanceBuffer&&(Pa.deleteBuffer(a.__webglLineDistanceBuffer),a.__webglLineDistanceBuffer=void 0),void 0!==a.__webglCustomAttributesList){for(var b in a.__webglCustomAttributesList)Pa.deleteBuffer(a.__webglCustomAttributesList[b].buffer);a.__webglCustomAttributesList=void 0}Ta.info.memory.geometries--},Qb=function(a){a.__webglInit=void 0;var c,d,e,f;if(a instanceof b.BufferGeometry){if(void 0!==a.vbbuffer&&(Pa.deleteBuffer(a.vbbuffer),a.vbbuffer=void 0),void 0!==a.ibbuffer&&(Pa.deleteBuffer(a.ibbuffer),a.ibbuffer=void 0),void 0!==a.iblinesbuffer&&(Pa.deleteBuffer(a.iblinesbuffer),a.iblinesbuffer=void 0),a.vaos){for(c=0;c<a.vaos.length;c++)Sa.deleteVertexArrayOES(a.vaos[c].vao);a.vaos=void 0}var g=a.attributes;for(var h in g)void 0!==g[h].buffer&&(Pa.deleteBuffer(g[h].buffer),g[h].buffer=void 0);Ta.info.memory.geometries--}else{var i=Yb[a.id];if(void 0!==i){for(c=0,d=i.length;c<d;c++){var j=i[c];if(void 0!==j.numMorphTargets){for(e=0,f=j.numMorphTargets;e<f;e++)Pa.deleteBuffer(j.__webglMorphTargetsBuffers[e]);delete j.__webglMorphTargetsBuffers}if(void 0!==j.numMorphNormals){for(e=0,f=j.numMorphNormals;e<f;e++)Pa.deleteBuffer(j.__webglMorphNormalsBuffers[e]);delete j.__webglMorphNormalsBuffers}Pb(j)}delete Yb[a.id]}else Pb(a)}};this.deallocateGeometry=Qb;var Rb=function(a){if(a.__webglTextureCube)Pa.deleteTexture(a.__webglTextureCube),a.__webglTextureCube=void 0;else{if(!a.__webglInit)return;Pa.deleteTexture(a.__webglTexture),a.__webglInit=void 0,a.__webglTexture=void 0}},Sb=function(a){a&&a.__webglTexture&&(Pa.deleteTexture(a.__webglTexture),Pa.deleteFramebuffer(a.__webglFramebuffer),void 0!==a.__webglRenderbuffer&&Pa.deleteRenderbuffer(a.__webglRenderbuffer))},Tb=function(a){var b=!1;a.program=void 0,a.programs.forEach(function(a){var c;if(void 0!==a&&void 0!=(c=a.program)){var d,e,f;for(d=0,e=Ua.length;d<e;d++)if((f=Ua[d])&&f.program===c){f.usedTimes--,0===f.usedTimes&&(Ua[d]=void 0,Pa.deleteProgram(c),Ta.info.memory.programs--,b=!0);break}}},!1),a.programs.length=0,b&&(Ua=Ua.filter(function(a){return void 0!==a}))};this.renderBufferDirect=function(a,c,d,e,f,g,h){if(!1!==e.visible&&(!e.isEdgeMaterial||f.iblines)){r(g.geometry);var i=W(a,c,d,e,g),j=f.attributes,k=!1,l=e.wireframe?1:0,m="direct_"+f.id+(h?"/"+h:"")+"_"+i.id+"_"+l;m!==Za&&(Za=m,k=!0);var n=t(e,i,f,h||0);if(k=k&&!n,k&&pb.initAttributes(),g instanceof b.Mesh){var o,p=j.index;if(p){var q,s,u=p.array?p.array:f.ib;e.isEdgeMaterial&&(p=j.indexlines,u=f.iblines),p.bytesPerItem?4===(s=p.bytesPerItem)&&qb.get("OES_element_index_uint"):s=u instanceof Uint32Array&&qb.get("OES_element_index_uint")?4:2,q=4===s?Pa.UNSIGNED_INT:Pa.UNSIGNED_SHORT;var w=e.isEdgeMaterial?null:f.offsets;w&&w.length>1&&(k=!0);var x=0;do{var y,z,A;w&&w.length?(y=w[x].index,z=w[x].start,A=w[x].count):(y=0,z=0,A=u.length),k&&v(e,i,f,y,p,h),o=Pa.TRIANGLES,f.isPoints?o=Pa.POINTS:(f.isLines||e.isEdgeMaterial)&&(o=Pa.LINES),f.numInstances?Ra.drawElementsInstancedANGLE(o,A,q,z*s,f.numInstances):Pa.drawElements(o,A,q,z*s)}while(w&&++x<w.length)}else{k&&v(e,i,f,0,void 0,h);var B=f.attributes.position;o=Pa.TRIANGLES,f.isPoints?o=Pa.POINTS:(f.isLines||e.isEdgeMaterial)&&(o=Pa.LINES),f.numInstances?Ra.drawArraysInstancedANGLE(o,0,B.array.length/3,f.numInstances):Pa.drawArrays(o,0,B.array.length/B.itemSize)}}else b.log("Only THREE.Mesh can be rendered by the Firefly renderer. Use THREE.Mesh to draw lines.");n&&Sa.bindVertexArrayOES(null)}},this.renderBuffer=function(a,c,d,e,f,g){if(!1!==e.visible){O(g);var h=W(a,c,d,e,g),i=h.attributes,j=!1,k=e.wireframe?1:0,l=f.id+"_"+h.id+"_"+k;if(l!==Za&&(Za=l,j=!0),j&&pb.initAttributes(),!e.morphTargets&&i.position>=0&&j&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglVertexBuffer),pb.enableAttribute(i.position),Pa.vertexAttribPointer(i.position,3,Pa.FLOAT,!1,0,0)),j){if(f.__webglCustomAttributesList)for(var m=0,n=f.__webglCustomAttributesList.length;m<n;m++){var o=f.__webglCustomAttributesList[m];i[o.buffer.belongsToAttribute]>=0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,o.buffer),pb.enableAttribute(i[o.buffer.belongsToAttribute]),Pa.vertexAttribPointer(i[o.buffer.belongsToAttribute],o.size,Pa.FLOAT,!1,0,0))}i.color>=0&&(g.geometry.colors.length>0||g.geometry.faces.length>0?(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglColorBuffer),pb.enableAttribute(i.color),Pa.vertexAttribPointer(i.color,3,Pa.FLOAT,!1,0,0)):e.defaultAttributeValues&&Pa.vertexAttrib3fv(i.color,e.defaultAttributeValues.color)),i.normal>=0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglNormalBuffer),pb.enableAttribute(i.normal),Pa.vertexAttribPointer(i.normal,3,Pa.FLOAT,!1,0,0)),i.tangent>=0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglTangentBuffer),pb.enableAttribute(i.tangent),Pa.vertexAttribPointer(i.tangent,4,Pa.FLOAT,!1,0,0)),i.uv>=0&&(g.geometry.faceVertexUvs[0]?(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglUVBuffer),pb.enableAttribute(i.uv),Pa.vertexAttribPointer(i.uv,2,Pa.FLOAT,!1,0,0)):e.defaultAttributeValues&&Pa.vertexAttrib2fv(i.uv,e.defaultAttributeValues.uv)),i.uv2>=0&&(g.geometry.faceVertexUvs[1]?(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglUV2Buffer),pb.enableAttribute(i.uv2),Pa.vertexAttribPointer(i.uv2,2,Pa.FLOAT,!1,0,0)):e.defaultAttributeValues&&Pa.vertexAttrib2fv(i.uv2,e.defaultAttributeValues.uv2)),i.lineDistance>=0&&(Pa.bindBuffer(Pa.ARRAY_BUFFER,f.__webglLineDistanceBuffer),pb.enableAttribute(i.lineDistance),Pa.vertexAttribPointer(i.lineDistance,1,Pa.FLOAT,!1,0,0))}if(pb.disableUnusedAttributes(),g instanceof b.Mesh){var p=f.__typeArray===Uint32Array?Pa.UNSIGNED_INT:Pa.UNSIGNED_SHORT;e.wireframe?(pb.setLineWidth(e.wireframeLinewidth*va),j&&Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),Pa.drawElements(Pa.LINES,f.__webglLineCount,p,0)):(j&&Pa.bindBuffer(Pa.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),Pa.drawElements(Pa.TRIANGLES,f.__webglFaceCount,p,0))}else if(g instanceof b.Line){var q=g.mode===b.LineStrip?Pa.LINE_STRIP:Pa.LINES;pb.setLineWidth(e.linewidth*va),Pa.drawArrays(q,0,f.__webglLineCount)}else g instanceof b.PointCloud&&Pa.drawArrays(Pa.POINTS,0,f.__webglPointCount)}},this.render=function(a,c,d,e,f){if(c instanceof b.Camera==!1)return void b.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");Za="",Xa=-1,Ya=null,void 0!==f&&(Ia.length=0,mb=!0);var g=a.fog;!0===a.autoUpdate&&a.updateMatrixWorld(),void 0===c.parent&&c.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),c.worldUpTransform?jb.multiplyMatrices(c.worldUpTransform,c.matrixWorld):jb.copy(c.matrixWorld),ib.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),hb.setFromMatrix(ib);var h=a instanceof A&&a.renderImmediate;if(h||(Na.length=0,Oa.length=0,B(a,!0===Ta.sortObjects,!0===a.forceVisible),!0===Ta.sortObjects&&(Na.sort(x),Oa.sort(w))),mb&&(f&&f.length&&(Ia=f.slice()),la(Ia)),this.setRenderTarget(d),this.resetGLState(),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a.overrideMaterial){var i=a.overrideMaterial;V(i),h?H(a,"",c,Ia,g,i):(D(Na,c,Ia,g,i),D(Oa,c,Ia,g,i))}else h?H(a,"",c,Ia,g,null):(pb.setBlending(b.NoBlending),D(Na,c,Ia,g,null),D(Oa,c,Ia,g,null));d&&d.generateMipmaps&&d.minFilter!==b.NearestFilter&&d.minFilter!==b.LinearFilter&&qa(d),this.resetGLState(),pb.setDepthTest(!0),pb.setDepthWrite(!0)},this.clearBlend=function(){pb.setBlending(b.NoBlending)},this.setProgramPrefix=function(a,b,c){$a=a,_a=b,ab=c},this.getProgramPrefix=function(){return{programPrefix:$a,vertexPrefix:_a,fragmentPrefix:ab}};var Ub,Vb,Wb,Xb,Yb={},Zb=0,$b={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"firefly_basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"firefly_basic",LineDashedMaterial:"dashed",PointCloudMaterial:"firefly_basic"};this.setFaceCulling=function(a,c){a===b.CullFaceNone?Pa.disable(Pa.CULL_FACE):(c===b.FrontFaceDirectionCW?Pa.frontFace(Pa.CW):Pa.frontFace(Pa.CCW),a===b.CullFaceBack?Pa.cullFace(Pa.BACK):a===b.CullFaceFront?Pa.cullFace(Pa.FRONT):Pa.cullFace(Pa.FRONT_AND_BACK),Pa.enable(Pa.CULL_FACE))},this.setMaterialFaces=function(a){pb.setDoubleSided(a.side===b.DoubleSide),pb.setFlipSided(a.side===b.BackSide)},this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",Mb),a.__webglTexture=Pa.createTexture(),Ta.info.memory.textures++),Pa.bindTexture(Pa.TEXTURE_2D,a.__webglTexture),Pa.pixelStorei(Pa.UNPACK_FLIP_Y_WEBGL,a.flipY),Pa.pixelStorei(Pa.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),Pa.pixelStorei(Pa.UNPACK_ALIGNMENT,a.unpackAlignment),a.image=na(a.image,wb);var c=a.image,d=b.Math.isPowerOfTwo(c.width)&&b.Math.isPowerOfTwo(c.height),e=sa(a.format),f=sa(a.type);ma(Pa.TEXTURE_2D,a,d);var g,h,i,j=a.mipmaps;if(a instanceof b.DataTexture)if(j.length>0&&d){for(h=0,i=j.length;h<i;h++)g=j[h],Pa.texImage2D(Pa.TEXTURE_2D,h,e,g.width,g.height,0,e,f,g.data);a.generateMipmaps=!1}else Pa.texImage2D(Pa.TEXTURE_2D,0,e,c.width,c.height,0,e,f,c.data);else if(a instanceof b.CompressedTexture){for(h=0,i=j.length;h<i;h++)g=j[h],a.format!==b.RGBAFormat&&a.format!==b.RGBFormat?Gb().indexOf(e)>-1?Pa.compressedTexImage2D(Pa.TEXTURE_2D,h,e,g.width,g.height,0,g.data):b.warn("Attempt to load unsupported compressed texture format"):Pa.texImage2D(Pa.TEXTURE_2D,h,e,g.width,g.height,0,e,f,g.data);if(j.length>1&&Gb().indexOf(e)>-1)for(var k,l=g.width>>1,m=g.height>>1,n=j.length;l>=1||m>=1;)k=4==g.width&&4==g.height?g.data:new DataView(g.data.buffer,g.data.byteOffset,g.data.byteLength*(Math.max(l,4)*Math.max(m,4))/(g.width*g.height)),Pa.compressedTexImage2D(Pa.TEXTURE_2D,n,e,Math.max(l,1),Math.max(m,1),0,k),l>>=1,m>>=1,++n}else if(j.length>0&&d){for(h=0,i=j.length;h<i;h++)g=Li(j[h]),Pa.texImage2D(Pa.TEXTURE_2D,h,e,e,f,g);a.generateMipmaps=!1}else Pa.texImage2D(Pa.TEXTURE_2D,0,e,e,f,Li(a.image));a.generateMipmaps&&d&&Pa.generateMipmap(Pa.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()},this.setTexture=function(a,b){Pa.activeTexture(Pa.TEXTURE0+b),a.needsUpdate?Ta.uploadTexture(a):a.__webglTexture?Pa.bindTexture(Pa.TEXTURE_2D,a.__webglTexture):Pa.bindTexture(Pa.TEXTURE_2D,Fb.__webglTexture)},Ta.uploadTexture(Fb),this.initFrameBufferMRT=function(a,c){var d=a[0],e=!1;if(d&&!d.__webglFramebuffer){void 0===d.depthBuffer&&(d.depthBuffer=!0),void 0===d.stencilBuffer&&(d.stencilBuffer=!0),d.__webglFramebuffer=Pa.createFramebuffer(),Pa.bindFramebuffer(Pa.FRAMEBUFFER,d.__webglFramebuffer);var f;d.shareDepthFrom?f=d.__webglRenderbuffer=d.shareDepthFrom.__webglRenderbuffer:d.depthBuffer&&!d.stencilBuffer?(f=d.__webglRenderbuffer=Pa.createRenderbuffer(),Pa.bindRenderbuffer(Pa.RENDERBUFFER,f),Pa.renderbufferStorage(Pa.RENDERBUFFER,Pa.DEPTH_COMPONENT16,d.width,d.height)):d.depthBuffer&&d.stencilBuffer&&(f=d.__webglRenderbuffer=Pa.createRenderbuffer(),Pa.bindRenderbuffer(Pa.RENDERBUFFER,f),Pa.renderbufferStorage(Pa.RENDERBUFFER,Pa.DEPTH_STENCIL,d.width,d.height)),d.depthBuffer&&!d.stencilBuffer?Pa.framebufferRenderbuffer(Pa.FRAMEBUFFER,Pa.DEPTH_ATTACHMENT,Pa.RENDERBUFFER,f):d.depthBuffer&&d.stencilBuffer&&Pa.framebufferRenderbuffer(Pa.FRAMEBUFFER,Pa.DEPTH_STENCIL_ATTACHMENT,Pa.RENDERBUFFER,f),e=!0}var g=Wa;Pa.bindFramebuffer(Pa.FRAMEBUFFER,d.__webglFramebuffer);var h;for(h=0;h<a.length;h++){var i=a[h];if(i&&!i.__webglTexture){var j=b.Math.isPowerOfTwo(i.width)&&b.Math.isPowerOfTwo(i.height),k=sa(i.format),l=sa(i.type);i.addEventListener("dispose",Nb),i.__webglTexture=Pa.createTexture(),Ta.info.memory.textures++,Pa.bindTexture(Pa.TEXTURE_2D,i.__webglTexture),ma(Pa.TEXTURE_2D,i,j),Pa.texImage2D(Pa.TEXTURE_2D,0,k,i.width,i.height,0,k,l,null),j&&i.generateMipmaps&&Pa.generateMipmap(Pa.TEXTURE_2D)}Pa.framebufferTexture2D(Pa.FRAMEBUFFER,Pa.COLOR_ATTACHMENT0+h,Pa.TEXTURE_2D,i&&i.__webglTexture,0)}if(this.supportsMRT()){for(var m=Pa.getParameter(Qa.MAX_COLOR_ATTACHMENTS_WEBGL);h<m;)Pa.framebufferTexture2D(Pa.FRAMEBUFFER,Pa.COLOR_ATTACHMENT0+h,Pa.TEXTURE_2D,null,0),h++;var n=[Qa.COLOR_ATTACHMENT0_WEBGL];for(h=1;h<a.length;h++)n.push(Qa.COLOR_ATTACHMENT0_WEBGL+h);Qa.drawBuffersWEBGL(n)}if(c){var o=Pa.checkFramebufferStatus(Pa.FRAMEBUFFER);o!==Pa.FRAMEBUFFER_COMPLETE&&(b.log("Can't use multiple render targets. Falling back to two passes. "+o),delete d.__webglFramebuffer,c=!1)}return Pa.bindFramebuffer(Pa.FRAMEBUFFER,g),e&&(Pa.bindTexture(Pa.TEXTURE_2D,null),Pa.bindRenderbuffer(Pa.RENDERBUFFER,null),Pa.bindFramebuffer(Pa.FRAMEBUFFER,null)),c},this.setRenderTarget=function(a){var b;if(Array.isArray(a))this.initFrameBufferMRT(a),b=a[0];else if(a){var c=a.__webglFramebuffer;c&&Wa===c||this.initFrameBufferMRT([a]),b=a}var d,e,f,g,h;b?(d=b.__webglFramebuffer,e=b.width,f=b.height,g=0,h=0):(d=null,e=eb,f=fb,g=cb,h=db),d!==Wa&&(Pa.bindFramebuffer(Pa.FRAMEBUFFER,d),Pa.viewport(g,h,e,f),Wa=d)},this.verifyMRTWorks=function(a){return!!this.supportsMRT()&&this.initFrameBufferMRT(a,!0)},this.readRenderTargetPixels=function(a,c,d,e,f,g){if(!(a instanceof b.WebGLRenderTarget))return void b.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(a.__webglFramebuffer){var h=!1;if(a.__webglFramebuffer!==Wa&&(Pa.bindFramebuffer(Pa.FRAMEBUFFER,a.__webglFramebuffer),h=!0),a.canReadPixels||Pa.checkFramebufferStatus(Pa.FRAMEBUFFER)===Pa.FRAMEBUFFER_COMPLETE){var i={};if(g=function(a,c,d,e,f){c.format=Pa.RGBA,c.type=Pa.UNSIGNED_BYTE;var g={format:b.RGBAFormat,type:b.UnsignedByteType,align:Pa.getParameter(Pa.PACK_ALIGNMENT)},h=Uint8Array,i=4,j=1;if(a.type!=b.UnsignedByteType||a.format!==b.RGBAFormat&&a.format!==b.RGBFormat){Pa.getError();if(c.format=Pa.getParameter(Pa.IMPLEMENTATION_COLOR_READ_FORMAT),Pa.getError()!=Pa.NO_ERROR)return null;if(c.type=Pa.getParameter(Pa.IMPLEMENTATION_COLOR_READ_TYPE),Pa.getError()!=Pa.NO_ERROR)return null;switch(c.type){case Pa.FLOAT:h=Float32Array,g.type=b.FloatType,j=4;break;case Pa.UNSIGNED_SHORT_5_6_5:h=Uint16Array,g.type=b.UnsignedShort565Type,j=2;break;case Pa.UNSIGNED_SHORT_4_4_4_4:h=Uint16Array,g.type=b.UnsignedShort4444Type,j=2;break;case Pa.UNSIGNED_SHORT_5_5_5_1:h=Uint16Array,g.type=b.UnsignedShort5551Type,j=2;break;case Pa.UNSIGNED_BYTE:h=Uint8Array,g.type=b.UnsignedByteType,j=1;break;default:var k=qb.get("OES_texture_half_float");if(!k||c.type!=k.HALF_FLOAT_OES)return null;h=Uint16Array,g.type=b.HalfFloatType,j=2}switch(c.format){case Pa.LUMINANCE:i=1,g.format=b.LuminanceFormat;break;case Pa.LUMINANCE_ALPHA:i=2,g.format=b.LuminanceAlphaFormat;break;case Pa.ALPHA:i=1,g.format=b.AlphaFormat;break;case Pa.RGB:g.format=b.RGBFormat,i=3;break;case Pa.RGBA:g.format=b.RGBAFormat,i=4;break;default:return null}}var l=i*d*j;return l=(l+g.align-1&~(g.align-1))/j,l*=e,f?f instanceof h&&f.length>=l?f:null:(f=new h(l),f.lmv__format=g,f)}(a,i,e,f,g)){Pa.readPixels(c,d,e,f,i.format,i.type,g);var j;(j=Pa.getError())!=Pa.NO_ERROR&&(g=null,b.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. readPixels error "+j))}else b.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Buffer format is invalid.")}else b.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.");return h&&Pa.bindFramebuffer(Pa.FRAMEBUFFER,Wa),g}return null}};La.prototype=Object.create(A.prototype),La.prototype.constructor=La,La.prototype.resetVisStatus=function(){this.visibleStats=0},La.prototype.forEach=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=!this.sortByShaderDone,g=e.pageOutGeometryEnabled(),h=e.onDemandLoadingEnabled(),i=this.start,j=this.lastItem;i<j;i++){var k=d?d[i]:i,l=e.getVizmesh(k,this.renderImportance,!0);if(!f||l&&l.material&&l.material.program&&!l.geometry_proxy||(f=!1),h){if(e.isFlagSet(k,Zi)&&b==_i)continue;if(!c&&b&&e.isFlagSet(k,b)&&(l.geometry||(l.geometry=e.requireGeometry(k),k<this.drawOrderRender&&(this.drawOrderRender=k),!l.geometry&&l.geometry_proxy&&(l.geometry=l.geometry_proxy)),l.geometry)){var m=b==_i&&e.isFlagSet(k,$i);if(b==_i){if(!(void 0==this.drawOrderRender||k<this.drawOrderRender))continue;e.setFlagFragment(k,$i,!0)}if(!m&&g&&e.pagingProxy){var n=e.getMaterial(k);n&&e.pagingProxy.onGeomTraversed(l.geometry,n.transparent)}}}!(c||l&&l.geometry)||b&&!e.isFlagSet(k,b)||a(l,k)}f&&this.sortByShader()},La.prototype.applyVisibility=function(){function a(a,c,d,e){var f=!1;k||(k=new b.Box3),d.getWorldBounds(e,k);var g=c.intersectsBox(k);if(a&&g===Gj.OUTSIDE)f=!0;else if(d.pixelCullingEnable()){var h=c.projectedBoxArea(k,g===Gj.CONTAINS);h*=c.areaConv,h<d.pixelCullingThreshold()&&(f=!0)}return f}function c(c,k){if(!c&&d.useThreeMesh)return void(h&&h(k));if(l||a(i,f,d,k)){if(c?c.visible=!1:b.warn("Unexpected null mesh"),e[k]=e[k]&~_i,d.pageOutGeometryEnabled()){var m=d.geomids[k],n=d.geoms.getGeometry(m);d.pagingProxy&&d.pagingProxy.onGeomCulled(n)}}else{var o=this.evalVisbility(g,e,k);c&&(c.visible=!!o),j=j&&!o}}var d,e,f,g,h,i,j,k,l;return function(a,b,k){j=!0,l=!1,f=b,g=a,h=k,d=this.frags;var m=2===g?this.boundingBoxHidden:this.boundingBox,n=f.intersectsBox(m);if(n===Gj.OUTSIDE&&(l=!0),i=n!==Gj.CONTAINS,d.pixelCullingEnable()){var o=this.renderImportance;0==o&&(o=f.projectedBoxArea(m,!i)),o*=f.areaConv,o<d.pixelCullingThreshold()&&(l=!0)}return e=this.frags.vizflags,this.forEach(c.bind(this),null,h),j}}();var Kk=500,Lk=fk.MATERIAL_VARIANT,Mk=function(){var a=null,c=[];return function(d,e,f,g,h,i){a||(a=new b.Matrix4);var j=f[g],k=d.getGeometry(j),l=d.getMaterial(j),m=h-g;if(1==m)return void i.addSingleFragment(d,j);c.length=0;for(var n=new Ha(k,m),o=g;o<h;o++){var p=f[o];d.getOriginalWorldMatrix(p,a);var q=d.fragments.fragId2dbId[p];n.addInstance(a,q)||c.push(p)}var r=n.finish();if(r){var s=e.getMaterialVariant(l,Lk.INSTANCED,d.model);i.addContainerMesh(r,s,f,g,m)}for(o=0;o<c.length;o++)p=c[o],i.addSingleFragment(d,p)}}(),Nk=function(a){var b=a||function(a,b){return a<b},c=[],d=[],e=function a(e,f,g){if(f||(f=0),g||(g=d.length),f>=g)return g;if(g===f+1){var h=c[d[f]];return b(h,e)?g:f}var i=parseInt(f+(g-f)/2),j=c[d[i-1]];return b(e,j)?a(e,f,i):b(j,e)?a(e,i,g):i-1};this.add=function(a){var b=e(a);if(b===d.length)return c.push(a),void d.push(c.length-1);c.push(a),d.splice(b,0,c.length-1)},this.size=function(){return d.length},this.get=function(a){return c[d[a]]},this.removeAt=function(a){var b=d[a];c[b]=void 0,d.splice(a,1)},this.toString=function(){for(var a="",b=0,c=this.size();b<c;++b)a+=this.get(b),b<c-1&&(a+=", ");return a}};Wa.prototype.resetBoxRun=function(){this.boxCount=0},Wa.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++},Wa.prototype.fragmentsHaveBeenAdded=function(){return this.vizflags.length>this.fragments.length},Wa.prototype.getSvfMaterialId=function(a){var b=this.getMaterial(a);return b?b.svfMatId:void 0},Wa.prototype.onDemandLoadingEnabled=function(){return this.pagingProxy&&this.pagingProxy.onDemandLoadingEnabled()},Wa.prototype.pageOutGeometryEnabled=function(){return this.pagingProxy&&this.pagingProxy.pageOutGeometryEnabled()},Wa.prototype.pixelCullingEnable=function(){return this.pagingProxy&&this.pagingProxy.pixelCullingEnable()},Wa.prototype.pixelCullingThreshold=function(){return this.pagingProxy?this.pagingProxy.pixelCullingThreshold():0},Wa.prototype.requireGeometry=function(a){var b=null,c=this.geomids[a];if(c>=0&&(b=this.geoms.getGeometry(c)),null==b){var d=this.fragments.packIds?this.fragments.packIds[a]:a;this.pagingProxy&&this.pagingProxy.loadPackFile(d)}return b},Wa.prototype.promiseGeometry=function(a){function b(a,b){var c;return c=a.then(function(){return c&&(delete c.lmv_loader_promise,c.lmv_geom_canceled)?Promise.reject({canceled:!0}):b},function(a){return c&&(delete c.lmv_loader_promise,c.lmv_geom_canceled)?Promise.reject({canceled:!0}):Promise.reject(a)}),c.lmv_loader_promise=a,c}if(this.getGeometry(a))return b(Promise.resolve(),{model:this.model,fragId:a});var c=this.fragments.packIds?this.fragments.packIds[a]:a;if(!this.pagingProxy||!this.pagingProxy.promisePackFile)return b(Promise.reject({reason:"Not supported"}));var d=this.pagingProxy.promisePackFile(c);return d.hasOwnProperty("lmv_promise_count")||(d.lmv_promise_count=0),++d.lmv_promise_count,this.pagingProxy.pageOut(!1,!1),b(d,{model:this.model,fragId:a})},Wa.prototype.cancelPromisedGeometry=function(a){if(!a)return!1;var b=a.lmv_loader_promise;return!!b&&(!!a.lmv_geom_canceled||(a.lmv_geom_canceled=!0,b.hasOwnProperty("lmv_promise_count")&&--b.lmv_promise_count<=0&&this.pagingProxy&&this.pagingProxy.promisePackFile&&this.pagingProxy.cancelPromisedPackFile(b),!0))},Wa.prototype.setMesh=function(a,c,d){if(this.vizmeshes){var e=this.vizmeshes[a];e&&e.parent&&e.parent.remove(e)}if(this.vizflags.length<=a){this.isFixedSize&&(b.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);var f=Math.ceil(1.5*this.vizflags.length)||1;this.useThreeMesh&&f<this.vizmeshes.length&&(f=this.vizmeshes.length);var g=new Uint16Array(f);if(g.set(this.vizflags),this.vizflags=g,this.transforms){var h=new Float32Array(12*f);h.set(this.transforms),this.transforms=h}if(this.boxes){var i=new Float32Array(6*f);i.set(this.boxes),this.boxes=i}if(this.geomids){var j=new Int32Array(f);j.set(this.geomids),this.geomids=j}if(this.materialids){var k=new Int32Array(f);k.set(this.materialids),this.materialids=k}}if(this.useThreeMesh){var l=new b.Mesh(c.geometry,c.material);c.matrix&&(l.matrix&&l.matrix.copy(c.matrix),l.matrixWorld.copy(c.matrix)),l.is2d=c.is2d,l.isLine=c.isLine,l.isWideLine=c.isWideLine,l.isPoint=c.isPoint,l.matrixAutoUpdate=!1,l.frustumCulled=!1,l.fragId=a,l.dbId=0|this.fragments.fragId2dbId[a],l.modelId=this.model.getModelId(),this.vizmeshes[a]=l}else this.geomids[a]=c.geometry.svfid,this.materialids[a]=c.material.id,this.materialmap[c.material.id]||(this.materialmap[c.material.id]=c.material);var m=0;if(c.isLine?m=8:c.isWideLine?m=512:c.isPoint&&(m=256),this.isFixedSize?this.vizflags[a]|=m:this.vizflags[a]|=Vi|m,d){var n=c.matrix,o=12*a,p=n.elements,q=this.transforms;q[o]=p[0],q[o+1]=p[1],q[o+2]=p[2],q[o+3]=p[4],q[o+4]=p[5],q[o+5]=p[6],q[o+6]=p[8],q[o+7]=p[9],q[o+8]=p[10],q[o+9]=p[12],q[o+10]=p[13],q[o+11]=p[14];var r=new b.Box3;c.geometry&&c.geometry.boundingBox?r.copy(c.geometry.boundingBox):this.geoms.getModelBox(this.geomids[a],r),r.applyMatrix4(n);var s=6*a,t=this.boxes;t[s]=r.min.x,t[s+1]=r.min.y,t[s+2]=r.min.z,t[s+3]=r.max.x,t[s+4]=r.max.y,t[s+5]=r.max.z}},Wa.prototype.isFlagSet=function(a,b){return!!(this.vizflags[a]&b)},Wa.prototype.setFlagFragment=function(a,b,c){var d=this.vizflags[a];return!!(d&b)!=c&&(this.vizflags[a]=c?d|b:d&~b,!0)},Wa.prototype.setFlagGlobal=function(a,b){var c=this.vizflags,d=0,e=c.length;if(b)for(;d<e;d++)c[d]=c[d]|a;else for(var f=~a;d<e;d++)c[d]=c[d]&f},Wa.prototype.hideLines=function(a){this.hideFragments(8,a),this.hideFragments(512,a)},Wa.prototype.hidePoints=function(a){this.hideFragments(256,a)},Wa.prototype.hideFragments=function(a,b){var c=Xi,d=this.vizflags,e=0,f=d.length;if(b)for(;e<f;e++)d[e]&a&&(d[e]=d[e]|c);else for(var g=~c;e<f;e++)d[e]&a&&(d[e]=d[e]&g);this.allVisibleDirty=!0},Wa.prototype.isFragVisible=function(a){return 1==(7&this.vizflags[a])},Wa.prototype.isFragOff=function(a){return!!(this.vizflags[a]&Xi)},Wa.prototype.isLine=function(a){return!!(8&this.vizflags[a])},Wa.prototype.isWideLine=function(a){return this.isFlagSet(a,512)},Wa.prototype.isPoint=function(a){return this.isFlagSet(a,256)},Wa.prototype.areAllVisible=function(){if(this.allVisibleDirty){
for(var a=this.vizflags,b=!0,c=0,d=a.length;c<d;c++)if(0==(1&a[c])){b=!1;break}this.allVisible=b,this.allVisibleDirty=!1}return this.allVisible};var Ok=function(){var a=null,c=null,d=parseInt("00FFFFFF",16),e=parseInt("FF000000",16);return function(f,g){return a||(a=new b.Color,c=new b.Color),a.set(f&d),Xa(a),g&&(c.setRGB(g.x,g.y,g.z),a.lerp(c,g.w)),Xa(a).getHex()|f&e}}();Wa.prototype.getVizmesh=function(){function a(){e||(e=new b.Mesh(void 0,void 0,!0),e.isTemp=!0,e.dbId=0,e.modelId=0,e.fragId=-1,e.hide=!1,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1,f=new b.MeshLambertMaterial({color:0,depthWrite:!1,emissive:13421772}),f.cutplanes=null,g=new b.Box3,h=new b.Vector3,i=new b.Vector3,j=new Float32Array([1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,1,-1,-1,-1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,1,-1,-1]),k=new b.BufferGeometry,k.addAttribute("position",new b.BufferAttribute(j,3)))}function c(a,b,c,d){var e=a*b,f=d.boxes;c.min.x=f[e],c.min.y=f[e+1],c.min.z=f[e+2],c.max.x=f[e+3],c.max.y=f[e+4],c.max.z=f[e+5]}function d(a,d,e){if(!e.boxTransform[d]){c(d,6,g,e);var f=new b.Matrix4;i.subVectors(g.max,g.min),i.multiplyScalar(.5),f.makeScale(i.x,i.y,i.z),h.addVectors(g.max,g.min),h.multiplyScalar(.5);var j=f.elements;j[12]=h.x,j[13]=h.y,j[14]=h.z,e.boxTransform[d]=f}a.geometry_proxy=k,a.matrixWorld.copy(e.boxTransform[d])}var e,f,g,h,i,j,k;return function(b,c,g){if(this.model.is2d()&&Ya(this,b),this.useThreeMesh)return this.vizmeshes[b];a(),this.getWorldMatrix(b,e.matrixWorld),e.visible=!0,e.hide=this.isFragOff(b),e.fragId=b,e.dbId=this.getDbIds(b),e.themingColor=this.db2ThemingColor[e.dbId],e.modelId=this.model.getModelId(),e.geometry=this.getGeometry(b);var h=!1;if(!h){var i=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMaxCount:0;if(!e.geometry&&this.boxCount<i){var j=this.pagingProxy?this.pagingProxy.options.debug.boxProxyMinScreen:.1;(void 0===c||0==c||void 0!==c&&c>j)&&(h=!0)}}return h?(d(e,b,this),g||(e.geometry=e.geometry_proxy),this.boxCount++,e.material=f,e.isLine=!1,e.isWideLine=!1,e.isPoint=!1):(e.material=this.getMaterial(b),e.isLine=this.isLine(b),e.isWideLine=this.isWideLine(b),e.isPoint=this.isPoint(b),e.geometry&&this.boxTransform[b]&&(this.boxTransform[b]=null)),e}}(),Wa.prototype.promiseVizmesh=function(a){return this.promiseGeometry(a)},Wa.prototype.cancelPromisedVizmesh=function(a){return this.cancelPromisedGeometry(a)},Wa.prototype.getMaterialId=function(a){return this.useThreeMesh?this.vizmeshes[a].material.id:this.materialids[a]},Wa.prototype.getMaterial=function(a){return this.useThreeMesh?this.vizmeshes[a].material:this.materialmap[this.materialids[a]]},Wa.prototype.getGeometry=function(a){var b;return this.useThreeMesh?(b=this.vizmeshes[a])?b.geometry:null:this.geoms.getGeometry(this.geomids[a])},Wa.prototype.lockGeometry=function(a){return!!this.useThreeMesh||this.geoms.lockGeometry(this.geomids[a])},Wa.prototype.unlockGeometry=function(a){return!!this.useThreeMesh||this.geoms.unlockGeometry(this.geomids[a])},Wa.prototype.getLockCount=function(a){return this.useThreeMesh?0:this.geoms.getLockCount(this.geomids[a])},Wa.prototype.getGeometryId=function(a){return this.useThreeMesh?a:this.geomids[a]},Wa.prototype.setMaterial=function(a,b){this.useThreeMesh?this.vizmeshes[a].material=b:(this.materialids[a]=b.id,this.materialmap[b.id]=b)},Wa.prototype.getCount=function(){return this.vizmeshes?this.vizmeshes.length:this.vizflags.length},Wa.prototype.getDbIds=function(a){return this.fragments.fragId2dbId[a]},Wa.prototype.dispose=function(a){if(this.useThreeMesh)for(var b={type:"dispose"},c={type:"removed"},d=0;d<this.vizmeshes.length;d++){var e=this.vizmeshes[d];e&&(e.dispatchEvent(c),e.geometry.dispatchEvent(b))}else this.geoms.dispose(a)},Wa.prototype.setVisibility=function(a,b){this.setFlagFragment(a,Vi,b),this.allVisibleDirty=!0},Wa.prototype.setFragOff=function(a,b){this.setFlagFragment(a,Xi,b),this.allVisibleDirty=!0},Wa.prototype.setAllVisibility=function(a){if(this.model.is2d()){var b=this.fragments;if(b&&b.dbId2fragId)for(var c in b.dbId2fragId)this.setObject2DGhosted(c,!a)}else this.setFlagGlobal(Vi,a),this.allVisible=a,this.allVisibleDirty=!1},Wa.prototype.updateAnimTransform=function(a,b,c,d){var e,f=this.animxforms;if(!f){var g=this.getCount();f=this.animxforms=new Float32Array(10*g);for(var h=0;h<g;h++)e=10*h,f[e]=1,f[e+1]=1,f[e+2]=1,f[e+3]=0,f[e+4]=0,f[e+5]=0,f[e+6]=1,f[e+7]=0,f[e+8]=0,f[e+9]=0}e=10*a;var i=!1;b&&(f[e]=b.x,f[e+1]=b.y,f[e+2]=b.z,i=!0),c&&(f[e+3]=c.x,f[e+4]=c.y,f[e+5]=c.z,f[e+6]=c.w,i=!0),d&&(f[e+7]=d.x,f[e+8]=d.y,f[e+9]=d.z,i=!0),this.setFlagFragment(a,Yi,i),i||(f[e]=1,f[e+1]=1,f[e+2]=1,f[e+3]=0,f[e+4]=0,f[e+5]=0,f[e+6]=1,f[e+7]=0,f[e+8]=0,f[e+9]=0)},Wa.prototype.getAnimTransform=function(a,b,c,d){if(!this.animxforms)return!1;if(!this.isFlagSet(a,Yi))return!1;var e=10*a,f=this.animxforms;return b&&(b.x=f[e],b.y=f[e+1],b.z=f[e+2]),c&&(c.x=f[e+3],c.y=f[e+4],c.z=f[e+5],c.w=f[e+6]),d&&(d.x=f[e+7],d.y=f[e+8],d.z=f[e+9]),!0},Wa.prototype.getOriginalWorldMatrix=function(a,b){var c=12*a,d=b.elements,e=this.transforms;if(e)d[0]=e[c],d[1]=e[c+1],d[2]=e[c+2],d[3]=0,d[4]=e[c+3],d[5]=e[c+4],d[6]=e[c+5],d[7]=0,d[8]=e[c+6],d[9]=e[c+7],d[10]=e[c+8],d[11]=0,d[12]=e[c+9],d[13]=e[c+10],d[14]=e[c+11],d[15]=1;else if(this.useThreeMesh){var f=this.getVizmesh(a);f?b.copy(f.matrixWorld):b.identity()}else b.identity()},Wa.prototype.getWorldMatrix=function(){function a(){c=new b.Matrix4,d=new b.Vector3,e=new b.Quaternion,f=new b.Vector3}var c,d,e,f;return function(b,g){c||a(),this.getOriginalWorldMatrix(b,g),this.isFlagSet(b,Yi)&&(this.getAnimTransform(b,f,e,d),c.compose(d,e,f),g.multiplyMatrices(c,g))}}(),Wa.prototype.getWorldBounds=function(){function a(){c=new b.Matrix4}var c;return function(b,d){if(c||a(),this.boxes&&!this.isFlagSet(b,Yi)){var e=this.boxes,f=6*b;return d.min.x=e[f],d.min.y=e[f+1],d.min.z=e[f+2],d.max.x=e[f+3],d.max.y=e[f+4],void(d.max.z=e[f+5])}if(this.useThreeMesh){var g=this.getVizmesh(b);g&&g.geometry&&d.copy(g.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[b],d);d.empty()||(this.getWorldMatrix(b,c),d.applyMatrix4(c))}}(),Wa.prototype.setThemingColor=function(a,b){this.db2ThemingColor[a]=b,Za(this,a)},Wa.prototype.clearThemingColors=function(){if(this.model.is2d())for(var a=1,b=this.fragments.dbId2fragId.length;a<b;a++)Za(this,a);this.db2ThemingColor.length=0},Wa.prototype.setObject2DGhosted=function(a,b){this.dbIdIsGhosted[a]=b,Za(this,a)},Wa.prototype.setObject2DVisible=function(a,b){this.dbIdIsHidden[a]=!b,Za(this,a)},Wa.prototype.getMemoryInfo=function(){return this.pagingProxy?this.pagingProxy.getMemoryInfo():null},$a.prototype.getWorldMatrix=function(a){this.frags.getWorldMatrix(this.fragId,a)},$a.prototype.getOriginalWorldMatrix=function(a){this.frags.getOriginalWorldMatrix(this.fragId,a)},$a.prototype.getWorldBounds=function(a){return this.frags.getWorldBounds(this.fragId,a)},$a.prototype.getAnimTransform=function(){return this.scale||(this.scale=new b.Vector3(1,1,1),this.quaternion=new b.Quaternion(0,0,0,1),this.position=new b.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},$a.prototype.updateAnimTransform=function(){this.scale||(this.scale=new b.Vector3(1,1,1),this.quaternion=new b.Quaternion(0,0,0,1),this.position=new b.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},$a.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)},$a.prototype.setMaterial=function(a){return this.frags.setMaterial(this.fragId,a)};var Pk={FragmentPointer:$a,FragmentList:Wa};_a.prototype={constructor:_a,copy:function(){return new _a(this.level,this.x,this.y)},isValid:function(){return Number.isInteger(this.level)&&this.level>=0&&Number.isInteger(this.x)&&Number.isInteger(this.y)},getChild:function(a){var b=1&a?1:0,c=2&a?1:0;return new _a(this.level+1,2*this.x+b,2*this.y+c)},getParent:function(){return 0==this.level?null:new _a(this.level-1,Math.floor(this.x/2),Math.floor(this.y/2))},getParentAtLevel:function(a){if(a<0||a>this.level)return null;var b=this.level-a;return new _a(a,Math.floor(this.x>>b),Math.floor(this.y>>b))},toString:function(){return"("+this.level+", "+this.x+", "+this.y+")"},equals:function(a,b,c){return a instanceof _a?this.equals(a.level,a.x,a.y):this.level===a&&this.x===b&&this.y===c}};var Qk=function(a){var b=((1<<2*a.level)-1)/3,c=1<<a.level;return b+a.y*c+a.x},Rk=function(a){for(var b=new _a(0,0,0);Qk(b)<=a;)b.level++;b.level--;var c=a-Qk(b),d=1<<b.level;return b.y=Math.floor(c/d),b.x=c%d,b},Sk={TileCoords:_a,tile2Index:Qk,index2Tile:Rk},Tk=function(a){this.elements=a?new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};Tk.prototype={constructor:Tk,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},transformPoint:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[4]*c+e[8]*d+e[12],a.y=e[1]*b+e[5]*c+e[9]*d+e[13],a.z=e[2]*b+e[6]*c+e[10]*d+e[14],a},transformDirection:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d;var f=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);if(f>0){var g=1/f;a.x*=g,a.y*=g,a.z*=g}return a},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return new Tk(this.elements instanceof Float64Array).fromArray(this.elements)}};var Uk=Sk,Vk=0,Wk=1,Xk=2,Yk=function(a,b){this.timeStamp=a,this.mesh=b,this.state=Vk},Zk={ModelIteratorTexQuad:db,TexQuadConfig:cb},$k=1,_k=[1,1,2,4],al="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",bl={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)}},vertexShader:al,fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include<pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},cl={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)}},vertexShader:al,fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},dl=new Float32Array(1),el=new Uint32Array(dl.buffer),fl=new Uint16Array(1),gl=new Uint16Array(1),hl=function(a){dl[0]=a;var b=el[0],c=0;if(0==(2147483647&b))gl[c++]=b>>16;else{var d=2147483648&b,e=2139095040&b,f=8388607&b;if(0===e)gl[c++]=d>>16;else if(2139095040==e)gl[c++]=0===f?d>>16|31744:65024;else{var g,h,i=d>>16,j=(0|e>>23)-127+15;j>=31?gl[c++]=d>>16|31744:j<=0?(14-j>24?g=0:(f|=8388608,g=f>>14-j,fl[0]=g,g=fl[0],f>>13-j&1&&(g+=1)),gl[c++]=i|g):(h=j<<10,fl[0]=h,h=fl[0],g=f>>13,fl[0]=g,g=fl[0],gl[c++]=4096&f?1+(i|h|g):i|h|g)}}return gl[0]},il=function(a){var b,c=65535&a;if(0==(32767&c))b=c<<16;else{var d=32768&c,e=31744&c,f=1023&c;if(0===e){var g=-1;do{g++,f<<=1}while(0==(1024&f));var h=d<<16,i=(e<<16>>26)-15+127-g,j=i<<23,k=(1023&f)<<13;b=h|j|k}else 31744==e?b=0===f?d<<16|2139095040:4290772992:(h=d<<16,i=(e<<16>>26)-15+127,j=i<<23,k=f<<13,b=h|j|k)}return el[0]=b,dl[0]},jl=function(a){if(a>59389||a<0)return b.log("out of range"),hl(NaN);if(0===a)return 0;var c=!1;a>29694&&(c=!0,a-=29694);var d=0|Math.abs(a/1024),e=Math.pow(2,d-13),f=e+(a-1024*d)*e/1024;return c&&(f=-f),hl(f)},kl=function(a){if(0===a)return 0;var b=il(a),c=!1;b<0&&(c=!0,b=-b);var d=0|Math.floor(Math.log(b)/Math.log(2)),e=Math.pow(2,d),f=(b-e)/e*1024+1024*(d+13);return c&&(f+=29694),f},ll=function(){for(var a=[-1/255,-.17,-75,-1789,-.005],c=0;c<a.length;c++)b.log("input",a[c],"encoded",hl(a[c]),"decoded",il(hl(a[c])));for(var c=0;c<59390;c++){var d=kl(jl(c));d!==c&&b.log("Roundtrip failed for",c,d)}},ml={FloatToHalf:hl,HalfToFloat:il,HALF_INT_MAX:59390,IntToHalf:jl,HalfToInt:kl,HalfTest:ll},nl={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2};hb.prototype.setFlagNode=function(a,b,c){var d=this.nodeAccess.getNodeFlags(a);return!!(d&b)!=c&&(c?this.nodeAccess.setNodeFlags(a,d|b):this.nodeAccess.setNodeFlags(a,d&~b),!0)},hb.prototype.setFlagGlobal=function(a,b){var c=this.nodeAccess,d=0,e=c.numNodes;if(b)for(;d<e;d++)c.setNodeFlags(d,c.getNodeFlags(d)|a);else for(var f=~a;d<e;d++)c.setNodeFlags(d,c.getNodeFlags(d)&f)},hb.prototype.setNodeOff=function(a,b){var c=this.setFlagNode(a,1073741824,b);return c&&(b?this.numOff++:this.numOff--),c},hb.prototype.isNodeOff=function(a){return!!(1073741824&this.nodeAccess.getNodeFlags(a))},hb.prototype.setNodeHidden=function(a,b){var c=this.setFlagNode(a,2147483648,b);return c&&(b?this.numHidden++:this.numHidden--),c},hb.prototype.isNodeHidden=function(a){return!!(2147483648&this.nodeAccess.getNodeFlags(a))},hb.prototype.getNodeType=function(a){return 7&this.nodeAccess.getNodeFlags(a)},hb.prototype.isNodeSelectable=function(a){return!(536870912&this.nodeAccess.getNodeFlags(a))},hb.prototype.getNodeParentId=function(a){return this.nodeAccess.getParentId(a)},hb.prototype.getRootId=function(){return this.nodeAccess.rootId},hb.prototype.getNodeName=function(a){return this.nodeAccess.name(a)},hb.prototype.getChildCount=function(a){return this.nodeAccess.getNumChildren(a)},hb.prototype.getNodeBox=function(a,b){this.nodeAccess.getNodeBox(a,b)},hb.prototype.getNodeIndex=function(a){return this.nodeAccess.getIndex(a)},hb.prototype.enumNodeFragments=function(a,b,c){function d(a){f.nodeAccess.enumNodeFragments(a,b),c&&f.enumNodeChildren(a,function(a){d(a)})}var e;"number"==typeof a?e=a:a&&(e=a.dbId);var f=this;d(e)},hb.prototype.enumNodeChildren=function(a,b,c){function d(a){f.nodeAccess.enumNodeChildren(a,function(a){b(a),c&&d(a)})}var e;"number"==typeof a?e=a:a&&(e=a.dbId);var f=this;c&&b(e),d(e)},hb.prototype.findNodeForSelection=function(a,b){if(b===nl.LEAF_OBJECT)return a;var c,d,e=a;if(b===nl.FIRST_OBJECT){var f=[];for(c=a;c;)f.push(c),c=this.getNodeParentId(c);for(var g=f.length-1;g>=0;g--)if(5!==(d=this.getNodeType(f[g]))&&2!==d&&3!==d){e=f[g];break}}else if(b===nl.LAST_OBJECT)for(c=a;c;){if(4===(d=this.getNodeType(c))){e=c;break}c=this.getNodeParentId(c)}return e};var ol=16777216,pl=33554432,ql=16777215,rl=-1<<30,sl=5;jb.prototype.getIndex=function(a){var b=this.dbIdToIndex[a];if(b)return b;b=this.nextNode++,this.nodes.push(a);for(var c=1;c<sl;c++)this.nodes.push(0);return this.dbIdToIndex[a]=b,b},jb.prototype.setNode=function(a,b,c,d,e,f){var g=this.getIndex(a),h=g*sl,i=e.length,j=f&&f.length;j&&(i+=f.length),this.nodes[h+1]=b,this.nodes[h+2]=this.nextChild,this.nodes[h+3]=j?-i:i,this.nodes[h+4]=d;var k;for(k=0;k<e.length;k++)this.children[this.nextChild++]=this.getIndex(e[k]);if(j)for(k=0;k<f.length;k++)this.children[this.nextChild++]=-f[k]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(g,c)},jb.prototype.processName=function(a,b){var c,d,e=-1,f=-1;if(b&&(f=b.lastIndexOf("]"),-1!==(e=b.lastIndexOf("["))&&-1!==f||(e=b.lastIndexOf(":"),f=b.length)),e>=0&&f>e){c=b.slice(0,e+1);var g=b.slice(e+1,f);d=parseInt(g,10),d&&d+""===g||(c=b,d=0)}else c=b,d=0;var h=this.s2i[c];void 0===h&&(this.strings.push(c),h=this.strings.length-1,this.s2i[c]=h),this.names[a]=h,this.nameSuffixes[a]=d},jb.prototype.flatten=function(a,b,c,d,e,f){this.nodes=kb(this.nodes),this.children=kb(this.children),this.names=kb(this.names),this.nameSuffixes=kb(this.nameSuffixes),this.s2i=null},lb.prototype.getNumNodes=function(a){return this.numNodes},lb.prototype.getIndex=function(a){return this.dbIdToIndex[a]},lb.prototype.name=function(a){var b=this.dbIdToIndex[a];if("number"==typeof b){var c=this.strings[this.names[b]],d=this.nameSuffixes[b];if(d){return"["===c.charAt(c.length-1)?c+d+"]":c+d}return c}},lb.prototype.getParentId=function(a){var b=this.dbIdToIndex[a];if("number"==typeof b)return this.nodes[b*sl+1]},lb.prototype.getNodeFlags=function(a){var b=this.dbIdToIndex[a];if("number"==typeof b)return this.nodes[b*sl+4]},lb.prototype.setNodeFlags=function(a,b){var c=this.dbIdToIndex[a];"number"==typeof c&&(this.nodes[c*sl+4]=b)},lb.prototype.getNumChildren=function(a){var b=this.dbIdToIndex[a];if("number"!=typeof b)return 0;var c=this.nodes[b*sl+3];if(c>=0)return c;var d=this.nodes[b*sl+2];c=Math.abs(c);for(var e=0,f=0;f<c;f++){if(this.children[d+f]<0)break;e++}return e},lb.prototype.getNumFragments=function(a){var b=this.dbIdToIndex[a];if("number"!=typeof b)return 0;var c=this.nodes[b*sl+3];if(c>=0)return 0;var d=this.nodes[b*sl+2];c=Math.abs(c);for(var e=0,f=c-1;f>=0;f--){if(this.children[d+f]>=0)break;e++}return e},lb.prototype.getNodeBox=function(a,b){var c=this.getIndex(a);if("number"!=typeof c)return void b.makeEmpty();for(var d=6*c,e=0;e<6;e++)b[e]=this.nodeBoxes[d+e]},lb.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map(function(a){return parseInt(a)})),this.visibleIds},lb.prototype.enumNodeChildren=function(a,b){var c=this.dbIdToIndex[a];if("number"==typeof c){var d=this.nodes[c*sl+2],e=this.nodes[c*sl+3];e=Math.abs(e);for(var f=0;f<e;f++){var g=this.children[d+f];if(g<0)break;b(this.nodes[g*sl+0],a,c)}}},lb.prototype.enumNodeFragments=function(a,b){var c=this.dbIdToIndex[a];if("number"==typeof c){var d=this.nodes[c*sl+2],e=this.nodes[c*sl+3];if(e<0){e=-e;for(var f=0;f<e;f++){var g=this.children[d+f];g>0||b(-g-1,a,c)}}}},lb.prototype.computeBoxes=function(a){function b(a,b,c){var f=e.getIndex(a);d(a,f);for(var h=6*c,i=6*f,j=0;j<3;j++)g[h+j]>g[i+j]&&(g[h+j]=g[i+j]),g[h+j+3]<g[i+j+3]&&(g[h+j+3]=g[i+j+3])}function c(b,c,d){for(var e=6*b,f=6*d,h=0;h<3;h++)g[f+h]>a[e+h]&&(g[f+h]=a[e+h]),g[f+h+3]<a[e+h+3]&&(g[f+h+3]=a[e+h+3])}function d(a,d){var f=6*d;g[f]=g[f+1]=g[f+2]=1/0,g[f+3]=g[f+4]=g[f+5]=-1/0,e.getNumChildren(a)&&e.enumNodeChildren(a,b,!0),e.getNumFragments(a)&&e.enumNodeFragments(a,c)}var e=this,f=e.getIndex(e.rootId),g=e.nodeBoxes;d(e.rootId,f)},mb.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b},mb.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]},mb.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b},mb.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]},mb.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b},mb.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]},mb.prototype.setFlags=function(a,b,c,d){this.nodesS[a*this.node_stride_short+15]=d<<3|c<<2|3&b},mb.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]},mb.prototype.setBox0=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b[0],d[c+1]=b[1],d[c+2]=b[2],d[c+3]=b[3],d[c+4]=b[4],d[c+5]=b[5]},mb.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},mb.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b.min.x,d[c+1]=b.min.y,d[c+2]=b.min.z,d[c+3]=b.max.x,d[c+4]=b.max.y,d[c+5]=b.max.z},mb.prototype.makeEmpty=function(a){var b=a*this.node_stride,c=this.nodesI;c[b+6]=-1,c[b+7]=0,this.is_lean_node||(c[b+8]=-1)},mb.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);var c=new ArrayBuffer(b*this.bytes_per_node),d=new Int32Array(c);d.set(this.nodesI),this.nodeCapacity=b,this.nodesRaw=c,this.nodesF=new Float32Array(c),this.nodesI=d,this.nodesS=new Uint16Array(c)}},mb.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;c<a;c++)this.makeEmpty(b+c);return b},mb.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var tl=3,ul=1e-5,vl=1e-5,wl=15,xl=16,yl=function(){function a(a,b,c,d){a[b]=.5*(c[d]+c[d+3]),a[b+1]=.5*(c[d+1]+c[d+4]),a[b+2]=.5*(c[d+2]+c[d+5])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[3]<b[c]&&(a[3]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[4]<b[c+1]&&(a[4]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[5]<b[c+2]&&(a[5]=b[c+2])}function c(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[3]<b[c+3]&&(a[3]=b[c+3]),a[4]<b[c+4]&&(a[4]=b[c+4]),a[5]<b[c+5]&&(a[5]=b[c+5])}function d(a,b){a[0]>b[0]&&(a[0]=b[0]),a[1]>b[1]&&(a[1]=b[1]),a[2]>b[2]&&(a[2]=b[2]),a[3]<b[3]&&(a[3]=b[3]),a[4]<b[4]&&(a[4]=b[4]),a[5]<b[5]&&(a[5]=b[5])}function e(a,b,c,d){for(var e=0;e<3;e++)a[b+e]=c[d+3+e]-c[d+e]}function f(a,b){a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5]}function g(a){a[0]=s,a[1]=s,a[2]=s,a[3]=-s,a[4]=-s,a[5]=-s}function h(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],e=a[b+5]-a[b+2];return c<0||d<0||e<0?0:2*(c*d+d*e+e*c)}function i(a){var b=a[3]-a[0],c=a[4]-a[1],d=a[5]-a[2];return b<0||c<0||d<0?0:2*(b*c+c*d+d*b)}function j(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function k(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function l(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}function m(a,d,e,f,g,h,i){for(var j=a.centroids,k=a.primitives,l=a.finfo.boxes,m=a.finfo.boxStride,n=i*(1-vl)/h[f],o=g[f],p=a.sort_prims,q=d;q<=e;q++){var r=0|k[q],s=n*(j[3*r+f]-o),t=0|s;t<0?t=0:t>=i&&(t=i-1),p[q]=t,u[t].num_prims++,c(u[t].box_bbox,l,r*m),b(u[t].box_centroid,j,3*r)}}function n(a,b,c,e,g,h,j){if(h[e]<a.scene_epsilon)return void(j.best_cost=1/0);var k=xl;k>c-b+1&&(k=c-b+1);var l;for(l=0;l<k;l++)u[l].reset();for(l=0;l<k-1;l++)v[l].reset();j.num_bins=k,m(a,b,c,e,g,h,k),f(v[0].BL,u[0].box_bbox),f(v[0].CL,u[0].box_centroid),v[0].AL=i(v[0].BL),v[0].NL=u[0].num_prims;var n;for(l=1;l<k-1;l++){n=u[l];var o=v[l];f(o.BL,v[l-1].BL),d(o.BL,n.box_bbox),o.AL=i(o.BL),f(o.CL,v[l-1].CL),d(o.CL,n.box_centroid),o.NL=v[l-1].NL+n.num_prims}l=k-1,f(w,u[l].box_bbox),f(x,u[l].box_centroid);var p=i(w),q=u[l].num_prims,r=l,s=p*q+v[l-1].AL*v[l-1].NL;for(f(j.vb_right,w),f(j.cb_right,u[l].box_centroid),f(j.vb_left,v[l-1].BL),f(j.cb_left,v[l-1].CL),j.num_left=v[l-1].NL,l-=1;l>=1;l--){n=u[l],d(w,n.box_bbox),d(x,n.box_centroid),p=i(w),q+=n.num_prims;var t=p*q+v[l-1].AL*v[l-1].NL;t<=s&&(s=t,r=l,f(j.vb_right,w),f(j.cb_right,x),f(j.vb_left,v[l-1].BL),f(j.cb_left,v[l-1].CL),j.num_left=v[l-1].NL)}j.best_split=r,j.best_cost=s}function o(a,b,c,d,e,f,g){var h,i,j=a.primitives,k=a.sort_prims,l=0,m=0|b,n=0|g.best_split;for(h=b;h<=c;h++){var o=0|j[h];k[h]<n?j[m++]=o:k[l++]=o}for(i=0;i<l;i++)j[m+i]=k[i]}function p(a,c,d,f,h,i,j,k){var l=a.primitives,m=a.centroids,n=h-f+1;n>a.frags_per_inner_node&&(n=a.frags_per_inner_node),n>k&&(n=k),c.setPrimStart(d,f),c.setPrimCount(d,n),f+=n,g(i);for(var o=f;o<=h;o++)b(i,m,3*l[o]);e(j,0,i,0);var p=0;return j[1]>j[0]&&(p=1),j[2]>j[p]&&(p=2),p}function q(a,b,c,d,f,g,h,i){e(y,0,g,0);var k=a.nodes,l=h?a.frags_per_leaf_node_transparent:a.frags_per_leaf_node,m=h?a.frags_per_inner_node_transparent:a.frags_per_inner_node,q=a.max_polys_per_node,r=0;y[1]>y[0]&&(r=1),y[2]>y[r]&&(r=2),k.setBox0(b,f);var s=0,t=0,u=d-c+1;if(a.finfo.hasPolygonCounts&&a.frags_per_inner_node)for(var v=u<=a.frags_per_inner_node?d:c+a.frags_per_inner_node-1,w=c;w<=v&&(s+=a.finfo.getPolygonCount(a.primitives[w]),t++,!(s>q));w++);if(u<=l&&s<q||1===u||i>wl||y[r]<a.scene_epsilon)return k.setLeftChild(b,-1),k.setPrimStart(b,c),k.setPrimCount(b,d-c+1),void k.setFlags(b,0,0,h?1:0);m&&(r=p(a,k,b,c,d,g,y,t),c+=k.getPrimCount(b));var x=new j;if(n(a,c,d,r,g,y,x),x.num_bins<0)return void k.setPrimCount(b,k.getPrimCount(b)+d-c+1);o(a,c,d,r,g,y,x);var z=k.nextNodes(2),A=.5*(x.vb_left[3+r]+x.vb_left[r]),B=.5*(x.vb_right[3+r]+x.vb_right[r]);k.setFlags(b,r,A<B?0:1,h?1:0),k.setLeftChild(b,z),a.recursion_stack.push([a,z+1,c+x.num_left,d,x.vb_right,x.cb_right,h,i+1]),a.recursion_stack.push([a,z,c,c+x.num_left-1,x.vb_left,x.cb_left,h,i+1])}function r(d){var f=d.boxv_o,h=d.boxc_o,i=d.boxv_t,j=d.boxc_t;g(f),g(h),g(i),g(j);for(var k=d.centroids,l=d.finfo.boxes,m=d.finfo.boxStride,n=0,o=d.prim_count;n<o;n++){var p=d.primitives[n];a(k,3*p,l,m*p),n>=d.first_transparent?(b(j,k,3*p),c(i,l,m*p)):(b(h,k,3*p),c(f,l,m*p))}e(y,0,d.boxv_o,0);var q=Math.max(y[0],y[1],y[2]);d.scene_epsilon=ul*q}var s=1/0;j.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},k.prototype.reset=function(){this.num_prims=0,g(this.box_bbox),g(this.box_centroid)},l.prototype.reset=function(){this.NL=0,this.AL=0,g(this.BL),g(this.CL)};var t,u=[];for(t=0;t<xl;t++)u.push(new k);var v=[];for(t=0;t<xl-1;t++)v.push(new l);var w=new Float32Array(6),x=new Float32Array(6),y=new Float32Array(3);return{bvh_subdivide:q,compute_boxes:r,box_area:h}}();nb.prototype.getCount=function(){return this.count},nb.prototype.isTransparent=function(a){return!(!this.materialDefs||!this.materialDefs[this.materials[a]])&&this.materialDefs[this.materials[a]].transparent},nb.prototype.getPolygonCount=function(a){return this.polygonCounts[a]},ob.prototype.sortPrimitives=function(){var a,b,c=new Float32Array(this.work_buf),d=this.primitives,e=0;for(a=0,b=this.prim_count;a<b;a++){d[a]=a;var f=this.finfo.isTransparent(a);f&&e++,c[a]=yl.box_area(this.finfo.boxes,this.finfo.boxStride*a),f&&(c[a]=-c[a])}Array.prototype.sort.call(this.primitives,function(a,b){return c[b]-c[a]}),this.first_transparent=this.prim_count-e},ob.prototype.build=function(a){function b(b,c){a.hasOwnProperty(b)?d[b]=a[b]:d[b]=c}var c=a&&!!a.useSlimNodes,d=this;if(c)b("frags_per_leaf_node",1),b("frags_per_inner_node",0),b("frags_per_leaf_node_transparent",1),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",1/0);else{var e=a.isWeakDevice?.5:1;b("frags_per_leaf_node",0|32*e),b("frags_per_inner_node",0|this.frags_per_leaf_node),b("frags_per_leaf_node_transparent",this.frags_per_leaf_node),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",0|1e4*e)}if(this.nodes&&this.nodes.is_lean_node==c)this.nodes.nodeCount=0;else{for(var f=this.prim_count/this.frags_per_leaf_node,g=1;g<f;)g*=2;this.nodes=new mb(g,!!a&&a.useSlimNodes)}this.sortPrimitives(),yl.compute_boxes(this);var h=this.nodes.nextNodes(2);yl.bvh_subdivide(this,h,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);for(var i;this.recursion_stack.length;)i=this.recursion_stack.pop(),yl.bvh_subdivide(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])
;for(yl.bvh_subdivide(this,h+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)i=this.recursion_stack.pop(),yl.bvh_subdivide(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])};var zl={};!function(a){a[a.UNKNOWN_FAILURE=1]="UNKNOWN_FAILURE",a[a.BAD_DATA=2]="BAD_DATA",a[a.NETWORK_FAILURE=3]="NETWORK_FAILURE",a[a.NETWORK_ACCESS_DENIED=4]="NETWORK_ACCESS_DENIED",a[a.NETWORK_FILE_NOT_FOUND=5]="NETWORK_FILE_NOT_FOUND",a[a.NETWORK_SERVER_ERROR=6]="NETWORK_SERVER_ERROR",a[a.NETWORK_UNHANDLED_RESPONSE_CODE=7]="NETWORK_UNHANDLED_RESPONSE_CODE",a[a.BROWSER_WEBGL_NOT_SUPPORTED=8]="BROWSER_WEBGL_NOT_SUPPORTED",a[a.BAD_DATA_NO_VIEWABLE_CONTENT=9]="BAD_DATA_NO_VIEWABLE_CONTENT",a[a.BROWSER_WEBGL_DISABLED=10]="BROWSER_WEBGL_DISABLED",a[a.BAD_DATA_MODEL_IS_EMPTY=11]="BAD_DATA_MODEL_IS_EMPTY",a[a.RTC_ERROR=12]="RTC_ERROR",a[a.UNSUPORTED_FILE_EXTENSION=13]="UNSUPORTED_FILE_EXTENSION",a[a.VIEWER_INTERNAL_ERROR=14]="VIEWER_INTERNAL_ERROR"}(a.ErrorCodes||(a.ErrorCodes={}));var Al="function"==typeof Symbol&&"symbol"===g(Symbol.iterator)?function(a){return void 0===a?"undefined":g(a)}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":void 0===a?"undefined":g(a)},Bl=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},Cl=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Dl=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},El=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":g(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},Fl=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":g(b))&&"function"!=typeof b?a:b},Gl=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Hl=(function(){function b(){Bl(this,b),this.callback=function(a,b){},this.level=-1,this.setLevel(a.LogLevels.ERROR)}Cl(b,[{key:"initialize",value:function(a){a&&a.eventCallback&&(this.callback=a.callback)}},{key:"shutdown",value:function(){}},{key:"track",value:function(a){}},{key:"logToADP",value:function(a){return!1}},{key:"updateRuntimeStats",value:function(a){}},{key:"reportRuntimeStats",value:function(){}},{key:"setLevel",value:function(b){function c(){}function d(){var a=Array.prototype.slice.call(arguments).join(" ");e.callback({category:"error",message:a},{adp:!1}),console.error.apply(console,arguments)}if(this.level!==b){this.level=b;var e=this;this.debug=b>=a.LogLevels.DEBUG?console.log.bind(console):c,this.log=b>=a.LogLevels.LOG?console.log.bind(console):c,this.info=b>=a.LogLevels.INFO?console.info.bind(console):c,this.warn=b>=a.LogLevels.WARNING?console.warn.bind(console):c,this.error=b>=a.LogLevels.ERROR?d:c}}}])}(),{});/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
(function(){function a(a){throw a}function b(a,b){var c=a.split("."),d=l;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||b===k?d=d[e]?d[e]:d[e]={}:d[e]=b}function c(a,b,c){var d,e="number"==typeof b?b:b=0,f="number"==typeof c?c:a.length;for(d=-1,e=7&f;e--;++b)d=d>>>8^r[255&(d^a[b])];for(e=f>>3;e--;b+=8)d=d>>>8^r[255&(d^a[b])],d=d>>>8^r[255&(d^a[b+1])],d=d>>>8^r[255&(d^a[b+2])],d=d>>>8^r[255&(d^a[b+3])],d=d>>>8^r[255&(d^a[b+4])],d=d>>>8^r[255&(d^a[b+5])],d=d>>>8^r[255&(d^a[b+6])],d=d>>>8^r[255&(d^a[b+7])];return(4294967295^d)>>>0}function d(){}function e(a){var b,c,d,e,f,g,h,i,j,k=a.length,l=0,n=Number.POSITIVE_INFINITY;for(i=0;i<k;++i)a[i]>l&&(l=a[i]),a[i]<n&&(n=a[i]);for(b=1<<l,c=new(m?Uint32Array:Array)(b),d=1,e=0,f=2;d<=l;){for(i=0;i<k;++i)if(a[i]===d){for(g=0,h=e,j=0;j<d;++j)g=g<<1|1&h,h>>=1;for(j=g;j<b;j+=f)c[j]=d<<16|i;++e}++d,e<<=1,f<<=1}return[c,l,n]}function f(b,c){switch(this.i=[],this.j=32768,this.d=this.f=this.c=this.n=0,this.input=m?new Uint8Array(b):b,this.o=!1,this.k=w,this.w=!1,!c&&(c={})||(c.index&&(this.c=c.index),c.bufferSize&&(this.j=c.bufferSize),c.bufferType&&(this.k=c.bufferType),c.resize&&(this.w=c.resize)),this.k){case v:this.a=32768,this.b=new(m?Uint8Array:Array)(32768+this.j+258);break;case w:this.a=0,this.b=new(m?Uint8Array:Array)(this.j),this.e=this.D,this.q=this.A,this.l=this.C;break;default:a(Error("invalid inflate mode"))}}function g(b,c){for(var d,e=b.f,f=b.d,g=b.input,h=b.c;f<c;)d=g[h++],d===k&&a(Error("input buffer is broken")),e|=d<<f,f+=8;return d=e&(1<<c)-1,b.f=e>>>c,b.d=f-c,b.c=h,d}function h(a,b){for(var c,d,e,f=a.f,g=a.d,h=a.input,i=a.c,j=b[0],l=b[1];g<l&&(c=h[i++])!==k;)f|=c<<g,g+=8;return d=j[f&(1<<l)-1],e=d>>>16,a.f=f>>e,a.d=g-e,a.c=i,65535&d}function i(a){function b(a,b,c){var d,e,f,i;for(i=0;i<a;)switch(d=h(this,b)){case 16:for(f=3+g(this,2);f--;)c[i++]=e;break;case 17:for(f=3+g(this,3);f--;)c[i++]=0;e=0;break;case 18:for(f=11+g(this,7);f--;)c[i++]=0;e=0;break;default:e=c[i++]=d}return c}var c,d,f,i,j=g(a,5)+257,k=g(a,5)+1,l=g(a,4)+4,n=new(m?Uint8Array:Array)(A.length);for(i=0;i<l;++i)n[A[i]]=g(a,3);c=e(n),d=new(m?Uint8Array:Array)(j),f=new(m?Uint8Array:Array)(k),a.l(e(b.call(a,j,c,d)),e(b.call(a,k,c,f)))}function j(a){this.input=a,this.c=0,this.m=[],this.s=!1}var k=void 0,l=this,m="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;new(m?Uint8Array:Array)(256);var n;for(n=0;256>n;++n)for(var o=n,p=7,o=o>>>1;o;o>>>=1)--p;var q=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],r=m?new Uint32Array(q):q;d.prototype.getName=function(){return this.name},d.prototype.getData=function(){return this.data},d.prototype.G=function(){return this.H},b("Zlib.GunzipMember",d),b("Zlib.GunzipMember.prototype.getName",d.prototype.getName),b("Zlib.GunzipMember.prototype.getData",d.prototype.getData),b("Zlib.GunzipMember.prototype.getMtime",d.prototype.G);var s,t=[];for(s=0;288>s;s++)switch(!0){case 143>=s:t.push([s+48,8]);break;case 255>=s:t.push([s-144+400,9]);break;case 279>=s:t.push([s-256+0,7]);break;case 287>=s:t.push([s-280+192,8]);break;default:a("invalid literal: "+s)}var u=function(){var b,c,d=[];for(b=3;258>=b;b++)c=function(b){switch(!0){case 3===b:return[257,b-3,0];case 4===b:return[258,b-4,0];case 5===b:return[259,b-5,0];case 6===b:return[260,b-6,0];case 7===b:return[261,b-7,0];case 8===b:return[262,b-8,0];case 9===b:return[263,b-9,0];case 10===b:return[264,b-10,0];case 12>=b:return[265,b-11,1];case 14>=b:return[266,b-13,1];case 16>=b:return[267,b-15,1];case 18>=b:return[268,b-17,1];case 22>=b:return[269,b-19,2];case 26>=b:return[270,b-23,2];case 30>=b:return[271,b-27,2];case 34>=b:return[272,b-31,2];case 42>=b:return[273,b-35,3];case 50>=b:return[274,b-43,3];case 58>=b:return[275,b-51,3];case 66>=b:return[276,b-59,3];case 82>=b:return[277,b-67,4];case 98>=b:return[278,b-83,4];case 114>=b:return[279,b-99,4];case 130>=b:return[280,b-115,4];case 162>=b:return[281,b-131,5];case 194>=b:return[282,b-163,5];case 226>=b:return[283,b-195,5];case 257>=b:return[284,b-227,5];case 258===b:return[285,b-258,0];default:a("invalid length: "+b)}}(b),d[b]=c[2]<<24|c[1]<<16|c[0];return d}();m&&new Uint32Array(u);var v=0,w=1;f.prototype.g=function(){for(;!this.o;){var b=g(this,3);switch(1&b&&(this.o=!0),b>>>=1){case 0:var c=this.input,d=this.c,e=this.b,f=this.a,h=k,j=k,l=k,n=e.length,o=k;switch(this.d=this.f=0,h=c[d++],h===k&&a(Error("invalid uncompressed block header: LEN (first byte)")),j=h,h=c[d++],h===k&&a(Error("invalid uncompressed block header: LEN (second byte)")),j|=h<<8,h=c[d++],h===k&&a(Error("invalid uncompressed block header: NLEN (first byte)")),l=h,h=c[d++],h===k&&a(Error("invalid uncompressed block header: NLEN (second byte)")),l|=h<<8,j===~l&&a(Error("invalid uncompressed block header: length verify")),d+j>c.length&&a(Error("input buffer is broken")),this.k){case v:for(;f+j>e.length;){if(o=n-f,j-=o,m)e.set(c.subarray(d,d+o),f),f+=o,d+=o;else for(;o--;)e[f++]=c[d++];this.a=f,e=this.e(),f=this.a}break;case w:for(;f+j>e.length;)e=this.e({t:2});break;default:a(Error("invalid inflate mode"))}if(m)e.set(c.subarray(d,d+j),f),f+=j,d+=j;else for(;j--;)e[f++]=c[d++];this.c=d,this.a=f,this.b=e;break;case 1:this.l(M,O);break;case 2:i(this);break;default:a(Error("unknown BTYPE: "+b))}}return this.q()};var x,y,z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],A=m?new Uint16Array(z):z,B=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],C=m?new Uint16Array(B):B,D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],E=m?new Uint8Array(D):D,F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],G=m?new Uint16Array(F):F,H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=m?new Uint8Array(H):H,J=new(m?Uint8Array:Array)(288);for(x=0,y=J.length;x<y;++x)J[x]=143>=x?8:255>=x?9:279>=x?7:8;var K,L,M=e(J),N=new(m?Uint8Array:Array)(30);for(K=0,L=N.length;K<L;++K)N[K]=5;var O=e(N);f.prototype.l=function(a,b){var c=this.b,d=this.a;this.r=a;for(var e,f,i,j,k=c.length-258;256!==(e=h(this,a));)if(256>e)d>=k&&(this.a=d,c=this.e(),d=this.a),c[d++]=e;else for(f=e-257,j=C[f],0<E[f]&&(j+=g(this,E[f])),e=h(this,b),i=G[e],0<I[e]&&(i+=g(this,I[e])),d>=k&&(this.a=d,c=this.e(),d=this.a);j--;)c[d]=c[d++-i];for(;8<=this.d;)this.d-=8,this.c--;this.a=d},f.prototype.C=function(a,b){var c=this.b,d=this.a;this.r=a;for(var e,f,i,j,k=c.length;256!==(e=h(this,a));)if(256>e)d>=k&&(c=this.e(),k=c.length),c[d++]=e;else for(f=e-257,j=C[f],0<E[f]&&(j+=g(this,E[f])),e=h(this,b),i=G[e],0<I[e]&&(i+=g(this,I[e])),d+j>k&&(c=this.e(),k=c.length);j--;)c[d]=c[d++-i];for(;8<=this.d;)this.d-=8,this.c--;this.a=d},f.prototype.e=function(){var a,b,c=new(m?Uint8Array:Array)(this.a-32768),d=this.a-32768,e=this.b;if(m)c.set(e.subarray(32768,c.length));else for(a=0,b=c.length;a<b;++a)c[a]=e[a+32768];if(this.i.push(c),this.n+=c.length,m)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];return this.a=32768,e},f.prototype.D=function(a){var b,c,d,e,f=this.input.length/this.c+1|0,g=this.input,h=this.b;return a&&("number"==typeof a.t&&(f=a.t),"number"==typeof a.z&&(f+=a.z)),2>f?(c=(g.length-this.c)/this.r[2],e=c/2*258|0,d=e<h.length?h.length+e:h.length<<1):d=h.length*f,m?(b=new Uint8Array(d),b.set(h)):b=h,this.b=b},f.prototype.q=function(){var a,b,c,d,e,f=0,g=this.b,h=this.i,i=new(m?Uint8Array:Array)(this.n+(this.a-32768));if(0===h.length)return m?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(b=0,c=h.length;b<c;++b)for(a=h[b],d=0,e=a.length;d<e;++d)i[f++]=a[d];for(b=32768,c=this.a;b<c;++b)i[f++]=g[b];return this.i=[],this.buffer=i},f.prototype.A=function(){var a,b=this.a;return m?this.w?(a=new Uint8Array(b),a.set(this.b.subarray(0,b))):a=this.b.subarray(0,b):(this.b.length>b&&(this.b.length=b),a=this.b),this.buffer=a},j.prototype.F=function(){return this.s||this.g(),this.m.slice()},j.prototype.g=function(){for(var b=this.input.length;this.c<b;){var e=new d,g=k,h=k,i=k,j=k,l=k,n=k,o=k,p=k,q=k,r=this.input,s=this.c;switch(e.u=r[s++],e.v=r[s++],(31!==e.u||139!==e.v)&&a(Error("invalid file signature:"+e.u+","+e.v)),e.p=r[s++],e.p){case 8:break;default:a(Error("unknown compression method: "+e.p))}if(e.h=r[s++],p=r[s++]|r[s++]<<8|r[s++]<<16|r[s++]<<24,e.H=new Date(1e3*p),e.N=r[s++],e.M=r[s++],0<(4&e.h)&&(e.I=r[s++]|r[s++]<<8,s+=e.I),0<(8&e.h)){for(o=[],n=0;0<(l=r[s++]);)o[n++]=String.fromCharCode(l);e.name=o.join("")}if(0<(16&e.h)){for(o=[],n=0;0<(l=r[s++]);)o[n++]=String.fromCharCode(l);e.J=o.join("")}0<(2&e.h)&&(e.B=65535&c(r,0,s),e.B!==(r[s++]|r[s++]<<8)&&a(Error("invalid header crc16"))),g=r[r.length-4]|r[r.length-3]<<8|r[r.length-2]<<16|r[r.length-1]<<24,r.length-s-4-4<512*g&&(j=g),h=new f(r,{index:s,bufferSize:j}),e.data=i=h.g(),s=h.c,e.K=q=(r[s++]|r[s++]<<8|r[s++]<<16|r[s++]<<24)>>>0,c(i,k,k)!==q&&a(Error("invalid CRC-32 checksum: 0x"+c(i,k,k).toString(16)+" / 0x"+q.toString(16))),e.L=g=(r[s++]|r[s++]<<8|r[s++]<<16|r[s++]<<24)>>>0,(4294967295&i.length)!==g&&a(Error("invalid input size: "+(4294967295&i.length)+" / "+g)),this.m.push(e),this.c=s}this.s=!0;var t,u,v,w=this.m,x=0,y=0;for(t=0,u=w.length;t<u;++t)y+=w[t].data.length;if(m)for(v=new Uint8Array(y),t=0;t<u;++t)v.set(w[t].data,x),x+=w[t].data.length;else{for(v=[],t=0;t<u;++t)v[t]=w[t].data;v=Array.prototype.concat.apply([],v)}return v},b("Zlib.Gunzip",j),b("Zlib.Gunzip.prototype.decompress",j.prototype.g),b("Zlib.Gunzip.prototype.getMembers",j.prototype.F)}).call(Hl);var Il,Jl=Hl.Zlib,Kl="undefined"!=typeof self&&"undefined"==typeof window,Ll={endpoint:{HTTP_REQUEST_HEADERS:{},getApiEndpoint:function(){return null},getManifestApi:function(a,b,c){return null},getItemApi:function(a,b,c){return null},getThumbnailApi:function(a,b,c){return null},makeOssPath:function(a,b,c){return null},getUseCredentials:function(){return!1},pathRequiresCredentials:function(a){return!1},getDomainParam:function(){return""},setUseCredentials:function(a){}}};Ll.setEndpoint=function(a){this.endpoint=a};var Ml=!1;Ll.simplifyPath=tb,Ll.OSS_PREFIX="urn:adsk.objects:os.object:",Ll.getDirectOSSUrl=function(a,b){var c=b.indexOf(Ll.OSS_PREFIX);if(-1!==c){var d=b.substr(c+Ll.OSS_PREFIX.length),e=d.substr(0,d.indexOf("/")),f=d.substr(d.indexOf("/")+1);return f=tb(f),this.endpoint.makeOssPath(a,e,f)}},Ll.generateUrl=function(a,b,c){if(Ki()&&!vb(a,c))return c;c=tb(c);var d=c.indexOf("urn:"),e=c.indexOf("?");c=-1!=d?-1!==e?c.slice(0,d)+encodeURIComponent(c.slice(d,e))+c.slice(e):c.slice(0,d)+encodeURIComponent(c.slice(d)):encodeURI(c);var f=Ll.getDirectOSSUrl(a,c);if(f)return f;if(0!==decodeURIComponent(c).indexOf("urn:"))return c;switch("items"!==b&&(c=c.substr(6)),b){case"items":return this.endpoint.getItemApi(a,c);case"bubbles":return this.endpoint.getManifestApi(a,c);case"thumbnails":return this.endpoint.getThumbnailApi(a,c)}},Ll.rawGet=function(b,c,d,e,f,g){function h(a){f&&f(l.status,l.statusText,{url:d})}function i(b){if(200===l.status||206===l.status)if(l.response&&l.response instanceof ArrayBuffer){var c=new Uint8Array(l.response);if(!g.skipDecompress&&31==c[0]&&139==c[1]){Ml||(Ml=!0,a.logger.warn("An LMV resource ("+d+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{c=new Jl.Gunzip(c).decompress()}catch(b){f(a.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:d,exception:b.toString(),stack:b.stack})}}e(c)}else e(l.response||l.responseText);else h(b)}var g=g||{};if(d=Ll.generateUrl(b,c,d),Ki()&&!vb(b,d))return void wb(d,e,f,g);if(g.queryParams){var j=-1===d.indexOf("?")?"?":"&";d=d+j+g.queryParams}var k=sb(),l=new k;try{var m=!g.hasOwnProperty("asynchronous")||g.asynchronous;if(l.open(g.noBody?"HEAD":"GET",d,m),g.hasOwnProperty("responseType")&&(l.responseType=g.responseType),l.withCredentials=!0,g.hasOwnProperty("withCredentials")&&(l.withCredentials=g.withCredentials),g.headers)for(var n in g.headers)l.setRequestHeader(n,g.headers[n]),"authorization"===n.toLocaleLowerCase()&&(l.withCredentials=!1);m&&(l.onload=i,l.onerror=h,l.ontimeout=h,g.ondata&&(l.overrideMimeType("text/plain; charset=x-user-defined"),g._dlProgress={streamOffset:0,counter:0},l.onreadystatechange=function(){if(l.readyState>2){var a=l.responseText;if(g._dlProgress.streamOffset>=a.length)return;var b=ub(a,g._dlProgress.streamOffset);g._dlProgress.streamOffset=a.length,g.ondata(b)}})),l.send(),g.skipAssetCallback||(Kl?self.postMessage({assetRequest:[d,g.headers,null]}):a.assets&&a.assets.push([d,g.headers,null])),m||i()}catch(a){f(l.status,l.statusText,{url:d,exception:a})}},Ll.defaultFailureCallback=function(b,c,d){403==b?this.raiseError(a.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:d.url,httpStatus:b,httpStatusText:c}):404==b?this.raiseError(a.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:d.url,httpStatus:b,httpStatusText:c}):b>=500&&b<600?this.raiseError(a.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:d.url,httpStatus:b,httpStatusText:c}):d.exception?this.raiseError(a.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:d.url,exception:d.exception.toString(),stack:d.exception.stack}):this.raiseError(a.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:d.url,httpStatus:b,httpStatusText:c,data:d})},Ll.getItem=function(a,b,c,d,e){e=e||{},xb(a,e),Ll.rawGet(a.endpoint,"items",b,c,d,e)},Ll.getManifest=function(a,b,c,d,e){e=e||{},e.hasOwnProperty("responseType")||(e.responseType="json"),xb(a,e),Ll.rawGet(a.endpoint,"bubbles",b,c,d,e)},Ll.getThumbnail=function(a,b,c,d,e){e=e||{},xb(a,e);var f=e.queryParams||"",g=[];if(-1===f.indexOf("guid=")&&g.push("guid="+encodeURIComponent(e.guid)),-1===f.indexOf("role=")){var h=e.role||"rendered";g.push("role="+h)}if(-1===f.indexOf("width=")){var i=e.size||400;g.push("width="+i)}if(-1===f.indexOf("height=")){var i=e.size||400;g.push("height="+i)}-1===f.indexOf("acmsession=")&&e.acmsession&&g.push("acmsession="+e.acmsession);var j=g.join("&");e.queryParams?e.queryParams=e.queryParams+"&"+j:e.queryParams=j,Ll.rawGet(a.endpoint,"thumbnails",b,c,d,e)},Ll.getACMSession=function(a,b,c,d){var e,f={};for(var g in b)"oauth2AccessToken"===g?e=b[g]:-1!==g.indexOf("x-ads-acm")&&(f[g]=b[g]);f.application="autodesk";var h=new XMLHttpRequest;h.open("POST",a+"/oss-ext/v2/acmsessions",!0),h.setRequestHeader("Content-Type","application/json"),h.setRequestHeader("Authorization","Bearer "+e),h.responseType="json",h.onload=function(){if(200===h.status&&h.response){var a="string"==typeof h.response?JSON.parse(h.response):h.response;a&&a.acmsession?c(a.acmsession):d(h.status,"Can't get acm session from response.")}else d(h.status)},h.onerror=d,h.ontimeout=d,h.send(JSON.stringify(f)),delete f.application};var Nl,Ol=function(){function a(b,c){Bl(this,a),this.delegate=a.copyDelegate(this,b)}return Cl(a,[{key:"dtor",value:function(){this.delegate=null}},{key:"isValid",value:function(){return null!=this.delegate}}],[{key:"simpleInitLoadContext",value:function(a){return a=a||{},a.headers=a.headers||{},a}},{key:"nullFunction",value:function(){}},{key:"copyDelegate",value:function(c,d){var e={};return d&&Object.assign(e,d),e.workerScript||zl.mainThreadClass&&(e.workerScript=new zl.mainThreadClass),e.matman||(e.matman=new fk),e.model||(e.model=fb),e.eventTarget||(b.EventDispatcher.prototype.apply(c),e.eventTarget=c),e.initLoadContext||(e.initLoadContext=a.simpleInitLoadContext),e.requestRedraw||(e.requestRedraw=a.nullFunction),e.reportError||(e.reportError=a.nullFunction),e.signalProgress||(e.signalProgress=a.nullFunction),e}}]),a}(),Pl=2,Ql=1048576,Rl=function(b,c){function d(a,b,c,d,e,g){function h(a,b,c){var d=null;if(b){var e=c-1;s=s+e&~e;var f=b.length;d=new a(r,s,f),d.set(b),s+=f*c}return d}var i,j=0,k=0,l=[],m=g.inMemory,n=!1,o=0,p=b.geoms;if(!c&&g.travsed>=g.currentCount)return 0;var q;for(q=0;q<g.totalCount;++q)!function(g){if(m[g>>5]&1<<(31&g)){var h=b.fragments.mesh2frag[a+":"+g];Array.isArray(h)&&(h=h[0]);var q=p.geoms[b.getGeometryId(h)];if(q&&q.packId==a){var r=q.vb.buffer===q.ib.buffer?q.vb.buffer.byteLength>q.vb.byteLength+q.ib.byteLength:q.vb.buffer.byteLength>q.vb.byteLength||q.ib.buffer.byteLength>q.ib.byteLength;(c||q.traversed!=d&&q.transparent!=e)&&(i=p.removeGeometry(q.svfid,f.delegate.webGLRenderer))>0?(k+=i,m[q.meshIndex>>5]&=~(1<<(31&q.meshIndex)),n=n||r):(++o,r&&(j+=q.vb.byteLength,j+=q.ib.byteLength+3&-4,l.push(q)))}else console.error("Mismapped or missing geometry %d:%d",a,g)}}(q);if(g.currentCount=o,g.culled=0,0==k)return 0;if(k/=Ql,0==l.length||!n)return k;var r=new ArrayBuffer(j),s=0;return l.forEach(function(a){a.vb=h(Float32Array,a.vb,4),a.ib=h(Uint16Array,a.ib,2)}),k}var e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},f=b;this.options={onDemandLoading:!1,pageOutGeometryEnabled:!1},e(this.options,c),this.options.debug={maxPageOutSize:195,pixelCullingEnable:this.options.onDemandLoading,pixelCullingThreshold:Ri,occlusionThreshold:1,occlusionTestThreshold:1,startOcclusionTestingPackCount:8,testPackfileCount:4,useOcclusionInstancing:!0,automaticRefresh:!0,boxProxyMaxCount:0,boxProxyMinScreen:.4},e(this.options.debug,c.debug),this.reachLimit=!1,this.geomidsmap={},this.geomTravCount=[],this.loadedPacks={},this.loadedPackfileCount=0,this.memoryOverhead=0,this.loadingPacks={},this.loadingPacksSize=0,this.queuedPacks=[],this.packQueuedMap={},this.queuedPacksSize=0,this.occludedPacks=[],this.occlusionCulledCount=0,this.packsPagedOut=0,this.traversedCounter=0,this.transparentCounter=0,this.resetCount=0,this.invalidateCount=-1,this.geompacks=f.svf.geompacks,this.geommap=f.geommap,this.totalGeomSize=this.options.totalGeomSize,this.overheadSize=this.options.overheadSize,this.minMemoryLimit=Math.min(Math.max(.1*this.totalGeomSize,10),50)+this.overheadSize,this.lastPageOut=-1,this.pageOutResetCounter=-1;var g,h=!1,i=0,j=0,k=0,l=[],m=-1,n=[],o=!0,p=null,q=0,r=!0,s=!1,t=function(a){this.resetCanPageOut(!!a.debug.unloadPackFiles,0!=a.delay,!1)}.bind(this);f.delegate.eventTarget&&f.delegate.eventTarget.addEventListener("loadMissingGeometry",t),this.dtor=function(){f.delegate.eventTarget&&f.delegate.eventTarget.removeEventListener("loadMissingGeometry",t)},this.onDemandLoadingEnabled=function(){return this.options.onDemandLoading},this.pageOutGeometryEnabled=function(){return this.options.pageOutGeometryEnabled&&this.onDemandLoadingEnabled()},this.pixelCullingEnable=function(){return this.options.debug.pixelCullingEnable},this.pixelCullingThreshold=function(){return this.options.debug.pixelCullingThreshold},this.getMemoryLimit=function(){return Math.max(this.minMemoryLimit,this.options.limit)},this.getMemoryInfo=function(){return this.onDemandLoadingEnabled()?{limit:this.options.limit,effectiveLimit:this.getMemoryLimit(),loaded:this.preparedPackFilesSize()}:null},this.getLoadedMeshes=function(a){var b=this.loadedPacks[a];return b&&b.inMemory},this.loadPackFile=function(){return!0},this.doLoadPackFile=function(a){return!!this.onDemandLoadingEnabled()&&(!!this.loadingPacks[a]||!0!==this.occludedPacks[a]&&(this.queuedPacks.length>0||this.occlusionTesting>=1?!!this.addGeomPackMissingLastFrame(a)&&(this.loadGeometryMissingLastFrame(),!0):f.loadGeometryPackOnDemand(a,this.getLoadedMeshes(a))))},this.unloadPackFile=function(a,b,c){if(!this.onDemandLoadingEnabled())return!1;var e=f.model.getFragmentList(),g=this.loadedPacks[a];return!!(e&&g&&e.geoms)&&(d(a,e,b,this.traversedCounter,this.transparentCounter,g),0==g.currentCount&&(delete this.loadedPacks[a],--this.loadedPackfileCount,c&&++this.packsPagedOut),!0)};var u=function(){if(this.resetCount!=this.pageOutResetCounter)return!1;f.delegate.requestRedraw(!1)}.bind(this);this.onPackFileLoaded=function(b,c,d){var e=this.geommap[b];if(s=!1,this.loadingPacks.hasOwnProperty(b)&&(delete this.loadingPacks[b],this.loadingPacksSize-=e.geomSize+e.usize),c){var f=this.loadedPacks[b];if(!f){var g=c.meshes.length;f=this.loadedPacks[b]={totalCount:g,travsed:0,culled:0,resetCounter:this.resetCount,geomSize:0,inMemory:new Array((g+31)/32|0)},++this.loadedPackfileCount,this.options.debug.occlusionTestThreshold>0&&0==this.occlusionTesting&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=1)}f.geomSize+=d,f.currentCount=f.totalCount,f.inMemory.fill(-1),this.totalGeomSize+=f.geomSize-e.geomSize,this.packQueuedMap[b]&&(this.queuedPacksSize+=f.geomSize-e.geomSize),e.geomSize=f.geomSize,u()}this.loadedGeometrySize()>this.getMemoryLimit()&&a.logger.warn("More pack files being loaded than the max count: "+this.loadedGeometrySize())},this.checkLoadFinished=function(){if(!s){var a=f.pack_workers;if(a)for(var b=0;b<a.length;b++)if(0!=a[b].queued)return;(0!=this.geomPacksMissingLastFrame().length||i<l.length)&&(this.loadedGeometrySize()<this.getMemoryLimit()||r)||(s=!0,f.onDemandGeomLoadDone())}},this.doOnDemandLoadFinished=function(){this.loadGeometryMissingLastFrame(),this.checkLoadFinished()},this.onPackFileLoading=function(a){if(!this.loadingPacks.hasOwnProperty(a)){this.loadingPacks[a]=!0;var b=this.geommap[a];this.loadingPacksSize+=b.geomSize+b.usize}},this.onProcessReceivedMesh=function(a,b){var c=a.svfid;this.onDemandLoadingEnabled()&&b>1&&null==this.geomidsmap[c]&&(this.geomidsmap[c]=this.geomTravCount.length,this.geomTravCount.push(0))},this.loadedGeometrySize=function(){return f.model.getGeometryList().geomMemory/Ql+this.overheadSize},this.preparedPackFilesSize=function(){return this.loadingPacksSize+this.loadedGeometrySize()},this.cancelPending=function(){this.loadingPacksSize>1/Ql&&(f.cancelGeometryPackLoading(),this.loadingPacks={},this.loadingPacksSize=0),this.queuedPacks.length=0,this.queuedPacksSize=0,this.packQueuedMap={},this.occlusionTesting=this.onDemandLoadingEnabled()&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount?1:0,this.occludedPacks.length=0},this.resetIterator=function(a){this.lastCamera=a,++this.resetCount},this.reset=function(){var a=this.loadedPacks;for(var b in a)a[b].travsed=0,a[b].culled=0;this.geomTravCount.fill(0),this.resetCount>this.invalidateCount&&(this.cancelPending(),this.resetCanPageOut(!1,!0,!0))},this.geomPacksMissingLastFrame=function(){return this.queuedPacks},this.addGeomPackMissingLastFrame=function(a){if(!this.onDemandLoadingEnabled())return!0;if(this.pageOutGeometryEnabled()&&this.loadedGeometrySize()>=this.getMemoryLimit()&&(this.reachLimit=!0),!this.packQueuedMap[a]){var b=this.geommap[a];b&&(this.queuedPacks.push(a),this.queuedPacksSize+=b.geomSize,this.packQueuedMap[a]=!0)}return!0},this.loadGeometryMissingLastFrame=function(){var a,b=this.queuedPacks;for(a=0;a<b.length;++a){var c=b[a];if(this.occlusionTesting>=1&&void 0===this.occludedPacks[c])break;if(!this.geommap[c].loading&&!this.occludedPacks[c]&&!f.loadGeometryPackOnDemand(c,this.getLoadedMeshes(c)))break}0!=a||s||u();var d=this;b.splice(0,a).forEach(function(a){d.queuedPacksSize-=d.geommap[a].geomSize,delete d.packQueuedMap[a]})},this.needResumeNextFrame=function(){return h};var v=function(a,b){var c=a>=n.length?1e10:n[a];return(b>=n.length?1e10:n[b])-c}.bind(this.loadedPacks);this.markVisibleGeoms=function(a){var b,c=f.model.getData().instanceTree||f.model.getData().fragmentMap;if(c&&a.visibleIdCB&&(b=a.visibleIdCB())){var d,e,g=++this.traversedCounter,h={},i=b.length,j=this.loadedPacks;for(e in j)j[e].travsed=0;for(var k=0;k<i;k+=4)d=b[k]|b[k+1]<<8|b[k+2]<<16,(d=d<<8>>8)>0&&(h[d]=1+(0|h[d]));var l=f.model.getFragmentList(),m=0|this.options.debug.occlusionThreshold;for(e in h)d=Number(e),h[d]>=m&&c.enumNodeFragments(d,function(a){var b=l.getGeometry(a);if(b){var c=j[b.packId];c&&b.traversed!=g&&++c.travsed,b.traversed=g}})}},this.pageOut=function(b,c,d){h=!1;var e=0;if(b&&this.options.debug.occlusionTestThreshold>0&&this.loadedPackfileCount>=this.options.debug.startOcclusionTestingPackCount&&(this.occlusionTesting=Pl),this.occlusionTest(d),!b)return e;this.pageOutResetCounter=this.resetCount;var f=this.loadedGeometrySize();if(r=!0,f&&(this.reachLimit||f>this.getMemoryLimit())){this.markVisibleGeoms(d);var g=this.loadedPacks,i=Object.keys(g),j=!1;i.sort(v);var k=f-Math.min(f,this.options.debug.maxPageOutSize);return i.every(function(a){return g[a].resetCounter<this.resetCount?this.unloadPackFile(a,!1,!0):j=!0,this.loadedGeometrySize()>k}.bind(this)),c&&this.loadedGeometrySize()==f&&g[i[0]].resetCounter<this.resetCount&&(this.unloadPackFile(i[0],!1,!0),a.logger.log("A force page out occur.")),this.loadedGeometrySize()==f?(e=0,this.reachLimit=!0):(this.reachLimit=!1,this.loadGeometryMissingLastFrame(),h=!0),this.lastPageOut=f-this.loadedGeometrySize(),a.logger.log("[On Demand Loading] Unload pack files size: "+this.lastPageOut),window&&window.gc&&window.gc(),0==this.lastPageOut&&(r=j,this.checkLoadFinished()),e}return h=h||this.queuedPacks.length>0,this.loadFragsFromLoadOrder(),e},this.occlusionTest=function(b){function c(a){var b=j.fragments.packIds;if(!b)return null;var c=[];return a.forEach(function(a){for(var d=[],e=b.lastIndexOf(a);e>=0;)b[e]==a?d.push(e--):e=b.lastIndexOf(a,e-1);c.push(d)}),c}function d(a){var c=null;o=0;var d=b.queuedPacks,e=b.occludedPacks;a=Math.min(4,a||4);for(var f=d.length,g=0;g<f&&a>0;++g){var h=d[g];void 0===e[h]?(c=c||[],c.push(h),--a):e[h]||++o}return c}function e(c){l=null;for(var d=0;d<m.length;++d)b.occludedPacks[m[d]]=!c[d],c[d]||(a.logger.debug("[On Demand Loading] Occluded Geometry Pack file: "+m[d]),++b.occlusionCulledCount);b.doOnDemandLoadFinished(),g()}function g(){n||l||s||(l=null,i&&!k&&(m=d(b.options.debug.testPackfileCount))&&(n=setTimeout(function(){n=0;var a=c(m);l=i(j.boxes,b.options.debug.occlusionTestThreshold,a,b.options.debug.useOcclusionInstancing,m),l.then(e,function(){e([!0,!0,!0,!0])})},o*p)))}function h(a){l||this.occlusionTesting<Pl||(a&&(i=a.occlusionTestCB,k=a.moved),(j=f.model.getFragmentList())&&i&&!k&&g())}var i=null,j=null,k=!1,l=null,m=null,n=0,o=0,p=3;return h}(this),this.loadFragsFromLoadOrder=function(){for(var a=f.model.getFragmentList();i<l.length;){for(var b=l[i],c=b.length;j<c;){var d=b[j];if(!a.getGeometry(d)){var e=a.fragments.packIds?a.fragments.packIds[d]:d,g=this.queuedPacks.length;if(!this.doLoadPackFile(e)&&g==this.queuedPacks.length)return}++j}++i,j=0}},this.pfOrder=function(){return g},this.getNumVisiblePFs=function(){return g?m:-1},this.onLoadOrderCalculated=function(b){if(b.error)return void(p=null);if(b.fragOrder&&b.packOrder&&(p=b),b.id==k&&p){if(this.lastPageOut=-1,r=!0,s=!1,l.length=0,f.model){var c=f.model.getFastLoadList();c&&(a.logger.log("Using PF fast-load-list for homeView, size:",c.length),l.push(c))}l.push(p.fragOrder),g=p.packOrder,m=p.pfVisible;var d,e=g.length;for(n.length=this.geompacks.length,n.fill(1e10),d=0;d<e;++d)n[g[d]]=d;var h,o=f.model.getFragmentList(),q=this.overheadSize,t=this.getMemoryLimit();for(h=0;h<l.length&&q<t;++h){var u=l[h];e=u.length;var v=[];v.length=n.length,v.fill(0);var w=this.geompacks;for(d=0;d<e&&q<t;++d){var x=u[d],y=o.fragments.packIds?o.fragments.packIds[x]:x,z=w[y];if(z){var A=o.getGeometry(x)?z.geomSize:z.totalGeomSize;A>v[y]&&(q+=A-v[y],v[y]=A)}}}var B=this.loadedPacks;for(var C in B)B.hasOwnProperty(C)&&(v[C]||this.unloadPackFile(C,!0));++this.traversedCounter,++this.transparentCounter,this.reachLimit=this.loadedGeometrySize()>=this.getMemoryLimit(),this.cancelPending(),i=0,j=0,this.loadFragsFromLoadOrder(),f.delegate.requestRedraw(!0),this.invalidateCount=this.resetCount+1}},this.resetCanPageOut=function(a,b,c){function d(b){if(q=0,o||!c||b.options.debug.automaticRefresh){b.occlusionCulledCount=0,b.packsPagedOut=0;var d,e=b.lastCamera,g=b.loadedPacks;if(a)for(d in g)g.hasOwnProperty(d)&&b.unloadPackFile(d,!0);f.calculateLoadOrder(++k,e,b.options.debug.pixelCullingEnable?b.options.debug.pixelCullingThreshold:-1),o=!1}}q&&(clearTimeout(q),q=0),b?q=setTimeout(d,100,this):d(this)},this.onGeomTraversed=function(a,b){var c=a.packId,d=a.svfid;a.traversed=this.traversedCounter,b&&(a.transparent=this.transparentCounter);var e=!0,f=this.geomidsmap[d];null!=f&&(this.geomTravCount[f]+=2,this.geomTravCount[f]|=1,e=a.instanceCount==this.geomTravCount[f]>>1);var g=this.loadedPacks[c];g&&e&&g.travsed++},this.onGeomCulled=function(a){if(a){var b=a.packId,c=a.svfid,d=this.geomidsmap[c],e=!d;null!=d&&(1&this.geomTravCount[d]?this.onGeomTraversed(a):(this.geomTravCount[d]+=2,e=a.instanceCount==this.geomTravCount[d]>>1));var f=this.loadedPacks[b];f&&e&&f.culled++}}},Sl="UNLOAD_PROPERTYDB",Tl=1,Ul={},Vl=function(b,c,d){if(this.delegate=Ol.copyDelegate(this,d),this.eventTarget=this.delegate.eventTarget,this.model=c,this.svf=c&&c.getData(),this.dbPath="",this.sharedDbPath=!1,this.svf&&this.svf.propertydb&&this.svf.propertydb.avs.length){this.dbFiles=this.svf.propertydb;for(var e in this.dbFiles)this.dbFiles[e][0]&&(this.dbFiles[e][0]=this.dbFiles[e][0].replace(/\\/g,"/"));var f=Mi(this.svf.basePath);if(b){var g=Ll.simplifyPath(f+this.svf.propertydb.avs[0]);if((g=g.slice(0,g.lastIndexOf("/")+1))===b){var h={};for(var e in this.dbFiles){var i=this.dbFiles[e][0];i=Ll.simplifyPath(f+i),
h[e]=[i]}this.dbFiles=h,this.dbPath=b,this.sharedDbPath=!0}else this.dbPath=f,this.sharedDbPath=!1}else this.dbPath=f,this.sharedDbPath=!1}else this.sharedDbPath=!0,this.dbPath=b,this.dbFiles={attrs:[],avs:[],ids:[],values:[],offsets:[]},a.logger.log("Using shared db path "+b);this.queryParams="",this.svf&&this.svf.acmSessionId&&(this.queryParams="acmsession="+this.svf.acmSessionId)};Vl.prototype.dtor=function(){this.asyncPropertyOperation({operation:Sl},function(){},function(){})},Vl.prototype.processLoadResult=function(b){var c=this;if(b.instanceTreeStorage){var d=new lb(b.instanceTreeStorage,b.rootId,b.instanceBoxes);c.instanceTree=new hb(d,b.objectCount,b.maxTreeDepth),c.svf&&(c.svf.instanceTree=c.instanceTree)}else b.instanceTree?(a.logger.warn("glTF instance tree not supported"),c.hasObjectProperties=b.objectCount):b.objectCount&&(c.hasObjectProperties=b.objectCount,c.svf&&(c.svf.hasObjectProperties=b.objectCount));c.eventTarget.dispatchEvent({type:"propertyDbLoaded",svf:c.svf,model:c.model,target:c})},Vl.prototype.processLoadError=function(a){var b=this;b.propertyDbError=a,b.eventTarget.dispatchEvent({type:"propertyDbUnavailable",svf:b.svf,model:b.model,target:b})},Vl.prototype.load=function(){var a=this;if(this.svf&&this.svf.instanceTree&&this.svf.instanceBoxes)return void setTimeout(function(){a.processLoadResult(a.svf)},0);Nl||(Nl=this.delegate.workerScript.createWorkerWithIntercept(),Nl.addEventListenerWithIntercept(yb)),this.propWorker=Nl;var b=function(b){a.processLoadResult(b)},c=function(b){a.processLoadError(b)},d=zb(b,c),e={operation:"LOAD_PROPERTYDB",dbPath:this.dbPath,sharedDbPath:this.sharedDbPath,propertydb:this.dbFiles,fragToDbId:this.svf&&this.svf.fragments.fragId2dbId,fragBoxes:this.svf&&this.svf.fragments.boxes,cbId:d,queryParams:this.queryParams};Nl.doOperation(this.delegate.initLoadContext(e))},Vl.prototype.asyncPropertyOperation=function(b,c,d){var e=this;if(b.dbPath=this.dbPath,e.instanceTree||e.hasObjectProperties)b.cbId=zb(c,d),Nl.doOperation(b);else if(e.propertyDbError)d&&d(e.propertyDbError);else{var f=function f(g){e.eventTarget.removeEventListener("propertyDbLoaded",f),e.eventTarget.removeEventListener("propertyDbUnavailable",f),e.instanceTree||e.hasObjectProperties||e.propertyDbError?e.asyncPropertyOperation(b,c,d):d&&d({code:a.ErrorCodes.UNKNOWN_FAILURE,msg:"Failed to load properties"})};e.eventTarget.addEventListener("propertyDbLoaded",f),e.eventTarget.addEventListener("propertyDbUnavailable",f)}},Vl.prototype.getProperties=function(a,b,c){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbId:a},b,c)},Vl.prototype.getBulkProperties=function(a,b,c,d,e){this.asyncPropertyOperation({operation:"GET_PROPERTIES",dbIds:a,propFilter:b,ignoreHidden:e},c,d)},Vl.prototype.searchProperties=function(a,b,c,d,e){this.asyncPropertyOperation({operation:"SEARCH_PROPERTIES",searchText:a,attributeNames:b,completeInfo:e},c,d)},Vl.prototype.findProperty=function(a){var b=this;return new Promise(function(c,d){b.asyncPropertyOperation({operation:"FIND_PROPERTY",propertyName:a},c,d)})},Vl.prototype.findLayers=function(){var a=this;return new Promise(function(b,c){a.asyncPropertyOperation({operation:"FIND_LAYERS"},b,c)})},Vl.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:"BUILD_EXTERNAL_ID_MAPPING"},a,b)},Vl.prototype.isObjectTreeLoaded=function(){return!!this.instanceTree},Vl.prototype.getObjectTree=function(a,b){var c=this;if(c.instanceTree)a(c.instanceTree);else if(c.propertyDbError)b&&b(c.propertyDbError);else if("hasObjectProperties"in c)b&&b("F2D files do not have an InstanceTree.");else{var d=function d(){c.eventTarget.removeEventListener("propertyDbLoaded",d),c.eventTarget.removeEventListener("propertyDbUnavailable",d),c.getObjectTree(a,b)};c.eventTarget.addEventListener("propertyDbLoaded",d),c.eventTarget.addEventListener("propertyDbUnavailable",d)}};var Wl=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],Xl=new Float32Array(4),Yl=new Float32Array(4),Zl=function(c,d,e,f){if(!c.LogLuv)return void a.logger.warn("Environment map expected to be in LogLuv format.");for(var g=Math.pow(2,d),h=Array.isArray(c.image)?c.image:[c.image],i=0;i<h.length;i++)for(var j=h[i],k=0;k<j.mipmaps.length;k++){var l,m=j.mipmaps[k],n=m.data;e?(l=new Uint16Array(n.length/4*3),m.data=l):l=n.buffer;for(var o=0,p=0;p<n.length;p+=4)Xl[0]=n[p]/255,Xl[1]=n[p+1]/255,Xl[2]=n[p+2]/255,Xl[3]=n[p+3]/255,Bb(Yl,Xl),e?(Db(Xl,Yl,g),l[o++]=hl(Xl[0]),l[o++]=hl(Xl[1]),l[o++]=hl(Xl[2])):(Cb(Xl,Yl,g),n[p]=Math.round(255*Xl[0]),n[p+1]=Math.round(255*Xl[1]),n[p+2]=Math.round(255*Xl[2]),n[p+3]=Math.round(255*Xl[3]))}c.LogLuv=!1,e?(c.type=b.HalfFloatType,c.format=b.RGBFormat,c.RGBM=!1,c.GammaEncoded=!0):c.RGBM=!0,f&&f(c)},$l=null,_l=1,am=function(c,d,e,f,g){if(!d.LogLuv)return void a.logger.warn("Environment map expected to be in LogLuv format.");$l||($l=c.createWorker());var h=_l++,i=function a(c){if(c.data.id===h){$l.removeEventListener("message",a);var e=c.data.map;d.image=e.image,d.LogLuv=!1,f?(d.type=b.HalfFloatType,d.format=b.RGBFormat,d.RGBM=!1,d.GammaEncoded=!0):d.RGBM=!0,g(d)}};$l.addEventListener("message",i),$l.doOperation({operation:"DECODE_ENVMAP",map:d,exposure:e,useHalfFloat:f,id:h},Eb(d))};!function(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},e=c("DXT1"),f=c("DXT3"),g=c("DXT5"),h=new Int32Array(a,0,31);if(542327876!==h[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),d;if(4&!h[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),d;var i,j=h[21],k=!1;switch(j){case e:i=8,d.format=THREE.RGB_S3TC_DXT1_Format;break;case f:i=16,d.format=THREE.RGBA_S3TC_DXT3_Format;break;case g:i=16,d.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==h[22]&&16711680&h[23]&&65280&h[24]&&255&h[25]&&4278190080&h[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",function(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}(j)),d;k=!0,i=64,d.format=THREE.RGBAFormat}d.mipmapCount=1,h[7]>0&&!1!==b&&(d.mipmapCount=Math.max(1,h[7])),d.isCubemap=!!(512&h[28]),d.width=h[4],d.height=h[3];for(var l=h[1]+4,m=d.width,n=d.height,o=d.isCubemap?6:1,p=0;p<o;p++){for(var q=0;q<d.mipmapCount;q++){if(k)var r=function(a,b,c,d){for(var e=c*d*4,f=new Uint8Array(a,b,e),g=new Uint8Array(e),h=0,i=0,j=0;j<d;j++)for(var k=0;k<c;k++){var l=f[i];i++;var m=f[i];i++;var n=f[i];i++;var o=f[i];i++,g[h]=n,h++,g[h]=m,h++,g[h]=l,h++,g[h]=o,h++}return g}(a,l,m,n),s=r.length;else var s=Math.max(4,m)/4*Math.max(4,n)/4*i,r=new Uint8Array(a,l,s);var t={data:r,width:m,height:n};d.mipmaps.push(t),l+=s,m=Math.max(.5*m,1),n=Math.max(.5*n,1)}m=d.width,n=d.height}return d}}(),function(){THREE.PVRLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager,this._parser=THREE.PVRLoader.parse},THREE.PVRLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.PVRLoader.prototype.constructor=THREE.PVRLoader,THREE.PVRLoader.parse=function(a,b){var c=new Uint32Array(a,0,13),d={buffer:a,header:c,loadMipmaps:b};if(55727696===c[0])return THREE.PVRLoader._parseV3(d);if(559044176===c[11])return THREE.PVRLoader._parseV2(d);throw new Error("[THREE.PVRLoader] Unknown PVR format")},THREE.PVRLoader._parseV3=function(a){var b,c,d=a.header,e=d[12],f=d[2],g=d[6],h=d[7],i=(d[9],d[10]),j=d[11];switch(f){case 0:b=2,c=THREE.RGB_PVRTC_2BPPV1_Format;break;case 1:b=2,c=THREE.RGBA_PVRTC_2BPPV1_Format;break;case 2:b=4,c=THREE.RGB_PVRTC_4BPPV1_Format;break;case 3:b=4,c=THREE.RGBA_PVRTC_4BPPV1_Format;break;default:throw new Error("pvrtc - unsupported PVR format "+f)}return a.dataPtr=52+e,a.bpp=b,a.format=c,a.width=h,a.height=g,a.numSurfaces=i,a.numMipmaps=j,a.isCubemap=6===i,THREE.PVRLoader._extract(a)},THREE.PVRLoader._parseV2=function(a){var b,c,d=a.header,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],b=(d[5],d[6]),j=(d[7],d[8],d[9],d[10]),k=(d[11],d[12]),l=255&i,m=j>0;if(25===l)c=m?THREE.RGBA_PVRTC_4BPPV1_Format:THREE.RGB_PVRTC_4BPPV1_Format,b=4;else{if(24!==l)throw new Error("pvrtc - unknown format "+l);c=m?THREE.RGBA_PVRTC_2BPPV1_Format:THREE.RGB_PVRTC_2BPPV1_Format,b=2}return a.dataPtr=e,a.bpp=b,a.format=c,a.width=g,a.height=f,a.numSurfaces=k,a.numMipmaps=h+1,a.isCubemap=6===k,THREE.PVRLoader._extract(a)},THREE.PVRLoader._extract=function(a){var b={mipmaps:[],width:a.width,height:a.height,format:a.format,mipmapCount:a.numMipmaps,isCubemap:a.isCubemap},c=a.buffer,d=a.dataPtr,e=a.bpp,f=a.numSurfaces,g=0,h=0,i=0,j=0,k=0,l=0;2===e?(i=8,j=4):(i=4,j=4),h=i*j*e/8,b.mipmaps.length=a.numMipmaps*f;for(var m=0;m<a.numMipmaps;){var n=a.width>>m,o=a.height>>m;k=n/i,l=o/j,k<2&&(k=2),l<2&&(l=2),g=k*l*h;for(var p=0;p<f;p++){var q=new Uint8Array(c,d,g),r={data:q,width:n,height:o};b.mipmaps[p*a.numMipmaps+m]=r,d+=g}m++}return b}}();var bm=Ei()?4:1/0,cm=[],dm=0,em=Ei()?32:1/0;em*=1048576;var fm=0,gm=1/0,hm=function(){for(;dm<bm&&cm.length>0;){var a=cm.shift();++dm,a.loadFunction(a.context,a.path,a.mapping,a.callback,a.options)}},im=function(b,c,d,e,f,g){if(dm<bm&&cm.length<=0)return++dm,void b(c,d,e,f,g);if(a.assets&&c){var h=Ll.generateUrl(c.endpoint,"items",d);if(c.queryParams){h=h+(-1===h.indexOf("?")?"?":"&")+c.queryParams}a.assets.push([h,c.headers,null])}cm.push({loadFunction:b,context:c,path:d,mapping:e,callback:f,options:g}),hm()},jm=function(a,c,d,e,f,g,h){mm.loadTextureWithSecurity(d,b.UVMapping,function(b){if(b){var f=g.materials.scene.SceneUnit,i=a.webGLRenderer?a.webGLRenderer.getMaxAnisotropy():0;h(e,b,f,i)}var j=a.matman;j&&(j.setTextureInCache(c,e,b,d),g.loadOptions.onTextureReceived&&g.loadOptions.setTextureInCache(j,e,b,!Ob()),Ob()||!g.loadDone||g.texLoadDone||(g.texLoadDone=!0,a.eventTarget.dispatchEvent({type:"texturesLoaded",model:c})))},f,a.initLoadContext)},km=function(a,b,c){var d=c.length;if(d>0){mm.setTextureCount(d);for(var e=b.getData(),f=0;f<d;++f){var g=c[f];jm(a,b,g.path,g.map,g.acmSessionId,e,ck.convertTexture)}}},lm=function(a,b,c,d){if(c.textureMaps&&!c.texturesLoaded){c.texturesLoaded=!0;var e=c.textureMaps;for(var f in e){var g=e[f];g.uri&&g.textureObj&&g.mapName&&!a.matman.loadTextureFromCache(b,c,g,f)&&d.push(function(a,b,c,d){var e=a.getData();return{path:mm.calculateTexturePath(a,c.uri,b),map:c,acmSessionId:e.acmSessionId}}(b,c,g,f))}}},mm=function(){function c(){Bl(this,c)}return Cl(c,null,[{key:"setMaxRequest",value:function(a){a>0&&(bm=a)}},{key:"getMaxRequest",value:function(){return bm}},{key:"setMemoryLimit",value:function(a){a>0&&(em=a,c.setTextureCount(fm))}},{key:"getMemoryLimit",value:function(){return em}},{key:"setTextureCount",value:function(a){a>=0&&(fm=a,gm=Math.max(16384,em/(4*fm)))}},{key:"getTextureCount",value:function(){return fm}},{key:"calculateTexturePath",value:function(a,b,c,d){var e=a.getData(),f=null,g=c&&c.proteinType,h=c&&c.isPrismMaterial&&c.prismType,i=(h&&Ll.endpoint.PRISM_ROOT||g&&Ll.endpoint.PROTEIN_ROOT)&&(0===b.indexOf("1/Mats")||0===b.indexOf("2/Mats")||0===b.indexOf("3/Mats"));if(d&&(d.asset=null),i)f=h?Ll.endpoint.PRISM_ROOT+b:Ll.endpoint.PROTEIN_ROOT+b;else{for(var j=0;j<e.manifest.assets.length;++j){var k=e.manifest.assets[j];if(k.id.toLowerCase()==b.toLowerCase()){f=Mi(e.basePath+k.URI),d&&(d.asset=k);break}}f||(f=Mi(e.basePath+b))}return f}},{key:"loadTextureWithSecurity",value:function(c,d,e,f,g,h,i){var j=void 0;Ll.endpoint.getUseCredentials()?(j=Ll.endpoint.pathRequiresCredentials(c),b.ImageUtils.crossOrigin=j?"use-credentials":"anonymous"):b.ImageUtils.crossOrigin="";var k=c.indexOf("urn:"),l=void 0;j&&-1!==k&&(l=Ll.endpoint.getDomainParam(),f&&(l=l?l+"&":"",l+="acmsession="+f)),i&&i.queryParams&&(l=l?l+"&":"",l+=i.queryParams),l&&(c+="?"+l);var m=function(a){dm--,e(a),hm()},n=h?m:function(a){dm--,a&&(a.image=Fb(a.image)),e(a),hm()},o=function(b){dm--,a.logger.error("Texture load error",b),e(null)};if(Ki())return void im(Mb,g(),c,d,m,i);if(".dds"===c.slice(c.length-4).toLocaleLowerCase())if(Ci()){var p=c.slice(0,c.length-4)+".pvr";im(function(a,c,d,e){(new b.PVRLoader).load(p,e,o)},null,p,d,m)}else im(function(a,c,d,e){(new b.DDSLoader).load(c,e,o)},null,c,d,m);else j||i&&(i.rawData||i.extractImage)?im(Lb,g(),c,d,n,i):im(function(a,c,d,e){b.ImageUtils.loadTexture(c,d,e,o)},null,c,d,n,i)}},{key:"setTextureDefinition",value:function(a,b,c,d,e){return!!Nb(b,a.matman,c,d)&&(c.textureMaps[d].textureObj=e,!0)}},{key:"loadTexture",value:function(a,b,c,d,e,f,g,h){function i(a){h&&h(a?null:"Texture load failed",a)}var j=c.textureMaps;if(!j)return!1;var k=j[d];return!(!k||!k.textureObj)&&(k.uri=e,a.matman.loadTextureFromCache(b,c,k,d,f,i)?h&&h(null,c[d]):jm(a,b,f,k,null,b.getData(),g),!0)}},{key:"loadMaterialTextures",value:function(a,b,c){var d=[];lm(a,b,c,d),km(a,b,d)}},{key:"loadModelTextures",value:function(a,b){var c=a.matman,d=c._getModelHash(b),e=[];for(var f in c._materials)if(-1!=f.indexOf(d)){var g=c._materials[f];lm(a,b,g,e)}km(a,b,e);var h=b.getData();Ob()||!h.loadDone||h.texLoadDone||(h.texLoadDone=!0,a.eventTarget.dispatchEvent({type:"texturesLoaded",model:b}))}},{key:"loadCubeMap",value:function(a,c,d){var e=function(e){e?(e.mapping=b.CubeReflectionMapping,e.LogLuv=-1!==a.indexOf("logluv"),e.RGBM=-1!==a.indexOf("rgbm"),Zl(e,c,!1,d)):d&&d(e)},f=void 0;return b.ImageUtils.crossOrigin="",Array.isArray(a)?(f=b.ImageUtils.loadTextureCube(a,b.CubeReflectionMapping,e),f.format=b.RGBFormat):"string"==typeof a?-1!==a.toLowerCase().indexOf(".dds")?f=(new b.DDSLoader).load(a,e):(f=b.ImageUtils.loadTexture(a,b.SphericalReflectionMapping,d),f.format=b.RGBFormat):a?d&&d(a):d&&d(null),f}}]),c}(),nm=Ki()?10:Ei()?2:6,om=1048576,pm={},qm={type:"fragmentLoaded",model:null,data:null,getFragIds:function(){if(this.fragIds)return this.fragIds;var a=this.model;if(!a||!this.data||!this.data.meshes)return null;var b=this.fragIds=[],c=this.data.packId,d=0,e=a.getData(),f=e.fragments,g=this.data.meshes.length;for(d=0;d<g;++d){var h=c+":"+d++,i=f.mesh2frag[h];if(void 0===i)return;Array.isArray(i)?i.forEach(function(a){b.push(a)}):b.push(i)}return b}},rm=function(a,b){qm.model=a.model,qm.data=b,a.delegate.eventTarget.dispatchEvent(qm)},sm=function(c){function d(c,e){Bl(this,d);var f=Fl(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c,e));f.next_pack=0,f.loading=!1,f.loadedPacksCount=0,f.tmpMatrix=new b.Matrix4,f.tmpBox=new b.Box3,f.fetchingTopology=!1,f.loadTime=0;var g=f;f.delegate.loadPropertyDb||(f.delegate.loadPropertyDb=function(a,b){var c=b.getData();c.propDbLoader=new Vl(a,b,this),c.propDbLoader.load()}),f.delegate.loadModelTextures||(f.delegate.loadModelTextures=function(a){mm.loadModelTextures(g.delegate,a)});var h=e&&e.memory,i=f.memoryOpts={debug:{}};if(!Ki()){if(i.limit=Di()?195:Ci()?150:600,i.onDemandLoading=!0,i.pageOutGeometryEnabled=!0,h){i.debug=h.debug||{};var j=h.hasOwnProperty("limit")?h.limit:0;(0|j)>0?i.limit=0|j:0==j?(i.onDemandLoading=!1,i.pageOutGeometryEnabled=!1,i.debug.force=!1):a.logger.warn("Memory limit, "+j+", is invalid - ignored")}i.onDemandLoading&&Oi(!0)}return f}return El(d,c),Cl(d,[{key:"dtor",value:function(){if(Dl(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"dtor",this).call(this),this.initWorkerScriptToken&&(this.initWorkerScriptToken.cancel(),this.initWorkerScriptToken=null,a.logger.debug("SVF loader dtor: on init worker script.")),this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null,a.logger.debug("SVF loader dtor: on svf worker.")),this.svfLoadOrderWorker&&(this.svfLoadOrderWorker.terminate(),this.svfLoadOrderWorker=null,a.logger.debug("SVF loader dtor: on load order worker.")),this.pack_workers){for(var b=0;b<this.pack_workers.length;b++)this.pack_workers[b].clearAllEventListenerWithIntercept(),this.pack_workers[b].terminate();this.pack_workers=null,a.logger.debug("SVF loader dtor: on geom worker.")}this.svf&&this.svf.propDbLoader&&(this.svf.propDbLoader.dtor(),this.svf.propDbLoader=null),this.pagingProxy&&(this.pagingProxy.dtor(),this.pagingProxy=null),this.tmpMatrix=null,this.tmpBox=null,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadTime=0}},{key:"loadFile",value:function(b,c,d,e){if(!this.delegate)return a.logger.log("SVF loader was already destructed. So no longer usable."),!1;if(this.loading)return a.logger.log("Loading of SVF already in progress. Ignoring new request."),!1;this.loading=!0,this.delegate.eventTarget.dispatchEvent({type:"fileLoadStarted",loader:this});var f=b.indexOf("urn:");if(-1!=f){b=decodeURIComponent(b);var g=b.substr(f,b.substr(f).indexOf("/"));a.logger.log("Extracted URN: "+g);var h=g.lastIndexOf(":");this.svfUrn=g.substr(h+1)}else this.svfUrn=b;this.sharedDbPath=c.sharedPropertyDbPath,this.currentLoadPath=b;var i=this.currentLoadPath.lastIndexOf("/");-1!=i&&(this.basePath=this.currentLoadPath.substr(0,i+1)),this.acmSessionId=c.acmSessionId,this.queryParams="",this.acmSessionId&&(this.queryParams="acmsession="+this.acmSessionId),this.options=c;var j=this;return this.initWorkerScriptToken=this.delegate.workerScript.initWorkerScript(function(){j.loadSvfCB(b,c,d,e)}),!0}},{key:"loadSvfCB",value:function(b,c,e,f){this.t0=(new Date).getTime(),this.firstPixelTimestamp=null,this.failedToLoadSomeGeometryPacks=null,this.failedToLoadPacksCount=0;var g=!0;c.doneWhenDownloaded&&(this.onDone=e);var h=this,i={url:Mi(b),basePath:this.currentLoadPath,objectIds:c.ids,globalOffset:c.globalOffset,placementTransform:c.placementTransform,applyRefPoint:c.applyRefPoint,queryParams:this.queryParams,bvhOptions:c.bvhOptions||{isWeakDevice:Ei()},applyScaling:c.applyScaling,loadInstanceTree:c.loadInstanceTree,max_pf_files:0},j=this.memoryOpts.onDemandLoading||!!this.memoryOpts.debug.memoryOptimizedSvfLoading;j&&(i.perfOpt={memoryOptimizedSvfLoading:j,forceMemoryOptimizedMode:!!this.memoryOpts.debug.forceMemoryOptimizedModeOnSvfLoading});var k=this.svfWorker=this.delegate.workerScript.createWorkerWithIntercept(),l=function(b){var j=function(){k&&(k.clearAllEventListenerWithIntercept(),k.terminate(),h.svfWorker=null,k=null)};if(g&&f&&(g=!1,f()),b.data&&b.data.manifest)d.interceptManifest.call(h,b.data.manifest),i.operation="LOAD_SVF_CONTD",i.manifest=b.data.manifest,k.doOperation(i);else if(b.data&&b.data.svf){var l=h.svf=b.data.svf;h.failedToLoadSomeGeometryPacks&&(e&&(e(h.failedToLoadSomeGeometryPacks,null),delete h.onDone),h.failedToLoadSomeGeometryPacks=null),h.onModelRootLoadDone(l),e&&!c.doneWhenDownloaded&&e(null,h.model),h.delegate.eventTarget.dispatchEvent({type:"svfLoaded",svf:l,model:h.model}),h.svf.loadDone=!1;var m=!1;if(h.svf.metadata&&h.svf.metadata.gltf&&(m=!0),!m){var n=l.geompacks.length;if(0==n)h.onGeomLoadDone();else if(h.model.getFragmentList().onDemandLoadingEnabled())a.logger.debug("[On Demand Loading]: Enabled."),h.loadedPacksCount=0;else if(n)for(var o=Math.min(n,nm),p=0;p<o;p++)!function(a){var b=l.geompacks[h.next_pack++];b.loading=!0,Ki()?h.loadGeometryPack(b.id,b.uri):function(b){setTimeout(function(){h.loadGeometryPack(b.id,b.uri)},200*a)}(b)}(p)}1==b.data.progress&&(h.loading=!1,j()),l.fragments.polygonCounts||(l.fragments.polygonCounts=new Int32Array(l.fragments.length)),b.data.bvh&&(h.svf.bvh=b.data.bvh,h.model.setBVH(new mb(h.svf.bvh.nodes,h.svf.bvh.useLeanNodes),h.svf.bvh.primitives,h.options.bvhOptions),h.delegate.requestRedraw(!1))}else b.data&&b.data.bvh?(h.svf&&!h.svf.bvh&&(h.svf.bvh=b.data.bvh,h.model.setBVH(new mb(h.svf.bvh.nodes,h.svf.bvh.useLeanNodes),h.svf.bvh.primitives,h.options.bvhOptions),h.delegate.requestRedraw(!1)),h.loading=!1,j()):b.data&&b.data.mesh?(h.processReceivedMesh(b.data),1===b.data.progress&&(h.onGeomLoadDone(),h.loading=!1,j())):b.data&&b.data.progress?1==b.data.progress&&(h.loading=!1,j()):b.data&&b.data.error?(h.loading=!1,j(),a.logger.error("Error while processing SVF: "+JSON.stringify(b.data.error.args)),e&&(e(b.data.error,null),delete h.onDone)):b.data&&b.data.debug?a.logger.debug(b.data.message):(h.delegate.reportError(a.ErrorCodes.NETWORK_FAILURE,"SVF download failed."),h.loading=!1,j())};return k.addEventListenerWithIntercept(l),i.operation="LOAD_SVF",i.interceptManifest=!!d.interceptManifest,k.doOperation(this.delegate.initLoadContext(i)),!0}},{key:"cancelGeometryPackLoading",value:function(){if(this.pack_workers&&this.isValid()){for(var a=0;a<this.pack_workers.length;a++){if(this.svf){var b=this.geommap[this.pack_workers[a].packId];b&&(b.loading=!1)}this.pack_workers[a].queued=0,this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate()}this.pack_workers=null}}},{key:"loadGeometryPackOnDemand",value:function(b,c){function d(a,b){a.queued=0,h.geommap[b].loading=!1,f.doOnDemandLoadFinished()}if(!this.svf||!this.isValid())return!0;var e=this.geommap[b];if(!e||e.loading)return!0;this.t0||(this.t0=(new Date).getTime());var f=this.pagingProxy,g=void 0,h=this,i=function(b){if(b.data&&b.data.meshes){for(var c=b.data.meshes,e={packId:b.data.packId,meshIndex:0,mesh:null},g=0,i=0;i<c.length;i++){var j=c[i];j&&(e.meshIndex=i,e.mesh=j,h.processReceivedMesh(e),e.geometry&&(g+=e.geometry.byteSize+464,e.geometry=null))}f.onPackFileLoaded(b.data.packId,b.data,g/om),rm(h,b.data),b.data.progress>=1&&(h.loadedPacksCount++,d(h.pack_workers[b.data.workerId],b.data.packId))}else b.data&&b.data.progress?(h.pack_workers[b.data.workerId].queued-=1,h.delegate.signalProgress(100*h.loadedPacksCount/h.svf.geompacks.length)):b.data&&b.data.debug?a.logger.debug(b.data.message):b.data&&b.data.error?(f.onPackFileLoaded(b.target.packId,null,0),d(b.target,b.target.packId),++h.failedToLoadPacksCount,h.failedToLoadSomeGeometryPacks={code:b.data.error.code,msg:b.data.error.msg}):(f.onPackFileLoaded(b.target.packId,null,0),d(b.target,b.target.packId))};if(!this.pack_workers){this.pack_workers=[];var j=nm;for(g=0;g<j;g++){var k=this.delegate.workerScript.createWorkerWithIntercept();k.addEventListenerWithIntercept(i),k.queued=0,this.pack_workers.push(k)}}var l=0,m=this.pack_workers[0].queued;for(g=1;g<this.pack_workers.length;g++)this.pack_workers[g].queued<m&&(l=g,m=this.pack_workers[g].queued);if(m>1||f.preparedPackFilesSize()>=f.getMemoryLimit())return this.model.addGeomPackMissingLastFrame(b)||this.delegate.requestRedraw(!1),!1;var n=void 0,o=void 0,p=e.uri;n=this.pack_workers[l],n.queued+=2,n.packId=b,o=l,f.onPackFileLoading(b),e.loading=!0,this.svf.partPacksLoadDone=!1,a.logger.debug("[On Demand Loading] Loading Geometry Pack file: "+b);var q=Mi(this.svf.basePath+p),r={operation:"LOAD_GEOMETRY",url:q,packId:b,workerId:o,packNormals:this.options.packNormals,createWireframe:this.options.createWireframe,skipAssetCallback:!0,queryParams:this.queryParams,inMemory:c};return n.doOperation(this.delegate.initLoadContext(r)),!0}},{key:"loadGeometryPack",value:function(b,c){var d=void 0,e=void 0,f=void 0,g=void 0,h=this;if(this.svf&&this.isValid()){var i=function(b){if(b.data&&b.data.meshes){for(var c=b.data.meshes,d={packId:b.data.packId,meshIndex:0,mesh:null},e=0;e<c.length;e++){var f=c[e];f&&(d.meshIndex=e,d.mesh=f,h.processReceivedMesh(d))}if(b.data.progress>=1){h.pack_workers[b.data.workerId].queued-=1,h.loadedPacksCount++,h.delegate.signalProgress(100*h.loadedPacksCount/h.svf.geompacks.length);var i=!0;for(g=0;g<h.pack_workers.length;g++)if(0!=h.pack_workers[g].queued){i=!1;break}if(i){for(g=0;g<h.pack_workers.length;g++)h.pack_workers[g].clearAllEventListenerWithIntercept(),h.pack_workers[g].terminate();h.pack_workers=null}h.loadedPacksCount+h.failedToLoadPacksCount==h.svf.geompacks.length&&h.onGeomLoadDone()}}else if(b.data&&b.data.progress){if(h.pack_workers[b.data.workerId].queued-=1,h.next_pack<h.svf.geompacks.length){for(var j=null;h.next_pack<h.svf.geompacks.length&&(j=h.svf.geompacks[h.next_pack++],j.loading););j&&!j.loading?(j.loading=!0,h.loadGeometryPack(j.id,j.uri)):h.svf.fragments.packIds=null}}else b.data&&b.data.debug?a.logger.debug(b.data.message):b.data&&b.data.error?(++h.failedToLoadPacksCount,h.failedToLoadSomeGeometryPacks={code:b.data.error.code,msg:b.data.error.msg}):h.pack_workers[b.data.workerId].queued-=2},j=this.pack_workers;if(j||(j=this.pack_workers=[]),j.length<nm){var k=!0;for(f=0;f<j.length;f++)if(0===j[f].queued){k=!1;break}if(k){var l=this.delegate.workerScript.createWorkerWithIntercept();l.addEventListenerWithIntercept(i),l.queued=0,j.push(l)}}var m=0,n=j[0].queued;for(f=1;f<j.length;f++)j[f].queued<n&&(m=f,n=j[f].queued);d=j[m],d.queued+=2,e=m;var o=Mi(this.svf.basePath+c),p={operation:"LOAD_GEOMETRY",url:o,packId:parseInt(b),workerId:e,createWireframe:this.options.createWireframe,packNormals:this.options.packNormals,queryParams:this.queryParams};d.doOperation(this.delegate.initLoadContext(p))}}},{key:"processReceivedMesh",value:function(b){var c=b.packId+":"+b.meshIndex,d=this.svf,e=d.fragments,f=this.model,g=e.mesh2frag[c];if(void 0===g)return void a.logger.warn("Mesh "+c+" was not referenced by any fragments.");Array.isArray(g)||(g=[g]),Oj.meshToGeometry(b),b.geometry.packId=b.packId,b.geometry.meshIndex=b.meshIndex;var h=g.length,i=f.getFragmentList().getGeometryId(g[0]);f.getGeometryList().addGeometry(b.geometry,h,i),this.pagingProxy&&this.pagingProxy.onProcessReceivedMesh(b.geometry,h);for(var j=b.geometry.attributes.index.array||b.geometry.ib,k=j.length/3,l=0;l<g.length;l++){var m=0|g[l];f.getFragmentList().getOriginalWorldMatrix(m,this.tmpMatrix);var n=e.materials[m].toString();e.polygonCounts&&(e.polygonCounts[m]=k);var o=b.geometry;pm.geometry=o,pm.material=this.delegate.matman.setupMaterial(this.model,o,n),pm.matrix=this.tmpMatrix,pm.isLine=o.isLines,pm.isWideLine=o.isWideLines,pm.isPoint=o.isPoints,pm.is2d=o.is2d,f.activateFragment(m,pm,!!d.placementTransform)}this.model.getFragmentList().onDemandLoadingEnabled()||(e.mesh2frag[c]=null),e.numLoaded+=g.length,f.getGeometryList().geomPolyCount>d.nextRepaintPolys&&(this.firstPixelTimestamp=this.firstPixelTimestamp||Date.now(),d.numRepaints++,d.nextRepaintPolys+=1e4*Math.pow(1.5,d.numRepaints),this.delegate.requestRedraw(!1))}},{key:"onModelRootLoadDone",value:function(c){function d(a){n.isValid()&&n.pagingProxy&&n.pagingProxy.onLoadOrderCalculated(a.data)}c.geomMemory=0,c.fragments.numLoaded=0,c.gpuNumMeshes=0,c.gpuMeshMemory=0,c.nextRepaintPolys=0,c.numRepaints=0,c.urn=this.svfUrn,c.acmSessionId=this.acmSessionId,c.basePath=this.basePath,c.loadOptions=this.options;var e=Date.now();this.loadTime+=e-this.t0,a.logger.log("SVF load: "+(e-this.t0));var f=this.model=new this.delegate.model(c);f.loader=this;var g=this.memoryOpts;this.delegate.renderScene&&this.delegate.renderScene.length>0&&(g.pageOutGeometryEnabled=!1);var h=this.geommap={},i=Object.keys(c.fragments.mesh2frag).length,j=c.fragments.length,k=(224*i+134*j)/om,l=0;c.geompacks.forEach(function(a){a.hasOwnProperty("geomSize")||(a.geomSize=.7*a.usize),a.usize/=om,a.geomSize/=om,l+=a.geomSize,h[parseInt(a.id)]=a});var m=Ei()?Math.min(l,Pi/om):0;l+=k,g.totalGeomSize=l,g.overheadSize=k,g.onDemandLoading&&(l+m<g.limit&&!g.debug.force?g.onDemandLoading=!1:this.pagingProxy=new Rl(this,g)),f.initialize(this.pagingProxy);var n=this;this.model.getFragmentList().onDemandLoadingEnabled()&&c.fragments.boxes&&c.fragments.packIds&&(this.svfLoadOrderWorker=this.delegate.workerScript.createWorker(),this.svfLoadOrderWorker.addEventListener("message",d,!1),this.svfLoadOrderWorker.doOperation({operation:"CALCULATE_LOAD_ORDER",fragments:{boxes:c.fragments.boxes,packIds:c.fragments.packIds}}),this.model.setUUID(c.urn)),this.model.getFragmentList().onDemandLoadingEnabled()&&Ei()||this.options.skipPropertyDb?this.svf.fragmentMap=new ib(this.svf.fragments.fragId2dbId):this.delegate.loadPropertyDb(this.sharedDbPath,this.model);var o=this.convertMaterials(f);if(this.t0=e,c.bbox=(new b.Box3).copy(c.bbox),c.modelBox&&(c.modelBox=(new b.Box3).copy(c.modelBox)),c.refPointTransform&&(c.refPointTransform=new Tk(!0).copy(c.refPointTransform)),c.placementTransform&&(c.placementTransform=new Tk(!0).copy(c.placementTransform)),c.cameras)for(var p=0;p<c.cameras.length;p++){var q=c.cameras[p];q.position=(new b.Vector3).copy(q.position),q.target=(new b.Vector3).copy(q.target),q.up=(new b.Vector3).copy(q.up),isFinite(q.position.x+q.position.y+q.position.z+q.target.x+q.target.y+q.target.z+q.up.x+q.up.y+q.up.z)||(q.target=c.bbox.center(),q.position.copy(q.target),q.position.z+=c.bbox.max.z-c.bbox.min.z,q.up={x:0,y:1,z:0}),isFinite(q.aspect)||(q.aspect=1),isFinite(q.fov)||(q.fov=90),isFinite(q.orthoScale)||(q.orthoScale=1)}c.proteinMaterials&&Ll.endpoint.PROTEIN_ROOT&&Ll.endpoint.PRISM_ROOT&&this.delegate.loadModelTextures(this.model),a.logger.log("scene bounds: "+JSON.stringify(c.bbox));var r={category:"metadata_load_stats",urn:c.urn,has_topology:!!c.topologyPath,has_animations:!!c.animations,cameras:c.cameras?c.cameras.length:0,lights:c.lights?c.lights.length:0,materials:o,is_mobile:Ei()};a.logger.track(r),this.delegate.signalProgress(5),this.delegate.requestRedraw(!1)}},{key:"calculateLoadOrder",value:function(a,b,c){if(!this.svfLoadOrderWorker)return!1;var d={projectionMatrix:{elements:b.projectionMatrix.elements},matrixWorldInverse:{elements:b.matrixWorldInverse.elements},aspect:b.aspect,position:{x:b.position.x,y:b.position.y,z:b.position.z},clientWidth:b.clientWidth,clientHeight:b.clientHeight},e={operation:"CALCULATE_LOAD_ORDER",id:a,camera:d,pixelCullingThreshold:c};return this.svfLoadOrderWorker.doOperation(e),!0}},{key:"convertMaterials",value:function(a){var b=this.delegate.matman,c=this.svf,d=0,e=void 0;if(!c.materials)return d;if(c.gltfMaterials){var f=c.materials.materials;for(e in f){var g=f[e],h=ck.convertMaterialGltf(g,c),i=b._getMaterialHash(a,e);b.addMaterial(i,h,!1),d++}return d}var j=c.materials.materials,k=c.proteinMaterials?c.proteinMaterials.materials:null;for(e in j){var l=k&&k[e]&&ck.isPrismMaterial(k[e]),m=l?k[e]:j[e];b.convertOneMaterial(a,m,e),d++}return d}},{key:"makeBVH",value:function(b){var c=performance.now(),d=b.materials?b.materials.materials:null;b.bvh=new ob(b.fragments,d),b.bvh.build(this.options.bvhOptions||{isWeakDevice:Ei()});var e=performance.now();a.logger.log("BVH build time: "+(e-c))}},{key:"onDemandGeomLoadDone",value:function(){this.svf.loadDone=!0,this.svf.proteinMaterials&&Ll.endpoint.PROTEIN_ROOT&&Ll.endpoint.PRISM_ROOT||Ei()||this.delegate.loadModelTextures(this.model);var b=Date.now(),c="[On Demand Loading] On demand requested geometries load time: "+(b-this.t0);a.logger.log(c);var d={category:"on_demand_geom_load_stats",is_f2d:!1,has_prism:this.delegate.matman.hasPrism,load_time:b-this.t0,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),load_pack_count:this.loadedPacksCount,urn:this.svfUrn};a.logger.track(d),this.t0=null,a.assets&&!Ki()&&window.webkit&&(!function(a){var b={command:"assets",data:a};!Ki()&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage(b)}(a.assets),Ni()),this.loadedPacksCount=0,this.svf.partPacksLoadDone=!0,this.delegate.eventTarget.dispatchEvent({type:"geometryDownloadComplete",model:this.model,memoryLimited:!0}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)}},{key:"onGeomLoadDone",value:function(){this.svf.loadDone=!0,this.svf.proteinMaterials&&Ll.endpoint.PROTEIN_ROOT&&Ll.endpoint.PRISM_ROOT||this.delegate.loadModelTextures(this.model),this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var b=Date.now(),c="Fragments load time: "+(b-this.t0);this.loadTime+=b-this.t0;var d=this.firstPixelTimestamp-this.t0;c+=" (first pixel time: "+d+")",this.svf.bvh&&!this.svf.placementTransform||(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions),
this.delegate.requestRedraw(!1)),a.logger.log(c),this.options.useConsolidation&&this.delegate.webGLRenderer&&this.model.consolidate(this.delegate.matman,this.options.consolidationMemoryLimit,this.delegate.webGLRenderer);var e={category:"model_load_stats",is_f2d:!1,has_prism:this.delegate.matman.hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};d>0&&(e.first_pixel_time=d),a.logger.track(e),a.assets&&!Ki()&&window.webkit&&(!function(a){var b={command:"assets",data:a};!Ki()&&window.webkit.messageHandlers.callbackHandler&&window.webkit.messageHandlers.callbackHandler.postMessage(b)}(a.assets),Ni()),this.currentLoadPath=null,this.delegate.eventTarget.dispatchEvent({type:"geometryDownloadComplete",model:this.model,memoryLimited:!1}),this.onDone&&(this.onDone(null,this.model),delete this.onDone)}},{key:"fetchTopologyFile",value:function(b,c){function d(b){if(b.data["status-topology"])return h=(new Date).getTime(),j=Math.round((h-g)/1e3),void a.logger.log("Topology file downloaded. ("+j+" seconds). Processing...");var d=b.data["fetch-topology"];d&&(i=(new Date).getTime(),j=Math.round((i-h)/1e3),d.topology?a.logger.log("Topology file processed successfully! ("+j+" seconds)."):a.logger.log("Topology file processed, but an error ocurred. ("+j+" seconds)."),c(d),k.fetchingTopology=!1,e.clearAllEventListenerWithIntercept(),e.terminate(),e=null)}if(!this.fetchingTopology){this.fetchingTopology=!0;var e=this.delegate.workerScript.createWorkerWithIntercept();e.addEventListenerWithIntercept(d);var f={path:b,queryParams:this.queryParams},g=(new Date).getTime(),h=void 0,i=void 0,j=void 0;a.logger.log("Fetching topology file..."),f.operation="FETCH_TOPOLOGY",e.doOperation(this.delegate.initLoadContext(f));var k=this}}},{key:"is3d",value:function(){return!0}}]),d}(Ol);sm.interceptManifest=void 0;var tm=["degree","radian","millimeter","centimeter","meter","kilometer","inch","foot","mile"],um={mm:"millimeter",cm:"centimeter",m:"meter",km:"kilometer",in:"inch",ft:"foot"},vm=["AssetLibID","Hidden","thumbnail","unifiedbitmap_Bitmap","bumpmap_Bitmap","BaseSchema","UIName","revision","opaque_albedo_urn","opaque_f0_urn","opaque_luminance_modifier_urn","opaque_mfp_modifier_urn","surface_albedo_urn","surface_anisotropy_urn","surface_cutout_urn","surface_normal_urn","surface_rotation_urn","surface_roughness_urn"],wm=["beckmann","ggx"],xm={surface_ndf_type:wm,layered_ndf_type:wm,bumpmap_Type:["height","normal"],wood_pore_type:["both","earlywood","latewood"],common_Shared_Asset:[0,1]},ym={strings:$b,booleans:ac,scalars:Zb,integers:bc,colors:Xb,choicelists:Yb,uris:_b},zm={texture_RealWorldScaleX:!0,texture_RealWorldScaleY:!0,texture_RealWorldOffsetX:!0,texture_RealWorldOffsetY:!0,bumpmap_Depth:!0,bumpmap_RealWorldScaleX:!0,bumpmap_RealWorldScaleY:!0,bumpmap_RealWorldOffsetX:!0,bumpmap_RealWorldOffsetY:!0,unifiedbitmap_RealWorldScaleX:!0,unifiedbitmap_RealWorldScaleY:!0,unifiedbitmap_RealWorldOffsetX:!0,unifiedbitmap_RealWorldOffsetY:!0},Am={bumpmap_RealWorldScaleX:"texture_RealWorldScaleX",bumpmap_RealWorldScaleY:"texture_RealWorldScaleY",bumpmap_RealWorldOffsetX:"texture_RealWorldOffsetX",bumpmap_RealWorldOffsetY:"texture_RealWorldOffsetY",bumpmap_UScale:"texture_UScale",bumpmap_VScale:"texture_VScale",bumpmap_UOffset:"texture_UOffset",bumpmap_VOffset:"texture_VOffset",bumpmap_URepeat:"texture_URepeat",bumpmap_VRepeat:"texture_VRepeat",bumpmap_WAngle:"texture_WAngle",unifiedbitmap_RealWorldScaleX:"texture_RealWorldScaleX",unifiedbitmap_RealWorldScaleY:"texture_RealWorldScaleY",unifiedbitmap_RealWorldOffsetX:"texture_RealWorldOffsetX",unifiedbitmap_RealWorldOffsetY:"texture_RealWorldOffsetY",unifiedbitmap_UScale:"texture_UScale",unifiedbitmap_VScale:"texture_VScale",unifiedbitmap_UOffset:"texture_UOffset",unifiedbitmap_VOffset:"texture_VOffset",unifiedbitmap_URepeat:"texture_URepeat",unifiedbitmap_VRepeat:"texture_VRepeat",unifiedbitmap_WAngle:"texture_WAngle"},Bm={height:0,normal:1},Cm={beckmann:0,ggx:1},Dm={millimeter:1e3,MilliMeter:1e3,mm:1e3,8206:1e3,decimeter:10,DeciMeter:10,dm:10,8204:10,centimeter:100,CentiMeter:100,cm:100,8205:100,meter:1,Meter:1,m:1,8193:1,kilometer:.001,KiloMeter:.001,km:.001,8201:.001,inch:39.37008,Inch:39.37008,in:39.37008,8214:39.37008,foot:3.28084,Foot:3.28084,ft:3.28084,8215:3.28084,mile:62137e-8,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,yd:1.09361,8221:1.09361},Em=void 0,Fm=void 0,Gm={convertMaterial:rc,convertTexture:qc},Hm=function(){function a(b,c,d,e,f){Bl(this,a),this._aesMaterials={},this._nextId=-1,this._model=b,this._textureDelegate={eventTarget:c,matman:d,initLoadContext:e,webGLRenderer:f};var g=b.getData();if(this._nextId=0,g&&g.materials){for(var h in g.materials.materials){this._aesMaterials[h]=void 0;var i=parseInt(h,10);this._nextId<i&&(this._nextId=i)}++this._nextId}}return Cl(a,[{key:"getMaterialIds",value:function(){return Object.keys(this._aesMaterials)}},{key:"getMaterialUrn",value:function(a){return this._aesMaterials.hasOwnProperty(a)?"mid:"+a:null}},{key:"getMaterialId",value:function(a){if(null==a)return null;if("mid:"!=a.substr(0,4))return null;var b=a.substr(4);return this._aesMaterials.hasOwnProperty(b)?b:null}},{key:"getRootObjectId",value:function(){var a=this._model.getFragmentMap();return a?a.getRootId():0}},{key:"enumerateChildObjectIds",value:function(a,b,c){var d=this._model.getFragmentMap();return!!d&&(d.enumNodeChildren(a,b,c),!0)}},{key:"getObjectUrn",value:function(a){var b=void 0;if(a)if(Array.isArray(a)){var c=[];a.forEach(function(a){c.push(a?"dbid:"+a.toString():null)}),b=c}else b="dbid:"+a.toString();else b=null;return Promise.resolve(b)}},{key:"getObjectId",value:function(a){var b=void 0;if(a)if(Array.isArray(a)){var c=[];a.forEach(function(a){if(a&&"dbid:"==a.substr(0,5)){var b=a.substr(5);c.push(parseInt(b))}else c.push(0)}),b=c}else if("dbid:"!=a.substr(0,5))b=0;else{var d=a.substr(5);b=parseInt(d)}else b=0;return Promise.resolve(b)}},{key:"getMaterialDefinition",value:function(a){if(!this._aesMaterials.hasOwnProperty(a))return null;var b=this._aesMaterials[a];if(void 0!==b)return b;var c=this._model.getData(),d=c.materials.materials[a];if(c.proteinMaterials){var e=c.proteinMaterials.materials[a];e&&ck.isPrismMaterial(e)&&(d=e)}var f=this,g=d?ec(d,function(b){var c=null;c=f._textureDelegate.matman.lookupMaterial(f._model,a);var d={},e={url:mm.calculateTexturePath(f._model,b,c,d)};return d.asset&&(e.size=d.asset.size),e}):null;return this._aesMaterials[a]=g,g}},{key:"_parseMaterial",value:function(a,b,c,d){var e=c||this._nextId.toString(),f=this._model.getData(),g=f&&f.materials?f.materials.scene.SceneUnit:"inch";if(a.hasOwnProperty("userassets")&&a.hasOwnProperty("materials"))this._textureDelegate.matman.convertOneMaterial(this._model,a,e);else{var h=Gm.convertMaterial(a,g,b,this._textureDelegate.matman.lookupMaterial(this._model,e));if(!h)return null;c||(this._textureDelegate.matman.addObjectMaterial(this._model,h,e),++this._nextId)}return this._aesMaterials[e]=a,e}},{key:"createMaterial",value:function(a,b){return this._parseMaterial(a,b)}},{key:"updateMaterial",value:function(a,b,c){return!("string"!=typeof a||!a||!this._aesMaterials.hasOwnProperty(a))&&!!this._parseMaterial(b,c,a)}},{key:"setTextureDefinition",value:function(a,b,c){var d=this._textureDelegate.matman.lookupMaterial(this._model,a);return!!d&&(c.properties||(c.properties={}),c.properties.booleans||(c.properties.booleans={}),c.properties.booleans.texture_URepeat={values:[c.options.data.texture_URepeat]},c.properties.booleans.texture_VRepeat={values:[c.options.data.texture_VRepeat]},mm.setTextureDefinition(this._textureDelegate,this._model,d,b,c))}},{key:"loadTexture",value:function(a,b,c,d){var e=this;return new Promise(function(f,g){var h=e._textureDelegate.matman.lookupMaterial(e._model,a);if(!h)return void g("Invalid Material Id");mm.loadTexture(e._textureDelegate,e._model,h,b,c,d,Gm.convertTexture,function(e,h){e?g(e):f({matid:a,mapName:b,urn:c,url:d})})||g("Invalid Arguments")})}},{key:"getObjectMaterialIds",value:function(a){var b=this._model.getFragmentMap();if(!b)return null;var c=this._model.getData().fragments;if(!c)return null;var d=[];return b.enumNodeFragments(a,function(a){var b=c.materials[a].toString();d.push(b)},!1),d}},{key:"getObjectVisibility",value:function(a){return!this._model.visibilityManager||this._model.visibilityManager.isNodeVisible(a)}},{key:"setObjectMaterials",value:function(a,b){var c=this._model.getFragmentMap();if(!c)return!1;var d=this._model,e=this._model.getData().fragments;if(!e)return null;var f=this._model.getFragmentList(),g=this._textureDelegate,h=void 0;if(Array.isArray(b)){var i=0;h=function(a){var c=b[i++];if(c){e.materials[a]=parseInt(c);var h=g.matman.lookupMaterial(d,c);h&&f.setMaterial(a,h)}}}else{var j=this._textureDelegate.matman.lookupMaterial(d,b);if(j){var k=parseInt(b);h=function(a){e.materials[a]=k,f.setMaterial(a,j)}}}return c.enumNodeFragments(a,h,!1),!0}},{key:"setObjectVisibility",value:function(a,b){return!!this._model.visibilityManager&&(b?this._model.visibilityManager.show(a):this._model.visibilityManager.hide(a),!0)}}]),a}(),Im=yc.version,Jm=function(){function b(a,c){Bl(this,b),this.WORKER_DATA_URL=null,this.WORKER_FETCHING_SCRIPT=!1,this.WORKER_FETCHING_CALLBACKS=[],this._url=a,this._enableInlineWorker=c}return Cl(b,[{key:"clearWorkerDataURL",value:function(){this.WORKER_DATA_URL=null}},{key:"initWorkerScript",value:function(a,b){if(this._enableInlineWorker&&!this.WORKER_DATA_URL){this.WORKER_FETCHING_CALLBACKS.push({successCB:a});var c=this;if(!this.WORKER_FETCHING_SCRIPT){var d=new XMLHttpRequest,e=this._url;d.open("GET",e,!0),d.withCredentials=!1,d.onload=function(){c.WORKER_FETCHING_SCRIPT=!1;var a=void 0;window.URL=window.URL||window.webkitURL;try{a=new Blob([d.responseText],{type:"application/javascript"})}catch(c){var b=new BlobBuilder;b.append(d.responseText),a=b.getBlob()}c.WORKER_DATA_URL=URL.createObjectURL(a);var e=c.WORKER_FETCHING_CALLBACKS.concat();c.WORKER_FETCHING_CALLBACKS=[];for(var f=0;f<e.length;++f)e[f].successCB&&e[f].successCB()},this.WORKER_FETCHING_SCRIPT=!0,d.send()}var f={};return f.cancel=function(){var b=-1;return!!c.WORKER_FETCHING_CALLBACKS.some(function(c,d){return c.successCB==a&&(b=d,!0)})&&(c.WORKER_FETCHING_CALLBACKS.splice(b,1),!0)},f}return a&&a(),null}},{key:"createWorker",value:function(){var a=void 0;return a=this._enableInlineWorker?new Worker(this.WORKER_DATA_URL):new Worker(this._url),a.doOperation=a.postMessage,a}},{key:"createWorkerWithIntercept",value:function(){function b(a){if(!d)return null;for(var b=0;b<d.length;++b)if(d[b].arg===a){var c=d[b].callback;return d.splice(b,1),0===d.length&&(d=null),c}return null}var c=this.createWorker();c.checkEvent=function(b){return!(!b.data||!b.data.assetRequest)&&(a.assets&&a.assets.push(b.data.assetRequest),!0)};var d=[];return c.addEventListenerWithIntercept=function(a){var b=function(b){c.checkEvent(b)||a(b)};return d||(d=[]),d.push({arg:a,callback:b}),c.addEventListener("message",b,!1),b},c.removeEventListenerWithIntercept=function(a){var d=b(a);d&&c.removeEventListener("message",d,!1)},c.clearAllEventListenerWithIntercept=function(){if(d)for(var a=d.concat(),b=0;b<a.length;++b)c.removeEventListenerWithIntercept(a[b].arg)},c}}]),b}();zl.webWorkerClass=Jm;var Km=function(a){return a+="_map","\n    #if defined(USE_"+a.toUpperCase()+")\n        uniform sampler2D "+a+";\n        uniform mat3 "+a+"_texMatrix;\n        uniform bool "+a+"_invert;\n    #endif\n    "},Lm=function(a){return a+="_map","\n    #if defined(USE_"+a.toUpperCase()+")\n        uniform sampler2D "+a+";\n        uniform mat3 "+a+"_texMatrix;\n        uniform vec2 "+a+"_bumpScale;\n        uniform int "+a+"_bumpmapType;\n    #endif\n    "},Mm=function(a,b){var c=a,d=a+"_map";b={f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4"}[b]||b;var e="_"+c,f="";switch(b){case"float":f="x";break;case"vec2":f="xy";break;case"vec3":f="xyz";break;case"vec4":f="xyzw";break;default:throw new Error("Unexpected swizzle type: "+b)}return"\n    "+b+" "+e+" = "+c+";\n    #if defined(USE_"+d.toUpperCase()+")\n    {\n        "+e+" = texture2D("+d+", ("+d+"_texMatrix * vec3(vUv, 1.0)).xy)."+f+";\n        if ("+d+"_invert) {\n            "+e+" = "+b+"(1.0) - "+e+";\n        }\n    }\n    #endif\n    "},Nm=function(a,c){b.ShaderChunk["prism_uniforms_"+a]=Km(a),b.ShaderChunk["prism_sample_"+a]=Mm(a,c)},Om=function(a){for(var b in a)Nm(b,a[b].type)},Pm="varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\n#if defined(PRISMWOOD)\nvarying vec3 vUvw;\n#endif\n#if defined(PRISMWOOD) && defined(PRISMWOODBUMP)\nvarying vec3 vtNormal;\nvarying mat3 vNormalMatrix;\n#endif\nvoid computeTangents(vec3 normal, out vec3 u, out vec3 v) {\n    float scale = normal.z < 0.0 ? -1.0 : 1.0;\n    vec3 temp = scale * normal;\n    float e = temp.z;\n    float h = 1.0/(1.0 + e);\n    float hvx = h * temp.y;\n    float hvxy = hvx * -temp.x;\n    u = vec3(e + hvx * temp.y, hvxy, -temp.x);\n    v = vec3(hvxy, e + h * temp.x * temp.x, -temp.y);\n    u *= scale;\n    v *= scale;\n}\nvoid main() {\n    vUv = uv;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n    vViewPosition = -mvPosition.xyz;\n    vNormal = normalize(normalMatrix * normal);\n    vec3 Tu, Tv;\n    computeTangents(vNormal, Tu, Tv);\n    vTangent = Tu;\n    vBitangent = Tv;\n#if defined(PRISMWOOD)\n    vUvw = position;\n#endif\n#if defined(PRISMWOOD) && defined(PRISMWOODBUMP)\n    vtNormal = normalize(normal);\n    vNormalMatrix = normalMatrix;\n#endif\n}\n",Qm=null,Rm=function(){return Qm||(Qm={uniforms:{opaque_albedo:{type:"c",value:new b.Color(.963976,.963976,.954687)},opaque_f0:{type:"f",value:.0529},opaque_luminance_modifier:{type:"c",value:new b.Color},opaque_luminance:{type:"f",value:0}},vertexShader:Pm,fragmentShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform vec3 opaque_albedo;\nuniform float opaque_f0;\nuniform float opaque_luminance;\nuniform vec3 opaque_luminance_modifier;\nuniform float uEnvExp;\n#include <prism_uniforms_surface_albedo>\n#include <prism_uniforms_surface_roughness>\n#include <prism_uniforms_surface_cutout>\n#include <prism_uniforms_surface_anisotropy>\n#include <prism_uniforms_surface_rotation>\n#include <prism_uniforms_surface_normal>\n#include <prism_uniforms_opaque_albedo>\n#include <prism_uniforms_opaque_f0>\n#include <prism_uniforms_opaque_luminance>\n#include <prism_uniforms_opaque_luminance_modifier>\n#include <common>\n#include <bsdfs>\n#include <lights_pars>\n#include <envmap_pars_fragment>\n#include <prism_common>\n#include <prism_math>\n#include <prism_env_opaque>\n#include <prism_brdf_opaque>\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\nvec3 getDiscreteLightRadiance(\n    GeometricContext geometry,\n    float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float opaqueF0,\n    vec3 opaqueAlbedo\n) {\n    vec3 N = geometry.normal;\n    vec3 V = geometry.viewDir;\n    IncidentLight directLight;\n    vec3 accumLight = vec3(0.0);\n#define ACCUM_LIGHT { vec3 L = directLight.direction; float NdotL = max(EPSILON, dot(N, L)); vec3 H = normalize(L + V); float NdotH = dot(N, H); float VdotH = dot(V, H); float Hu = dot(H, Tu); float Hv = dot(H, Tv); vec3 Hlocal = vec3(Hu, Hv, NdotH); accumLight += directLight.color * PrismOpaqueBRDF(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, opaqueF0, opaqueAlbedo ); }\n#if NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        DirectionalLight directionalLight = directionalLights[i];\n        getDirectionalDirectLightIrradiance(directionalLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n        PointLight pointLight = pointLights[i];\n        getPointDirectLightIrradiance(pointLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_SPOT_LIGHTS > 0\n    for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n        SpotLight spotLight = spotLights[i];\n        getSpotDirectLightIrradiance(spotLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n    return accumLight;\n}\n#endif\nvoid main() {\n    vec3 N;\n    vec3 V;\n    vec3 Tu;\n    vec3 Tv;\n    getGeoContext(\n        vViewPosition, vNormal, vUv,\n        vTangent, vBitangent,\n        N, V, Tu, Tv\n    );\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n    float surface_cutout = 1.0;\n    #include <prism_sample_surface_cutout>\n    if (_surface_cutout < 0.01) discard;\n    #include <prism_sample_surface_albedo>\n    #include <prism_sample_surface_roughness>\n    #include <prism_sample_surface_anisotropy>\n    #include <prism_sample_surface_rotation>\n    #include <prism_sample_opaque_albedo>\n    #include <prism_sample_opaque_f0>\n    #include <prism_sample_opaque_luminance_modifier>\n    #include <prism_sample_opaque_luminance>\n    vec3 outRadiance = vec3(0.0);\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = N;\n    geometry.viewDir = V;\n    outRadiance += getDiscreteLightRadiance(\n        geometry,\n        NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _opaque_f0,\n        _opaque_albedo\n    );\n#endif\n#if defined(USE_ENVMAP)\n    outRadiance += PrismOpaqueIBL(\n        N, V, NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _opaque_f0,\n        _opaque_albedo,\n        _opaque_luminance,\n        _opaque_luminance_modifier\n    );\n#endif\n    outRadiance *= uEnvExp;\n    outRadiance = toneMapping(outRadiance);\n    gl_FragColor = LinearToGamma(vec4(outRadiance, 1.0), float(GAMMA_FACTOR));\n}\n"},Om(Qm.uniforms),Qm)},Sm=null,Tm=function(){return Sm||(Sm={uniforms:{metal_f0:{type:"c",value:new b.Color(.963976,.963976,.954687)}},vertexShader:Pm,fragmentShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform vec3 metal_f0;\nuniform float uEnvExp;\n#include <prism_uniforms_surface_albedo>\n#include <prism_uniforms_surface_roughness>\n#include <prism_uniforms_surface_cutout>\n#include <prism_uniforms_surface_anisotropy>\n#include <prism_uniforms_surface_rotation>\n#include <prism_uniforms_surface_normal>\n#include <prism_uniforms_metal_f0>\n#include <common>\n#include <bsdfs>\n#include <lights_pars>\n#include <envmap_pars_fragment>\n#include <prism_common>\n#include <prism_math>\n#include <prism_env_metal>\n#include <prism_brdf_metal>\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\nvec3 getDiscreteLightRadiance(\n    GeometricContext geometry,\n    float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    vec3 metalF0\n) {\n    vec3 N = geometry.normal;\n    vec3 V = geometry.viewDir;\n    IncidentLight directLight;\n    vec3 accumLight = vec3(0.0);\n#define ACCUM_LIGHT { vec3 L = directLight.direction; float NdotL = max(EPSILON, dot(N, L)); vec3 H = normalize(L + V); float NdotH = dot(N, H); float VdotH = dot(V, H); float Hu = dot(H, Tu); float Hv = dot(H, Tv); vec3 Hlocal = vec3(Hu, Hv, NdotH); accumLight += directLight.color * PrismMetalBRDF(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0); }\n#if NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        DirectionalLight directionalLight = directionalLights[i];\n        getDirectionalDirectLightIrradiance(directionalLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n        PointLight pointLight = pointLights[i];\n        getPointDirectLightIrradiance(pointLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if (NUM_SPOT_LIGHTS > 0)\n    for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n        SpotLight spotLight = spotLights[i];\n        getSpotDirectLightIrradiance(spotLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n    return accumLight;\n}\n#endif\nvoid main() {\n    vec3 N;\n    vec3 V;\n    vec3 Tu;\n    vec3 Tv;\n    getGeoContext(\n        vViewPosition, vNormal, vUv,\n        vTangent, vBitangent,\n        N, V, Tu, Tv\n    );\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n    float surface_cutout = 1.0;\n    #include <prism_sample_surface_cutout>\n    if (_surface_cutout < 0.01) discard;\n    #include <prism_sample_surface_albedo>\n    #include <prism_sample_surface_roughness>\n    #include <prism_sample_surface_anisotropy>\n    #include <prism_sample_surface_rotation>\n    #include <prism_sample_metal_f0>\n    vec3 outRadiance = vec3(0.0);\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = N;\n    geometry.viewDir = V;\n    outRadiance += getDiscreteLightRadiance(\n        geometry,\n        NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _metal_f0\n    );\n#endif\n#if defined(USE_ENVMAP)\n    outRadiance += PrismMetalIBL(\n        N, V, NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _metal_f0\n    );\n#endif\n    outRadiance *= uEnvExp;\n    outRadiance = toneMapping(outRadiance);\n    gl_FragColor = LinearToGamma(vec4(outRadiance, 1.0), float(GAMMA_FACTOR));\n}\n"},Om(Sm.uniforms),Sm)},Um=null,Vm=function(){return Um||(Um={uniforms:{layered_f0:{type:"f",value:.0603},layered_diffuse:{type:"c",value:new b.Color(.9673,.9556,.9137)},layered_fraction:{type:"f",value:.25},layered_bottom_f0:{type:"c",value:new b.Color(.9673,.9556,.9137)},layered_roughness:{type:"f",value:0},layered_anisotropy:{type:"f",value:0},layered_rotation:{type:"f",value:0}},vertexShader:Pm,fragmentShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform float layered_f0;\nuniform vec3 layered_diffuse;\nuniform float layered_fraction;\nuniform vec3 layered_bottom_f0;\nuniform float layered_roughness;\nuniform float layered_anisotropy;\nuniform float layered_rotation;\nuniform float uEnvExp;\n#include <prism_uniforms_surface_albedo>\n#include <prism_uniforms_surface_roughness>\n#include <prism_uniforms_surface_cutout>\n#include <prism_uniforms_surface_anisotropy>\n#include <prism_uniforms_surface_rotation>\n#include <prism_uniforms_surface_normal>\n#include <prism_uniforms_layered_f0>\n#include <prism_uniforms_layered_diffuse>\n#include <prism_uniforms_layered_fraction>\n#include <prism_uniforms_layered_bottom_f0>\n#include <prism_uniforms_layered_roughness>\n#include <prism_uniforms_layered_anisotropy>\n#include <prism_uniforms_layered_rotation>\n#include <common>\n#include <bsdfs>\n#include <lights_pars>\n#include <envmap_pars_fragment>\n#include <prism_common>\n#include <prism_math>\n#include <prism_env_layered>\n#include <prism_brdf_layered>\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\nvec3 getDiscreteLightRadiance(\n    GeometricContext geometry,\n    float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float layeredF0,\n    vec3 layeredDiffuse,\n    float layeredRoughness,\n    float layeredAnisotropy,\n    float layeredRotation,\n    vec3 layeredBottomF0,\n    float layeredFraction\n) {\n    vec3 N = geometry.normal;\n    vec3 V = geometry.viewDir;\n    IncidentLight directLight;\n    vec3 accumLight = vec3(0.0);\n#define ACCUM_LIGHT { vec3 L = directLight.direction; float NdotL = max(EPSILON, dot(N, L)); vec3 H = normalize(L + V); float NdotH = dot(N, H); float VdotH = dot(V, H); float Hu = dot(H, Tu); float Hv = dot(H, Tv); vec3 Hlocal = vec3(Hu, Hv, NdotH); accumLight += directLight.color * PrismLayeredBRDF( Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal, NdotL, NdotH, NdotV, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy, layeredRotation, layeredBottomF0, layeredFraction ); }\n#if NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        DirectionalLight directionalLight = directionalLights[i];\n        getDirectionalDirectLightIrradiance(directionalLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n        PointLight pointLight = pointLights[i];\n        getPointDirectLightIrradiance(pointLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_SPOT_LIGHTS > 0\n    for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n        SpotLight spotLight = spotLights[i];\n        getSpotDirectLightIrradiance(spotLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n    return accumLight;\n}\n#endif\nvoid main() {\n    vec3 N;\n    vec3 V;\n    vec3 Tu;\n    vec3 Tv;\n    getGeoContext(\n        vViewPosition, vNormal, vUv,\n        vTangent, vBitangent,\n        N, V, Tu, Tv\n    );\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n    float surface_cutout = 1.0;\n    #include <prism_sample_surface_cutout>\n    if (_surface_cutout < 0.01) discard;\n    #include <prism_sample_surface_albedo>\n    #include <prism_sample_surface_roughness>\n    #include <prism_sample_surface_anisotropy>\n    #include <prism_sample_surface_rotation>\n    #include <prism_sample_layered_f0>\n    #include <prism_sample_layered_diffuse>\n    #include <prism_sample_layered_fraction>\n    #include <prism_sample_layered_bottom_f0>\n    #include <prism_sample_layered_roughness>\n    #include <prism_sample_layered_anisotropy>\n    #include <prism_sample_layered_rotation>\n    vec3 outRadiance = vec3(0.0);\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = N;\n    geometry.viewDir = V;\n    outRadiance += getDiscreteLightRadiance(\n        geometry,\n        NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _layered_f0,\n        _layered_diffuse,\n        _layered_roughness,\n        _layered_anisotropy,\n        _layered_rotation,\n        _layered_bottom_f0,\n        _layered_fraction\n    );\n#endif\n#if defined(USE_ENVMAP)\n    outRadiance += PrismLayeredIBL(\n        N, V, NdotV, Tu, Tv,\n        N, NdotV,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _layered_f0,\n        _layered_diffuse,\n        _layered_roughness,\n        _layered_anisotropy,\n        _layered_rotation,\n        _layered_bottom_f0,\n        _layered_fraction\n    );\n#endif\n    outRadiance *= uEnvExp;\n    outRadiance = toneMapping(outRadiance);\n    gl_FragColor = LinearToGamma(vec4(outRadiance, 1.0), float(GAMMA_FACTOR));\n}\n"},Om(Um.uniforms),Um)},Wm=null,Xm=function(){return Wm||(Wm={transparent:!0,depthWrite:!1,uniforms:{transparent_color:{type:"c",value:new b.Color(1118481)},transparent_ior:{type:"f",value:2}},vertexShader:Pm,
fragmentShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform vec3 transparent_color;\nuniform float transparent_ior;\nuniform float uEnvExp;\n#include <prism_uniforms_surface_albedo>\n#include <prism_uniforms_surface_roughness>\n#include <prism_uniforms_surface_cutout>\n#include <prism_uniforms_surface_anisotropy>\n#include <prism_uniforms_surface_rotation>\n#include <prism_uniforms_surface_normal>\n#include <prism_uniforms_transparent_color>\n#include <prism_uniforms_transparent_ior>\n#include <common>\n#include <bsdfs>\n#include <lights_pars>\n#include <envmap_pars_fragment>\n#include <prism_common>\n#include <prism_math>\n#include <prism_env_transparent>\n#include <prism_brdf_transparent>\n#include <prism_transparency>\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\nvec3 getDiscreteLightRadiance(\n    GeometricContext geometry,\n    float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float transparentIor\n) {\n    vec3 N = geometry.normal;\n    vec3 V = geometry.viewDir;\n    IncidentLight directLight;\n    vec3 accumLight = vec3(0.0);\n#define ACCUM_LIGHT { vec3 L = directLight.direction; float NdotL = max(EPSILON, dot(N, L)); vec3 H = normalize(L + V); float NdotH = dot(N, H); float VdotH = dot(V, H); float Hu = dot(H, Tu); float Hv = dot(H, Tv); vec3 Hlocal = vec3(Hu, Hv, NdotH); accumLight += directLight.color * PrismTransparentBRDF(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, transparentIor); }\n#if NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        DirectionalLight directionalLight = directionalLights[i];\n        getDirectionalDirectLightIrradiance(directionalLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n        PointLight pointLight = pointLights[i];\n        getPointDirectLightIrradiance(pointLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if (NUM_SPOT_LIGHTS > 0)\n    for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n        SpotLight spotLight = spotLights[i];\n        getSpotDirectLightIrradiance(spotLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n    return accumLight;\n}\n#endif\nvoid main() {\n    vec3 N;\n    vec3 V;\n    vec3 Tu;\n    vec3 Tv;\n    getGeoContext(\n        vViewPosition, vNormal, vUv,\n        vTangent, vBitangent,\n        N, V, Tu, Tv\n    );\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n    float surface_cutout = 1.0;\n    #include <prism_sample_surface_cutout>\n    if (_surface_cutout < 0.01) discard;\n    #include <prism_sample_surface_albedo>\n    #include <prism_sample_surface_roughness>\n    #include <prism_sample_surface_anisotropy>\n    #include <prism_sample_surface_rotation>\n    #include <prism_sample_transparent_color>\n    #include <prism_sample_transparent_ior>\n    vec3 outRadiance = vec3(0.0);\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = N;\n    geometry.viewDir = V;\n    outRadiance += getDiscreteLightRadiance(\n        geometry,\n        NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _transparent_ior\n    );\n#endif\n#if defined(USE_ENVMAP)\n    outRadiance += PrismTransparentIBL(\n        N, V, NdotV, Tu, Tv,\n        _surface_albedo,\n        _surface_roughness,\n        _surface_anisotropy,\n        _surface_rotation,\n        _transparent_color,\n        _transparent_ior\n    );\n#endif\n    outRadiance *= uEnvExp;\n    outRadiance = toneMapping(outRadiance);\n    gl_FragColor = LinearToGamma(vec4(outRadiance, 1.0), float(GAMMA_FACTOR));\n    applyPrismTransparency(gl_FragColor, _transparent_color, _transparent_ior);\n}\n"},Om(Wm.uniforms),Wm)},Ym=null,Zm=null,$m=function(){var a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],c=new Uint8Array(a),d=new b.DataTexture(c,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);d.generateMipmaps=!1,d.flipY=!1,d.needsUpdate=!0;var e=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],f=new Uint8Array(e),g=new b.DataTexture(f,256,1,b.LuminanceFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);g.generateMipmaps=!1,g.flipY=!1,g.needsUpdate=!0;var h=function(b){return a[b%256]},i=new Array(262144),j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0;for(j=0;j<256;++j)for(k=0;k<256;++k)l=h(k)+j,m=h(l),n=h(l+1),o=h(k+1)+j,p=h(o),q=h(o+1),r=4*(256*j+k),i[r]=m,i[r+1]=n,i[r+2]=p,i[r+3]=q;var s=new Uint8Array(i),t=new b.DataTexture(s,256,256,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0;var u=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],v=new Array(1024);for(k=0;k<256;++k){var w=a[k]%16;v[4*k]=127*u[3*w]+128,v[4*k+1]=127*u[3*w+1]+128,v[4*k+2]=127*u[3*w+2]+128,v[4*k+3]=0}var x=new Uint8Array(v),y=new b.DataTexture(x,256,1,b.RGBAFormat,b.UnsignedByteType,b.UVMapping,b.RepeatWrapping,b.RepeatWrapping,b.NearestFilter,b.NearestFilter,0);return y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0,{permutationTex:d,gradientTex:g,perm2DTex:t,permGradTex:y}},_m=function(){return Ym||(Zm=$m(),Ym={defines:{PRISMWOOD:""},uniforms:{wood_fiber_cosine_enable:{type:"i",value:!1},wood_fiber_cosine_bands:{type:"i",value:1},wood_fiber_cosine_weights:{type:"v4",value:new b.Vector4(.1,1,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new b.Vector4(1,1,1,1)},wood_fiber_perlin_enable:{type:"i",value:!0},wood_fiber_perlin_bands:{type:"i",value:4},wood_fiber_perlin_weights:{type:"v4",value:new b.Vector4(8,2,.5,.05)},wood_fiber_perlin_frequencies:{type:"v4",value:new b.Vector4(.016666666666666666,.05,.18181818181818182,1)},wood_fiber_perlin_scale_z:{type:"f",value:.2},wood_growth_perlin_enable:{type:"i",value:!0},wood_growth_perlin_bands:{type:"i",value:2},wood_growth_perlin_weights:{type:"v4",value:new b.Vector4(2,.5,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new b.Vector4(.2,1,1,1)},wood_latewood_ratio:{type:"f",value:.082},wood_earlywood_sharpness:{type:"f",value:.25},wood_latewood_sharpness:{type:"f",value:.812},wood_ring_thickness:{type:"f",value:.6},wood_earlycolor_perlin_enable:{type:"i",value:!0},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new b.Vector4(.85,.3,1,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new b.Vector4(.125,.3333333333333333,1,1)},wood_early_color:{type:"c",value:new b.Color(.42050799696531205,.14799801144636357,.0563742292350767)},wood_use_manual_late_color:{type:"i",value:!1},wood_manual_late_color:{type:"c",value:new b.Color(0,0,0)},wood_latecolor_perlin_enable:{type:"i",value:!0},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new b.Vector4(.35,1,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new b.Vector4(.2222222222222222,1,1,1)},wood_late_color_power:{type:"f",value:1.36},wood_diffuse_perlin_enable:{type:"i",value:!0},wood_diffuse_perlin_bands:{type:"i",value:2},wood_diffuse_perlin_weights:{type:"v4",value:new b.Vector4(.1,.25,1,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new b.Vector4(.5,20,1,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:!0},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:!0},wood_ray_color_power:{type:"f",value:1.2},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:!0},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:!0},wood_groove_roughness:{type:"f",value:.2},wood_diffuse_lobe_weight:{type:"f",value:.85},wood_curly_distortion_enable:{type:"i",value:!1},wood_curly_distortion_scale:{type:"f",value:.25},wood_ring_fraction:{type:"v4",value:new b.Vector4(.918,.2295,.066584,.984584)},wood_fall_rise:{type:"v2",value:new b.Vector2(.6885,.015416)},permutationMap:{type:"t",value:Zm.permutationTex},gradientMap:{type:"t",value:Zm.gradientTex},perm2DMap:{type:"t",value:Zm.perm2DTex},permGradMap:{type:"t",value:Zm.permGradTex}},vertexShader:Pm,fragmentShader:"varying vec3 vViewPosition;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vTangent;\nvarying vec3 vBitangent;\nvarying vec3 vUvw;\nvarying vec3 vtNormal;\nvarying mat3 vNormalMatrix;\nuniform vec3 surface_albedo;\nuniform float surface_roughness;\nuniform float surface_anisotropy;\nuniform float surface_rotation;\nuniform bool wood_fiber_cosine_enable;\nuniform int wood_fiber_cosine_bands;\nuniform vec4 wood_fiber_cosine_weights;\nuniform vec4 wood_fiber_cosine_frequencies;\nuniform bool wood_fiber_perlin_enable;\nuniform int wood_fiber_perlin_bands;\nuniform vec4 wood_fiber_perlin_weights;\nuniform vec4 wood_fiber_perlin_frequencies;\nuniform float wood_fiber_perlin_scale_z;\nuniform bool wood_growth_perlin_enable;\nuniform int wood_growth_perlin_bands;\nuniform vec4 wood_growth_perlin_weights;\nuniform vec4 wood_growth_perlin_frequencies;\nuniform float wood_latewood_ratio;\nuniform float wood_earlywood_sharpness;\nuniform float wood_latewood_sharpness;\nuniform float wood_ring_thickness;\nuniform bool wood_earlycolor_perlin_enable;\nuniform int wood_earlycolor_perlin_bands;\nuniform vec4 wood_earlycolor_perlin_weights;\nuniform vec4 wood_earlycolor_perlin_frequencies;\nuniform vec3 wood_early_color;\nuniform bool wood_use_manual_late_color;\nuniform vec3 wood_manual_late_color;\nuniform bool wood_latecolor_perlin_enable;\nuniform int wood_latecolor_perlin_bands;\nuniform vec4 wood_latecolor_perlin_weights;\nuniform vec4 wood_latecolor_perlin_frequencies;\nuniform float wood_late_color_power;\nuniform bool wood_diffuse_perlin_enable;\nuniform int wood_diffuse_perlin_bands;\nuniform vec4 wood_diffuse_perlin_weights;\nuniform vec4 wood_diffuse_perlin_frequencies;\nuniform float wood_diffuse_perlin_scale_z;\nuniform bool wood_use_pores;\nuniform int wood_pore_type;\nuniform float wood_pore_radius;\nuniform float wood_pore_cell_dim;\nuniform float wood_pore_color_power;\nuniform float wood_pore_depth;\nuniform bool wood_use_rays;\nuniform float wood_ray_color_power;\nuniform float wood_ray_seg_length_z;\nuniform float wood_ray_num_slices;\nuniform float wood_ray_ellipse_z2x;\nuniform float wood_ray_ellipse_radius_x;\nuniform bool wood_use_latewood_bump;\nuniform float wood_latewood_bump_depth;\nuniform bool wood_use_groove_roughness;\nuniform float wood_groove_roughness;\nuniform float wood_diffuse_lobe_weight;\nuniform vec4 wood_ring_fraction;\nuniform vec2 wood_fall_rise;\nuniform bool wood_curly_distortion_enable;\nuniform float wood_curly_distortion_scale;\nuniform sampler2D permutationMap;\nuniform sampler2D gradientMap;\nuniform sampler2D perm2DMap;\nuniform sampler2D permGradMap;\nuniform float uEnvExp;\n#include <common>\n#include <bsdfs>\n#include <lights_pars>\n#include <envmap_pars_fragment>\n#include <prism_common>\n#include <prism_math>\n#include <prism_env_opaque>\n#include <prism_brdf_opaque>\n#include <prism_wood>\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\nvec3 getDiscreteLightRadiance(\n    GeometricContext geometry,\n    float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float opaqueF0,\n    vec3 opaqueAlbedo\n) {\n    vec3 N = geometry.normal;\n    vec3 V = geometry.viewDir;\n    IncidentLight directLight;\n    vec3 accumLight = vec3(0.0);\n#define ACCUM_LIGHT { vec3 L = directLight.direction; float NdotL = max(EPSILON, dot(N, L)); vec3 H = normalize(L + V); float NdotH = dot(N, H); float VdotH = dot(V, H); float Hu = dot(H, Tu); float Hv = dot(H, Tv); vec3 Hlocal = vec3(Hu, Hv, NdotH); accumLight += directLight.color * PrismOpaqueBRDF(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, opaqueF0, opaqueAlbedo ); }\n#if NUM_DIR_LIGHTS > 0\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n        DirectionalLight directionalLight = directionalLights[i];\n        getDirectionalDirectLightIrradiance(directionalLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_POINT_LIGHTS > 0\n    for (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n        PointLight pointLight = pointLights[i];\n        getPointDirectLightIrradiance(pointLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n#if NUM_SPOT_LIGHTS > 0\n    for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n        SpotLight spotLight = spotLights[i];\n        getSpotDirectLightIrradiance(spotLight, geometry, directLight);\n        ACCUM_LIGHT\n    }\n#endif\n    return accumLight;\n}\n#endif\nvoid main() {\n    vec3 N;\n    vec3 V;\n    vec3 Tu;\n    vec3 Tv;\n    getGeoContext(\n        vViewPosition, vNormal, vUv,\n        vTangent, vBitangent,\n        N, V, Tu, Tv\n    );\n#if defined(PRISMWOODBUMP)\n    getFinalWoodContext(\n        N, V, Tu, Tv, vUvw,\n        vNormal, vtNormal, vNormalMatrix\n    );\n#endif\n    float NdotV = clamp(dot(N, V), EPSILON, 1.0);\n    float woodRoughness = surface_roughness;\n    vec3 woodDiffuse = NoiseWood(vUvw, woodRoughness);\n    vec3 outRadiance = vec3(0.0);\n#if (NUM_DIR_LIGHTS > 0) || (NUM_POINT_LIGHTS > 0) || (NUM_SPOT_LIGHTS > 0)\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = N;\n    geometry.viewDir = V;\n    outRadiance += getDiscreteLightRadiance(\n        geometry,\n        NdotV, Tu, Tv,\n        surface_albedo,\n        woodRoughness,\n        surface_anisotropy,\n        surface_rotation,\n        0.04,\n        woodDiffuse\n    );\n#endif\n#if defined(USE_ENVMAP)\n    outRadiance += PrismOpaqueIBL(\n        N, V, NdotV, Tu, Tv,\n        surface_albedo,\n        woodRoughness,\n        surface_anisotropy,\n        surface_rotation,\n        0.04,\n        woodDiffuse,\n        0.0,\n        vec3(0.0)\n    );\n#endif\n    outRadiance *= uEnvExp;\n    outRadiance = toneMapping(outRadiance);\n    gl_FragColor = LinearToGamma(vec4(outRadiance, 1.0), float(GAMMA_FACTOR));\n}\n"})};!function(){b.ShaderChunk.normal_map=Ah,b.ShaderChunk.prism_common="#include <normal_map>\nfloat sqr(float x) {\n    return x * x;\n}\nvoid getGeoContext(\n    vec3 viewPosition,\n    vec3 normal,\n    vec2 uv,\n    vec3 tangent,\n    vec3 bitangent,\n    out vec3 N,\n    out vec3 V,\n    out vec3 Tu,\n    out vec3 Tv\n) {\n    N = normalize(normal);\n    V = normalize(viewPosition);\n    Tu = normalize(tangent);\n    Tv = normalize(bitangent);\n#if defined(USE_MAP)\n    vec3 q0 = dFdx(-viewPosition);\n    vec3 q1 = dFdy(-viewPosition);\n    vec2 st0 = dFdx(uv);\n    vec2 st1 = dFdy(uv);\n    Tu = normalize(q0 * st1.t - q1 * st0.t);\n    Tv = normalize(-q0 * st1.s + q1 * st0.s);\n#endif\n#if defined(USE_SURFACE_NORMAL_MAP)\n    if (surface_normal_map_bumpmapType == 0) {\n        heightMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    } else {\n        normalMapTransform(surface_normal_map, uv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);\n    }\n#endif\n}",b.ShaderChunk.prism_math="\nvec2 RoughnessToAlpha(float roughness, float anisotropy) {\n    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);\n    alpha = alpha * alpha;\n    alpha = clamp(alpha, 0.001, 1.0);\n    return alpha;\n}\nvec3 FresnelSchlick(vec3 f0, float cosAngle) {\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    return f0 + (1.0 - f0) * x5;\n}\nvec3 FresnelRough(vec3 f0, float cosAngle, float alpha) {\n    float x = 1.0 - cosAngle;\n    float x2 = x * x;\n    float x5 = x * x2 * x2;\n    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);\n    return f0 + (maxReflectance - f0) * x5;\n}\nfloat IORToReflectance(float ior) {\n    return sqr((1.0 - ior) / (1.0 + ior));\n}\n",b.ShaderChunk.prism_env="#if defined(USE_ENVMAP)\nfloat alphaToPhong(float alpha) {\n    return max(0.0, 2.56/alpha - 7.0);\n}\nfloat phongToReflMipIndex(float exponent) {\n    const float EXP_COUNT = 10.0;\n    const float LOG_MIN = 0.0;\n    const float LOG_MAX = 9.0;\n    const float NUM_MIPS = 6.0;\n    float targetLog = log2(exponent);\n    float deltaLog = clamp(targetLog - LOG_MIN, 0.0, LOG_MAX - LOG_MIN);\n    float level = clamp((1.0-(deltaLog + 0.5) / EXP_COUNT), 0.0, 1.0) * NUM_MIPS;\n    return level;\n}\nvec3 decodeRGBM(in vec4 vRGBM) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret / uEnvExp;\n    return ret;\n}\nvec3 sampleReflection(vec3 n, vec3 v, float a) {\n    float mipLevel = phongToReflMipIndex(alphaToPhong(a));\n    v = reflect(-v, n);\n    v = inverseTransformDirection(v, viewMatrix);\n#ifdef GL_EXT_shader_texture_lod\n    return decodeRGBM(textureCubeLodEXT(envMap, v, mipLevel));\n#else\n    return decodeRGBM(textureCube(envMap, v, mipLevel));\n#endif\n}\nuniform samplerCube irrMap;\nvec3 sampleIrradiance(vec3 v) {\n    v = inverseTransformDirection(v, viewMatrix);\n    return decodeRGBM(textureCube(irrMap, v));\n}\n#endif\n",b.ShaderChunk.prism_env_opaque="#include <prism_env>\n#if defined(USE_ENVMAP)\nvec3 PrismOpaqueIBL(\n    vec3 N, vec3 V, float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float opaqueF0,\n    vec3 opaqueAlbedo,\n    float opaqueLuminance,\n    vec3 opaqueLuminanceModifier\n) {\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = FresnelRough(vec3(opaqueF0), NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, alpha);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n    vec3 envIrradiance = sampleIrradiance(N);\n    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;\n    vec3 emission = opaqueLuminanceModifier * opaqueLuminance;\n    return diffuse + specular + emission;\n}\n#endif\n",b.ShaderChunk.prism_env_metal="#include <prism_env>\n#if defined(USE_ENVMAP)\nvec3 PrismMetalIBL(\n    vec3 N, vec3 V, float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    vec3 metalF0\n) {\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = FresnelRough(metalF0, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, alpha);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n    return specular;\n}\n#endif\n",b.ShaderChunk.prism_env_layered="#include <prism_env>\n#if defined(USE_ENVMAP)\nvec3 PrismLayeredIBL(\n    vec3 N, vec3 V, float NdotV, vec3 Tu, vec3 Tv,\n    vec3 N2, float N2dotV,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float layeredF0,\n    vec3 layeredDiffuse,\n    float layeredRoughness,\n    float layeredAnisotropy,\n    float layeredRotation,\n    vec3 bottomF0,\n    float layeredFraction\n) {\n    vec3 F = FresnelSchlick(vec3(layeredF0), NdotV);\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 envSpecular = sampleReflection(N, V, alpha);\n    vec3 topSpecular = F * surfaceAlbedo * envSpecular;\n    vec3 amount = (1.0 - F);\n    vec3 envIrradiance = sampleIrradiance(N);\n    vec3 topDiffuse = layeredDiffuse * envIrradiance;\n    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;\n    envSpecular = sampleReflection(N2, V, alpha);\n    F = FresnelRough(bottomF0, N2dotV, alpha);\n    vec3 botSpecular = F * envSpecular;\n    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);\n}\n#endif",b.ShaderChunk.prism_env_transparent="#include <prism_env>\n#if defined(USE_ENVMAP)\nvec3 PrismTransparentIBL(\n    vec3 N, vec3 V, float NdotV, vec3 Tu, vec3 Tv,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    vec3 transparentColor,\n    float transparentIor\n) {\n    vec3 reflectance = vec3(IORToReflectance(transparentIor));\n    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;\n    vec3 F = FresnelRough(reflectance, NdotV, alpha);\n    vec3 envSpecular = sampleReflection(N, V, alpha);\n    vec3 specular = F * surfaceAlbedo * envSpecular;\n    vec3 envIrradiance = sampleIrradiance(N);\n    vec3 color = F * surfaceRoughness * transparentColor * envIrradiance;\n    return specular + color;\n}\n#endif",b.ShaderChunk.prism_brdf="float aSqrd(float maxAlphaSqr, float cosTheta) {\n    if (abs(cosTheta) < 1e-10) {\n        return 1e10;\n    }\n    float tan2 = 1.0/sqr(cosTheta) - 1.0;\n    return maxAlphaSqr * tan2;\n}\nvec3 Rotate(vec3 vec, float angle) {\n    float s = sin(angle);\n    float c = cos(angle);\n    return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);\n}\nfloat NDF_GGX(float alphaU, float alphaV, vec3 normal) {\n    float nx2 = sqr(normal.x);\n    float ny2 = sqr(normal.y);\n    float nz2 = sqr(normal.z);\n    float scale = 1.0/(alphaU * alphaV * PI);\n    return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);\n}\nfloat G1_GGX(float aSqrd) {\n    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));\n}\nvec3 MicrofacetLobe(\n    vec3 Hlocal,\n    float NdotL,\n    float NdotH,\n    float NdotV,\n    float VdotH,\n    float roughness,\n    float anisotropy,\n    float rotation,\n    vec3 reflectance\n) {\n    vec2 alpha = RoughnessToAlpha(roughness, anisotropy);\n    Hlocal = Rotate(Hlocal, rotation);\n    vec3 F = FresnelSchlick(reflectance, VdotH);\n    float D = NDF_GGX(alpha.x, alpha.y, Hlocal);\n    float alpha2 = max(sqr(alpha.x), sqr(alpha.y));\n    float alpha2NL = aSqrd(alpha2, NdotL);\n    float alpha2NV = aSqrd(alpha2, NdotV);\n    float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);\n    return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));\n}\nvec3 DiffuseLobe(vec3 diffuseColor) {\n    return diffuseColor * RECIPROCAL_PI;\n}\n",b.ShaderChunk.prism_brdf_opaque="#include <prism_brdf>\nvec3 PrismOpaqueBRDF(\n    vec3 Hlocal,\n    float NdotL,\n    float NdotH,\n    float NdotV,\n    float VdotH,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float opaqueF0,\n    vec3 opaqueAlbedo\n) {\n    vec3 diffuse = DiffuseLobe(opaqueAlbedo);\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n        Hlocal,\n        NdotL,\n        NdotH,\n        NdotV,\n        VdotH,\n        surfaceRoughness,\n        surfaceAnisotropy,\n        surfaceRotation,\n        vec3(opaqueF0)\n    );\n    return (specular + diffuse) * NdotL;\n}\n",b.ShaderChunk.prism_brdf_metal="#include <prism_brdf>\nvec3 PrismMetalBRDF(\n    vec3 Hlocal,\n    float NdotL,\n    float NdotH,\n    float NdotV,\n    float VdotH,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    vec3 metalF0\n) {\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n        Hlocal,\n        NdotL,\n        NdotH,\n        NdotV,\n        VdotH,\n        surfaceRoughness,\n        surfaceAnisotropy,\n        surfaceRotation,\n        metalF0\n    );\n    return specular * NdotL;\n}\n",b.ShaderChunk.prism_brdf_layered="#include <prism_brdf>\nvec3 PrismLayeredBRDF(\n    vec3 Hlocal,\n    float NdotL,\n    float NdotH,\n    float NdotV,\n    float VdotH,\n    vec3 Hlocal2,\n    float N2dotL,\n    float N2dotH,\n    float N2dotV,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float layeredF0,\n    vec3 layeredDiffuse,\n    float layeredRoughness,\n    float layeredAnisotropy,\n    float layeredRotation,\n    vec3 layeredBottomF0,\n    float layeredFraction\n) {\n    vec3 Fl = FresnelSchlick(vec3(layeredF0), NdotL);\n    vec3 Fv = FresnelSchlick(vec3(layeredF0), NdotV);\n    vec3 amount = (1.0 - Fl) * (1.0 - Fv);\n    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(\n        Hlocal,\n        NdotL,\n        NdotH,\n        NdotV,\n        VdotH,\n        surfaceRoughness,\n        surfaceAnisotropy,\n        surfaceRotation,\n        vec3(layeredF0)\n    );\n    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);\n    vec3 botSpecular = MicrofacetLobe(\n        Hlocal2,\n        N2dotL,\n        N2dotH,\n        N2dotV,\n        VdotH,\n        layeredRoughness,\n        layeredAnisotropy,\n        layeredRotation,\n        layeredBottomF0\n    );\n    return topSpecular * NdotL + amount * mix(\n        topDiffuse * NdotL,\n        botSpecular * N2dotL,\n        layeredFraction\n    );\n}\n",b.ShaderChunk.prism_brdf_transparent="#include <prism_brdf>\nvec3 PrismTransparentBRDF(\n    vec3 Hlocal,\n    float NdotL,\n    float NdotH,\n    float NdotV,\n    float VdotH,\n    vec3 surfaceAlbedo,\n    float surfaceRoughness,\n    float surfaceAnisotropy,\n    float surfaceRotation,\n    float transparentIor\n) {\n    vec3 reflectance = vec3(IORToReflectance(transparentIor));\n    vec3 specular = surfaceAlbedo * MicrofacetLobe(\n        Hlocal,\n        NdotL,\n        NdotH,\n        NdotV,\n        VdotH,\n        surfaceRoughness,\n        surfaceAnisotropy,\n        surfaceRotation,\n        reflectance\n    );\n    return specular * NdotL;\n}\n",b.ShaderChunk.prism_wood=yh,b.ShaderChunk.prism_transparency=zh,b.ShaderChunk.prism_uniforms_surface_normal=Lm("surface_normal"),Nm("surface_albedo","vec3"),Nm("surface_roughness","float"),Nm("surface_anisotropy","float"),Nm("surface_rotation","float"),Nm("surface_cutout","float")}();var an={uniforms:{surface_albedo:{type:"c",value:new b.Color},surface_roughness:{type:"f",value:.1},surface_anisotropy:{type:"f",value:0},surface_rotation:{type:"f",value:0},uEnvExp:{type:"f",value:1}},extensions:{derivatives:!0,shaderTextureLOD:!0}},bn={},cn=function(a){return(bn[a]||Rm)()},dn=function(a){function c(a){Bl(this,c);var d=cn(a),e=Object.assign({},an,d);e.uniforms=b.UniformsUtils.merge([an.uniforms,d.uniforms]);var f=Fl(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));for(var g in d.uniforms){var h=d.uniforms[g];"t"===h.type&&h.value&&(f.uniforms[g].value=h.value)}return f._lights=!1,f}return El(c,a),Cl(c,[{key:"lights",get:function(){return this._lights},set:function(a){if(a&&this.uniforms){var c=b.UniformsLib.lights;for(var d in c)this.uniforms[d]=b.UniformsUtils.clone(c[d])}this._lights=a}}]),c}(b.ShaderMaterial);dn.OPAQUE=Symbol("Opaque"),dn.METAL=Symbol("Metal"),dn.LAYERED=Symbol("Layered"),dn.TRANSPARENT=Symbol("Transparent"),dn.WOOD=Symbol("Wood"),bn[dn.OPAQUE]=Rm,bn[dn.METAL]=Tm,bn[dn.LAYERED]=Vm,bn[dn.TRANSPARENT]=Xm,bn[dn.WOOD]=_m;var en=function(a,b){var c=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],d=255*a[2]+a[3],e=Math.pow(2,(d-127)/2),f=e/a[1],g=a[0]*f,h=c[0]*g+c[3]*e+c[6]*f,i=c[1]*g+c[4]*e+c[7]*f,j=c[2]*g+c[5]*e+c[8]*f;h<0&&(h=0),i<0&&(i=0),j<0&&(j=0),b[0]=h,b[1]=i,b[2]=j},fn=function(a,b,c){var d=Math.sqrt(a[0]*c)*(1/16),e=Math.sqrt(a[1]*c)*(1/16),f=Math.sqrt(a[2]*c)*(1/16),g=Math.min(Math.max(Math.max(d,e),Math.max(f,1e-6)),1);g=Math.ceil(255*g)/255,b[0]=d/g,b[1]=e/g,b[2]=f/g,b[3]=g},gn=function(a,b){for(var c=new Float32Array(4),d=new Float32Array(4),e=0;e<a.image.length;e++)for(var f=a.image[e],g=0;g<f.mipmaps.length;g++)for(var h=f.mipmaps[g].data,i=0;i<h.length;i+=4)c[0]=h[i]/255,c[1]=h[i+1]/255,c[2]=h[i+2]/255,c[3]=h[i+3]/255,en(c,d),fn(d,c,b),h[i]=Math.round(255*c[0]),h[i+1]=Math.round(255*c[1]),h[i+2]=Math.round(255*c[2]),h[i+3]=Math.round(255*c[3])},hn=function(a,c){return new Promise(function(d,e){var f=new b.DDSLoader,g=new b.CubeTexture;g.format=b.RGBAFormat,g.encoding=b.LinearEncoding,g.mapping=b.CubeReflectionMapping,g.isCompressedTexture=!0,g.generateMipmaps=!1;var h=Math.pow(2,c);f.load(a,function(a){gn(a,h);for(var c=0;c<a.image.length;c++)g.image[c]=a.image[c];g.minFilter=g.image[0].mipmaps.length>1?g.minFilter:b.LinearFilter,g.needsUpdate=!0,d(g)},function(){},function(a){e(new Error("environment map load failed"))})})},jn=function(){function a(){Bl(this,a),this._specMap=null,this._irrMap=null,this._exposure=0}return Cl(a,[{key:"load",value:function(a,b,c){var d=this;return Promise.all([hn(a,c),hn(b,c)]).then(function(a){var b=Gl(a,2),e=b[0],f=b[1];return d._specMap=e,d._irrMap=f,d._exposure=c,d})}},{key:"setToScene",value:function(b){a.registerSceneShader(!0),b.background=this._specMap}},{key:"setToMaterial",value:function(a){a.envMap=this._specMap,a.uniforms.envMap={value:this._specMap},a.uniforms.irrMap={value:this._irrMap},a.uniforms.uEnvExp={value:Math.pow(2,this._exposure)},a.needsUpdate=!0}}],[{key:"load",value:function(b,c,d){return(new a).load(b,c,d)}},{key:"registerSceneShader",value:function(a){a?(b.ShaderLib.cube_orig||(b.ShaderLib.cube_orig={fragmentShader:b.ShaderLib.cube.fragmentShader}),b.ShaderLib.cube.fragmentShader="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvec3 decodeRGBM(in vec4 vRGBM) {\n    vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\n    ret *= ret;\n    return ret;\n}\nvoid main() {\n    vec4 texel = textureCube(tCube, vWorldPosition.xyz);\n    vec3 color = toneMapping(decodeRGBM(texel));\n    gl_FragColor = vec4(color, opacity);\n    gl_FragColor = LinearToGamma(gl_FragColor, float(GAMMA_FACTOR));\n}\n"):b.ShaderLib.cube_orig&&(b.ShaderLib.cube.fragmentShader=b.ShaderLib.cube_orig.fragmentShader)}}]),a
}(),kn=Symbol("Riverbank"),ln=Symbol("Contrast"),mn=Symbol("Rim Highlights"),nn=Symbol("Cool Light"),on=Symbol("Warm Light"),pn=Symbol("Soft Light"),qn=Symbol("Grid Light"),rn=Symbol("Plaza"),sn=Symbol("Snow Field"),tn=Symbol("Field"),un=Symbol("Boardwalk"),vn=Symbol("Crossroads"),wn=Symbol("Seaport"),xn=Symbol("Glacier"),yn=Symbol("RaaS Test Env"),zn={};zn[kn]={name:"Riverbank",path:"riverbank",exposure:-5.7},zn[ln]={name:"Contrast",path:"IDViz",exposure:0},zn[mn]={name:"Rim Highlights",path:"RimHighlights",exposure:-9},zn[nn]={name:"Cool Light",path:"CoolLight",exposure:-9},zn[on]={name:"Warm Light",path:"WarmLight",exposure:-9},zn[pn]={name:"Soft Light",path:"SoftLight",exposure:-9},zn[qn]={name:"Grid Light",path:"GridLight",exposure:-9},zn[rn]={name:"Plaza",path:"Plaza",exposure:-14},zn[sn]={name:"Snow Field",path:"SnowField",exposure:-10.461343},zn[tn]={name:"Field",path:"field",exposure:-2.9},zn[un]={name:"Boardwalk",path:"boardwalk",exposure:-7},zn[vn]={name:"Crossroads",path:"crossroads",exposure:-5.5},zn[wn]={name:"Seaport",path:"seaport",exposure:-6.5},zn[xn]={name:"Glacier",path:"glacier",exposure:0},zn[yn]={name:"RaaS Test Env",path:"Reflection",exposure:-1.5};var An="https://autodeskviewer.com/viewers/latest/res/environments/",Bn=function(a){return zn[a]},Cn=function(a){var b=Bn(a);return b?jn.load(An+b.path+"_mipdrop.logluv.dds",An+b.path+"_irr.logluv.dds",b.exposure):Promise.reject(new Error("Preset does not exist: "+a))},Dn=Object.freeze({RIVERBANK:kn,CONTRAST:ln,RIM_HIGHLIGHTS:mn,COOL_LIGHT:nn,WARM_LIGHT:on,SOFT_LIGHT:pn,GRID_LIGHT:qn,PLAZA:rn,SNOW_FIELD:sn,FIELD:tn,BOARDWALK:un,CROSSROADS:vn,SEAPORT:wn,GLACIER:xn,RAAS_TEST:yn,get:Bn,load:Cn}),En="varying vec3 vNormal;\nvarying float depth;\n#include <pack_normals>\nvoid main() {\n#ifdef UNPACK_NORMALS\n    vec3 objectNormal = decodeNormal(normal);\n#else\n    vec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n    objectNormal = -objectNormal;\n#endif\n    objectNormal = objectNormal;\n    vec3 instPos = position;\n    vec3 transformedNormal = normalMatrix * objectNormal;\n    vNormal = normalize( transformedNormal );\n    vec4 mvPosition = modelViewMatrix * vec4( instPos, 1.0 );\n    depth = mvPosition.z;\n    vec4 p_Position = projectionMatrix * mvPosition;\n    gl_Position = p_Position;\n}",Fn="varying highp vec3 vNormal;\nvarying highp float depth;\nvoid main() {\n    vec3 n = vNormal;\n    n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n    n = normalize( n );\n    gl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}\n",Gn=function(a){function b(){return Bl(this,b),Fl(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,{vertexShader:En,fragmentShader:Fn}))}return El(b,a),b}(b.ShaderMaterial),Hn="\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",In={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)}},vertexShader:Hn,fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;\n#include <pack_depth>\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    float depth = texture2D(tDiffuse, ssP).z;\n    if (depth != 0.0)\n        depth = (depth + cameraNear) * cameraInvNearFar;\n    gl_FragColor = packDepth(depth);\n}\n"},Jn={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)}},vertexShader:Hn,fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\n    vec2 ssP = vec2(gl_FragCoord.xy);\n    ssP = ssP * 2.0 + mod(ssP, 2.0);\n    ssP = (ssP + 0.5) * resolution * 0.5;\n    gl_FragColor = texture2D(tDiffuse, ssP);\n}\n"},Kn="varying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",Ln={uniforms:b.UniformsUtils.merge([{tDepth:{type:"t",value:null},projInfo:{type:"v4",value:new b.Vector4},isOrtho:{type:"f",value:0},worldMatrix_mainPass:{type:"m4",value:new b.Matrix4},size:{type:"v2",value:new b.Vector2(512,512)},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.1},projScale:{type:"f",value:500},intensity:{type:"f",value:.4},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}}]),vertexShader:Kn,fragmentShader:"\n#extension GL_OES_standard_derivatives : enable\n#include <depth_texture>\n#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (5)\n#define MIN_RADIUS (3.0)\nuniform float           projScale;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\n    float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\n    float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\n    ssR = alpha;\n    return vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\n    return clamp( (z+cameraNear) / (cameraNear-cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\n    float temp = floor(key * 255.0);\n    p.x = temp * (1.0 / 255.0);\n    p.y = key * 255.0 - temp;\n}\n#include <pack_depth>\nfloat unpackDepthNearFar( const in vec4 rgba_depth ) {\n    float depth = unpackDepth( rgba_depth );\n    if (depth == 0.0)\n        return -cameraFar * 1.0e10;\n    return depth * (cameraNear - cameraFar) - cameraNear;\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\n    return normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\n    return cross(dFdy(C), dFdx(C));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\n    vec3 P;\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\n    return P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\n    ivec2 ssP = ivec2(ssR * unitOffset) + ssC;\n    vec3 P;\n    vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;\n#ifdef USE_MIPMAP\n    int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\n    if (mipLevel == 0) {\n        P.z = texture2D(tDepth, screenUV).z;\n        if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n    }\n    else if (mipLevel == 1)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\n    else if (mipLevel == 2)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\n    else if (mipLevel == 3)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\n    else if (mipLevel == 4)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\n    else if (mipLevel == 5)\n        P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\n    P.z = texture2D(tDepth, screenUV).z;\n    if (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\n    P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\n    return P;\n}\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\n    float ssR;\n    vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\n    ssR = max(0.75, ssR * ssDiskRadius);\n    vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\n    vec3 v = Q - C;\n    float vv = dot(v, v);\n    float vn = dot(v, n_C);\n    const float epsilon = 0.001;\n    float angAdjust = mix(1.0, max(0.0, 1.5 * n_C.z), 0.35);\n#define HIGH_QUALITY\n#ifdef HIGH_QUALITY\n    float f = max(1.0 - vv / (radius * radius), 0.0); return angAdjust * f * max((vn - bias) / sqrt(epsilon + vv), 0.0);\n#else\n    float f = max(radius * radius - vv, 0.0); return angAdjust * f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n#endif\n}\nconst bool useNoise = true;\nfloat getRandomAngle(vec2 pos) {\n    float dt= dot(pos ,vec2(12.9898,78.233));\n    return 6.28318 * fract(sin(mod(dt,3.14)) * 43758.5453);\n}\nvoid main() {\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 nrmz = texture2D(tDepth, vUv);\n    if (nrmz.z == 0.0) {\n        gl_FragColor.r = 1.0;\n        gl_FragColor.a = 0.0;\n        packKey(1.0, gl_FragColor.gb);\n        return;\n    }\n    vec3 C = getPosition(ssC, nrmz.z);\n    packKey(CSZToKey(C.z), gl_FragColor.gb);\n    float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\n    float A;\n    if (ssDiskRadius <= MIN_RADIUS) {\n        A = 1.0;\n    } else {\n        float sum = 0.0;\n        float randomPatternRotationAngle = getRandomAngle(vUv);\n        vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\n        sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\n        float intensityDivR6 = intensity / pow(radius, 6.0);\n#ifdef HIGH_QUALITY\n        A = pow(max(0.0, 1.0 - sqrt(sum * (3.0 / float(NUM_SAMPLES)))), intensity);\n#else\n        A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\n        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n#endif\n        if (abs(dFdx(C.z)) < 0.02) {\n            A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n        }\n        if (abs(dFdy(C.z)) < 0.02) {\n            A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n        }\n        A = mix(1.0, A, clamp(ssDiskRadius - MIN_RADIUS,0.0,1.0));\n    }\n    gl_FragColor.r = A;\n    gl_FragColor.a = 1.0;\n}\n"},Mn={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new b.Vector2(512,512)},resolution:{type:"v2",value:new b.Vector2(1/512,1/512)},axis:{type:"v2",value:new b.Vector2(1,0)},radius:{type:"f",value:50}},vertexShader:Kn,fragmentShader:"\n#define EDGE_SHARPNESS     (3.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nuniform float radius;\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\n    return p.x + p.y * (1.0 / 255.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\n    float gaussian[R + 1];\n#       if R == 3\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;\n#       elif R == 4\n    gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;\n#       elif R == 6\n    gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\n    ivec2 axisi = ivec2(axis);\n    ivec2 ssC = ivec2(gl_FragCoord.xy);\n    vec4 temp = texture2D(tDiffuse, vUv);\n    gl_FragColor.gb = temp.KEY_COMPONENTS;\n    gl_FragColor.a = temp.a;\n    VALUE_TYPE sum = temp.VALUE_COMPONENTS;\n    if (temp.a == 0.0) {\n        result = sum;\n        return;\n    }\n    float key = unpackKey(keyPassThrough);\n    float BASE = gaussian[0];\n    float totalWeight = BASE;\n    sum *= totalWeight;\n    float scale = 1.5 / radius;\n    int r = -4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = -2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r=-1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 1; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[1];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 2; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[2];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 3; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[3];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    r = 4; {\n        vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\n        temp = texture2D(tDiffuse, ssUV);\n        float      tapKey = unpackKey(temp.KEY_COMPONENTS);\n        VALUE_TYPE value  = temp.VALUE_COMPONENTS;\n        float weight = 0.3 + gaussian[4];\n        float dz = tapKey - key;\n        weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz) * scale);\n        sum += value * weight;\n        totalWeight += weight;\n    }\n    const float epsilon = 0.0001;\n    result = sum / (totalWeight + epsilon);\n}\n"},Nn={uniforms:{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},aoOpacity:{type:"f",value:1}},vertexShader:Kn,fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform float aoOpacity;\nvarying vec2 vUv;\nvec4 sampleColor() {\n    return texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\n    return sqrt(texture2D(tAO, vUv).r);\n}\nvoid main() {\n    vec4 texel = sampleColor();\n    float ao = sampleAO();\n    ao = 1.0 - (1.0 - ao) * aoOpacity;\n    texel.rgb *= ao;\n    gl_FragColor = texel;\n}\n"};!function(){b.ShaderChunk.pack_depth="\nvec4 packDepth( const in float depth ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\n    return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\n",b.ShaderChunk.pack_normals="\n#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n) {\n    return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc) {\n    vec2 ang = enc * 2.0 - 1.0;\n    vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\n    vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\n    return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}\n",b.ShaderChunk.depth_texture="\nuniform sampler2D tDepth;\nuniform vec4 projInfo;\nuniform float isOrtho;\nuniform mat4 worldMatrix_mainPass;\nvec3 reconstructCSPosition(vec2 fragCoords, float z) {\n    return vec3((fragCoords * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructWorldPosition(vec2 fragCoords, vec2 screenUv) {\n    float zCam = texture2D(tDepth, screenUv).z;\n    vec3 csPos = reconstructCSPosition(fragCoords, zCam);\n    return (worldMatrix_mainPass * vec4(csPos, 1.0)).xyz;\n}\n"}();var On=function(){function a(){Bl(this,a),this.isMobileDevice=!1,this.radius=10,this.bias=1,this.intensity=.4,this.debugShowSAO=!1,this.depthMaterial=new Gn,this.saoMipFirstPass=new yi(In),this.saoMipPass=new yi(Jn),this.saoPass=new yi(Ln),this.saoBlurPass=new yi(Mn),this.blendPass=new yi(Nn),this.black=new b.Color(0,0,0),this.white=new b.Color(1,1,1)}return Cl(a,[{key:"render",value:function(a,c,d,e,f){if(!this.depthTarget||this.depthTarget.width!=f.width||this.depthTarget.height!=f.height){var g=f.width,h=f.height,i=1/g,j=1/h,k=b.FloatType;this.isMobileDevice&&(k=b.HalfFloatType),this.depthTarget=new b.WebGLRenderTarget(g,h,{minFilter:b.NearestFilter,magFilter:b.NearestFilter,format:b.RGBFormat,type:k,stencilBuffer:!1}),this.postTarget1=new b.WebGLRenderTarget(g,h,{minFilter:b.LinearFilter,magFilter:b.LinearFilter,format:b.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),this.postTarget1.texture.generateMipmaps=!1,this.ssaoTarget=this.postTarget1.clone(),this.depthMipMap=[];for(var l=0;l<5;l++){var m=new b.WebGLRenderTarget(0|g/(2<<l),0|h/(2<<l),{minFilter:b.NearestFilter,magFilter:b.NearestFilter,format:b.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});m.texture.generateMipmaps=!1,this.depthMipMap.push(m),this.saoPass.uniforms["tDepth_mip"+(l+1)].value=m.texture}this.saoPass.uniforms.size.value.set(g,h),this.saoPass.uniforms.resolution.value.set(i,j),this.saoPass.uniforms.tDepth.value=this.depthTarget.texture,this.saoBlurPass.uniforms.size.value.set(g,h),this.saoBlurPass.uniforms.resolution.value.set(i,j),this.blendPass.uniforms.tAO.value=this.ssaoTarget.texture,this.blendPass.uniforms.aoOpacity.value=1}this.saoPass.uniforms.radius.value=this.radius,this.saoPass.uniforms.bias.value=this.bias*this.radius*(this.isMobileDevice?.1:.01),this.saoPass.uniforms.intensity.value=this.intensity,this.saoBlurPass.uniforms.radius.value=this.radius;var n=d.near,o=d.far;this.saoPass.uniforms.cameraNear.value=n,this.saoPass.uniforms.cameraFar.value=o,this.saoMipFirstPass.uniforms.cameraNear.value=n,this.saoMipFirstPass.uniforms.cameraInvNearFar.value=1/(n-o);var p=d.projectionMatrix.elements,q=d instanceof b.PerspectiveCamera;q?this.saoPass.uniforms.projInfo.value.set(-2/(f.width*p[0]),-2/(f.height*p[5]),(1-p[8])/p[0],(1+p[9])/p[5]):this.saoPass.uniforms.projInfo.value.set(-2/(f.width*p[0]),-2/(f.height*p[5]),(1-p[12])/p[0],(1-p[13])/p[5]);var r=q?0:1;this.saoPass.uniforms.isOrtho.value=r;this.saoPass.uniforms.projScale.value=f.height*p[5]*.125;var s=c.overrideMaterial,t=a.autoClear;a.autoClear=!1;var u=new b.Color(a.getClearColor()),v=a.getClearAlpha();this.debugShowSAO&&(a.setClearColor(this.white,1),a.clearTarget(f,!0,!1,!1)),a.setClearColor(this.black,1),a.clearTarget(this.depthTarget,!0,this.depthMaterial.depthWrite,!1),a.setClearColor(u,v),c.overrideMaterial=this.depthMaterial,a.render(c,d,this.depthTarget,!1),c.overrideMaterial=s;var w=this.depthMipMap[0];this.saoMipFirstPass.uniforms.resolution.value.set(1/w.width,1/w.height),this.saoMipFirstPass.render(a,w,this.depthTarget);for(var x=1;x<this.depthMipMap.length;x++){var y=this.depthMipMap[x];this.saoMipPass.uniforms.resolution.value.set(1/y.width,1/y.height),this.saoMipPass.render(a,y,w),w=y}this.saoPass.render(a,this.ssaoTarget,f),this.saoBlurPass.uniforms.axis.value.set(1,0),this.saoBlurPass.render(a,this.postTarget1,this.ssaoTarget),this.saoBlurPass.uniforms.axis.value.set(0,1),this.saoBlurPass.render(a,this.ssaoTarget,this.postTarget1),this.blendPass.render(a,e,f),a.autoClear=t}}]),a}(),Pn="varying vec2 vUv;\nvarying vec2 vGaussianUVs[14];\nvoid main() {\n    vUv = vec2(uv.x, uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    vGaussianUVs[ 0] = vUv + vec2(-7.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 1] = vUv + vec2(-6.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 2] = vUv + vec2(-5.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 3] = vUv + vec2(-4.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 4] = vUv + vec2(-3.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 5] = vUv + vec2(-2.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 6] = vUv + vec2(-1.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 7] = vUv + vec2( 1.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 8] = vUv + vec2( 2.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[ 9] = vUv + vec2( 3.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[10] = vUv + vec2( 4.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[11] = vUv + vec2( 5.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[12] = vUv + vec2( 6.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n    vGaussianUVs[13] = vUv + vec2( 7.0 * KERNEL_SCALE, 0.0)UV_SWIZZLE;\n}",Qn="uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvarying vec2 vGaussianUVs[14];\nvoid main() {\n    gl_FragColor = vec4(0.0);\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 0]) * 0.0044299121055113265;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 1]) * 0.00895781211794;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 2]) * 0.0215963866053;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 3]) * 0.0443683338718;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 4]) * 0.0776744219933;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 5]) * 0.115876621105;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 6]) * 0.147308056121;\n    gl_FragColor += texture2D(tDiffuse, vUv             ) * 0.159576912161;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 7]) * 0.147308056121;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 8]) * 0.115876621105;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[ 9]) * 0.0776744219933;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[10]) * 0.0443683338718;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[11]) * 0.0215963866053;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[12]) * 0.00895781211794;\n    gl_FragColor += texture2D(tDiffuse, vGaussianUVs[13]) * 0.0044299121055113265;\n}\n",Rn={defines:{UV_SWIZZLE:".xy",KERNEL_SCALE:"1.0"},uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:Pn,fragmentShader:Qn},Sn={defines:{UV_SWIZZLE:".yx",KERNEL_SCALE:"1.0"},uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:Pn,fragmentShader:Qn},Tn=function(){function a(b,c){Bl(this,a),this.passH=new yi(Rn),this.passV=new yi(Sn),this.passH.material.defines.KERNEL_SCALE=(1/b).toFixed(8),this.passV.material.defines.KERNEL_SCALE=(1/c).toFixed(8)}return Cl(a,[{key:"render",value:function(a,b,c,d){this.passH.render(a,c,b),this.passV.render(a,d,c)}}]),a}(),Un={uniforms:{tDiffuse:{type:"t",value:null},color:{type:"v4",value:new b.Vector4(1,1,1,1)}},vertexShader:Kn,fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec4 color;\nvarying vec2 vUv;\nvoid main() {\n    float shadow = 1.0 - texture2D(tDiffuse, vUv).r;\n    gl_FragColor = vec4(color.rgb, color.a * shadow);\n}\n"},Vn=function(a){function c(a){Bl(this,c);var d=Fl(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,new b.BufferGeometry,new b.MeshBasicMaterial({color:"#ffffff"})));return d._params=Object.assign({resolution:128,blurLevel:1,color:new b.Color(0,0,0),alpha:1,debug:!1},a),d.geometry.addAttribute("position",new b.BufferAttribute(new Float32Array([-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5]),3)),d.geometry.addAttribute("uv",new b.BufferAttribute(new Float32Array([0,0,0,1,1,1,1,0]),2)),d.geometry.setIndex(new b.BufferAttribute(new Uint16Array([0,1,2,2,3,0]),1)),d._target1=new b.WebGLRenderTarget(d._params.resolution,d._params.resolution,{format:b.RGBFormat,stencilBuffer:!1}),d._target2=d._target1.clone(),d._matDepth=new b.ShaderMaterial({vertexShader:b.ShaderLib.depth.vertexShader,fragmentShader:b.ShaderLib.depth.fragmentShader.replace(/DEPTH_PACKING/g,"3200")}),d._matDepth.blending=b.NoBlending,d._blurPass=new Tn(d._params.resolution,d._params.resolution),d.material=new b.ShaderMaterial(Un),d.material.uniforms.tDiffuse.value=d._target1.texture,d.material.uniforms.color.value.set(d._params.color.r,d._params.color.g,d._params.color.b,d._params.alpha),d.material.transparent=!0,d.material.depthWrite=!1,d._camera=new b.OrthographicCamera(-.5,.5,.5,-.5,.01,.99),d._camera.position.y=-.5,d._camera.rotation.x=Math.PI/2,d.add(d._camera),d._debugBox=new b.Mesh(new b.BoxGeometry(1,1,1),new b.MeshBasicMaterial({color:65280,wireframe:!0})),d.add(d._debugBox),d}return El(c,a),Cl(c,[{key:"render",value:function(a,b){this.clear(a),this.renderShadow(a,b),this.postprocess(a)}},{key:"clear",value:function(a){var b=a.getRenderTarget(),c=a.getClearColor().getHex(),d=a.getClearAlpha();a.setClearColor(16777215,1),a.clearTarget(this._target1,!0,!0,!1),a.setRenderTarget(b),a.setClearColor(c,d)}},{key:"renderShadow",value:function(a,b){this.visible=!1;var c=b.overrideMaterial;b.overrideMaterial=this._matDepth;var d=a.getRenderTarget(),e=a.autoClear;a.autoClear=!1,a.render(b,this._camera,this._target1),a.setRenderTarget(d),a.autoClear=e,b.overrideMaterial=c,this.visible=!0}},{key:"postprocess",value:function(a){for(var b=0;b<this._params.blurLevel;++b)this._blurPass.render(a,this._target1,this._target2,this._target1)}}]),c}(b.Mesh);a.PrismMaterial=dn,a.Environment=jn,a.EnvPresets=Dn,a.SAOEffect=On,a.ShadowPlane=Vn,a.GaussianBlurPass=Tn,a.WebWorkerCreator=Jm,a.VERSION=Im,a.BackgroundShader=xh,a.BasicShader=ii,a.BlendShader=ki,a.CelShader=li,a.CopyShader=mi,a.FXAAShader=ni,a.SAOBlurShader=oi,a.SAOShader=pi,a.NormalsShader=qi,a.EdgeShader=ri,a.LineShader=si,a.OcclusionShader=ti,a.ShaderPass=yi,a.GaussianPass=Ai,a.GroundReflection=ej,a.PhongShader=gj,a.VertexEnumerator=rj,a.DeriveTopology=Cj,a.VBIntersector=Ej,a.GeometryList=y,a.RenderBatch=A,a.InstanceBufferBuilder=Ha,a.WebGLRenderer=Jk,a.ModelIteratorLinear=Ma,a.ConsolidationIterator=Ta,a.ModelIteratorBVH=Ua,a.BufferGeometryUtils=Oj,a.RenderScene=Va,a.SortedList=Nk,a.RenderModel=fb,a.MaterialConverter=ck,a.MaterialManager=fk,a.SvfLoader=sm,a.TextureLoader=mm,a.DEBUG_SHADERS=!1,a.WebGLShader=fj,a.consolidateFragmentList=Sa,a.copyVertexFormat=wa,a.copyPrimitiveProps=xa,a.mergeGeometries=Aa,a.Consolidation=Ca,a.ConsolidationBuilder=Da,a.registerWorkerSupport=Fa,a.multithreadingSupported=Ga,a.ConsolidationUtils=lk,a.isIOSDevice=Ci,a.isAndroidDevice=Di,a.isMobileDevice=Ei,a.isChrome=Fi,a.isSafari=Gi,a.isFirefox=Hi,a.isMac=Ii,a.isWindows=Ji,a.isNodeJS=Ki,a.rescueFromPolymer=Li,a.pathToURL=Mi,a.clearAssets=Ni,a.MODEL_ROOT_LOADED_EVENT="svfLoaded",a.LOAD_MISSING_GEOMETRY="loadMissingGeometry",a.FRAGMENTS_LOADED_EVENT="fragmentLoaded",a.FILE_LOAD_STARTED="fileLoadStarted",a.GEOMETRY_DOWNLOAD_COMPLETE="geometryDownloadComplete",a.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",a.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",a.TEXTURES_LOADED_EVENT="texturesLoaded",a.setMemoryOptimizedLoading=Oi,a.GPU_MEMORY_LIMIT=Pi,a.GPU_OBJECT_LIMIT=Qi,a.GEOMETRY_OVERHEAD=464,a.PIXEL_CULLING_THRESHOLD=Ri,a.PAGEOUT_SUCCESS=0,a.PAGEOUT_FAIL=Si,a.PAGEOUT_NONE=Ti,a.RENDER_NORMAL=Ui,a.RENDER_HIGHLIGHTED=1,a.RENDER_HIDDEN=2,a.RENDER_SHADOWMAP=3,a.RENDER_FINISHED=4,a.GROUND_UNFINISHED=0,a.GROUND_FINISHED=1,a.GROUND_RENDERED=2,a.MESH_VISIBLE=Vi,a.MESH_HIGHLIGHTED=Wi,a.MESH_HIDE=Xi,a.MESH_ISLINE=8,a.MESH_MOVED=Yi,a.MESH_TRAVERSED=Zi,a.MESH_DRAWN=$i,a.MESH_RENDERFLAG=_i,a.MESH_ISPOINT=256,a.MESH_ISWIDELINE=512,a.DB_ID=0,a.FRAGMENT_ID=1,a.RESET_NORMAL=aj,a.RESET_REDRAW=bj,a.RESET_RELOAD=cj,a.POSTPROC_STYLE_OFF=0,a.POSTPROC_STYLE_EDGING=1,a.POSTPROC_STYLE_CEL=2,a.POSTPROC_STYLE_GRAPHITE=3,a.POSTPROC_STYLE_PENCIL=4,a.CreateCubeMapFromColors=gb,a.CutPlanesUniforms=Bh,a.IdUniforms=Ch,a.ThemingUniform=Dh,a.ShadowMapCommonUniforms=Eh,a.ShadowMapUniforms=Fh,a.PointSizeUniforms=Gh,a.WideLinesUniforms=Hh,a.DepthTextureUniforms=Ih,a.GetPrismMapSampleChunk=h,a.GetPrismMapUniformChunk=i,a.resolve=Nh,a.PackDepthShaderChunk=Oh,a.TonemapShaderChunk=Ph,a.OrderedDitheringShaderChunk=Qh,a.CutPlanesShaderChunk=Rh,a.PackNormalsShaderChunk=Sh,a.HatchPatternShaderChunk=Th,a.EnvSamplingShaderChunk=Uh,a.IdVertexDeclaration=Vh,a.IdVertexShaderChunk=Wh,a.IdFragmentDeclaration=Xh,a.IdOutputShaderChunk=Yh,a.FinalOutputShaderChunk=Zh,a.ThemingFragmentDeclaration=$h,a.ThemingFragmentShaderChunk=_h,a.InstancingVertexDeclaration=ai,a.ShadowMapDeclareCommonUniforms=bi,a.ShadowMapVertexDeclaration=ci,a.ShadowMapVertexShaderChunk=di,a.ShadowMapFragmentDeclaration=ei,a.PointSizeDeclaration=fi,a.PointSizeShaderChunk=gi,a.ShaderChunks=hi,a.SAOMinifyFirstShader=bl,a.SAOMinifyShader=cl,a.LineStyleDefs=Uj,a.CreateLinePatternTexture=Vj,a.LineStyleDef=Wj,a.FloatToHalf=hl,a.HalfToFloat=il,a.HALF_INT_MAX=59390,a.IntToHalf=jl,a.HalfToInt=kl,a.HalfTest=ll,a.HalfFloat=ml,a.createShaderMaterial=ui,a.setMacro=vi,a.removeMacro=wi,a.ShaderUtils=xi,a.createGroundShape=Ia,a.setGroundShapeTransform=wk,a.GroundShadow=xk,a.GroundShadowUtils=yk,a.PrismMaps=ok,a.GetPrismMapChunk=pk,a.WebGLProgram=qk,a.WebGLProgramUtils=rk,a.GetPrismMapUniforms=S,a.PrismShader=Xj,a.createPrismMaterial=Yj,a.clonePrismMaterial=Zj,a.PrismShaderUtils=$j,a.ShadowMapShader=zk,a.GroundShadowShader=Ak,a.ShadowMapOverrideMaterials=Bk,a.ShadowConfig=Ck,a.SHADOWMAP_NEEDS_UPDATE=Dk,a.SHADOWMAP_INCOMPLETE=Ek,a.SHADOWMAP_VALID=Fk,a.ShadowMaps=Ka,
a.ShadowRender=Hk,a.ShadowMapUtils=Ik,a.FrustumIntersector=Gj,a.OUTSIDE=0,a.INTERSECTS=1,a.CONTAINS=2,a.CONTAINMENT_UNKNOWN=-1,a.FragmentList=Wa,a.FragmentPointer=$a,a.FragmentListUtils=Pk,a.TileCoords=_a,a.tile2Index=Qk,a.index2Tile=Rk,a.TileUtils=Sk,a.TexQuadConfig=cb,a.ModelIteratorTexQuad=db,a.ModelIteratorTexQuadUtils=Zk,a.SelectionMode=nl,a.InstanceTree=hb,a.DbidFragmentMap=ib;a.InstanceTreeStorage=jb,a.InstanceTreeAccess=lb,a.NodeArray=mb,a.BVHModule=yl,a.BVHBuilder=ob,a.workerScript=zl,a.loadWorker=pb,a.setLogger=U,a.errorCodeString=qb,a.getErrorCode=rb,a.LmvVector3=sj,a.LmvMatrix4=Tk,a.LmvBox3=tj,a.ViewingService=Ll,a.FileLoader=Ol,a.clearPropertyWorkerCache=Ab,a.PropDbLoader=Vl,a.DecodeEnvMap=Zl,a.getTransferables=Eb,a.DecodeEnvMapAsync=am,a.ModelEditor=Hm,Object.defineProperty(a,"__esModule",{value:!0})})},function(a,b){a.exports=THREE},function(a,b){a.exports=require("xhr2")},function(a,b){a.exports=require("fs")},function(a,b,c){(function(a,d){function e(b,c,d){function e(){for(var a;null!==(a=b.read());)h.push(a),i+=a.length;b.once("readable",e)}function f(a){b.removeListener("end",g),b.removeListener("readable",e),d(a)}function g(){var c=a.concat(h,i);h=[],d(null,c),b.close()}var h=[],i=0;b.on("error",f),b.on("end",g),b.end(c),e()}function f(b,c){if("string"==typeof c&&(c=new a(c)),!a.isBuffer(c))throw new TypeError("Not a string or buffer");var d=p.Z_FINISH;return b._processChunk(c,d)}function g(a){if(!(this instanceof g))return new g(a);n.call(this,a,p.DEFLATE)}function h(a){if(!(this instanceof h))return new h(a);n.call(this,a,p.INFLATE)}function i(a){if(!(this instanceof i))return new i(a);n.call(this,a,p.GZIP)}function j(a){if(!(this instanceof j))return new j(a);n.call(this,a,p.GUNZIP)}function k(a){if(!(this instanceof k))return new k(a);n.call(this,a,p.DEFLATERAW)}function l(a){if(!(this instanceof l))return new l(a);n.call(this,a,p.INFLATERAW)}function m(a){if(!(this instanceof m))return new m(a);n.call(this,a,p.UNZIP)}function n(c,d){if(this._opts=c=c||{},this._chunkSize=c.chunkSize||b.Z_DEFAULT_CHUNK,o.call(this,c),c.flush&&c.flush!==p.Z_NO_FLUSH&&c.flush!==p.Z_PARTIAL_FLUSH&&c.flush!==p.Z_SYNC_FLUSH&&c.flush!==p.Z_FULL_FLUSH&&c.flush!==p.Z_FINISH&&c.flush!==p.Z_BLOCK)throw new Error("Invalid flush flag: "+c.flush);if(this._flushFlag=c.flush||p.Z_NO_FLUSH,c.chunkSize&&(c.chunkSize<b.Z_MIN_CHUNK||c.chunkSize>b.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+c.chunkSize);if(c.windowBits&&(c.windowBits<b.Z_MIN_WINDOWBITS||c.windowBits>b.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+c.windowBits);if(c.level&&(c.level<b.Z_MIN_LEVEL||c.level>b.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+c.level);if(c.memLevel&&(c.memLevel<b.Z_MIN_MEMLEVEL||c.memLevel>b.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+c.memLevel);if(c.strategy&&c.strategy!=b.Z_FILTERED&&c.strategy!=b.Z_HUFFMAN_ONLY&&c.strategy!=b.Z_RLE&&c.strategy!=b.Z_FIXED&&c.strategy!=b.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+c.strategy);if(c.dictionary&&!a.isBuffer(c.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new p.Zlib(d);var e=this;this._hadError=!1,this._binding.onerror=function(a,c){e._binding=null,e._hadError=!0;var d=new Error(a);d.errno=c,d.code=b.codes[c],e.emit("error",d)};var f=b.Z_DEFAULT_COMPRESSION;"number"==typeof c.level&&(f=c.level);var g=b.Z_DEFAULT_STRATEGY;"number"==typeof c.strategy&&(g=c.strategy),this._binding.init(c.windowBits||b.Z_DEFAULT_WINDOWBITS,f,c.memLevel||b.Z_DEFAULT_MEMLEVEL,g,c.dictionary),this._buffer=new a(this._chunkSize),this._offset=0,this._closed=!1,this._level=f,this._strategy=g,this.once("end",this.close)}var o=c(10),p=c(30),q=c(42),r=c(45).ok;p.Z_MIN_WINDOWBITS=8,p.Z_MAX_WINDOWBITS=15,p.Z_DEFAULT_WINDOWBITS=15,p.Z_MIN_CHUNK=64,p.Z_MAX_CHUNK=1/0,p.Z_DEFAULT_CHUNK=16384,p.Z_MIN_MEMLEVEL=1,p.Z_MAX_MEMLEVEL=9,p.Z_DEFAULT_MEMLEVEL=8,p.Z_MIN_LEVEL=-1,p.Z_MAX_LEVEL=9,p.Z_DEFAULT_LEVEL=p.Z_DEFAULT_COMPRESSION,Object.keys(p).forEach(function(a){a.match(/^Z/)&&(b[a]=p[a])}),b.codes={Z_OK:p.Z_OK,Z_STREAM_END:p.Z_STREAM_END,Z_NEED_DICT:p.Z_NEED_DICT,Z_ERRNO:p.Z_ERRNO,Z_STREAM_ERROR:p.Z_STREAM_ERROR,Z_DATA_ERROR:p.Z_DATA_ERROR,Z_MEM_ERROR:p.Z_MEM_ERROR,Z_BUF_ERROR:p.Z_BUF_ERROR,Z_VERSION_ERROR:p.Z_VERSION_ERROR},Object.keys(b.codes).forEach(function(a){b.codes[b.codes[a]]=a}),b.Deflate=g,b.Inflate=h,b.Gzip=i,b.Gunzip=j,b.DeflateRaw=k,b.InflateRaw=l,b.Unzip=m,b.createDeflate=function(a){return new g(a)},b.createInflate=function(a){return new h(a)},b.createDeflateRaw=function(a){return new k(a)},b.createInflateRaw=function(a){return new l(a)},b.createGzip=function(a){return new i(a)},b.createGunzip=function(a){return new j(a)},b.createUnzip=function(a){return new m(a)},b.deflate=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new g(b),a,c)},b.deflateSync=function(a,b){return f(new g(b),a)},b.gzip=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new i(b),a,c)},b.gzipSync=function(a,b){return f(new i(b),a)},b.deflateRaw=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new k(b),a,c)},b.deflateRawSync=function(a,b){return f(new k(b),a)},b.unzip=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new m(b),a,c)},b.unzipSync=function(a,b){return f(new m(b),a)},b.inflate=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new h(b),a,c)},b.inflateSync=function(a,b){return f(new h(b),a)},b.gunzip=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new j(b),a,c)},b.gunzipSync=function(a,b){return f(new j(b),a)},b.inflateRaw=function(a,b,c){return"function"==typeof b&&(c=b,b={}),e(new l(b),a,c)},b.inflateRawSync=function(a,b){return f(new l(b),a)},q.inherits(n,o),n.prototype.params=function(a,c,e){if(a<b.Z_MIN_LEVEL||a>b.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+a);if(c!=b.Z_FILTERED&&c!=b.Z_HUFFMAN_ONLY&&c!=b.Z_RLE&&c!=b.Z_FIXED&&c!=b.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+c);if(this._level!==a||this._strategy!==c){var f=this;this.flush(p.Z_SYNC_FLUSH,function(){f._binding.params(a,c),f._hadError||(f._level=a,f._strategy=c,e&&e())})}else d.nextTick(e)},n.prototype.reset=function(){return this._binding.reset()},n.prototype._flush=function(b){this._transform(new a(0),"",b)},n.prototype.flush=function(b,c){var e=this._writableState;if(("function"==typeof b||void 0===b&&!c)&&(c=b,b=p.Z_FULL_FLUSH),e.ended)c&&d.nextTick(c);else if(e.ending)c&&this.once("end",c);else if(e.needDrain){var f=this;this.once("drain",function(){f.flush(c)})}else this._flushFlag=b,this.write(new a(0),"",c)},n.prototype.close=function(a){if(a&&d.nextTick(a),!this._closed){this._closed=!0,this._binding.close();var b=this;d.nextTick(function(){b.emit("close")})}},n.prototype._transform=function(b,c,d){var e,f=this._writableState,g=f.ending||f.ended,h=g&&(!b||f.length===b.length);if(null===!b&&!a.isBuffer(b))return d(new Error("invalid input"));h?e=p.Z_FINISH:(e=this._flushFlag,b.length>=f.length&&(this._flushFlag=this._opts.flush||p.Z_NO_FLUSH));this._processChunk(b,e,d)},n.prototype._processChunk=function(b,c,d){function e(k,n){if(!i._hadError){var o=g-n;if(r(o>=0,"have should not go down"),o>0){var p=i._buffer.slice(i._offset,i._offset+o);i._offset+=o,j?i.push(p):(l.push(p),m+=p.length)}if((0===n||i._offset>=i._chunkSize)&&(g=i._chunkSize,i._offset=0,i._buffer=new a(i._chunkSize)),0===n){if(h+=f-k,f=k,!j)return!0;var q=i._binding.write(c,b,h,f,i._buffer,i._offset,i._chunkSize);return q.callback=e,void(q.buffer=b)}if(!j)return!1;d()}}var f=b&&b.length,g=this._chunkSize-this._offset,h=0,i=this,j="function"==typeof d;if(!j){var k,l=[],m=0;this.on("error",function(a){k=a});do{var n=this._binding.writeSync(c,b,h,f,this._buffer,this._offset,g)}while(!this._hadError&&e(n[0],n[1]));if(this._hadError)throw k;var o=a.concat(l,m);return this.close(),o}var p=this._binding.write(c,b,h,f,this._buffer,this._offset,g);p.buffer=b,p.callback=e},q.inherits(g,n),q.inherits(h,n),q.inherits(i,n),q.inherits(j,n),q.inherits(k,n),q.inherits(l,n),q.inherits(m,n)}).call(b,c(5).Buffer,c(9))},function(a,b,c){(function(a){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function d(){return f.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function e(a,b){if(d()<b)throw new RangeError("Invalid typed array length");return f.TYPED_ARRAY_SUPPORT?(a=new Uint8Array(b),a.__proto__=f.prototype):(null===a&&(a=new f(b)),a.length=b),a}function f(a,b,c){if(!(f.TYPED_ARRAY_SUPPORT||this instanceof f))return new f(a,b,c);if("number"==typeof a){if("string"==typeof b)throw new Error("If encoding is specified then the first argument must be a string");return j(this,a)}return g(this,a,b,c)}function g(a,b,c,d){if("number"==typeof b)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&b instanceof ArrayBuffer?m(a,b,c,d):"string"==typeof b?k(a,b,c):n(a,b)}function h(a){if("number"!=typeof a)throw new TypeError('"size" argument must be a number');if(a<0)throw new RangeError('"size" argument must not be negative')}function i(a,b,c,d){return h(b),b<=0?e(a,b):void 0!==c?"string"==typeof d?e(a,b).fill(c,d):e(a,b).fill(c):e(a,b)}function j(a,b){if(h(b),a=e(a,b<0?0:0|o(b)),!f.TYPED_ARRAY_SUPPORT)for(var c=0;c<b;++c)a[c]=0;return a}function k(a,b,c){if("string"==typeof c&&""!==c||(c="utf8"),!f.isEncoding(c))throw new TypeError('"encoding" must be a valid string encoding');var d=0|q(b,c);a=e(a,d);var g=a.write(b,c);return g!==d&&(a=a.slice(0,g)),a}function l(a,b){var c=b.length<0?0:0|o(b.length);a=e(a,c);for(var d=0;d<c;d+=1)a[d]=255&b[d];return a}function m(a,b,c,d){if(b.byteLength,c<0||b.byteLength<c)throw new RangeError("'offset' is out of bounds");if(b.byteLength<c+(d||0))throw new RangeError("'length' is out of bounds");return b=void 0===c&&void 0===d?new Uint8Array(b):void 0===d?new Uint8Array(b,c):new Uint8Array(b,c,d),f.TYPED_ARRAY_SUPPORT?(a=b,a.__proto__=f.prototype):a=l(a,b),a}function n(a,b){if(f.isBuffer(b)){var c=0|o(b.length);return a=e(a,c),0===a.length?a:(b.copy(a,0,0,c),a)}if(b){if("undefined"!=typeof ArrayBuffer&&b.buffer instanceof ArrayBuffer||"length"in b)return"number"!=typeof b.length||X(b.length)?e(a,0):l(a,b);if("Buffer"===b.type&&$(b.data))return l(a,b.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function o(a){if(a>=d())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+d().toString(16)+" bytes");return 0|a}function p(a){return+a!=a&&(a=0),f.alloc(+a)}function q(a,b){if(f.isBuffer(a))return a.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(a)||a instanceof ArrayBuffer))return a.byteLength;"string"!=typeof a&&(a=""+a);var c=a.length;if(0===c)return 0;for(var d=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":case void 0:return S(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return V(a).length;default:if(d)return S(a).length;b=(""+b).toLowerCase(),d=!0}}function r(a,b,c){var d=!1;if((void 0===b||b<0)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),c<=0)return"";if(c>>>=0,b>>>=0,c<=b)return"";for(a||(a="utf8");;)switch(a){case"hex":return G(this,b,c);case"utf8":case"utf-8":return C(this,b,c);case"ascii":return E(this,b,c);case"latin1":case"binary":return F(this,b,c);case"base64":return B(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function s(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function t(a,b,c,d,e){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,isNaN(c)&&(c=e?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(e)return-1;c=a.length-1}else if(c<0){if(!e)return-1;c=0}if("string"==typeof b&&(b=f.from(b,d)),f.isBuffer(b))return 0===b.length?-1:u(a,b,c,d,e);if("number"==typeof b)return b&=255,f.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):u(a,[b],c,d,e);throw new TypeError("val must be string, number or Buffer")}function u(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&("ucs2"===(d=String(d).toLowerCase())||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;j<h;j++)if(f(a,j)===f(b,-1===k?0:j-k)){if(-1===k&&(k=j),j-k+1===i)return k*g}else-1!==k&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;m<i;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function v(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d))>e&&(d=e):d=e;var f=b.length;if(f%2!=0)throw new TypeError("Invalid hex string");d>f/2&&(d=f/2);for(var g=0;g<d;++g){var h=parseInt(b.substr(2*g,2),16);if(isNaN(h))return g;a[c+g]=h}return g}function w(a,b,c,d){return W(S(b,a.length-c),a,c,d)}function x(a,b,c,d){return W(T(b),a,c,d)}function y(a,b,c,d){return x(a,b,c,d)}function z(a,b,c,d){return W(V(b),a,c,d)}function A(a,b,c,d){return W(U(b,a.length-c),a,c,d)}function B(a,b,c){return 0===b&&c===a.length?Y.fromByteArray(a):Y.fromByteArray(a.slice(b,c))}function C(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(e+h<=c){var i,j,k,l;switch(h){case 1:f<128&&(g=f);break;case 2:i=a[e+1],128==(192&i)&&(l=(31&f)<<6|63&i)>127&&(g=l);break;case 3:i=a[e+1],j=a[e+2],128==(192&i)&&128==(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j)>2047&&(l<55296||l>57343)&&(g=l);break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128==(192&i)&&128==(192&j)&&128==(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k)>65535&&l<1114112&&(g=l)}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return D(d)}function D(a){var b=a.length;if(b<=_)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=_));return c}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function F(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function G(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;++f)e+=R(a[f]);return e}function H(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function I(a,b,c){if(a%1!=0||a<0)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function J(a,b,c,d,e,g){if(!f.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>e||b<g)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function K(a,b,c,d){b<0&&(b=65535+b+1);for(var e=0,f=Math.min(a.length-c,2);e<f;++e)a[c+e]=(b&255<<8*(d?e:1-e))>>>8*(d?e:1-e)}function L(a,b,c,d){b<0&&(b=4294967295+b+1);for(var e=0,f=Math.min(a.length-c,4);e<f;++e)a[c+e]=b>>>8*(d?e:3-e)&255}function M(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function N(a,b,c,d,e){return e||M(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(a,b,c,d,23,4),c+4}function O(a,b,c,d,e){return e||M(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(a,b,c,d,52,8),c+8}function P(a){if(a=Q(a).replace(aa,""),a.length<2)return"";for(;a.length%4!=0;)a+="=";return a}function Q(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function R(a){return a<16?"0"+a.toString(16):a.toString(16)}function S(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;++g){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=65536+(e-55296<<10|c-56320)}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function T(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function U(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function V(a){return Y.toByteArray(P(a))}function W(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function X(a){return a!==a}var Y=c(6),Z=c(7),$=c(8);b.Buffer=f,b.SlowBuffer=p,b.INSPECT_MAX_BYTES=50,f.TYPED_ARRAY_SUPPORT=void 0!==a.TYPED_ARRAY_SUPPORT?a.TYPED_ARRAY_SUPPORT:function(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()&&"function"==typeof a.subarray&&0===a.subarray(1,1).byteLength}catch(a){return!1}}(),b.kMaxLength=d(),f.poolSize=8192,f._augment=function(a){return a.__proto__=f.prototype,a},f.from=function(a,b,c){return g(null,a,b,c)},f.TYPED_ARRAY_SUPPORT&&(f.prototype.__proto__=Uint8Array.prototype,f.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&f[Symbol.species]===f&&Object.defineProperty(f,Symbol.species,{value:null,configurable:!0})),f.alloc=function(a,b,c){return i(null,a,b,c)},f.allocUnsafe=function(a){return j(null,a)},f.allocUnsafeSlow=function(a){return j(null,a)},f.isBuffer=function(a){return!(null==a||!a._isBuffer)},f.compare=function(a,b){if(!f.isBuffer(a)||!f.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var c=a.length,d=b.length,e=0,g=Math.min(c,d);e<g;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:d<c?1:0},f.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},f.concat=function(a,b){if(!$(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return f.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=f.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){var g=a[c];if(!f.isBuffer(g))throw new TypeError('"list" argument must be an Array of Buffers');g.copy(d,e),e+=g.length}return d},f.byteLength=q,f.prototype._isBuffer=!0,f.prototype.swap16=function(){var a=this.length;if(a%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<a;b+=2)s(this,b,b+1);return this},f.prototype.swap32=function(){var a=this.length;if(a%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)s(this,b,b+3),s(this,b+1,b+2);return this},f.prototype.swap64=function(){var a=this.length;if(a%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)s(this,b,b+7),s(this,b+1,b+6),s(this,b+2,b+5),s(this,b+3,b+4);return this},f.prototype.toString=function(){var a=0|this.length;return 0===a?"":0===arguments.length?C(this,0,a):r.apply(this,arguments)},f.prototype.equals=function(a){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===f.compare(this,a)},f.prototype.inspect=function(){var a="",c=b.INSPECT_MAX_BYTES;return this.length>0&&(a=this.toString("hex",0,c).match(/.{2}/g).join(" "),this.length>c&&(a+=" ... ")),"<Buffer "+a+">"},f.prototype.compare=function(a,b,c,d,e){if(!f.isBuffer(a))throw new TypeError("Argument must be a Buffer");if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),b<0||c>a.length||d<0||e>this.length)throw new RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;for(var g=e-d,h=c-b,i=Math.min(g,h),j=this.slice(d,e),k=a.slice(b,c),l=0;l<i;++l)if(j[l]!==k[l]){g=j[l],h=k[l];break}return g<h?-1:h<g?1:0},f.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)},f.prototype.indexOf=function(a,b,c){return t(this,a,b,c,!0)},f.prototype.lastIndexOf=function(a,b,c){return t(this,a,b,c,!1)},f.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b|=0,isFinite(c)?(c|=0,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(c<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return v(this,a,b,c);case"utf8":case"utf-8":return w(this,a,b,c);case"ascii":return x(this,a,b,c);case"latin1":case"binary":return y(this,a,b,c);case"base64":return z(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;f.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c)<0&&(a=0):a>c&&(a=c),b<0?(b+=c)<0&&(b=0):b>c&&(b=c),b<a&&(b=a);var d;if(f.TYPED_ARRAY_SUPPORT)d=this.subarray(a,b),d.__proto__=f.prototype;else{var e=b-a;d=new f(e,void 0);for(var g=0;g<e;++g)d[g]=this[g+a]}return d},f.prototype.readUIntLE=function(a,b,c){a|=0,b|=0,c||I(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},f.prototype.readUIntBE=function(a,b,c){a|=0,b|=0,c||I(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},f.prototype.readUInt8=function(a,b){return b||I(a,1,this.length),this[a]},f.prototype.readUInt16LE=function(a,b){return b||I(a,2,this.length),this[a]|this[a+1]<<8},f.prototype.readUInt16BE=function(a,b){return b||I(a,2,this.length),this[a]<<8|this[a+1]},f.prototype.readUInt32LE=function(a,b){return b||I(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},f.prototype.readUInt32BE=function(a,b){return b||I(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},f.prototype.readIntLE=function(a,b,c){a|=0,b|=0,c||I(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},f.prototype.readIntBE=function(a,b,c){a|=0,b|=0,c||I(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},f.prototype.readInt8=function(a,b){return b||I(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},f.prototype.readInt16LE=function(a,b){b||I(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt16BE=function(a,b){b||I(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},f.prototype.readInt32LE=function(a,b){return b||I(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},f.prototype.readInt32BE=function(a,b){return b||I(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},f.prototype.readFloatLE=function(a,b){return b||I(a,4,this.length),Z.read(this,a,!0,23,4)},f.prototype.readFloatBE=function(a,b){return b||I(a,4,this.length),Z.read(this,a,!1,23,4)},f.prototype.readDoubleLE=function(a,b){return b||I(a,8,this.length),Z.read(this,a,!0,52,8)},f.prototype.readDoubleBE=function(a,b){return b||I(a,8,this.length),Z.read(this,a,!1,52,8)},f.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b|=0,c|=0,!d){J(this,a,b,c,Math.pow(2,8*c)-1,0)}var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},f.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b|=0,c|=0,!d){J(this,a,b,c,Math.pow(2,8*c)-1,0)}var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},f.prototype.writeUInt8=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,1,255,0),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),this[b]=255&a,b+1},f.prototype.writeUInt16LE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):K(this,a,b,!0),b+2},f.prototype.writeUInt16BE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,2,65535,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):K(this,a,b,!1),b+2},f.prototype.writeUInt32LE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a):L(this,a,b,!0),b+4},f.prototype.writeUInt32BE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,4,4294967295,0),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):L(this,a,b,!1),b+4},f.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);J(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)a<0&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b|=0,!d){var e=Math.pow(2,8*c-1);J(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)a<0&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},f.prototype.writeInt8=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,1,127,-128),f.TYPED_ARRAY_SUPPORT||(a=Math.floor(a)),a<0&&(a=255+a+1),this[b]=255&a,b+1},f.prototype.writeInt16LE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8):K(this,a,b,!0),b+2},f.prototype.writeInt16BE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,2,32767,-32768),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>8,this[b+1]=255&a):K(this,a,b,!1),b+2},f.prototype.writeInt32LE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,4,2147483647,-2147483648),f.TYPED_ARRAY_SUPPORT?(this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24):L(this,a,b,!0),b+4},f.prototype.writeInt32BE=function(a,b,c){return a=+a,b|=0,c||J(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),f.TYPED_ARRAY_SUPPORT?(this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a):L(this,a,b,!1),b+4},f.prototype.writeFloatLE=function(a,b,c){return N(this,a,b,!0,c)},f.prototype.writeFloatBE=function(a,b,c){return N(this,a,b,!1,c)},f.prototype.writeDoubleLE=function(a,b,c){return O(this,a,b,!0,c)},f.prototype.writeDoubleBE=function(a,b,c){return O(this,a,b,!1,c)},f.prototype.copy=function(a,b,c,d){if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("sourceStart out of bounds");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var e,g=d-c;if(this===a&&c<b&&b<d)for(e=g-1;e>=0;--e)a[e+b]=this[e+c];else if(g<1e3||!f.TYPED_ARRAY_SUPPORT)for(e=0;e<g;++e)a[e+b]=this[e+c];else Uint8Array.prototype.set.call(a,this.subarray(c,c+g),b);return g},f.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),1===a.length){var e=a.charCodeAt(0);e<256&&(a=e)}if(void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!f.isEncoding(d))throw new TypeError("Unknown encoding: "+d)}else"number"==typeof a&&(a&=255);if(b<0||this.length<b||this.length<c)throw new RangeError("Out of range index");if(c<=b)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var g;if("number"==typeof a)for(g=b;g<c;++g)this[g]=a;else{var h=f.isBuffer(a)?a:S(new f(a,d).toString()),i=h.length;for(g=0;g<c-b;++g)this[g+b]=h[g%i]}return this};var aa=/[^+\/0-9A-Za-z-_]/g}).call(b,function(){return this}())},function(a,b){"use strict";function c(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===a[b-2]?2:"="===a[b-1]?1:0}function d(a){return 3*a.length/4-c(a)}function e(a){var b,d,e,f,g,h=a.length;f=c(a),g=new k(3*h/4-f),d=f>0?h-4:h;var i=0;for(b=0;b<d;b+=4)e=j[a.charCodeAt(b)]<<18|j[a.charCodeAt(b+1)]<<12|j[a.charCodeAt(b+2)]<<6|j[a.charCodeAt(b+3)],g[i++]=e>>16&255,g[i++]=e>>8&255,g[i++]=255&e;return 2===f?(e=j[a.charCodeAt(b)]<<2|j[a.charCodeAt(b+1)]>>4,g[i++]=255&e):1===f&&(e=j[a.charCodeAt(b)]<<10|j[a.charCodeAt(b+1)]<<4|j[a.charCodeAt(b+2)]>>2,g[i++]=e>>8&255,g[i++]=255&e),g}function f(a){return i[a>>18&63]+i[a>>12&63]+i[a>>6&63]+i[63&a]}function g(a,b,c){for(var d,e=[],g=b;g<c;g+=3)d=(a[g]<<16)+(a[g+1]<<8)+a[g+2],e.push(f(d));return e.join("")}function h(a){for(var b,c=a.length,d=c%3,e="",f=[],h=0,j=c-d;h<j;h+=16383)f.push(g(a,h,h+16383>j?j:h+16383));return 1===d?(b=a[c-1],e+=i[b>>2],e+=i[b<<4&63],e+="=="):2===d&&(b=(a[c-2]<<8)+a[c-1],e+=i[b>>10],e+=i[b>>4&63],e+=i[b<<2&63],e+="="),f.push(e),f.join("")}b.byteLength=d,b.toByteArray=e,b.fromByteArray=h;for(var i=[],j=[],k="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0,n=l.length;m<n;++m)i[m]=l[m],j[l.charCodeAt(m)]=m;j["-".charCodeAt(0)]=62,j["_".charCodeAt(0)]=63},function(a,b){b.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},b.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},function(a,b){var c={}.toString;a.exports=Array.isArray||function(a){return"[object Array]"==c.call(a)}},function(a,b){function c(){throw new Error("setTimeout has not been defined")}function d(){throw new Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.prependListener=j,m.prependOnceListener=j,m.listeners=function(a){return[]},m.binding=function(a){throw new Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw new Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b,c){a.exports=c(11).Transform},function(a,b,c){b=a.exports=c(12),b.Stream=b,b.Readable=b,b.Writable=c(23),b.Duplex=c(22),b.Transform=c(28),b.PassThrough=c(29)},function(a,b,c){(function(b,d){"use strict";function e(a){return L.from(a)}function f(a){return L.isBuffer(a)||a instanceof M}function g(a,b,c){if("function"==typeof a.prependListener)return a.prependListener(b,c);a._events&&a._events[b]?I(a._events[b])?a._events[b].unshift(c):a._events[b]=[c,a._events[b]]:a.on(b,c)}function h(a,b){H=H||c(22),a=a||{},this.objectMode=!!a.objectMode,b instanceof H&&(this.objectMode=this.objectMode||!!a.readableObjectMode);var d=a.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new R,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=a.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,a.encoding&&(Q||(Q=c(27).StringDecoder),this.decoder=new Q(a.encoding),this.encoding=a.encoding)}function i(a){if(H=H||c(22),!(this instanceof i))return new i(a);this._readableState=new h(a,this),this.readable=!0,a&&("function"==typeof a.read&&(this._read=a.read),"function"==typeof a.destroy&&(this._destroy=a.destroy)),K.call(this)}function j(a,b,c,d,f){var g=a._readableState;if(null===b)g.reading=!1,p(a,g);else{var h;f||(h=l(g,b)),h?a.emit("error",h):g.objectMode||b&&b.length>0?("string"==typeof b||g.objectMode||Object.getPrototypeOf(b)===L.prototype||(b=e(b)),d?g.endEmitted?a.emit("error",new Error("stream.unshift() after end event")):k(a,g,b,!0):g.ended?a.emit("error",new Error("stream.push() after EOF")):(g.reading=!1,g.decoder&&!c?(b=g.decoder.write(b),g.objectMode||0!==b.length?k(a,g,b,!1):s(a,g)):k(a,g,b,!1))):d||(g.reading=!1)}return m(g)}function k(a,b,c,d){b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,d?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&q(a)),s(a,b)}function l(a,b){var c;return f(b)||"string"==typeof b||void 0===b||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function m(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function n(a){return a>=U?a=U:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++),a}function o(a,b){return a<=0||0===b.length&&b.ended?0:b.objectMode?1:a!==a?b.flowing&&b.length?b.buffer.head.data.length:b.length:(a>b.highWaterMark&&(b.highWaterMark=n(a)),a<=b.length?a:b.ended?b.length:(b.needReadable=!0,0))}function p(a,b){if(!b.ended){if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,q(a)}}function q(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(P("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?G(r,a):r(a))}function r(a){P("emit readable"),a.emit("readable"),y(a)}function s(a,b){b.readingMore||(b.readingMore=!0,G(t,a,b))}function t(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(P("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function u(a){return function(){var b=a._readableState;P("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&J(a,"data")&&(b.flowing=!0,y(a))}}function v(a){P("readable nexttick read 0"),a.read(0)}function w(a,b){b.resumeScheduled||(b.resumeScheduled=!0,G(x,a,b))}function x(a,b){b.reading||(P("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),y(a),b.flowing&&!b.reading&&a.read(0)}function y(a){var b=a._readableState;for(P("flow",b.flowing);b.flowing&&null!==a.read(););}function z(a,b){if(0===b.length)return null;var c;return b.objectMode?c=b.buffer.shift():!a||a>=b.length?(c=b.decoder?b.buffer.join(""):1===b.buffer.length?b.buffer.head.data:b.buffer.concat(b.length),b.buffer.clear()):c=A(a,b.buffer,b.decoder),c}function A(a,b,c){var d;return a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):d=a===b.head.data.length?b.shift():c?B(a,b):C(a,b),d}function B(a,b){var c=b.head,d=1,e=c.data;for(a-=e.length;c=c.next;){var f=c.data,g=a>f.length?f.length:a;if(g===f.length?e+=f:e+=f.slice(0,a),0===(a-=g)){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}return b.length-=d,e}function C(a,b){var c=L.allocUnsafe(a),d=b.head,e=1;for(d.data.copy(c),a-=d.data.length;d=d.next;){var f=d.data,g=a>f.length?f.length:a;if(f.copy(c,c.length-a,0,g),0===(a-=g)){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}return b.length-=e,c}function D(a){var b=a._readableState;if(b.length>0)throw new Error('"endReadable()" called on non-empty stream');b.endEmitted||(b.ended=!0,G(E,b,a))}function E(a,b){a.endEmitted||0!==a.length||(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function F(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}var G=c(13);a.exports=i;var H,I=c(8);i.ReadableState=h;var J=(c(14).EventEmitter,function(a,b){return a.listeners(b).length}),K=c(15),L=c(16).Buffer,M=b.Uint8Array||function(){},N=c(17);N.inherits=c(18);var O=c(19),P=void 0;P=O&&O.debuglog?O.debuglog("stream"):function(){};var Q,R=c(20),S=c(21);N.inherits(i,K);var T=["error","close","destroy","pause","resume"];Object.defineProperty(i.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(a){this._readableState&&(this._readableState.destroyed=a)}}),i.prototype.destroy=S.destroy,i.prototype._undestroy=S.undestroy,i.prototype._destroy=function(a,b){this.push(null),b(a)},i.prototype.push=function(a,b){var c,d=this._readableState;return d.objectMode?c=!0:"string"==typeof a&&(b=b||d.defaultEncoding,b!==d.encoding&&(a=L.from(a,b),b=""),c=!0),j(this,a,b,!1,c)},i.prototype.unshift=function(a){return j(this,a,null,!0,!1)},i.prototype.isPaused=function(){return!1===this._readableState.flowing},i.prototype.setEncoding=function(a){return Q||(Q=c(27).StringDecoder),this._readableState.decoder=new Q(a),this._readableState.encoding=a,this};var U=8388608;i.prototype.read=function(a){P("read",a),a=parseInt(a,10);var b=this._readableState,c=a;if(0!==a&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return P("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?D(this):q(this),null;if(0===(a=o(a,b))&&b.ended)return 0===b.length&&D(this),null;var d=b.needReadable;P("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,P("length less than watermark",d)),b.ended||b.reading?(d=!1,P("reading or ended",d)):d&&(P("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=o(c,b)));var e;return e=a>0?z(a,b):null,null===e?(b.needReadable=!0,a=0):b.length-=a,0===b.length&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&D(this)),null!==e&&this.emit("data",e),e},i.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))},i.prototype.pipe=function(a,b){function c(a,b){P("onunpipe"),a===m&&b&&!1===b.hasUnpiped&&(b.hasUnpiped=!0,f())}function e(){P("onend"),a.end()}function f(){P("cleanup"),a.removeListener("close",j),a.removeListener("finish",k),a.removeListener("drain",q),a.removeListener("error",i),a.removeListener("unpipe",c),m.removeListener("end",e),m.removeListener("end",l),m.removeListener("data",h),r=!0,!n.awaitDrain||a._writableState&&!a._writableState.needDrain||q()}function h(b){P("ondata"),s=!1,!1!==a.write(b)||s||((1===n.pipesCount&&n.pipes===a||n.pipesCount>1&&-1!==F(n.pipes,a))&&!r&&(P("false write response, pause",m._readableState.awaitDrain),m._readableState.awaitDrain++,s=!0),m.pause())}function i(b){P("onerror",b),l(),a.removeListener("error",i),0===J(a,"error")&&a.emit("error",b)}function j(){a.removeListener("finish",k),l()}function k(){P("onfinish"),a.removeListener("close",j),l()}
function l(){P("unpipe"),m.unpipe(a)}var m=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=a;break;case 1:n.pipes=[n.pipes,a];break;default:n.pipes.push(a)}n.pipesCount+=1,P("pipe count=%d opts=%j",n.pipesCount,b);var o=(!b||!1!==b.end)&&a!==d.stdout&&a!==d.stderr,p=o?e:l;n.endEmitted?G(p):m.once("end",p),a.on("unpipe",c);var q=u(m);a.on("drain",q);var r=!1,s=!1;return m.on("data",h),g(a,"error",i),a.once("close",j),a.once("finish",k),a.emit("pipe",m),n.flowing||(P("pipe resume"),m.resume()),a},i.prototype.unpipe=function(a){var b=this._readableState,c={hasUnpiped:!1};if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this,c),this);if(!a){var d=b.pipes,e=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var f=0;f<e;f++)d[f].emit("unpipe",this,c);return this}var g=F(b.pipes,a);return-1===g?this:(b.pipes.splice(g,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this,c),this)},i.prototype.on=function(a,b){var c=K.prototype.on.call(this,a,b);if("data"===a)!1!==this._readableState.flowing&&this.resume();else if("readable"===a){var d=this._readableState;d.endEmitted||d.readableListening||(d.readableListening=d.needReadable=!0,d.emittedReadable=!1,d.reading?d.length&&q(this):G(v,this))}return c},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var a=this._readableState;return a.flowing||(P("resume"),a.flowing=!0,w(this,a)),this},i.prototype.pause=function(){return P("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(P("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(P("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(P("wrapped data"),b.decoder&&(e=b.decoder.write(e)),(!b.objectMode||null!==e&&void 0!==e)&&(b.objectMode||e&&e.length)){d.push(e)||(c=!0,a.pause())}});for(var e in a)void 0===this[e]&&"function"==typeof a[e]&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));for(var f=0;f<T.length;f++)a.on(T[f],d.emit.bind(d,T[f]));return d._read=function(b){P("wrapped _read",b),c&&(c=!1,a.resume())},d},i._fromList=z}).call(b,function(){return this}(),c(9))},function(a,b,c){(function(b){"use strict";function c(a,c,d,e){if("function"!=typeof a)throw new TypeError('"callback" argument must be a function');var f,g,h=arguments.length;switch(h){case 0:case 1:return b.nextTick(a);case 2:return b.nextTick(function(){a.call(null,c)});case 3:return b.nextTick(function(){a.call(null,c,d)});case 4:return b.nextTick(function(){a.call(null,c,d,e)});default:for(f=new Array(h-1),g=0;g<f.length;)f[g++]=arguments[g];return b.nextTick(function(){a.apply(null,f)})}}!b.version||0===b.version.indexOf("v0.")||0===b.version.indexOf("v1.")&&0!==b.version.indexOf("v1.8.")?a.exports=c:a.exports=b.nextTick}).call(b,c(9))},function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;i<e;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners)&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(e<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){return this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},function(a,b,c){a.exports=c(14).EventEmitter},function(a,b,c){function d(a,b){for(var c in a)b[c]=a[c]}function e(a,b,c){return g(a,b,c)}var f=c(5),g=f.Buffer;g.from&&g.alloc&&g.allocUnsafe&&g.allocUnsafeSlow?a.exports=f:(d(f,b),b.Buffer=e),d(g,e),e.from=function(a,b,c){if("number"==typeof a)throw new TypeError("Argument must not be a number");return g(a,b,c)},e.alloc=function(a,b,c){if("number"!=typeof a)throw new TypeError("Argument must be a number");var d=g(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},e.allocUnsafe=function(a){if("number"!=typeof a)throw new TypeError("Argument must be a number");return g(a)},e.allocUnsafeSlow=function(a){if("number"!=typeof a)throw new TypeError("Argument must be a number");return f.SlowBuffer(a)}},function(a,b,c){(function(a){function c(a){return Array.isArray?Array.isArray(a):"[object Array]"===q(a)}function d(a){return"boolean"==typeof a}function e(a){return null===a}function f(a){return null==a}function g(a){return"number"==typeof a}function h(a){return"string"==typeof a}function i(a){return"symbol"==typeof a}function j(a){return void 0===a}function k(a){return"[object RegExp]"===q(a)}function l(a){return"object"==typeof a&&null!==a}function m(a){return"[object Date]"===q(a)}function n(a){return"[object Error]"===q(a)||a instanceof Error}function o(a){return"function"==typeof a}function p(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||void 0===a}function q(a){return Object.prototype.toString.call(a)}b.isArray=c,b.isBoolean=d,b.isNull=e,b.isNullOrUndefined=f,b.isNumber=g,b.isString=h,b.isSymbol=i,b.isUndefined=j,b.isRegExp=k,b.isObject=l,b.isDate=m,b.isError=n,b.isFunction=o,b.isPrimitive=p,b.isBuffer=a.isBuffer}).call(b,c(5).Buffer)},function(a,b){"function"==typeof Object.create?a.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:a.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},function(a,b){},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b,c){a.copy(b,c)}var f=c(16).Buffer;a.exports=function(){function a(){d(this,a),this.head=null,this.tail=null,this.length=0}return a.prototype.push=function(a){var b={data:a,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length},a.prototype.unshift=function(a){var b={data:a,next:this.head};0===this.length&&(this.tail=b),this.head=b,++this.length},a.prototype.shift=function(){if(0!==this.length){var a=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,a}},a.prototype.clear=function(){this.head=this.tail=null,this.length=0},a.prototype.join=function(a){if(0===this.length)return"";for(var b=this.head,c=""+b.data;b=b.next;)c+=a+b.data;return c},a.prototype.concat=function(a){if(0===this.length)return f.alloc(0);if(1===this.length)return this.head.data;for(var b=f.allocUnsafe(a>>>0),c=this.head,d=0;c;)e(c.data,b,d),d+=c.data.length,c=c.next;return b},a}()},function(a,b,c){"use strict";function d(a,b){var c=this,d=this._readableState&&this._readableState.destroyed,e=this._writableState&&this._writableState.destroyed;if(d||e)return void(b?b(a):!a||this._writableState&&this._writableState.errorEmitted||g(f,this,a));this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(a||null,function(a){!b&&a?(g(f,c,a),c._writableState&&(c._writableState.errorEmitted=!0)):b&&b(a)})}function e(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function f(a,b){a.emit("error",b)}var g=c(13);a.exports={destroy:d,undestroy:e}},function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);j.call(this,a),k.call(this,a),a&&!1===a.readable&&(this.readable=!1),a&&!1===a.writable&&(this.writable=!1),this.allowHalfOpen=!0,a&&!1===a.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",e)}function e(){this.allowHalfOpen||this._writableState.ended||g(f,this)}function f(a){a.end()}var g=c(13),h=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};a.exports=d;var i=c(17);i.inherits=c(18);var j=c(12),k=c(23);i.inherits(d,j);for(var l=h(k.prototype),m=0;m<l.length;m++){var n=l[m];d.prototype[n]||(d.prototype[n]=k.prototype[n])}Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(a){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=a,this._writableState.destroyed=a)}}),d.prototype._destroy=function(a,b){this.push(null),this.end(),g(b,a)}},function(a,b,c){(function(b,d,e){"use strict";function f(a){var b=this;this.next=null,this.entry=null,this.finish=function(){B(b,a)}}function g(a){return I.from(a)}function h(a){return I.isBuffer(a)||a instanceof J}function i(){}function j(a,b){D=D||c(22),a=a||{},this.objectMode=!!a.objectMode,b instanceof D&&(this.objectMode=this.objectMode||!!a.writableObjectMode);var d=a.highWaterMark,e=this.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var g=!1===a.decodeStrings;this.decodeStrings=!g,this.defaultEncoding=a.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(a){s(b,a)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new f(this)}function k(a){if(D=D||c(22),!(L.call(k,this)||this instanceof D))return new k(a);this._writableState=new j(a,this),this.writable=!0,a&&("function"==typeof a.write&&(this._write=a.write),"function"==typeof a.writev&&(this._writev=a.writev),"function"==typeof a.destroy&&(this._destroy=a.destroy),"function"==typeof a.final&&(this._final=a.final)),H.call(this)}function l(a,b){var c=new Error("write after end");a.emit("error",c),C(b,c)}function m(a,b,c,d){var e=!0,f=!1;return null===c?f=new TypeError("May not write null values to stream"):"string"==typeof c||void 0===c||b.objectMode||(f=new TypeError("Invalid non-string/buffer chunk")),f&&(a.emit("error",f),C(d,f),e=!1),e}function n(a,b,c){return a.objectMode||!1===a.decodeStrings||"string"!=typeof b||(b=I.from(b,c)),b}function o(a,b,c,d,e,f){if(!c){var g=n(b,d,e);d!==g&&(c=!0,e="buffer",d=g)}var h=b.objectMode?1:d.length;b.length+=h;var i=b.length<b.highWaterMark;if(i||(b.needDrain=!0),b.writing||b.corked){var j=b.lastBufferedRequest;b.lastBufferedRequest={chunk:d,encoding:e,isBuf:c,callback:f,next:null},j?j.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest,b.bufferedRequestCount+=1}else p(a,b,!1,h,d,e,f);return i}function p(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function q(a,b,c,d,e){--b.pendingcb,c?(C(e,d),C(z,a,b),a._writableState.errorEmitted=!0,a.emit("error",d)):(e(d),a._writableState.errorEmitted=!0,a.emit("error",d),z(a,b))}function r(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function s(a,b){var c=a._writableState,d=c.sync,e=c.writecb;if(r(c),b)q(a,c,d,b,e);else{var f=w(c);f||c.corked||c.bufferProcessing||!c.bufferedRequest||v(a,c),d?E(t,a,c,f,e):t(a,c,f,e)}}function t(a,b,c,d){c||u(a,b),b.pendingcb--,d(),z(a,b)}function u(a,b){0===b.length&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function v(a,b){b.bufferProcessing=!0;var c=b.bufferedRequest;if(a._writev&&c&&c.next){var d=b.bufferedRequestCount,e=new Array(d),g=b.corkedRequestsFree;g.entry=c;for(var h=0,i=!0;c;)e[h]=c,c.isBuf||(i=!1),c=c.next,h+=1;e.allBuffers=i,p(a,b,!0,b.length,e,"",g.finish),b.pendingcb++,b.lastBufferedRequest=null,g.next?(b.corkedRequestsFree=g.next,g.next=null):b.corkedRequestsFree=new f(b)}else{for(;c;){var j=c.chunk,k=c.encoding,l=c.callback;if(p(a,b,!1,b.objectMode?1:j.length,j,k,l),c=c.next,b.writing)break}null===c&&(b.lastBufferedRequest=null)}b.bufferedRequestCount=0,b.bufferedRequest=c,b.bufferProcessing=!1}function w(a){return a.ending&&0===a.length&&null===a.bufferedRequest&&!a.finished&&!a.writing}function x(a,b){a._final(function(c){b.pendingcb--,c&&a.emit("error",c),b.prefinished=!0,a.emit("prefinish"),z(a,b)})}function y(a,b){b.prefinished||b.finalCalled||("function"==typeof a._final?(b.pendingcb++,b.finalCalled=!0,C(x,a,b)):(b.prefinished=!0,a.emit("prefinish")))}function z(a,b){var c=w(b);return c&&(y(a,b),0===b.pendingcb&&(b.finished=!0,a.emit("finish"))),c}function A(a,b,c){b.ending=!0,z(a,b),c&&(b.finished?C(c):a.once("finish",c)),b.ended=!0,a.writable=!1}function B(a,b,c){var d=a.entry;for(a.entry=null;d;){var e=d.callback;b.pendingcb--,e(c),d=d.next}b.corkedRequestsFree?b.corkedRequestsFree.next=a:b.corkedRequestsFree=a}var C=c(13);a.exports=k;var D,E=!b.browser&&["v0.10","v0.9."].indexOf(b.version.slice(0,5))>-1?d:C;k.WritableState=j;var F=c(17);F.inherits=c(18);var G={deprecate:c(26)},H=c(15),I=c(16).Buffer,J=e.Uint8Array||function(){},K=c(21);F.inherits(k,H),j.prototype.getBuffer=function(){for(var a=this.bufferedRequest,b=[];a;)b.push(a),a=a.next;return b},function(){try{Object.defineProperty(j.prototype,"buffer",{get:G.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(a){}}();var L;"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(L=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(a){return!!L.call(this,a)||a&&a._writableState instanceof j}})):L=function(a){return a instanceof this},k.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},k.prototype.write=function(a,b,c){var d=this._writableState,e=!1,f=h(a)&&!d.objectMode;return f&&!I.isBuffer(a)&&(a=g(a)),"function"==typeof b&&(c=b,b=null),f?b="buffer":b||(b=d.defaultEncoding),"function"!=typeof c&&(c=i),d.ended?l(this,c):(f||m(this,d,a,c))&&(d.pendingcb++,e=o(this,d,f,a,b,c)),e},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,a.writing||a.corked||a.finished||a.bufferProcessing||!a.bufferedRequest||v(this,a))},k.prototype.setDefaultEncoding=function(a){if("string"==typeof a&&(a=a.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);return this._writableState.defaultEncoding=a,this},k.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))},k.prototype._writev=null,k.prototype.end=function(a,b,c){var d=this._writableState;"function"==typeof a?(c=a,a=null,b=null):"function"==typeof b&&(c=b,b=null),null!==a&&void 0!==a&&this.write(a,b),d.corked&&(d.corked=1,this.uncork()),d.ending||d.finished||A(this,d,c)},Object.defineProperty(k.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(a){this._writableState&&(this._writableState.destroyed=a)}}),k.prototype.destroy=K.destroy,k.prototype._undestroy=K.undestroy,k.prototype._destroy=function(a,b){this.end(),b(a)}}).call(b,c(9),c(24).setImmediate,function(){return this}())},function(a,b,c){function d(a,b){this._id=a,this._clearFn=b}var e=Function.prototype.apply;b.setTimeout=function(){return new d(e.call(setTimeout,window,arguments),clearTimeout)},b.setInterval=function(){return new d(e.call(setInterval,window,arguments),clearInterval)},b.clearTimeout=b.clearInterval=function(a){a&&a.close()},d.prototype.unref=d.prototype.ref=function(){},d.prototype.close=function(){this._clearFn.call(window,this._id)},b.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},b.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},b._unrefActive=b.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;b>=0&&(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},c(25),b.setImmediate=setImmediate,b.clearImmediate=clearImmediate},function(a,b,c){(function(a,b){!function(a,c){"use strict";function d(a){"function"!=typeof a&&(a=new Function(""+a));for(var b=new Array(arguments.length-1),c=0;c<b.length;c++)b[c]=arguments[c+1];var d={callback:a,args:b};return j[i]=d,h(i),i++}function e(a){delete j[a]}function f(a){var b=a.callback,d=a.args;switch(d.length){case 0:b();break;case 1:b(d[0]);break;case 2:b(d[0],d[1]);break;case 3:b(d[0],d[1],d[2]);break;default:b.apply(c,d)}}function g(a){if(k)setTimeout(g,0,a);else{var b=j[a];if(b){k=!0;try{f(b)}finally{e(a),k=!1}}}}if(!a.setImmediate){var h,i=1,j={},k=!1,l=a.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(a);m=m&&m.setTimeout?m:a,"[object process]"==={}.toString.call(a.process)?function(){h=function(a){b.nextTick(function(){g(a)})}}():function(){if(a.postMessage&&!a.importScripts){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}()?function(){var b="setImmediate$"+Math.random()+"$",c=function(c){c.source===a&&"string"==typeof c.data&&0===c.data.indexOf(b)&&g(+c.data.slice(b.length))};a.addEventListener?a.addEventListener("message",c,!1):a.attachEvent("onmessage",c),h=function(c){a.postMessage(b+c,"*")}}():a.MessageChannel?function(){var a=new MessageChannel;a.port1.onmessage=function(a){g(a.data)},h=function(b){a.port2.postMessage(b)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var a=l.documentElement;h=function(b){var c=l.createElement("script");c.onreadystatechange=function(){g(b),c.onreadystatechange=null,a.removeChild(c),c=null},a.appendChild(c)}}():function(){h=function(a){setTimeout(g,0,a)}}(),m.setImmediate=d,m.clearImmediate=e}}("undefined"==typeof self?void 0===a?this:a:self)}).call(b,function(){return this}(),c(9))},function(a,b){(function(b){function c(a,b){function c(){if(!e){if(d("throwDeprecation"))throw new Error(b);d("traceDeprecation")?console.trace(b):console.warn(b),e=!0}return a.apply(this,arguments)}if(d("noDeprecation"))return a;var e=!1;return c}function d(a){try{if(!b.localStorage)return!1}catch(a){return!1}var c=b.localStorage[a];return null!=c&&"true"===String(c).toLowerCase()}a.exports=c}).call(b,function(){return this}())},function(a,b,c){"use strict";function d(a){if(!a)return"utf8";for(var b;;)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(b)return;a=(""+a).toLowerCase(),b=!0}}function e(a){var b=d(a);if("string"!=typeof b&&(s.isEncoding===t||!t(a)))throw new Error("Unknown encoding: "+a);return b||a}function f(a){this.encoding=e(a);var b;switch(this.encoding){case"utf16le":this.text=m,this.end=n,b=4;break;case"utf8":this.fillLast=j,b=4;break;case"base64":this.text=o,this.end=p,b=3;break;default:return this.write=q,void(this.end=r)}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(b)}function g(a){return a<=127?0:a>>5==6?2:a>>4==14?3:a>>3==30?4:-1}function h(a,b,c){var d=b.length-1;if(d<c)return 0;var e=g(b[d]);return e>=0?(e>0&&(a.lastNeed=e-1),e):--d<c?0:(e=g(b[d]))>=0?(e>0&&(a.lastNeed=e-2),e):--d<c?0:(e=g(b[d]),e>=0?(e>0&&(2===e?e=0:a.lastNeed=e-3),e):0)}function i(a,b,c){if(128!=(192&b[0]))return a.lastNeed=0,"".repeat(c);if(a.lastNeed>1&&b.length>1){if(128!=(192&b[1]))return a.lastNeed=1,"".repeat(c+1);if(a.lastNeed>2&&b.length>2&&128!=(192&b[2]))return a.lastNeed=2,"".repeat(c+2)}}function j(a){var b=this.lastTotal-this.lastNeed,c=i(this,a,b);return void 0!==c?c:this.lastNeed<=a.length?(a.copy(this.lastChar,b,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(a.copy(this.lastChar,b,0,a.length),void(this.lastNeed-=a.length))}function k(a,b){var c=h(this,a,b);if(!this.lastNeed)return a.toString("utf8",b);this.lastTotal=c;var d=a.length-(c-this.lastNeed);return a.copy(this.lastChar,0,d),a.toString("utf8",b,d)}function l(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+"".repeat(this.lastTotal-this.lastNeed):b}function m(a,b){if((a.length-b)%2==0){var c=a.toString("utf16le",b);if(c){var d=c.charCodeAt(c.length-1);if(d>=55296&&d<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1],c.slice(0,-1)}return c}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=a[a.length-1],a.toString("utf16le",b,a.length-1)}function n(a){var b=a&&a.length?this.write(a):"";if(this.lastNeed){var c=this.lastTotal-this.lastNeed;return b+this.lastChar.toString("utf16le",0,c)}return b}function o(a,b){var c=(a.length-b)%3;return 0===c?a.toString("base64",b):(this.lastNeed=3-c,this.lastTotal=3,1===c?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]),a.toString("base64",b,a.length-c))}function p(a){var b=a&&a.length?this.write(a):"";return this.lastNeed?b+this.lastChar.toString("base64",0,3-this.lastNeed):b}function q(a){return a.toString(this.encoding)}function r(a){return a&&a.length?this.write(a):""}var s=c(16).Buffer,t=s.isEncoding||function(a){switch((a=""+a)&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};b.StringDecoder=f,f.prototype.write=function(a){if(0===a.length)return"";var b,c;if(this.lastNeed){if(void 0===(b=this.fillLast(a)))return"";c=this.lastNeed,this.lastNeed=0}else c=0;return c<a.length?b?b+this.text(a,c):this.text(a,c):b||""},f.prototype.end=l,f.prototype.text=k,f.prototype.fillLast=function(a){if(this.lastNeed<=a.length)return a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length),this.lastNeed-=a.length}},function(a,b,c){"use strict";function d(a){this.afterTransform=function(b,c){return e(a,b,c)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function e(a,b,c){var d=a._transformState;d.transforming=!1;var e=d.writecb;if(!e)return a.emit("error",new Error("write callback called multiple times"));d.writechunk=null,d.writecb=null,null!==c&&void 0!==c&&a.push(c),e(b);var f=a._readableState;f.reading=!1,(f.needReadable||f.length<f.highWaterMark)&&a._read(f.highWaterMark)}function f(a){if(!(this instanceof f))return new f(a);h.call(this,a),this._transformState=new d(this);var b=this;this._readableState.needReadable=!0,this._readableState.sync=!1,a&&("function"==typeof a.transform&&(this._transform=a.transform),"function"==typeof a.flush&&(this._flush=a.flush)),this.once("prefinish",function(){"function"==typeof this._flush?this._flush(function(a,c){g(b,a,c)}):g(b)})}function g(a,b,c){if(b)return a.emit("error",b);null!==c&&void 0!==c&&a.push(c);var d=a._writableState,e=a._transformState;if(d.length)throw new Error("Calling transform done when ws.length != 0");if(e.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}a.exports=f;var h=c(22),i=c(17);i.inherits=c(18),i.inherits(f,h),f.prototype.push=function(a,b){return this._transformState.needTransform=!1,h.prototype.push.call(this,a,b)},f.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")},f.prototype._write=function(a,b,c){var d=this._transformState;if(d.writecb=c,d.writechunk=a,d.writeencoding=b,!d.transforming){var e=this._readableState;(d.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark)}},f.prototype._read=function(a){var b=this._transformState;null!==b.writechunk&&b.writecb&&!b.transforming?(b.transforming=!0,this._transform(b.writechunk,b.writeencoding,b.afterTransform)):b.needTransform=!0},f.prototype._destroy=function(a,b){var c=this;h.prototype._destroy.call(this,a,function(a){b(a),c.emit("close")})}},function(a,b,c){"use strict";function d(a){if(!(this instanceof d))return new d(a);e.call(this,a)}a.exports=d;var e=c(28),f=c(17);f.inherits=c(18),f.inherits(d,e),d.prototype._transform=function(a,b,c){c(null,a)}},function(a,b,c){(function(a,d){function e(a){if(a<b.DEFLATE||a>b.UNZIP)throw new TypeError("Bad argument");this.mode=a,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function f(a,b){for(var c=0;c<a.length;c++)this[b+c]=a[c]}var g=c(31),h=c(32),i=c(33),j=c(38),k=c(41);for(var l in k)b[l]=k[l];b.NONE=0,b.DEFLATE=1,b.INFLATE=2,b.GZIP=3,b.GUNZIP=4,b.DEFLATERAW=5,b.INFLATERAW=6,b.UNZIP=7,e.prototype.init=function(a,c,d,e,f){switch(this.windowBits=a,this.level=c,this.memLevel=d,this.strategy=e,this.mode!==b.GZIP&&this.mode!==b.GUNZIP||(this.windowBits+=16),this.mode===b.UNZIP&&(this.windowBits+=32),this.mode!==b.DEFLATERAW&&this.mode!==b.INFLATERAW||(this.windowBits=-this.windowBits),this.strm=new h,this.mode){case b.DEFLATE:case b.GZIP:case b.DEFLATERAW:var g=i.deflateInit2(this.strm,this.level,b.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case b.INFLATE:case b.GUNZIP:case b.INFLATERAW:case b.UNZIP:var g=j.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(g!==b.Z_OK)return void this._error(g);this.write_in_progress=!1,this.init_done=!0},e.prototype.params=function(){throw new Error("deflateParams Not supported")},e.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(this.mode===b.NONE)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},e.prototype.write=function(b,c,d,e,f,g,h){this._writeCheck(),this.write_in_progress=!0;var i=this;return a.nextTick(function(){i.write_in_progress=!1;var a=i._write(b,c,d,e,f,g,h);i.callback(a[0],a[1]),i.pending_close&&i.close()}),this},e.prototype.writeSync=function(a,b,c,d,e,f,g){return this._writeCheck(),this._write(a,b,c,d,e,f,g)},e.prototype._write=function(a,c,e,g,h,k,l){if(this.write_in_progress=!0,a!==b.Z_NO_FLUSH&&a!==b.Z_PARTIAL_FLUSH&&a!==b.Z_SYNC_FLUSH&&a!==b.Z_FULL_FLUSH&&a!==b.Z_FINISH&&a!==b.Z_BLOCK)throw new Error("Invalid flush value");null==c&&(c=new d(0),g=0,e=0),h._set?h.set=h._set:h.set=f;var m=this.strm;switch(m.avail_in=g,m.input=c,m.next_in=e,m.avail_out=l,m.output=h,m.next_out=k,this.mode){case b.DEFLATE:case b.GZIP:case b.DEFLATERAW:var n=i.deflate(m,a);break;case b.UNZIP:case b.INFLATE:case b.GUNZIP:case b.INFLATERAW:var n=j.inflate(m,a);break;default:throw new Error("Unknown mode "+this.mode)}return n!==b.Z_STREAM_END&&n!==b.Z_OK&&this._error(n),this.write_in_progress=!1,[m.avail_in,m.avail_out]},e.prototype.close=function(){if(this.write_in_progress)return void(this.pending_close=!0);this.pending_close=!1,this.mode===b.DEFLATE||this.mode===b.GZIP||this.mode===b.DEFLATERAW?i.deflateEnd(this.strm):j.inflateEnd(this.strm),this.mode=b.NONE},e.prototype.reset=function(){switch(this.mode){case b.DEFLATE:case b.DEFLATERAW:var a=i.deflateReset(this.strm);break;case b.INFLATE:case b.INFLATERAW:var a=j.inflateReset(this.strm)}a!==b.Z_OK&&this._error(a)},e.prototype._error=function(a){this.onerror(g[a]+": "+this.strm.msg,a),this.write_in_progress=!1,this.pending_close&&this.close()},b.Zlib=e}).call(b,c(9),c(5).Buffer)},function(a,b){"use strict";a.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(a,b){"use strict";function c(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}a.exports=c},function(a,b,c){"use strict";function d(a,b){return a.msg=I[b],b}function e(a){return(a<<1)-(a>4?9:0)}function f(a){for(var b=a.length;--b>=0;)a[b]=0}function g(a){var b=a.state,c=b.pending;c>a.avail_out&&(c=a.avail_out),0!==c&&(E.arraySet(a.output,b.pending_buf,b.pending_out,c,a.next_out),a.next_out+=c,b.pending_out+=c,a.total_out+=c,a.avail_out-=c,b.pending-=c,0===b.pending&&(b.pending_out=0))}function h(a,b){F._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,b),a.block_start=a.strstart,g(a.strm)}function i(a,b){a.pending_buf[a.pending++]=b}function j(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=255&b}function k(a,b,c,d){var e=a.avail_in;return e>d&&(e=d),0===e?0:(a.avail_in-=e,E.arraySet(b,a.input,a.next_in,e,c),
1===a.state.wrap?a.adler=G(a.adler,b,e,c):2===a.state.wrap&&(a.adler=H(a.adler,b,e,c)),a.next_in+=e,a.total_in+=e,e)}function l(a,b){var c,d,e=a.max_chain_length,f=a.strstart,g=a.prev_length,h=a.nice_match,i=a.strstart>a.w_size-ja?a.strstart-(a.w_size-ja):0,j=a.window,k=a.w_mask,l=a.prev,m=a.strstart+ia,n=j[f+g-1],o=j[f+g];a.prev_length>=a.good_match&&(e>>=2),h>a.lookahead&&(h=a.lookahead);do{if(c=b,j[c+g]===o&&j[c+g-1]===n&&j[c]===j[f]&&j[++c]===j[f+1]){f+=2,c++;do{}while(j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&j[++f]===j[++c]&&f<m);if(d=ia-(m-f),f=m-ia,d>g){if(a.match_start=b,g=d,d>=h)break;n=j[f+g-1],o=j[f+g]}}}while((b=l[b&k])>i&&0!=--e);return g<=a.lookahead?g:a.lookahead}function m(a){var b,c,d,e,f,g=a.w_size;do{if(e=a.window_size-a.lookahead-a.strstart,a.strstart>=g+(g-ja)){E.arraySet(a.window,a.window,g,g,0),a.match_start-=g,a.strstart-=g,a.block_start-=g,c=a.hash_size,b=c;do{d=a.head[--b],a.head[b]=d>=g?d-g:0}while(--c);c=g,b=c;do{d=a.prev[--b],a.prev[b]=d>=g?d-g:0}while(--c);e+=g}if(0===a.strm.avail_in)break;if(c=k(a.strm,a.window,a.strstart+a.lookahead,e),a.lookahead+=c,a.lookahead+a.insert>=ha)for(f=a.strstart-a.insert,a.ins_h=a.window[f],a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[f+ha-1])&a.hash_mask,a.prev[f&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=f,f++,a.insert--,!(a.lookahead+a.insert<ha)););}while(a.lookahead<ja&&0!==a.strm.avail_in)}function n(a,b){var c=65535;for(c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);;){if(a.lookahead<=1){if(m(a),0===a.lookahead&&b===J)return sa;if(0===a.lookahead)break}a.strstart+=a.lookahead,a.lookahead=0;var d=a.block_start+c;if((0===a.strstart||a.strstart>=d)&&(a.lookahead=a.strstart-d,a.strstart=d,h(a,!1),0===a.strm.avail_out))return sa;if(a.strstart-a.block_start>=a.w_size-ja&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):(a.strstart>a.block_start&&(h(a,!1),a.strm.avail_out),sa)}function o(a,b){for(var c,d;;){if(a.lookahead<ja){if(m(a),a.lookahead<ja&&b===J)return sa;if(0===a.lookahead)break}if(c=0,a.lookahead>=ha&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),0!==c&&a.strstart-c<=a.w_size-ja&&(a.match_length=l(a,c)),a.match_length>=ha)if(d=F._tr_tally(a,a.strstart-a.match_start,a.match_length-ha),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=ha){a.match_length--;do{a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart}while(0!=--a.match_length);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else d=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=a.strstart<ha-1?a.strstart:ha-1,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function p(a,b){for(var c,d,e;;){if(a.lookahead<ja){if(m(a),a.lookahead<ja&&b===J)return sa;if(0===a.lookahead)break}if(c=0,a.lookahead>=ha&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=ha-1,0!==c&&a.prev_length<a.max_lazy_match&&a.strstart-c<=a.w_size-ja&&(a.match_length=l(a,c),a.match_length<=5&&(a.strategy===U||a.match_length===ha&&a.strstart-a.match_start>4096)&&(a.match_length=ha-1)),a.prev_length>=ha&&a.match_length<=a.prev_length){e=a.strstart+a.lookahead-ha,d=F._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-ha),a.lookahead-=a.prev_length-1,a.prev_length-=2;do{++a.strstart<=e&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+ha-1])&a.hash_mask,c=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart)}while(0!=--a.prev_length);if(a.match_available=0,a.match_length=ha-1,a.strstart++,d&&(h(a,!1),0===a.strm.avail_out))return sa}else if(a.match_available){if(d=F._tr_tally(a,0,a.window[a.strstart-1]),d&&h(a,!1),a.strstart++,a.lookahead--,0===a.strm.avail_out)return sa}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(d=F._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<ha-1?a.strstart:ha-1,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function q(a,b){for(var c,d,e,f,g=a.window;;){if(a.lookahead<=ia){if(m(a),a.lookahead<=ia&&b===J)return sa;if(0===a.lookahead)break}if(a.match_length=0,a.lookahead>=ha&&a.strstart>0&&(e=a.strstart-1,(d=g[e])===g[++e]&&d===g[++e]&&d===g[++e])){f=a.strstart+ia;do{}while(d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&d===g[++e]&&e<f);a.match_length=ia-(f-e),a.match_length>a.lookahead&&(a.match_length=a.lookahead)}if(a.match_length>=ha?(c=F._tr_tally(a,1,a.match_length-ha),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++),c&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function r(a,b){for(var c;;){if(0===a.lookahead&&(m(a),0===a.lookahead)){if(b===J)return sa;break}if(a.match_length=0,c=F._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++,c&&(h(a,!1),0===a.strm.avail_out))return sa}return a.insert=0,b===M?(h(a,!0),0===a.strm.avail_out?ua:va):a.last_lit&&(h(a,!1),0===a.strm.avail_out)?sa:ta}function s(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}function t(a){a.window_size=2*a.w_size,f(a.head),a.max_lazy_match=D[a.level].max_lazy,a.good_match=D[a.level].good_length,a.nice_match=D[a.level].nice_length,a.max_chain_length=D[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=ha-1,a.match_available=0,a.ins_h=0}function u(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new E.Buf16(2*fa),this.dyn_dtree=new E.Buf16(2*(2*da+1)),this.bl_tree=new E.Buf16(2*(2*ea+1)),f(this.dyn_ltree),f(this.dyn_dtree),f(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new E.Buf16(ga+1),this.heap=new E.Buf16(2*ca+1),f(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new E.Buf16(2*ca+1),f(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function v(a){var b;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=Z,b=a.state,b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?la:qa,a.adler=2===b.wrap?0:1,b.last_flush=J,F._tr_init(b),O):d(a,Q)}function w(a){var b=v(a);return b===O&&t(a.state),b}function x(a,b){return a&&a.state?2!==a.state.wrap?Q:(a.state.gzhead=b,O):Q}function y(a,b,c,e,f,g){if(!a)return Q;var h=1;if(b===T&&(b=6),e<0?(h=0,e=-e):e>15&&(h=2,e-=16),f<1||f>_||c!==$||e<8||e>15||b<0||b>9||g<0||g>X)return d(a,Q);8===e&&(e=9);var i=new u;return a.state=i,i.strm=a,i.wrap=h,i.gzhead=null,i.w_bits=e,i.w_size=1<<i.w_bits,i.w_mask=i.w_size-1,i.hash_bits=f+7,i.hash_size=1<<i.hash_bits,i.hash_mask=i.hash_size-1,i.hash_shift=~~((i.hash_bits+ha-1)/ha),i.window=new E.Buf8(2*i.w_size),i.head=new E.Buf16(i.hash_size),i.prev=new E.Buf16(i.w_size),i.lit_bufsize=1<<f+6,i.pending_buf_size=4*i.lit_bufsize,i.pending_buf=new E.Buf8(i.pending_buf_size),i.d_buf=1*i.lit_bufsize,i.l_buf=3*i.lit_bufsize,i.level=b,i.strategy=g,i.method=c,w(a)}function z(a,b){return y(a,b,$,aa,ba,Y)}function A(a,b){var c,h,k,l;if(!a||!a.state||b>N||b<0)return a?d(a,Q):Q;if(h=a.state,!a.output||!a.input&&0!==a.avail_in||h.status===ra&&b!==M)return d(a,0===a.avail_out?S:Q);if(h.strm=a,c=h.last_flush,h.last_flush=b,h.status===la)if(2===h.wrap)a.adler=0,i(h,31),i(h,139),i(h,8),h.gzhead?(i(h,(h.gzhead.text?1:0)+(h.gzhead.hcrc?2:0)+(h.gzhead.extra?4:0)+(h.gzhead.name?8:0)+(h.gzhead.comment?16:0)),i(h,255&h.gzhead.time),i(h,h.gzhead.time>>8&255),i(h,h.gzhead.time>>16&255),i(h,h.gzhead.time>>24&255),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,255&h.gzhead.os),h.gzhead.extra&&h.gzhead.extra.length&&(i(h,255&h.gzhead.extra.length),i(h,h.gzhead.extra.length>>8&255)),h.gzhead.hcrc&&(a.adler=H(a.adler,h.pending_buf,h.pending,0)),h.gzindex=0,h.status=ma):(i(h,0),i(h,0),i(h,0),i(h,0),i(h,0),i(h,9===h.level?2:h.strategy>=V||h.level<2?4:0),i(h,wa),h.status=qa);else{var m=$+(h.w_bits-8<<4)<<8,n=-1;n=h.strategy>=V||h.level<2?0:h.level<6?1:6===h.level?2:3,m|=n<<6,0!==h.strstart&&(m|=ka),m+=31-m%31,h.status=qa,j(h,m),0!==h.strstart&&(j(h,a.adler>>>16),j(h,65535&a.adler)),a.adler=1}if(h.status===ma)if(h.gzhead.extra){for(k=h.pending;h.gzindex<(65535&h.gzhead.extra.length)&&(h.pending!==h.pending_buf_size||(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending!==h.pending_buf_size));)i(h,255&h.gzhead.extra[h.gzindex]),h.gzindex++;h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),h.gzindex===h.gzhead.extra.length&&(h.gzindex=0,h.status=na)}else h.status=na;if(h.status===na)if(h.gzhead.name){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.name.length?255&h.gzhead.name.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.gzindex=0,h.status=oa)}else h.status=oa;if(h.status===oa)if(h.gzhead.comment){k=h.pending;do{if(h.pending===h.pending_buf_size&&(h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),g(a),k=h.pending,h.pending===h.pending_buf_size)){l=1;break}l=h.gzindex<h.gzhead.comment.length?255&h.gzhead.comment.charCodeAt(h.gzindex++):0,i(h,l)}while(0!==l);h.gzhead.hcrc&&h.pending>k&&(a.adler=H(a.adler,h.pending_buf,h.pending-k,k)),0===l&&(h.status=pa)}else h.status=pa;if(h.status===pa&&(h.gzhead.hcrc?(h.pending+2>h.pending_buf_size&&g(a),h.pending+2<=h.pending_buf_size&&(i(h,255&a.adler),i(h,a.adler>>8&255),a.adler=0,h.status=qa)):h.status=qa),0!==h.pending){if(g(a),0===a.avail_out)return h.last_flush=-1,O}else if(0===a.avail_in&&e(b)<=e(c)&&b!==M)return d(a,S);if(h.status===ra&&0!==a.avail_in)return d(a,S);if(0!==a.avail_in||0!==h.lookahead||b!==J&&h.status!==ra){var o=h.strategy===V?r(h,b):h.strategy===W?q(h,b):D[h.level].func(h,b);if(o!==ua&&o!==va||(h.status=ra),o===sa||o===ua)return 0===a.avail_out&&(h.last_flush=-1),O;if(o===ta&&(b===K?F._tr_align(h):b!==N&&(F._tr_stored_block(h,0,0,!1),b===L&&(f(h.head),0===h.lookahead&&(h.strstart=0,h.block_start=0,h.insert=0))),g(a),0===a.avail_out))return h.last_flush=-1,O}return b!==M?O:h.wrap<=0?P:(2===h.wrap?(i(h,255&a.adler),i(h,a.adler>>8&255),i(h,a.adler>>16&255),i(h,a.adler>>24&255),i(h,255&a.total_in),i(h,a.total_in>>8&255),i(h,a.total_in>>16&255),i(h,a.total_in>>24&255)):(j(h,a.adler>>>16),j(h,65535&a.adler)),g(a),h.wrap>0&&(h.wrap=-h.wrap),0!==h.pending?O:P)}function B(a){var b;return a&&a.state?(b=a.state.status)!==la&&b!==ma&&b!==na&&b!==oa&&b!==pa&&b!==qa&&b!==ra?d(a,Q):(a.state=null,b===qa?d(a,R):O):Q}function C(a,b){var c,d,e,g,h,i,j,k,l=b.length;if(!a||!a.state)return Q;if(c=a.state,2===(g=c.wrap)||1===g&&c.status!==la||c.lookahead)return Q;for(1===g&&(a.adler=G(a.adler,b,l,0)),c.wrap=0,l>=c.w_size&&(0===g&&(f(c.head),c.strstart=0,c.block_start=0,c.insert=0),k=new E.Buf8(c.w_size),E.arraySet(k,b,l-c.w_size,c.w_size,0),b=k,l=c.w_size),h=a.avail_in,i=a.next_in,j=a.input,a.avail_in=l,a.next_in=0,a.input=b,m(c);c.lookahead>=ha;){d=c.strstart,e=c.lookahead-(ha-1);do{c.ins_h=(c.ins_h<<c.hash_shift^c.window[d+ha-1])&c.hash_mask,c.prev[d&c.w_mask]=c.head[c.ins_h],c.head[c.ins_h]=d,d++}while(--e);c.strstart=d,c.lookahead=ha-1,m(c)}return c.strstart+=c.lookahead,c.block_start=c.strstart,c.insert=c.lookahead,c.lookahead=0,c.match_length=c.prev_length=ha-1,c.match_available=0,a.next_in=i,a.input=j,a.avail_in=h,c.wrap=g,O}var D,E=c(34),F=c(35),G=c(36),H=c(37),I=c(31),J=0,K=1,L=3,M=4,N=5,O=0,P=1,Q=-2,R=-3,S=-5,T=-1,U=1,V=2,W=3,X=4,Y=0,Z=2,$=8,_=9,aa=15,ba=8,ca=286,da=30,ea=19,fa=2*ca+1,ga=15,ha=3,ia=258,ja=ia+ha+1,ka=32,la=42,ma=69,na=73,oa=91,pa=103,qa=113,ra=666,sa=1,ta=2,ua=3,va=4,wa=3;D=[new s(0,0,0,0,n),new s(4,4,8,4,o),new s(4,5,16,8,o),new s(4,6,32,32,o),new s(4,4,16,16,p),new s(8,16,32,32,p),new s(8,16,128,128,p),new s(8,32,128,256,p),new s(32,128,258,1024,p),new s(32,258,258,4096,p)],b.deflateInit=z,b.deflateInit2=y,b.deflateReset=w,b.deflateResetKeep=v,b.deflateSetHeader=x,b.deflate=A,b.deflateEnd=B,b.deflateSetDictionary=C,b.deflateInfo="pako deflate (from Nodeca project)"},function(a,b){"use strict";var c="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;b.assign=function(a){for(var b=Array.prototype.slice.call(arguments,1);b.length;){var c=b.shift();if(c){if("object"!=typeof c)throw new TypeError(c+"must be non-object");for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}}return a},b.shrinkBuf=function(a,b){return a.length===b?a:a.subarray?a.subarray(0,b):(a.length=b,a)};var d={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray)return void a.set(b.subarray(c,c+d),e);for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f,g;for(d=0,b=0,c=a.length;b<c;b++)d+=a[b].length;for(g=new Uint8Array(d),e=0,b=0,c=a.length;b<c;b++)f=a[b],g.set(f,e),e+=f.length;return g}},e={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};b.setTyped=function(a){a?(b.Buf8=Uint8Array,b.Buf16=Uint16Array,b.Buf32=Int32Array,b.assign(b,d)):(b.Buf8=Array,b.Buf16=Array,b.Buf32=Array,b.assign(b,e))},b.setTyped(c)},function(a,b,c){"use strict";function d(a){for(var b=a.length;--b>=0;)a[b]=0}function e(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}function f(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function g(a){return a<256?fa[a]:fa[256+(a>>>7)]}function h(a,b){a.pending_buf[a.pending++]=255&b,a.pending_buf[a.pending++]=b>>>8&255}function i(a,b,c){a.bi_valid>V-c?(a.bi_buf|=b<<a.bi_valid&65535,h(a,a.bi_buf),a.bi_buf=b>>V-a.bi_valid,a.bi_valid+=c-V):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function j(a,b,c){i(a,c[2*b],c[2*b+1])}function k(a,b){var c=0;do{c|=1&a,a>>>=1,c<<=1}while(--b>0);return c>>>1}function l(a){16===a.bi_valid?(h(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=255&a.bi_buf,a.bi_buf>>=8,a.bi_valid-=8)}function m(a,b){var c,d,e,f,g,h,i=b.dyn_tree,j=b.max_code,k=b.stat_desc.static_tree,l=b.stat_desc.has_stree,m=b.stat_desc.extra_bits,n=b.stat_desc.extra_base,o=b.stat_desc.max_length,p=0;for(f=0;f<=U;f++)a.bl_count[f]=0;for(i[2*a.heap[a.heap_max]+1]=0,c=a.heap_max+1;c<T;c++)d=a.heap[c],f=i[2*i[2*d+1]+1]+1,f>o&&(f=o,p++),i[2*d+1]=f,d>j||(a.bl_count[f]++,g=0,d>=n&&(g=m[d-n]),h=i[2*d],a.opt_len+=h*(f+g),l&&(a.static_len+=h*(k[2*d+1]+g)));if(0!==p){do{for(f=o-1;0===a.bl_count[f];)f--;a.bl_count[f]--,a.bl_count[f+1]+=2,a.bl_count[o]--,p-=2}while(p>0);for(f=o;0!==f;f--)for(d=a.bl_count[f];0!==d;)(e=a.heap[--c])>j||(i[2*e+1]!==f&&(a.opt_len+=(f-i[2*e+1])*i[2*e],i[2*e+1]=f),d--)}}function n(a,b,c){var d,e,f=new Array(U+1),g=0;for(d=1;d<=U;d++)f[d]=g=g+c[d-1]<<1;for(e=0;e<=b;e++){var h=a[2*e+1];0!==h&&(a[2*e]=k(f[h]++,h))}}function o(){var a,b,c,d,f,g=new Array(U+1);for(c=0,d=0;d<O-1;d++)for(ha[d]=c,a=0;a<1<<_[d];a++)ga[c++]=d;for(ga[c-1]=d,f=0,d=0;d<16;d++)for(ia[d]=f,a=0;a<1<<aa[d];a++)fa[f++]=d;for(f>>=7;d<R;d++)for(ia[d]=f<<7,a=0;a<1<<aa[d]-7;a++)fa[256+f++]=d;for(b=0;b<=U;b++)g[b]=0;for(a=0;a<=143;)da[2*a+1]=8,a++,g[8]++;for(;a<=255;)da[2*a+1]=9,a++,g[9]++;for(;a<=279;)da[2*a+1]=7,a++,g[7]++;for(;a<=287;)da[2*a+1]=8,a++,g[8]++;for(n(da,Q+1,g),a=0;a<R;a++)ea[2*a+1]=5,ea[2*a]=k(a,5);ja=new e(da,_,P+1,Q,U),ka=new e(ea,aa,0,R,U),la=new e(new Array(0),ba,0,S,W)}function p(a){var b;for(b=0;b<Q;b++)a.dyn_ltree[2*b]=0;for(b=0;b<R;b++)a.dyn_dtree[2*b]=0;for(b=0;b<S;b++)a.bl_tree[2*b]=0;a.dyn_ltree[2*X]=1,a.opt_len=a.static_len=0,a.last_lit=a.matches=0}function q(a){a.bi_valid>8?h(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function r(a,b,c,d){q(a),d&&(h(a,c),h(a,~c)),G.arraySet(a.pending_buf,a.window,b,c,a.pending),a.pending+=c}function s(a,b,c,d){var e=2*b,f=2*c;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function t(a,b,c){for(var d=a.heap[c],e=c<<1;e<=a.heap_len&&(e<a.heap_len&&s(b,a.heap[e+1],a.heap[e],a.depth)&&e++,!s(b,d,a.heap[e],a.depth));)a.heap[c]=a.heap[e],c=e,e<<=1;a.heap[c]=d}function u(a,b,c){var d,e,f,h,k=0;if(0!==a.last_lit)do{d=a.pending_buf[a.d_buf+2*k]<<8|a.pending_buf[a.d_buf+2*k+1],e=a.pending_buf[a.l_buf+k],k++,0===d?j(a,e,b):(f=ga[e],j(a,f+P+1,b),h=_[f],0!==h&&(e-=ha[f],i(a,e,h)),d--,f=g(d),j(a,f,c),0!==(h=aa[f])&&(d-=ia[f],i(a,d,h)))}while(k<a.last_lit);j(a,X,b)}function v(a,b){var c,d,e,f=b.dyn_tree,g=b.stat_desc.static_tree,h=b.stat_desc.has_stree,i=b.stat_desc.elems,j=-1;for(a.heap_len=0,a.heap_max=T,c=0;c<i;c++)0!==f[2*c]?(a.heap[++a.heap_len]=j=c,a.depth[c]=0):f[2*c+1]=0;for(;a.heap_len<2;)e=a.heap[++a.heap_len]=j<2?++j:0,f[2*e]=1,a.depth[e]=0,a.opt_len--,h&&(a.static_len-=g[2*e+1]);for(b.max_code=j,c=a.heap_len>>1;c>=1;c--)t(a,f,c);e=i;do{c=a.heap[1],a.heap[1]=a.heap[a.heap_len--],t(a,f,1),d=a.heap[1],a.heap[--a.heap_max]=c,a.heap[--a.heap_max]=d,f[2*e]=f[2*c]+f[2*d],a.depth[e]=(a.depth[c]>=a.depth[d]?a.depth[c]:a.depth[d])+1,f[2*c+1]=f[2*d+1]=e,a.heap[1]=e++,t(a,f,1)}while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1],m(a,b),n(f,j,a.bl_count)}function w(a,b,c){var d,e,f=-1,g=b[1],h=0,i=7,j=4;for(0===g&&(i=138,j=3),b[2*(c+1)+1]=65535,d=0;d<=c;d++)e=g,g=b[2*(d+1)+1],++h<i&&e===g||(h<j?a.bl_tree[2*e]+=h:0!==e?(e!==f&&a.bl_tree[2*e]++,a.bl_tree[2*Y]++):h<=10?a.bl_tree[2*Z]++:a.bl_tree[2*$]++,h=0,f=e,0===g?(i=138,j=3):e===g?(i=6,j=3):(i=7,j=4))}function x(a,b,c){var d,e,f=-1,g=b[1],h=0,k=7,l=4;for(0===g&&(k=138,l=3),d=0;d<=c;d++)if(e=g,g=b[2*(d+1)+1],!(++h<k&&e===g)){if(h<l)do{j(a,e,a.bl_tree)}while(0!=--h);else 0!==e?(e!==f&&(j(a,e,a.bl_tree),h--),j(a,Y,a.bl_tree),i(a,h-3,2)):h<=10?(j(a,Z,a.bl_tree),i(a,h-3,3)):(j(a,$,a.bl_tree),i(a,h-11,7));h=0,f=e,0===g?(k=138,l=3):e===g?(k=6,l=3):(k=7,l=4)}}function y(a){var b;for(w(a,a.dyn_ltree,a.l_desc.max_code),w(a,a.dyn_dtree,a.d_desc.max_code),v(a,a.bl_desc),b=S-1;b>=3&&0===a.bl_tree[2*ca[b]+1];b--);return a.opt_len+=3*(b+1)+5+5+4,b}function z(a,b,c,d){var e;for(i(a,b-257,5),i(a,c-1,5),i(a,d-4,4),e=0;e<d;e++)i(a,a.bl_tree[2*ca[e]+1],3);x(a,a.dyn_ltree,b-1),x(a,a.dyn_dtree,c-1)}function A(a){var b,c=4093624447;for(b=0;b<=31;b++,c>>>=1)if(1&c&&0!==a.dyn_ltree[2*b])return I;if(0!==a.dyn_ltree[18]||0!==a.dyn_ltree[20]||0!==a.dyn_ltree[26])return J;for(b=32;b<P;b++)if(0!==a.dyn_ltree[2*b])return J;return I}function B(a){ma||(o(),ma=!0),a.l_desc=new f(a.dyn_ltree,ja),a.d_desc=new f(a.dyn_dtree,ka),a.bl_desc=new f(a.bl_tree,la),a.bi_buf=0,a.bi_valid=0,p(a)}function C(a,b,c,d){i(a,(L<<1)+(d?1:0),3),r(a,b,c,!0)}function D(a){i(a,M<<1,3),j(a,X,da),l(a)}function E(a,b,c,d){var e,f,g=0;a.level>0?(a.strm.data_type===K&&(a.strm.data_type=A(a)),v(a,a.l_desc),v(a,a.d_desc),g=y(a),e=a.opt_len+3+7>>>3,(f=a.static_len+3+7>>>3)<=e&&(e=f)):e=f=c+5,c+4<=e&&-1!==b?C(a,b,c,d):a.strategy===H||f===e?(i(a,(M<<1)+(d?1:0),3),u(a,da,ea)):(i(a,(N<<1)+(d?1:0),3),z(a,a.l_desc.max_code+1,a.d_desc.max_code+1,g+1),u(a,a.dyn_ltree,a.dyn_dtree)),p(a),d&&q(a)}function F(a,b,c){return a.pending_buf[a.d_buf+2*a.last_lit]=b>>>8&255,a.pending_buf[a.d_buf+2*a.last_lit+1]=255&b,a.pending_buf[a.l_buf+a.last_lit]=255&c,a.last_lit++,0===b?a.dyn_ltree[2*c]++:(a.matches++,b--,a.dyn_ltree[2*(ga[c]+P+1)]++,a.dyn_dtree[2*g(b)]++),a.last_lit===a.lit_bufsize-1}var G=c(34),H=4,I=0,J=1,K=2,L=0,M=1,N=2,O=29,P=256,Q=P+1+O,R=30,S=19,T=2*Q+1,U=15,V=16,W=7,X=256,Y=16,Z=17,$=18,_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],aa=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ba=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],da=new Array(2*(Q+2));d(da);var ea=new Array(2*R);d(ea);var fa=new Array(512);d(fa);var ga=new Array(256);d(ga);var ha=new Array(O);d(ha);var ia=new Array(R);d(ia);var ja,ka,la,ma=!1;b._tr_init=B,b._tr_stored_block=C,b._tr_flush_block=E,b._tr_tally=F,b._tr_align=D},function(a,b){"use strict";function c(a,b,c,d){for(var e=65535&a|0,f=a>>>16&65535|0,g=0;0!==c;){g=c>2e3?2e3:c,c-=g;do{e=e+b[d++]|0,f=f+e|0}while(--g);e%=65521,f%=65521}return e|f<<16|0}a.exports=c},function(a,b){"use strict";function c(a,b,c,e){var f=d,g=e+c;a^=-1;for(var h=e;h<g;h++)a=a>>>8^f[255&(a^b[h])];return-1^a}var d=function(){for(var a,b=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b}();a.exports=c},function(a,b,c){"use strict";function d(a){return(a>>>24&255)+(a>>>8&65280)+((65280&a)<<8)+((255&a)<<24)}function e(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(a){var b;return a&&a.state?(b=a.state,a.total_in=a.total_out=b.total=0,a.msg="",b.wrap&&(a.adler=1&b.wrap),b.mode=L,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new s.Buf32(pa),b.distcode=b.distdyn=new s.Buf32(qa),b.sane=1,b.back=-1,D):G}function g(a){var b;return a&&a.state?(b=a.state,b.wsize=0,b.whave=0,b.wnext=0,f(a)):G}function h(a,b){var c,d;return a&&a.state?(d=a.state,b<0?(c=0,b=-b):(c=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?G:(null!==d.window&&d.wbits!==b&&(d.window=null),d.wrap=c,d.wbits=b,g(a))):G}function i(a,b){var c,d;return a?(d=new e,a.state=d,d.window=null,c=h(a,b),c!==D&&(a.state=null),c):G}function j(a){return i(a,ra)}function k(a){if(sa){var b;for(q=new s.Buf32(512),r=new s.Buf32(32),b=0;b<144;)a.lens[b++]=8;for(;b<256;)a.lens[b++]=9;for(;b<280;)a.lens[b++]=7;for(;b<288;)a.lens[b++]=8;for(w(y,a.lens,0,288,q,0,a.work,{bits:9}),b=0;b<32;)a.lens[b++]=5;w(z,a.lens,0,32,r,0,a.work,{bits:5}),sa=!1}a.lencode=q,a.lenbits=9,a.distcode=r,a.distbits=5}function l(a,b,c,d){var e,f=a.state;return null===f.window&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new s.Buf8(f.wsize)),d>=f.wsize?(s.arraySet(f.window,b,c-f.wsize,f.wsize,0),f.wnext=0,f.whave=f.wsize):(e=f.wsize-f.wnext,e>d&&(e=d),s.arraySet(f.window,b,c-d,e,f.wnext),d-=e,d?(s.arraySet(f.window,b,c-d,d,0),f.wnext=d,f.whave=f.wsize):(f.wnext+=e,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=e))),0}function m(a,b){var c,e,f,g,h,i,j,m,n,o,p,q,r,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa=0,Ba=new s.Buf8(4),Ca=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!a||!a.state||!a.output||!a.input&&0!==a.avail_in)return G;c=a.state,c.mode===W&&(c.mode=X),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,o=i,p=j,xa=D;a:for(;;)switch(c.mode){case L:if(0===c.wrap){c.mode=X;break}for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(2&c.wrap&&35615===m){c.check=0,Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0),m=0,n=0,c.mode=M;break}if(c.flags=0,c.head&&(c.head.done=!1),!(1&c.wrap)||(((255&m)<<8)+(m>>8))%31){a.msg="incorrect header check",c.mode=ma;break}if((15&m)!==K){a.msg="unknown compression method",c.mode=ma;break}if(m>>>=4,n-=4,wa=8+(15&m),0===c.wbits)c.wbits=wa;else if(wa>c.wbits){a.msg="invalid window size",c.mode=ma;break}c.dmax=1<<wa,a.adler=c.check=1,c.mode=512&m?U:W,m=0,n=0;break;case M:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.flags=m,(255&c.flags)!==K){a.msg="unknown compression method",c.mode=ma;break}if(57344&c.flags){a.msg="unknown header flags set",c.mode=ma;break}c.head&&(c.head.text=m>>8&1),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=N;case N:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.time=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,Ba[2]=m>>>16&255,Ba[3]=m>>>24&255,c.check=u(c.check,Ba,4,0)),m=0,n=0,c.mode=O;case O:for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.head&&(c.head.xflags=255&m,c.head.os=m>>8),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0,c.mode=P;case P:if(1024&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length=m,c.head&&(c.head.extra_len=m),512&c.flags&&(Ba[0]=255&m,Ba[1]=m>>>8&255,c.check=u(c.check,Ba,2,0)),m=0,n=0}else c.head&&(c.head.extra=null);c.mode=Q;case Q:if(1024&c.flags&&(q=c.length,q>i&&(q=i),q&&(c.head&&(wa=c.head.extra_len-c.length,c.head.extra||(c.head.extra=new Array(c.head.extra_len)),s.arraySet(c.head.extra,e,g,q,wa)),512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,c.length-=q),c.length))break a;c.length=0,c.mode=R;case R:if(2048&c.flags){if(0===i)break a;q=0;do{wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.name+=String.fromCharCode(wa))}while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.name=null);c.length=0,c.mode=S;case S:if(4096&c.flags){if(0===i)break a;q=0;do{wa=e[g+q++],c.head&&wa&&c.length<65536&&(c.head.comment+=String.fromCharCode(wa))}while(wa&&q<i);if(512&c.flags&&(c.check=u(c.check,e,q,g)),i-=q,g+=q,wa)break a}else c.head&&(c.head.comment=null);c.mode=T;case T:if(512&c.flags){for(;n<16;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(65535&c.check)){a.msg="header crc mismatch",c.mode=ma;break}m=0,n=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0),a.adler=c.check=0,c.mode=W;break;case U:for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}a.adler=c.check=d(m),m=0,n=0,c.mode=V;case V:if(0===c.havedict)return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,F;a.adler=c.check=1,c.mode=W;case W:if(b===B||b===C)break a;case X:if(c.last){m>>>=7&n,n-=7&n,c.mode=ja;break}for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}switch(c.last=1&m,m>>>=1,n-=1,3&m){case 0:c.mode=Y;break;case 1:if(k(c),c.mode=ca,b===C){m>>>=2,n-=2;break a}break;case 2:c.mode=_;break;case 3:a.msg="invalid block type",c.mode=ma}m>>>=2,n-=2;break;case Y:for(m>>>=7&n,n-=7&n;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if((65535&m)!=(m>>>16^65535)){a.msg="invalid stored block lengths",c.mode=ma;break}if(c.length=65535&m,m=0,n=0,c.mode=Z,b===C)break a;case Z:c.mode=$;case $:if(q=c.length){if(q>i&&(q=i),q>j&&(q=j),0===q)break a;s.arraySet(f,e,g,q,h),i-=q,g+=q,j-=q,h+=q,c.length-=q;break}c.mode=W;break;case _:for(;n<14;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(c.nlen=257+(31&m),m>>>=5,n-=5,c.ndist=1+(31&m),m>>>=5,n-=5,c.ncode=4+(15&m),m>>>=4,n-=4,c.nlen>286||c.ndist>30){a.msg="too many length or distance symbols",c.mode=ma;break}c.have=0,c.mode=aa;case aa:for(;c.have<c.ncode;){for(;n<3;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.lens[Ca[c.have++]]=7&m,m>>>=3,n-=3}for(;c.have<19;)c.lens[Ca[c.have++]]=0;if(c.lencode=c.lendyn,c.lenbits=7,ya={bits:c.lenbits},xa=w(x,c.lens,0,19,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid code lengths set",c.mode=ma;break}c.have=0,c.mode=ba;case ba:for(;c.have<c.nlen+c.ndist;){for(;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(sa<16)m>>>=qa,n-=qa,c.lens[c.have++]=sa;else{if(16===sa){for(za=qa+2;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m>>>=qa,n-=qa,0===c.have){a.msg="invalid bit length repeat",c.mode=ma;break}wa=c.lens[c.have-1],q=3+(3&m),m>>>=2,n-=2}else if(17===sa){for(za=qa+3;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=3+(7&m),m>>>=3,n-=3}else{for(za=qa+7;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=qa,n-=qa,wa=0,q=11+(127&m),m>>>=7,n-=7}if(c.have+q>c.nlen+c.ndist){a.msg="invalid bit length repeat",c.mode=ma;break}for(;q--;)c.lens[c.have++]=wa}}if(c.mode===ma)break;if(0===c.lens[256]){a.msg="invalid code -- missing end-of-block",c.mode=ma;break}if(c.lenbits=9,ya={bits:c.lenbits},xa=w(y,c.lens,0,c.nlen,c.lencode,0,c.work,ya),c.lenbits=ya.bits,xa){a.msg="invalid literal/lengths set",c.mode=ma;break}if(c.distbits=6,c.distcode=c.distdyn,ya={bits:c.distbits},xa=w(z,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,ya),c.distbits=ya.bits,xa){a.msg="invalid distances set",c.mode=ma;break}if(c.mode=ca,b===C)break a;case ca:c.mode=da;case da:if(i>=6&&j>=258){a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,v(a,p),h=a.next_out,f=a.output,j=a.avail_out,g=a.next_in,e=a.input,i=a.avail_in,m=c.hold,n=c.bits,c.mode===W&&(c.back=-1);break}for(c.back=0;Aa=c.lencode[m&(1<<c.lenbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(ra&&0==(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.lencode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,c.length=sa,0===ra){c.mode=ia;break}if(32&ra){c.back=-1,c.mode=W;break}if(64&ra){a.msg="invalid literal/length code",c.mode=ma;break}c.extra=15&ra,c.mode=ea;case ea:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.length+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}c.was=c.length,c.mode=fa;case fa:for(;Aa=c.distcode[m&(1<<c.distbits)-1],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(0==(240&ra)){for(ta=qa,ua=ra,va=sa;Aa=c.distcode[va+((m&(1<<ta+ua)-1)>>ta)],qa=Aa>>>24,ra=Aa>>>16&255,sa=65535&Aa,!(ta+qa<=n);){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}m>>>=ta,n-=ta,c.back+=ta}if(m>>>=qa,n-=qa,c.back+=qa,64&ra){a.msg="invalid distance code",c.mode=ma;break}c.offset=sa,c.extra=15&ra,c.mode=ga;case ga:if(c.extra){for(za=c.extra;n<za;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}c.offset+=m&(1<<c.extra)-1,m>>>=c.extra,n-=c.extra,c.back+=c.extra}if(c.offset>c.dmax){a.msg="invalid distance too far back",c.mode=ma;break}c.mode=ha;case ha:if(0===j)break a;if(q=p-j,c.offset>q){if((q=c.offset-q)>c.whave&&c.sane){a.msg="invalid distance too far back",c.mode=ma;break}q>c.wnext?(q-=c.wnext,r=c.wsize-q):r=c.wnext-q,q>c.length&&(q=c.length),pa=c.window}else pa=f,r=h-c.offset,q=c.length;q>j&&(q=j),j-=q,c.length-=q;do{f[h++]=pa[r++]}while(--q);0===c.length&&(c.mode=da);break;case ia:if(0===j)break a;f[h++]=c.length,j--,c.mode=da;break;case ja:if(c.wrap){for(;n<32;){if(0===i)break a;i--,m|=e[g++]<<n,n+=8}if(p-=j,a.total_out+=p,c.total+=p,p&&(a.adler=c.check=c.flags?u(c.check,f,p,h-p):t(c.check,f,p,h-p)),p=j,(c.flags?m:d(m))!==c.check){a.msg="incorrect data check",c.mode=ma;break}m=0,n=0}c.mode=ka;case ka:if(c.wrap&&c.flags){for(;n<32;){if(0===i)break a;i--,m+=e[g++]<<n,n+=8}if(m!==(4294967295&c.total)){a.msg="incorrect length check",c.mode=ma;break}m=0,n=0}c.mode=la;case la:xa=E;break a;case ma:xa=H;break a;case na:return I;case oa:default:return G}
return a.next_out=h,a.avail_out=j,a.next_in=g,a.avail_in=i,c.hold=m,c.bits=n,(c.wsize||p!==a.avail_out&&c.mode<ma&&(c.mode<ja||b!==A))&&l(a,a.output,a.next_out,p-a.avail_out)?(c.mode=na,I):(o-=a.avail_in,p-=a.avail_out,a.total_in+=o,a.total_out+=p,c.total+=p,c.wrap&&p&&(a.adler=c.check=c.flags?u(c.check,f,p,a.next_out-p):t(c.check,f,p,a.next_out-p)),a.data_type=c.bits+(c.last?64:0)+(c.mode===W?128:0)+(c.mode===ca||c.mode===Z?256:0),(0===o&&0===p||b===A)&&xa===D&&(xa=J),xa)}function n(a){if(!a||!a.state)return G;var b=a.state;return b.window&&(b.window=null),a.state=null,D}function o(a,b){var c;return a&&a.state?(c=a.state,0==(2&c.wrap)?G:(c.head=b,b.done=!1,D)):G}function p(a,b){var c,d,e=b.length;return a&&a.state?(c=a.state,0!==c.wrap&&c.mode!==V?G:c.mode===V&&(d=1,(d=t(d,b,e,0))!==c.check)?H:l(a,b,e,e)?(c.mode=na,I):(c.havedict=1,D)):G}var q,r,s=c(34),t=c(36),u=c(37),v=c(39),w=c(40),x=0,y=1,z=2,A=4,B=5,C=6,D=0,E=1,F=2,G=-2,H=-3,I=-4,J=-5,K=8,L=1,M=2,N=3,O=4,P=5,Q=6,R=7,S=8,T=9,U=10,V=11,W=12,X=13,Y=14,Z=15,$=16,_=17,aa=18,ba=19,ca=20,da=21,ea=22,fa=23,ga=24,ha=25,ia=26,ja=27,ka=28,la=29,ma=30,na=31,oa=32,pa=852,qa=592,ra=15,sa=!0;b.inflateReset=g,b.inflateReset2=h,b.inflateResetKeep=f,b.inflateInit=j,b.inflateInit2=i,b.inflate=m,b.inflateEnd=n,b.inflateGetHeader=o,b.inflateSetDictionary=p,b.inflateInfo="pako inflate (from Nodeca project)"},function(a,b){"use strict";a.exports=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A;c=a.state,d=a.next_in,z=a.input,e=d+(a.avail_in-5),f=a.next_out,A=a.output,g=f-(b-a.avail_out),h=f+(a.avail_out-257),i=c.dmax,j=c.wsize,k=c.whave,l=c.wnext,m=c.window,n=c.hold,o=c.bits,p=c.lencode,q=c.distcode,r=(1<<c.lenbits)-1,s=(1<<c.distbits)-1;a:do{o<15&&(n+=z[d++]<<o,o+=8,n+=z[d++]<<o,o+=8),t=p[n&r];b:for(;;){if(u=t>>>24,n>>>=u,o-=u,0===(u=t>>>16&255))A[f++]=65535&t;else{if(!(16&u)){if(0==(64&u)){t=p[(65535&t)+(n&(1<<u)-1)];continue b}if(32&u){c.mode=12;break a}a.msg="invalid literal/length code",c.mode=30;break a}v=65535&t,u&=15,u&&(o<u&&(n+=z[d++]<<o,o+=8),v+=n&(1<<u)-1,n>>>=u,o-=u),o<15&&(n+=z[d++]<<o,o+=8,n+=z[d++]<<o,o+=8),t=q[n&s];c:for(;;){if(u=t>>>24,n>>>=u,o-=u,!(16&(u=t>>>16&255))){if(0==(64&u)){t=q[(65535&t)+(n&(1<<u)-1)];continue c}a.msg="invalid distance code",c.mode=30;break a}if(w=65535&t,u&=15,o<u&&(n+=z[d++]<<o,(o+=8)<u&&(n+=z[d++]<<o,o+=8)),(w+=n&(1<<u)-1)>i){a.msg="invalid distance too far back",c.mode=30;break a}if(n>>>=u,o-=u,u=f-g,w>u){if((u=w-u)>k&&c.sane){a.msg="invalid distance too far back",c.mode=30;break a}if(x=0,y=m,0===l){if(x+=j-u,u<v){v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}}else if(l<u){if(x+=j+l-u,(u-=l)<v){v-=u;do{A[f++]=m[x++]}while(--u);if(x=0,l<v){u=l,v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}}}else if(x+=l-u,u<v){v-=u;do{A[f++]=m[x++]}while(--u);x=f-w,y=A}for(;v>2;)A[f++]=y[x++],A[f++]=y[x++],A[f++]=y[x++],v-=3;v&&(A[f++]=y[x++],v>1&&(A[f++]=y[x++]))}else{x=f-w;do{A[f++]=A[x++],A[f++]=A[x++],A[f++]=A[x++],v-=3}while(v>2);v&&(A[f++]=A[x++],v>1&&(A[f++]=A[x++]))}break}}break}}while(d<e&&f<h);v=o>>3,d-=v,o-=v<<3,n&=(1<<o)-1,a.next_in=d,a.next_out=f,a.avail_in=d<e?e-d+5:5-(d-e),a.avail_out=f<h?h-f+257:257-(f-h),c.hold=n,c.bits=o}},function(a,b,c){"use strict";var d=c(34),e=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];a.exports=function(a,b,c,i,j,k,l,m){var n,o,p,q,r,s,t,u,v,w=m.bits,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=0,F=0,G=0,H=null,I=0,J=new d.Buf16(16),K=new d.Buf16(16),L=null,M=0;for(x=0;x<=15;x++)J[x]=0;for(y=0;y<i;y++)J[b[c+y]]++;for(B=w,A=15;A>=1&&0===J[A];A--);if(B>A&&(B=A),0===A)return j[k++]=20971520,j[k++]=20971520,m.bits=1,0;for(z=1;z<A&&0===J[z];z++);for(B<z&&(B=z),E=1,x=1;x<=15;x++)if(E<<=1,(E-=J[x])<0)return-1;if(E>0&&(0===a||1!==A))return-1;for(K[1]=0,x=1;x<15;x++)K[x+1]=K[x]+J[x];for(y=0;y<i;y++)0!==b[c+y]&&(l[K[b[c+y]]++]=y);if(0===a?(H=L=l,s=19):1===a?(H=e,I-=257,L=f,M-=257,s=256):(H=g,L=h,s=-1),G=0,y=0,x=z,r=k,C=B,D=0,p=-1,F=1<<B,q=F-1,1===a&&F>852||2===a&&F>592)return 1;for(var N=0;;){N++,t=x-D,l[y]<s?(u=0,v=l[y]):l[y]>s?(u=L[M+l[y]],v=H[I+l[y]]):(u=96,v=0),n=1<<x-D,o=1<<C,z=o;do{o-=n,j[r+(G>>D)+o]=t<<24|u<<16|v|0}while(0!==o);for(n=1<<x-1;G&n;)n>>=1;if(0!==n?(G&=n-1,G+=n):G=0,y++,0==--J[x]){if(x===A)break;x=b[c+l[y]]}if(x>B&&(G&q)!==p){for(0===D&&(D=B),r+=z,C=x-D,E=1<<C;C+D<A&&!((E-=J[C+D])<=0);)C++,E<<=1;if(F+=1<<C,1===a&&F>852||2===a&&F>592)return 1;p=G&q,j[p]=B<<24|C<<16|r-k|0}}return 0!==G&&(j[r+G]=x-D<<24|64<<16|0),m.bits=B,0}},function(a,b){"use strict";a.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(a,b,c){(function(a,d){function e(a,c){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(c)?d.showHidden=c:c&&b._extend(d,c),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,c,d){if(a.customInspect&&c&&A(c.inspect)&&c.inspect!==b.inspect&&(!c.constructor||c.constructor.prototype!==c)){var e=c.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,c);if(f)return f;var g=Object.keys(c),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(c)),z(c)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(c);if(0===g.length){if(A(c)){var q=c.name?": "+c.name:"";return a.stylize("[Function"+q+"]","special")}if(w(c))return a.stylize(RegExp.prototype.toString.call(c),"regexp");if(y(c))return a.stylize(Date.prototype.toString.call(c),"date");if(z(c))return k(c)}var r="",s=!1,u=["{","}"];if(o(c)&&(s=!0,u=["[","]"]),A(c)){r=" [Function"+(c.name?": "+c.name:"")+"]"}if(w(c)&&(r=" "+RegExp.prototype.toString.call(c)),y(c)&&(r=" "+Date.prototype.toUTCString.call(c)),z(c)&&(r=" "+k(c)),0===g.length&&(!s||0==c.length))return u[0]+r+u[1];if(d<0)return w(c)?a.stylize(RegExp.prototype.toString.call(c),"regexp"):a.stylize("[Object]","special");a.seen.push(c);var v;return v=s?l(a,c,d,p,g):g.map(function(b){return m(a,c,d,p,b,s)}),a.seen.pop(),n(v,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;g<h;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0;return a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||void 0===a}function C(a){return Object.prototype.toString.call(a)}function D(a){return a<10?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;b.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(a){return"[Circular]"}default:return a}}),h=d[c];c<f;h=d[++c])q(h)||!x(h)?g+=" "+h:g+=" "+e(h);return g},b.deprecate=function(c,e){function f(){if(!g){if(d.throwDeprecation)throw new Error(e);d.traceDeprecation?console.trace(e):console.error(e),g=!0}return c.apply(this,arguments)}if(v(a.process))return function(){return b.deprecate(c,e).apply(this,arguments)};if(!0===d.noDeprecation)return c;var g=!1;return f};var H,I={};b.debuglog=function(a){if(v(H)&&(H=d.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var c=d.pid;I[a]=function(){var d=b.format.apply(b,arguments);console.error("%s %d: %s",a,c,d)}}else I[a]=function(){};return I[a]},b.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},b.isArray=o,b.isBoolean=p,b.isNull=q,b.isNullOrUndefined=r,b.isNumber=s,b.isString=t,b.isSymbol=u,b.isUndefined=v,b.isRegExp=w,b.isObject=x,b.isDate=y,b.isError=z,b.isFunction=A,b.isPrimitive=B,b.isBuffer=c(43);var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];b.log=function(){console.log("%s - %s",E(),b.format.apply(b,arguments))},b.inherits=c(44),b._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(b,function(){return this}(),c(9))},function(a,b){a.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},function(a,b){"function"==typeof Object.create?a.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:a.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},function(a,b,c){(function(b){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function d(a,b){if(a===b)return 0;for(var c=a.length,d=b.length,e=0,f=Math.min(c,d);e<f;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:d<c?1:0}function e(a){return b.Buffer&&"function"==typeof b.Buffer.isBuffer?b.Buffer.isBuffer(a):!(null==a||!a._isBuffer)}function f(a){return Object.prototype.toString.call(a)}function g(a){return!e(a)&&("function"==typeof b.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(a):!!a&&(a instanceof DataView||!!(a.buffer&&a.buffer instanceof ArrayBuffer))))}function h(a){if(u.isFunction(a)){if(x)return a.name;var b=a.toString(),c=b.match(z);return c&&c[1]}}function i(a,b){return"string"==typeof a?a.length<b?a:a.slice(0,b):a}function j(a){if(x||!u.isFunction(a))return u.inspect(a);var b=h(a);return"[Function"+(b?": "+b:"")+"]"}function k(a){return i(j(a.actual),128)+" "+a.operator+" "+i(j(a.expected),128)}function l(a,b,c,d,e){throw new y.AssertionError({message:c,actual:a,expected:b,operator:d,stackStartFunction:e})}function m(a,b){a||l(a,!0,b,"==",y.ok)}function n(a,b,c,h){if(a===b)return!0;if(e(a)&&e(b))return 0===d(a,b);if(u.isDate(a)&&u.isDate(b))return a.getTime()===b.getTime();if(u.isRegExp(a)&&u.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.lastIndex===b.lastIndex&&a.ignoreCase===b.ignoreCase;if(null!==a&&"object"==typeof a||null!==b&&"object"==typeof b){if(g(a)&&g(b)&&f(a)===f(b)&&!(a instanceof Float32Array||a instanceof Float64Array))return 0===d(new Uint8Array(a.buffer),new Uint8Array(b.buffer));if(e(a)!==e(b))return!1;h=h||{actual:[],expected:[]};var i=h.actual.indexOf(a);return-1!==i&&i===h.expected.indexOf(b)||(h.actual.push(a),h.expected.push(b),p(a,b,c,h))}return c?a===b:a==b}function o(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function p(a,b,c,d){if(null===a||void 0===a||null===b||void 0===b)return!1;if(u.isPrimitive(a)||u.isPrimitive(b))return a===b;if(c&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;var e=o(a),f=o(b);if(e&&!f||!e&&f)return!1;if(e)return a=w.call(a),b=w.call(b),n(a,b,c);var g,h,i=A(a),j=A(b);if(i.length!==j.length)return!1;for(i.sort(),j.sort(),h=i.length-1;h>=0;h--)if(i[h]!==j[h])return!1;for(h=i.length-1;h>=0;h--)if(g=i[h],!n(a[g],b[g],c,d))return!1;return!0}function q(a,b,c){n(a,b,!0)&&l(a,b,c,"notDeepStrictEqual",q)}function r(a,b){if(!a||!b)return!1;if("[object RegExp]"==Object.prototype.toString.call(b))return b.test(a);try{if(a instanceof b)return!0}catch(a){}return!Error.isPrototypeOf(b)&&!0===b.call({},a)}function s(a){var b;try{a()}catch(a){b=a}return b}function t(a,b,c,d){var e;if("function"!=typeof b)throw new TypeError('"block" argument must be a function');"string"==typeof c&&(d=c,c=null),e=s(b),d=(c&&c.name?" ("+c.name+").":".")+(d?" "+d:"."),a&&!e&&l(e,c,"Missing expected exception"+d);var f="string"==typeof d,g=!a&&u.isError(e),h=!a&&e&&!c;if((g&&f&&r(e,c)||h)&&l(e,c,"Got unwanted exception"+d),a&&e&&c&&!r(e,c)||!a&&e)throw e}var u=c(42),v=Object.prototype.hasOwnProperty,w=Array.prototype.slice,x=function(){return"foo"===function(){}.name}(),y=a.exports=m,z=/\s*function\s+([^\(\s]*)\s*/;y.AssertionError=function(a){this.name="AssertionError",this.actual=a.actual,this.expected=a.expected,this.operator=a.operator,a.message?(this.message=a.message,this.generatedMessage=!1):(this.message=k(this),this.generatedMessage=!0);var b=a.stackStartFunction||l;if(Error.captureStackTrace)Error.captureStackTrace(this,b);else{var c=new Error;if(c.stack){var d=c.stack,e=h(b),f=d.indexOf("\n"+e);if(f>=0){var g=d.indexOf("\n",f+1);d=d.substring(g+1)}this.stack=d}}},u.inherits(y.AssertionError,Error),y.fail=l,y.ok=m,y.equal=function(a,b,c){a!=b&&l(a,b,c,"==",y.equal)},y.notEqual=function(a,b,c){a==b&&l(a,b,c,"!=",y.notEqual)},y.deepEqual=function(a,b,c){n(a,b,!1)||l(a,b,c,"deepEqual",y.deepEqual)},y.deepStrictEqual=function(a,b,c){n(a,b,!0)||l(a,b,c,"deepStrictEqual",y.deepStrictEqual)},y.notDeepEqual=function(a,b,c){n(a,b,!1)&&l(a,b,c,"notDeepEqual",y.notDeepEqual)},y.notDeepStrictEqual=q,y.strictEqual=function(a,b,c){a!==b&&l(a,b,c,"===",y.strictEqual)},y.notStrictEqual=function(a,b,c){a===b&&l(a,b,c,"!==",y.notStrictEqual)},y.throws=function(a,b,c){t(!0,a,b,c)},y.doesNotThrow=function(a,b,c){t(!1,a,b,c)},y.ifError=function(a){if(a)throw a};var A=Object.keys||function(a){var b=[];for(var c in a)v.call(a,c)&&b.push(c);return b}}).call(b,function(){return this}())}]);"undefined"!=typeof module&&module.exports&&(module.exports=WGS);